(()=>{"use strict";var e={110:(e,t,n)=>{n.d(t,{A:()=>h});var r=n(928),o=n.n(r);const a=require("fs/promises");var i=n.n(a),c=n(604),s=n(818),u=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))},l=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};function d(e,t){return null==t&&(t=process.env.STATIC_PAGE_ROOT_DIR),o().join(process.env.PWD,t+"/"+e)}function f(e,t,n){return u(this,void 0,void 0,(function(){var r,o,a,c,s,u;return l(this,(function(l){switch(l.label){case 0:return[4,i().readdir(e)];case 1:r=l.sent(),o=0,a=r,l.label=2;case 2:return o<a.length?(c=a[o],s=t.concat(c),u="".concat(e,"/").concat(c),[4,i().lstat(u)]):[3,7];case 3:return l.sent().isFile()?(n.push(s.join("/")),[3,6]):[3,4];case 4:return[4,f(u,s,n)];case 5:l.sent(),l.label=6;case 6:return o++,[3,2];case 7:return[2]}}))}))}n.n(s)().config();const h={read:function(e,t){return u(void 0,void 0,void 0,(function(){var n,r;return l(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),n=d(e,t),[4,i().readFile(n,{encoding:"utf8"})];case 1:return[2,o.sent()];case 2:return r=o.sent(),c.A.log("Failed to read file",{relativeFilePath:e,err:r},"high","pink"),[2,""];case 3:return[2]}}))}))},write:function(e,t,n){return u(void 0,void 0,void 0,(function(){var r,o;return l(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),r=d(e,n),[4,i().writeFile(r,t)];case 1:return a.sent(),[3,3];case 2:return o=a.sent(),c.A.log("Failed to write file",{relativeFilePath:e,err:o},"high","pink"),[3,3];case 3:return[2]}}))}))},getAllRelativePathsInDirRecursively:function(e){return u(void 0,void 0,void 0,(function(){var t;return l(this,(function(n){switch(n.label){case 0:return[4,f(o().join(process.env.PWD,e),[],t=[])];case 1:return n.sent(),[2,t]}}))}))}}},273:(e,t,n)=>{n.r(t),n.d(t,{default:()=>r});const r={}},296:(e,t,n)=>{n.d(t,{A:()=>g});const r=require("jsonwebtoken");var o=n.n(r);const a=require("bcrypt");var i=n.n(a),c=n(484),s=n(793),u=n(563),l=n(557),d=n(818),f=n.n(d);f().config();const h=function(e,t,n,r){return o=void 0,a=void 0,c=function(){return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(o){switch(o.label){case 0:return[4,l.A.makeQuery("INSERT INTO users (userName, passwordHash, email) VALUES (?, ?, ?);",[e,t,n]).run(r)];case 1:return[2,o.sent()]}}))},new((i=void 0)||(i=Promise))((function(e,t){function n(e){try{s(c.next(e))}catch(e){t(e)}}function r(e){try{s(c.throw(e))}catch(e){t(e)}}function s(t){var o;t.done?e(t.value):(o=t.value,o instanceof i?o:new i((function(e){e(o)}))).then(n,r)}s((c=c.apply(o,a||[])).next())}));var o,a,i,c};var m=n(422),p=n(604),v=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))},b=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};f().config();var y=c.A.isDevMode(),w={register:function(e,t){return v(void 0,void 0,void 0,(function(){var n,r,o,a;return b(this,(function(c){switch(c.label){case 0:return c.trys.push([0,7,,8]),w.validateUserNameAndPassword(e,t)?null!=(n=m.A.findErrorInEmailAddress(e.body.email))?(p.A.log("Email Input Error",{email:e.body.email,emailError:n},"high","pink"),t.status(400).send(n),[2]):[4,u.A.users.withUserName(e.body.userName,t)]:[2];case 1:return r=c.sent(),t.statusCode<200||t.statusCode>=300?[2]:r&&r.length>0?(p.A.log("UserName already exists",{userName:e.body.userName,existingUser:r[0]},"high","pink"),t.status(403).send('User "'.concat(e.body.userName,'" already exists.')),[2]):[4,u.A.users.withEmail(e.body.email,t)];case 2:return r=c.sent(),t.statusCode<200||t.statusCode>=300?[2]:r&&r.length>0?(p.A.log("There is already an account with the same email",{email:e.body.email,existingUser:r[0]},"high","pink"),t.status(403).send('There is already an account with the email "'.concat(e.body.email,'".')),[2]):[4,s.A.endEmailVerification(e,t)];case 3:return c.sent(),t.statusCode<200||t.statusCode>=300?[2]:[4,i().hash(e.body.password,10)];case 4:return o=c.sent(),[4,h(e.body.userName,o,e.body.email,t)];case 5:return c.sent(),t.statusCode<200||t.statusCode>=300?[2]:[4,w.addToken(e.body.userName,t)];case 6:return c.sent(),[3,8];case 7:return a=c.sent(),p.A.log("User Registration Error",{err:a},"high","pink"),t.status(500).send("ERROR: Failed to register the user (".concat(a,").")),[3,8];case 8:return[2]}}))}))},login:function(e,t){return v(void 0,void 0,void 0,(function(){var n,r;return b(this,(function(o){switch(o.label){case 0:return o.trys.push([0,4,,5]),w.validateUserNameAndPassword(e,t)?[4,w.findExistingUserByUserName(e.body.userName,t)]:[2];case 1:return(n=o.sent())?[4,i().compare(e.body.password,n.passwordHash)]:[2];case 2:return o.sent()?[4,w.addToken(e.body.userName,t)]:(p.A.log("Wrong password",{passwordEntered:y?e.body.password:"(HIDDEN)",passwordHash:n.passwordHash},"high","pink"),t.status(401).send("Wrong password."),[2]);case 3:return o.sent(),[3,5];case 4:return r=o.sent(),p.A.log("Login Error",{err:r},"high","pink"),t.status(500).send("ERROR: Failed to login (".concat(r,").")),[3,5];case 5:return[2]}}))}))},validateUserNameAndPassword:function(e,t){var n=m.A.findErrorInUserName(e.body.userName);if(null!=n)return p.A.log("UserName Input Error",{userName:e.body.userName,userNameError:n},"high","pink"),t.status(400).send(n),!1;var r=m.A.findErrorInPassword(e.body.password);return null==r||(p.A.log("Password Input Error",{password:y?e.body.password:"(HIDDEN)",passwordError:r},"high","pink"),t.status(400).send(r),!1)},findExistingUserByUserName:function(e,t){return v(void 0,void 0,void 0,(function(){var n;return b(this,(function(r){switch(r.label){case 0:return[4,u.A.users.withUserName(e,t)];case 1:return n=r.sent(),t&&(t.statusCode<200||t.statusCode>=300)?[2,null]:n&&0!=n.length?[2,n[0]]:(p.A.log("User Not Found",{userName:e},"high","pink"),null==t||t.status(404).send('There is no account with userName "'.concat(e,'".')),[2,null])}}))}))},getUserFromReqToken:function(e,t){void 0===t&&(t=!1);var n=e.cookies.thingspool_token;return n?w.getUserFromToken(n):(t||p.A.log("Token Not Found in Request",{},"high","pink"),null)},getUserFromToken:function(e){try{return o().verify(e,process.env.JWT_SECRET_KEY)||(p.A.log("User is not found in the given token.",{token:e},"high","pink"),null)}catch(e){return p.A.log("Token Verification Failed",{err:e},"high","pink"),null}},addToken:function(e,t){return v(void 0,void 0,void 0,(function(){var n,r;return b(this,(function(a){switch(a.label){case 0:return[4,w.findExistingUserByUserName(e,t)];case 1:return(n=a.sent())?(r=o().sign(n,process.env.JWT_SECRET_KEY,{expiresIn:"60m"}),null==t||t.cookie("thingspool_token",r,{secure:!c.A.isDevMode(),httpOnly:!0,sameSite:"strict"}).status(201),[2]):(p.A.log("AddToken Tried, User Not Found",{userName:e},"high"),null==t||t.status(404).send('Tried to add token, but there is no account with userName "'.concat(e,'".')),[2])}}))}))},clearToken:function(e){e.clearCookie("thingspool_token").status(204)},authenticateToken:function(e,t,n){return v(void 0,void 0,void 0,(function(){return b(this,(function(r){switch(r.label){case 0:return[4,w.authenticateToken_internal(n,!1,e,t)];case 1:return r.sent(),[2]}}))}))},authenticateTokenOptional:function(e,t,n){return v(void 0,void 0,void 0,(function(){return b(this,(function(r){switch(r.label){case 0:return[4,w.authenticateToken_internal(n,!0,e,t)];case 1:return r.sent(),[2]}}))}))},authenticateToken_internal:function(e,t,n,r){return v(void 0,void 0,void 0,(function(){var o,a;return b(this,(function(i){switch(i.label){case 0:return(o=w.getUserFromReqToken(n))?[3,1]:t?(e(),[2,!0]):(p.A.logRaw("Token-Authentication Failed","high","pink"),null==r||r.status(401).send("Token-Authentication Failed (User Not Found)"),[2,!1]);case 1:return i.trys.push([1,3,,4]),[4,w.addToken(o.userName,r)];case 2:return i.sent(),e(),[2,!0];case 3:return a=i.sent(),t?(e(),[2,!0]):(p.A.log("Failed to add token",{err:a},"high"),null==r||r.status(401).send("Failed to add token (error: ".concat(a,")")),[2,!1]);case 4:return[2]}}))}))}};const g=w},422:(e,t,n)=>{n.d(t,{A:()=>o});const r={escapeHTMLChars:e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replaceAll("\n","<br>").replaceAll(" ","&nbsp;"),findErrorInUserName:e=>e.length<4||e.length>16?r.inputRule.userName.length:e!=r.sanitizeUserName(e)?r.inputRule.userName.chars:null,findErrorInPassword:e=>e.length<6||e.length>24?r.inputRule.password.length:e!=r.sanitizePassword(e)?r.inputRule.password.chars:null,findErrorInEmailAddress:e=>e.length>64?r.inputRule.email.length:/^[^\s@]+@[^\s@]+.[^\s@]+$/.test(e)?null:"Please enter a valid email address.",findErrorInRoomName:e=>e.length<4||e.length>64?r.inputRule.roomName.length:e!=r.sanitizeRoomName(e)?r.inputRule.roomName.chars:null,sanitizeUserName:e=>(e.length>16&&(e=e.substring(0,16)),e.replace(/[^a-zA-Z0-9_]/g,"")),sanitizePassword:e=>(e.length>24&&(e=e.substring(0,24)),e.replace(/[^a-zA-Z0-9~`!@#\$%\^&\*\(\)-_\+=\{\[\}\]\|\\:;"'<>,\.\?\/]/g,"")),sanitizeRoomName:e=>(e.length>64&&(e=e.substring(0,64)),e.replace(/[^a-zA-Z0-9~`!@#\$%\^&\*\(\)-_\+=\{\[\}\]\|\\:;"'<>,\.\?\/]/g,"").replace(/\s+/g," ").trim()),inputRule:{userName:{length:"Username must be between 4 and 16 characters long.",chars:"Username can only contain alphabets, numbers, and underbar(_)."},password:{length:"Password must be between 6 and 24 characters long.",chars:"Password can only contain alphabets, numbers, and the following special characters: ~`!@#$%^&*()-_+={}[]|\\:;\"'<>,.?/"},email:{length:"Email address must not contain more than 64 characters."},roomName:{length:"Room name must be between 4 and 64 characters long.",chars:"Room name can only contain alphabets, numbers, spaces, and the following special characters: ~`!@#$%^&*()-_+={}[]|\\:;\"'<>,.?/"}}},o=r},482:(e,t,n)=>{n.d(t,{A:()=>s});var r,o=n(273),a=n(604),i="</td>",c=function(e,t,n){return"".concat('<td style="color: #e0e020; background-color: #202090;">').concat(e).concat(i).concat('<td style="color: #20e020; background-color: #101010;">').concat(t).concat(i).concat('<td style="color: #303030; background-color: #c0c0c0;">').concat(n).concat(i)};const s={init:function(e){r=e.of("/console").on("connection",(function(e){console.log("(consoleIO) Client connected"),e.on("command",(function(e){console.log("(consoleIO) Command received: [".concat(e,"]"));var t=e.split(" ");switch(t[0]){case"test":t.shift(),0==t.length?a.A.logRaw("Please provide the name of the test.","high","pink"):o.default.test(t[0],1==t.length?"low":t[1]);break;case"print":t.shift(),r.emit("log",c(0==t.length?"-":t.join(" "),"-","-"));break;case"reboot":r.emit("log",c("Rebooting...","-","-")),process.exit(0);break;default:r.emit("log",c("ERROR: Unknown Command","-","-"))}})),e.on("disconnect",(function(){console.log("(consoleIO) Client disconnected")}))}))},log:function(e,t,n){r?r.emit("log",c(e,t,n)):console.log("".concat(e,"\n(ORIGIN: ").concat(t,")\n(DETAILS: ").concat(n,")"))}}},484:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(818);n.n(r)().config();const o={getRootURL:function(){switch(process.env.MODE){case"dev":return"http://localhost:".concat(process.env.PORT);case"prod":return process.env.ROOT_URL;default:return console.error("Unknown mode :: ".concat(process.env.MODE)),"_ERROR_"}},isDevMode:function(){return"dev"==process.env.MODE}}},557:(e,t,n)=>{n.d(t,{A:()=>g});const r=require("mysql2/promise");var o=n.n(r),a=n(484),i=n(110),c=n(604),s=n(422),u=n(818),l=n.n(u),d=function(){function e(e,t,n){this.pool=e,this.queryStr=t,this.queryParams=n}return e.prototype.run=function(e){return t=this,n=void 0,o=function(){var t,n,r;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this.pool.query(this.queryStr,this.queryParams)];case 1:return t=o.sent(),n=t[0],t[1],c.A.log("SQL Query Succeeded",{queryStr:this.queryStr,queryParams:this.queryParams},"medium"),null==e||e.status(202),[2,n];case 2:return r=o.sent(),c.A.log("SQL Query Error",{err:r},"high","pink"),null==e||e.status(500).send(r),[2,[]];case 3:return[2]}}))},new((r=void 0)||(r=Promise))((function(e,a){function i(e){try{s(o.next(e))}catch(e){a(e)}}function c(e){try{s(o.throw(e))}catch(e){a(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(i,c)}s((o=o.apply(t,n||[])).next())}));var t,n,r,o},e}();const f=d;var h=function(){function e(e,t){this.pool=e,this.queries=t}return e.prototype.run=function(e){return t=this,n=void 0,o=function(){var t,n,r,o,a,i,s,u,l;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(d){switch(d.label){case 0:c.A.log("SQL Transaction Began",{numQueries:this.queries.length},"low"),t=void 0,n=!1,r=0,d.label=1;case 1:return d.trys.push([1,11,13,14]),[4,this.pool.getConnection()];case 2:return[4,(t=d.sent()).beginTransaction()];case 3:d.sent(),o=0,a=this.queries,d.label=4;case 4:return o<a.length?(i=a[o],r++,[4,null==t?void 0:t.query(i.queryStr,i.queryParams)]):[3,9];case 5:return s=d.sent(),u=s[0],s[1],0!=u.affectedRows?[3,7]:[4,null==t?void 0:t.rollback()];case 6:return d.sent(),c.A.log("SQL Transaction Query Made No Change",{progress:"".concat(r,"/").concat(this.queries.length),query:i},"high"),null==e||e.status(403),[2];case 7:c.A.log("SQL Transaction Query Succeeded",{progress:"".concat(r,"/").concat(this.queries.length),query:i},"low"),d.label=8;case 8:return o++,[3,4];case 9:return[4,null==t?void 0:t.commit()];case 10:return d.sent(),c.A.logRaw("SQL Transaction Committed","medium"),n=!0,[3,14];case 11:return l=d.sent(),c.A.log("SQL Transaction Error",{progress:"".concat(r,"/").concat(this.queries.length),err:l},"high","pink"),[4,null==t?void 0:t.rollback()];case 12:return d.sent(),null==e||e.status(500).send(l),[3,14];case 13:return null==t||t.release(),n&&(null==e||e.status(202)),[7];case 14:return[2]}}))},new((r=void 0)||(r=Promise))((function(e,a){function i(e){try{s(o.next(e))}catch(e){a(e)}}function c(e){try{s(o.throw(e))}catch(e){a(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(i,c)}s((o=o.apply(t,n||[])).next())}));var t,n,r,o},e}();const m=h;var p=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))},v=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};l().config();var b=a.A.isDevMode(),y=o().createPool({host:b?process.env.SQL_HOST_DEV:process.env.SQL_HOST_PROD,user:b?process.env.SQL_USER_DEV:process.env.SQL_USER_PROD,password:b?process.env.SQL_PASS_DEV:process.env.SQL_PASS_PROD,database:"main",waitForConnections:!0,connectionLimit:10,queueLimit:0,enableKeepAlive:!0,keepAliveInitialDelay:0}),w={makeQuery:function(e,t){return new f(y,e,t)},makeTransaction:function(e){return new m(y,e)},runSQLFile:function(e){return p(void 0,void 0,void 0,(function(){var t,n,r,a,s,u,l;return v(this,(function(d){switch(d.label){case 0:return c.A.log("Opening SQL File",{fileName:e},"high"),[4,i.A.read(e,"sql")];case 1:t=d.sent(),n=t.split(";").map((function(e){return e.trim()+";"})).filter((function(e){return e.length>1})),r=void 0,d.label=2;case 2:return d.trys.push([2,8,9,10]),[4,o().createConnection({host:b?process.env.SQL_HOST_DEV:process.env.SQL_HOST_PROD,user:b?process.env.SQL_USER_DEV:process.env.SQL_USER_PROD,password:b?process.env.SQL_PASS_DEV:process.env.SQL_PASS_PROD})];case 3:null==(r=d.sent())||r.connect(),a=0,s=n,d.label=4;case 4:return a<s.length?(u=s[a],[4,null==r?void 0:r.query(u)]):[3,7];case 5:d.sent(),d.label=6;case 6:return a++,[3,4];case 7:return[3,10];case 8:return l=d.sent(),c.A.log("SQL File Execution Error",{err:l},"high","pink"),[3,10];case 9:return null==r||r.end(),[7];case 10:return[2]}}))}))},toHTMLString:function(){return p(void 0,void 0,void 0,(function(){var e,t,n,r,o,a,i,c,u,l;return v(this,(function(d){switch(d.label){case 0:return t=function(e){return s.A.escapeHTMLChars(JSON.stringify(e,null,4))},n=(e=function(e){return"\n\n<h1>".concat(e,"</h1>\n")})("users"),r=t,[4,w.makeQuery("SELECT * FROM users;").run()];case 1:return o=n+r.apply(void 0,[d.sent()])+e("rooms"),a=t,[4,w.makeQuery("SELECT * FROM rooms;").run()];case 2:return i=o+a.apply(void 0,[d.sent()])+e("user_rooms"),c=t,[4,w.makeQuery("SELECT * FROM user_rooms;").run()];case 3:return u=i+c.apply(void 0,[d.sent()])+e("emailVerifications"),l=t,[4,w.makeQuery("SELECT * FROM emailVerifications;").run()];case 4:return[2,u+l.apply(void 0,[d.sent()])]}}))}))}};const g=w},563:(e,t,n)=>{n.d(t,{A:()=>l});var r=n(557),o=n(848),a=n(818),i=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))},c=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};n.n(a)().config();var s=function(e,t){var n=o.A.search.searchLimitPerPage,r=" AND (".concat(e.map((function(e){return"user_rooms.userStatus = '".concat(e,"'")})).join(" OR "),")");return"SELECT rooms.roomID AS roomID, rooms.roomName AS roomName, user_rooms.userStatus as userStatus, rooms.ownerUserName as ownerUserName\n    FROM rooms INNER JOIN user_rooms ON user_rooms.roomID = rooms.roomID\n    WHERE user_rooms.userID = ?".concat(e.length>0?r:"","\n    ORDER BY rooms.roomID DESC LIMIT ").concat(n,", ").concat(t*n,";")},u=function(e,t){var n=o.A.search.searchLimitPerPage,r=" AND (".concat(e.map((function(e){return"user_rooms.userStatus = '".concat(e,"'")})).join(" OR "),")");return"SELECT users.userID as userID, users.userName AS userName, user_rooms.userStatus as userStatus\n    FROM users INNER JOIN user_rooms ON user_rooms.userID = users.userID\n    WHERE user_rooms.roomID = ?".concat(e.length>0?r:"","\n    ORDER BY users.userID DESC LIMIT ").concat(n,", ").concat(t*n,";")};const l={rooms:{withRoomName:function(e,t){return i(void 0,void 0,void 0,(function(){return c(this,(function(n){switch(n.label){case 0:return[4,r.A.makeQuery("SELECT * FROM rooms WHERE roomName = ?;",[e]).run(t)];case 1:return[2,n.sent()]}}))}))},whichIOwn:function(e,t,n){return i(void 0,void 0,void 0,(function(){return c(this,(function(o){switch(o.label){case 0:return[4,r.A.makeQuery(s(["owner"],t),[e]).run(n)];case 1:return[2,o.sent()]}}))}))},whichIJoined:function(e,t,n){return i(void 0,void 0,void 0,(function(){return c(this,(function(o){switch(o.label){case 0:return[4,r.A.makeQuery(s(["member"],t),[e]).run(n)];case 1:return[2,o.sent()]}}))}))},whichInvitedMe:function(e,t,n){return i(void 0,void 0,void 0,(function(){return c(this,(function(o){switch(o.label){case 0:return[4,r.A.makeQuery(s(["invited"],t),[e]).run(n)];case 1:return[2,o.sent()]}}))}))},whichIRequestedToJoin:function(e,t,n){return i(void 0,void 0,void 0,(function(){return c(this,(function(o){switch(o.label){case 0:return[4,r.A.makeQuery(s(["requested"],t),[e]).run(n)];case 1:return[2,o.sent()]}}))}))},whichIAmPendingToJoin:function(e,t,n){return i(void 0,void 0,void 0,(function(){return c(this,(function(o){switch(o.label){case 0:return[4,r.A.makeQuery(s(["invited","requested"],t),[e]).run(n)];case 1:return[2,o.sent()]}}))}))},whichIAmAssociatedWith:function(e,t,n){return i(void 0,void 0,void 0,(function(){return c(this,(function(o){switch(o.label){case 0:return[4,r.A.makeQuery(s([],t),[e]).run(n)];case 1:return[2,o.sent()]}}))}))},others:function(e,t,n){return i(void 0,void 0,void 0,(function(){var a;return c(this,(function(i){switch(i.label){case 0:return a=o.A.search.searchLimitPerPage,[4,r.A.makeQuery("SELECT roomID, roomName FROM rooms\n                WHERE NOT EXISTS (SELECT roomID FROM user_rooms WHERE userID = ".concat(e," LIMIT 1)\n                ORDER BY roomID DESC LIMIT ").concat(a,", ").concat(t*a,";"),void 0).run(n)];case 1:return[2,i.sent()]}}))}))}},users:{withUserName:function(e,t){return i(void 0,void 0,void 0,(function(){return c(this,(function(n){switch(n.label){case 0:return[4,r.A.makeQuery("SELECT * FROM users WHERE userName = ?;",[e]).run(t)];case 1:return[2,n.sent()]}}))}))},withEmail:function(e,t){return i(void 0,void 0,void 0,(function(){return c(this,(function(n){switch(n.label){case 0:return[4,r.A.makeQuery("SELECT * FROM users WHERE email = ?;",[e]).run(t)];case 1:return[2,n.sent()]}}))}))},whoJoinedRoom:function(e,t,n){return i(void 0,void 0,void 0,(function(){return c(this,(function(o){switch(o.label){case 0:return[4,r.A.makeQuery(u(["member"],t),[e]).run(n)];case 1:return[2,o.sent()]}}))}))},whoAreInvitedToJoinRoom:function(e,t,n){return i(void 0,void 0,void 0,(function(){return c(this,(function(o){switch(o.label){case 0:return[4,r.A.makeQuery(u(["invited"],t),[e]).run(n)];case 1:return[2,o.sent()]}}))}))},whoRequestedToJoinRoom:function(e,t,n){return i(void 0,void 0,void 0,(function(){return c(this,(function(o){switch(o.label){case 0:return[4,r.A.makeQuery(u(["requested"],t),[e]).run(n)];case 1:return[2,o.sent()]}}))}))},whoArePendingToJoinRoom:function(e,t,n){return i(void 0,void 0,void 0,(function(){return c(this,(function(o){switch(o.label){case 0:return[4,r.A.makeQuery(u(["invited","requested"],t),[e]).run(n)];case 1:return[2,o.sent()]}}))}))},whoAreAssociatedWithRoom:function(e,t,n){return i(void 0,void 0,void 0,(function(){return c(this,(function(o){switch(o.label){case 0:return[4,r.A.makeQuery(u([],t),[e]).run(n)];case 1:return[2,o.sent()]}}))}))},others:function(e,t,n){return i(void 0,void 0,void 0,(function(){var a;return c(this,(function(i){switch(i.label){case 0:return a=o.A.search.searchLimitPerPage,[4,r.A.makeQuery("SELECT userID, userName FROM users\n                WHERE NOT EXISTS (SELECT userID FROM user_rooms WHERE roomID = ".concat(e," LIMIT 1)\n                ORDER BY userID DESC LIMIT ").concat(a,", ").concat(t*a,";"),void 0).run(n)];case 1:return[2,i.sent()]}}))}))}}}},604:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(482),o={thresholdLogLevel:0,setThresholdLogLevel:function(e){o.thresholdLogLevel=isNaN(e)?o.getLogLevelFromName(e):e},getThresholdLogLevel:function(){return o.thresholdLogLevel},getLogLevelFromName:function(e){switch(e){case"low":return 0;case"medium":return 1;case"high":return 2;default:console.error('ERROR: Unknown log level name ("'.concat(e,'")'))}return 0},log:function(e,t,n,a){void 0===t&&(t=void 0),void 0===n&&(n="high");var i="";null!=t&&(i=JSON.stringify(t));var c=o.getFuncCallPath(5,2);o.getLogLevelFromName(n)>=o.thresholdLogLevel&&r.A.log((a?'<b style="color:'.concat(a,'">'):"")+e+(a?"</b>":""),c,i)},logRaw:function(e,t,n){void 0===t&&(t="high"),o.log(e,void 0,t,n)},getFuncCallPath:function(e,t){void 0===e&&(e=1),void 0===t&&(t=1);var n={};Error.captureStackTrace(n);for(var r=n.stack.match(/((at Object\.)|(at async Object\.))[\w]+\s/g).map((function(e){return e.replace(/(at Object\.)|(at async Object\.)/g,"").trim()})),o=0;o<t;++o)r.shift();for(;r.length>e;)r.pop();return r.join(" <- ")}};const a=o},611:e=>{e.exports=require("http")},718:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Q});var r=n(484),o=n(557),a=n(848),i=n(611),c=n.n(i),s=n(604),u=n(296);const l={limitPropValueTextSize:(e,t,n)=>{const r=l.deepCopyObj(e);return l.limitPropValueTextSize_internal(r,t,n),r},limitPropValueTextSize_internal:(e,t,n)=>{for(const[r,o]of Object.entries(e)){if(r==t){if("string"!=typeof o)throw new Error(`Property "${t}" is not a string. (obj = ${JSON.stringify(e)})`);const a=o.substring(0,n);return void(e[r]=a.length<o.length?a+"...":a)}o.constructor==Object&&l.limitPropValueTextSize_internal(o,t,n)}},deepCopyObj:e=>{const t={};for(const[n,r]of Object.entries(e))if(Array.isArray(r)){const e=new Array(r.length);for(let t=0;t<r.length;++t)e[t]=r[t];t[n]=e}else r.constructor==Object?t[n]=l.deepCopyObj(r):t[n]=r;return t}},d=l;var f=n(818),h=n.n(f);h().config();var m={},p=function(e,t,n){void 0===n&&(n=void 0),s.A.log(t,n,"high","pink");var r="";null!=n&&(r=" :: "+JSON.stringify(n)),e("[".concat(t,"]").concat(r))},v={_reset:function(){m={}},makeRequest:function(e,t,n,r,o){return void 0===o&&(o=!0),new Promise((function(a,i){var l={"Content-Type":"application/json"};if(e){var f=m[e];if(!f)return void p(i,"Token Not Found (".concat(n,")"),{senderUserName:e});l.Cookie="thingspool_token=".concat(f,";")}var h={host:"localhost",port:process.env.PORT,path:n,method:t,headers:l},b=c().request(h,(function(e){if(v.resOk(e)){s.A.log("Res Callback (".concat(n,")"),{statusCode:e.statusCode},"low");var t="";e.setEncoding("utf8"),e.on("data",(function(r){v.resOk(e)?(s.A.log("Res Data (".concat(n,")"),{statusCode:e.statusCode,chunk:r},"low"),t+=r):p(i,"Res Data ERROR (".concat(n,")"),{statusCode:e.statusCode,chunk:r})})),e.on("end",(function(){v.resOk(e)?(s.A.log("Res End (".concat(n,")"),{statusCode:e.statusCode,data:t},"low"),o&&function(e,t){var n=t.headers["set-cookie"];if(n){for(var r=!1,o=0,a=n.map((function(e){return e.trim().split("=")}));o<a.length;o++){var i=a[o];if("thingspool_token"==i[0]){var c=i[1],l=u.A.getUserFromToken(c);if(!l)return;var d=l.userName;m[d]=c;var f=c.substring(0,20);s.A.log("Token Cached (".concat(d,")"),{token:f.length<c.length?f+"...":c},"low"),r=!0}}r||s.A.log("Token Cache Failed",{setCookie:n},"high","pink")}}(0,e),a({res:e,data:t})):p(i,"Res End ERROR (".concat(n,")"),{statusCode:e.statusCode,data:t})})),e.on("error",(function(e){return p(i,"Res Exception (".concat(n,")"),{err:e})}))}else p(i,"Res Callback ERROR (".concat(n,")"),{statusCode:e.statusCode})}));b.on("error",(function(e){return p(i,"Req Exception (".concat(n,")"),{err:e})})),r&&b.write(JSON.stringify(r)),b.end(),s.A.log("Req Sent (".concat(n,")"),{options:d.limitPropValueTextSize(h,"Cookie",40),body:r},"high")}))},resOk:function(e){return e.statusCode?e.statusCode>=200&&e.statusCode<300:(s.A.log("Res statusCode is undefined.",{},"high","pink"),!1)}};const b=v;var y=n(422),w={},g={},E={},k={},N=function(e,t){return e.ownerUserName==t.userName},A={_reset:function(){w={},g={},E={},k={}},toString:function(){return JSON.stringify({users:w,rooms:g,user_rooms:E},null,4)},toHTMLString:function(){var e=function(e){return"\n\n<h1>".concat(e,"</h1>\n")},t=function(e){return y.A.escapeHTMLChars(JSON.stringify(e,null,4))};return e("users")+t(w)+e("rooms")+t(g)+e("user_rooms")+t(E)+e("emailVerifications")+t(k)},insertUser:function(e){return null==w[e.userName]&&(w[e.userName]=e,!0)},deleteUser:function(e){return null!=w[e.userName]&&(delete w[e.userName],!0)},insertEmailVerification:function(e){return null==k[e.email]&&(k[e.email]=e,!0)},deleteEmailVerification:function(e){return null!=k[e.email]&&(delete k[e.email],!0)},insertRoom:function(e,t){return null!=w[t.userName]&&null==g[e.roomName]&&(e.ownerUserName=t.userName,g[e.roomName]=e,!!A.insertUserRoom({roomName:e.roomName,userName:t.userName,userStatus:"owner"},t)||(s.A.log("Error: insertRoom succeeded but insertUserRoom failed.",{room:e,roomOwner:t},"high","pink"),e.ownerUserName="",delete g[e.roomName],!1))},deleteRoom:function(e,t){if(null!=w[t.userName]&&null!=g[e.roomName]&&N(e,t)){e.ownerUserName="",delete g[e.roomName];var n=[];Object.values(E).filter((function(t){return t.roomName==e.roomName})).map((function(e){return"".concat(e.roomName," :: ").concat(e.userName)})).forEach((function(e){return n.push(e)}));for(var r=0,o=n;r<o.length;r++){var a=o[r];delete E[a]}return!0}return!1},insertUserRoom:function(e,t){var n="".concat(e.roomName," :: ").concat(e.userName);return!(null==w[t.userName]||null!=E[n]||"invited"!=e.userStatus&&"requested"!=e.userStatus&&("owner"!=e.userStatus||e.userName!=t.userName)||null==g[e.roomName]||!N(g[e.roomName],t)||(E[n]=e,0))},updateUserRoomStatus:function(e,t){var n="".concat(e.roomName," :: ").concat(e.userName);return!(null==w[t.userName]||null==E[n]||!("invited"==E[n].userStatus&&"member"==e.userStatus||"requested"==E[n].userStatus&&"member"==e.userStatus)||null==g[e.roomName]||!N(g[e.roomName],t)||(E[n]=e,0))},deleteUserRoom:function(e,t){var n="".concat(e.roomName," :: ").concat(e.userName);return!(null==w[t.userName]||null==E[n]||E[n].userStatus!=e.userStatus||null==g[e.roomName]||!N(g[e.roomName],t)||(delete E[n],0))}};const S=A;var T=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))},R=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},x="/api/auth/";const I={initUser:function(e){return T(void 0,void 0,void 0,(function(){var t;return R(this,(function(n){switch(n.label){case 0:return S.insertUser(e)?(s.A.log("testActions_auth.initUser",{userName:e.userName},"high","cyan"),[4,(r=e.email,T(void 0,void 0,void 0,(function(){var e,t;return R(this,(function(n){switch(n.label){case 0:return[4,b.makeRequest(null,"POST","".concat(x,"vemail"),{email:r},!1)];case 1:return e=n.sent(),t=e.data,S.insertEmailVerification({email:r,verificationCode:t,expirationTime:Math.floor(.001*Date.now())+a.A.auth.emailVerificationTimeoutInSeconds}),[2,t]}}))})))]):[2];case 1:return t=n.sent(),s.A.logRaw("Verification Code = ".concat(t),"low"),[4,b.makeRequest(null,"POST","".concat(x,"register"),{userName:e.userName,password:e.password,email:e.email,verificationCode:t})];case 2:return n.sent(),[2]}var r}))}))}};var L=n(563),D=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))},O=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},P="/api/room/",U=function(e,t,n,r,o){return D(void 0,void 0,void 0,(function(){var a,i,c,s,u,l;return O(this,(function(d){switch(d.label){case 0:return[4,L.A.rooms.withRoomName(n.roomName)];case 1:return a=d.sent(),o?[4,L.A.users.withUserName(o.userName)]:[3,3];case 2:return c=d.sent(),[3,4];case 3:c=void 0,d.label=4;case 4:return i=c,s=a&&0!=a.length?a[0].roomID:Math.floor(1e3*Math.random()),u=i&&0!=i.length?i[0].userID:Math.floor(1e3*Math.random()),l={roomID:s,userID:u},[4,b.makeRequest(r.userName,e,"".concat(P).concat(t),l)];case 5:return d.sent(),[2]}}))}))};const _={create:function(e,t){return D(void 0,void 0,void 0,(function(){return O(this,(function(n){switch(n.label){case 0:return S.insertRoom(e,t)?(s.A.log("testActions_room.create",{roomName:e.roomName,userName:t.userName},"high","cyan"),[4,b.makeRequest(t.userName,"POST","".concat(P,"create"),{roomName:e.roomName})]):[2];case 1:return n.sent(),[2]}}))}))},delete:function(e,t){return D(void 0,void 0,void 0,(function(){return O(this,(function(n){switch(n.label){case 0:return S.deleteRoom(e,t)?(s.A.log("testActions_room.delete",{roomName:e.roomName,userName:t.userName},"high","cyan"),[4,U("DELETE","delete",e,t)]):[2];case 1:return n.sent(),[2]}}))}))},leave:function(e,t){return D(void 0,void 0,void 0,(function(){return O(this,(function(n){switch(n.label){case 0:return S.deleteUserRoom({roomName:e.roomName,userName:t.userName,userStatus:"member"},t)?(s.A.log("testActions_room.leave",{roomName:e.roomName,userName:t.userName},"high","cyan"),[4,U("DELETE","leave",e,t)]):[2];case 1:return n.sent(),[2]}}))}))},acceptInvitation:function(e,t,n){return D(void 0,void 0,void 0,(function(){return O(this,(function(r){switch(r.label){case 0:return S.updateUserRoomStatus({roomName:e.roomName,userName:n.userName,userStatus:"member"},t)?(s.A.log("testActions_room.acceptInvitation",{roomName:e.roomName,ownerUserName:t.userName,userName:n.userName},"high","cyan"),[4,U("PUT","accept-invitation",e,n)]):[2];case 1:return r.sent(),[2]}}))}))},ignoreInvitation:function(e,t,n){return D(void 0,void 0,void 0,(function(){return O(this,(function(r){switch(r.label){case 0:return S.deleteUserRoom({roomName:e.roomName,userName:n.userName,userStatus:"invited"},t)?(s.A.log("testActions_room.ignoreInvitation",{roomName:e.roomName,ownerUserName:t.userName,userName:n.userName},"high","cyan"),[4,U("DELETE","ignore-invitation",e,n)]):[2];case 1:return r.sent(),[2]}}))}))},requestToJoin:function(e,t,n){return D(void 0,void 0,void 0,(function(){return O(this,(function(r){switch(r.label){case 0:return S.insertUserRoom({roomName:e.roomName,userName:n.userName,userStatus:"requested"},t)?(s.A.log("testActions_room.requestToJoin",{roomName:e.roomName,ownerUserName:t.userName,userName:n.userName},"high","cyan"),[4,U("POST","request-to-join",e,n)]):[2];case 1:return r.sent(),[2]}}))}))},cancelRequest:function(e,t,n){return D(void 0,void 0,void 0,(function(){return O(this,(function(r){switch(r.label){case 0:return S.deleteUserRoom({roomName:e.roomName,userName:n.userName,userStatus:"requested"},t)?(s.A.log("testActions_room.cancelRequest",{roomName:e.roomName,ownerUserName:t.userName,userName:n.userName},"high","cyan"),[4,U("DELETE","cancel-request",e,n)]):[2];case 1:return r.sent(),[2]}}))}))},invite:function(e,t,n){return D(void 0,void 0,void 0,(function(){return O(this,(function(r){switch(r.label){case 0:return S.insertUserRoom({roomName:e.roomName,userName:n.userName,userStatus:"invited"},t)?(s.A.log("testActions_room.invite",{roomName:e.roomName,ownerUserName:t.userName,userName:n.userName},"high","cyan"),[4,U("POST","invite",e,t,n)]):[2];case 1:return r.sent(),[2]}}))}))},cancelInvite:function(e,t,n){return D(void 0,void 0,void 0,(function(){return O(this,(function(r){switch(r.label){case 0:return S.deleteUserRoom({roomName:e.roomName,userName:n.userName,userStatus:"invited"},t)?(s.A.log("testActions_room.cancelInvite",{roomName:e.roomName,ownerUserName:t.userName,userName:n.userName},"high","cyan"),[4,U("DELETE","cancel-invite",e,t,n)]):[2];case 1:return r.sent(),[2]}}))}))},acceptRequest:function(e,t,n){return D(void 0,void 0,void 0,(function(){return O(this,(function(r){switch(r.label){case 0:return S.updateUserRoomStatus({roomName:e.roomName,userName:n.userName,userStatus:"member"},t)?(s.A.log("testActions_room.acceptRequest",{roomName:e.roomName,ownerUserName:t.userName,userName:n.userName},"high","cyan"),[4,U("PUT","accept-request",e,t,n)]):[2];case 1:return r.sent(),[2]}}))}))},ignoreRequest:function(e,t,n){return D(void 0,void 0,void 0,(function(){return O(this,(function(r){switch(r.label){case 0:return S.deleteUserRoom({roomName:e.roomName,userName:n.userName,userStatus:"requested"},t)?(s.A.log("testActions_room.ignoreRequest",{roomName:e.roomName,ownerUserName:t.userName,userName:n.userName},"high","cyan"),[4,U("DELETE","ignore-request",e,t,n)]):[2];case 1:return r.sent(),[2]}}))}))},kickout:function(e,t,n){return D(void 0,void 0,void 0,(function(){return O(this,(function(r){switch(r.label){case 0:return S.deleteUserRoom({roomName:e.roomName,userName:n.userName,userStatus:"member"},t)?(s.A.log("testActions_room.kickout",{roomName:e.roomName,ownerUserName:t.userName,userName:n.userName},"high","cyan"),[4,U("DELETE","kickout",e,t,n)]):[2];case 1:return r.sent(),[2]}}))}))}},j=I;const C={room:function(){return e=void 0,t=void 0,r=function(){var e,t,n,r,o,a,i,c,u,l;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(d){switch(d.label){case 0:for(e=12,t=4,n=[],a=0;a<e;++a)n.push({userName:"testUser_".concat(a),password:"testPass_".concat(a),email:"test_email_".concat(a,"@test.com")});for(r=[],a=0;a<t;++a)r.push({roomName:"testRoom ".concat(a),ownerUserName:""});a=0,d.label=1;case 1:return a<e?[4,j.initUser(n[a])]:[3,4];case 2:d.sent(),d.label=3;case 3:return++a,[3,1];case 4:o=Object.values(_),a=0,d.label=5;case 5:if(!(a<300))return[3,10];i=Math.floor(Math.random()*e),c=Math.floor(Math.random()*e),u=Math.floor(Math.random()*t),l=Math.floor(Math.random()*o.length),s.A.log("RANDOM ACTION: ".concat(a),{action:o[l].name,roomName:r[u].roomName,userName1:n[i].userName,userName2:n[c].userName},"low"),d.label=6;case 6:return d.trys.push([6,8,,9]),[4,o[l](r[u],n[i],n[c])];case 7:case 8:return d.sent(),[3,9];case 9:return++a,[3,5];case 10:return[2]}}))},new((n=void 0)||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}));var e,t,n,r}};var F=n(273);h().config();var M=!1;function q(e,t){return n=this,i=void 0,u=function(){var n,i,c;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(u){switch(u.label){case 0:return r.A.isDevMode()?M?(s.A.logRaw("TEST REJECTED (".concat(e,") - There is another test running."),"high","pink"),[2]):(s.A.logRaw("TEST STARTED (".concat(e,")"),"high"),M=!0,b._reset(),S._reset(),n=a.A.auth.bypassEmailVerification,a.A.auth.bypassEmailVerification=!0,i=s.A.getThresholdLogLevel(),s.A.setThresholdLogLevel(t),[4,o.A.runSQLFile("clear.sql")]):(s.A.logRaw("TEST REJECTED (".concat(e,") - You are not allowed to run tests on a non-dev mode."),"high","pink"),[2]);case 1:return u.sent(),[4,o.A.runSQLFile("init.sql")];case 2:return u.sent(),(c=C[e])?[4,c()]:(s.A.logRaw('Test routine "'.concat(e,'" not found.'),"high","pink"),[2]);case 3:return u.sent(),s.A.setThresholdLogLevel(i),a.A.auth.bypassEmailVerification=n,M=!1,s.A.logRaw("TEST ENDED (".concat(e,")"),"high"),[2]}}))},new((c=void 0)||(c=Promise))((function(e,t){function r(e){try{a(u.next(e))}catch(e){t(e)}}function o(e){try{a(u.throw(e))}catch(e){t(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof c?n:new c((function(e){e(n)}))).then(r,o)}a((u=u.apply(n,i||[])).next())}));var n,i,c,u}const Q=q;F.default.test=q},793:(e,t,n)=>{n.d(t,{A:()=>y});const r=require("crypto");var o=n.n(r);const a=require("nodemailer");var i=n.n(a),c=n(557),s=n(818),u=n.n(s),l=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))},d=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};u().config();const f={selectByEmail:function(e,t){return l(void 0,void 0,void 0,(function(){return d(this,(function(n){switch(n.label){case 0:return[4,c.A.makeQuery("SELECT * FROM emailVerifications WHERE email = ?;",[e]).run(t)];case 1:return[2,n.sent()]}}))}))},insert:function(e,t,n,r){return l(void 0,void 0,void 0,(function(){return d(this,(function(o){switch(o.label){case 0:return[4,c.A.makeQuery("INSERT INTO emailVerifications (email, verificationCode, expirationTime) VALUES (?, ?, ?);",[e,t,n.toString()]).run(r)];case 1:return o.sent(),[2]}}))}))},updateExpirationTime:function(e,t,n){return l(void 0,void 0,void 0,(function(){return d(this,(function(r){switch(r.label){case 0:return[4,c.A.makeQuery("UPDATE emailVerifications SET expirationTime = ? WHERE email = ?;",[t.toString(),e]).run(n)];case 1:return r.sent(),[2]}}))}))},deleteExpired:function(e,t){return l(void 0,void 0,void 0,(function(){return d(this,(function(n){switch(n.label){case 0:return[4,c.A.makeQuery("DELETE FROM emailVerifications WHERE expirationTime < ?;",[e.toString()]).run(t)];case 1:return n.sent(),[2]}}))}))}};var h=n(422),m=n(604),p=n(848),v=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))},b=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};u().config();const y={startEmailVerification:function(e,t){return v(void 0,void 0,void 0,(function(){var n,r,a,c,s,u,l;return b(this,(function(d){switch(d.label){case 0:return d.trys.push([0,9,,10]),[4,f.deleteExpired(Math.floor(.001*Date.now()),t)];case 1:return d.sent(),t.statusCode<200||t.statusCode>=300?[2]:null!=(n=h.A.findErrorInEmailAddress(e.body.email))?(m.A.log("Email Input Error",{email:e.body.email,emailError:n},"high","pink"),t.status(400).send(n),[2]):[4,f.selectByEmail(e.body.email,t)];case 2:return r=d.sent(),t.statusCode<200||t.statusCode>=300?[2]:r&&r.length>0?(m.A.log("Email is already undergoing verification",{email:e.body.email},"high","pink"),t.status(403).send('Email "'.concat(e.body.email,'" is already undergoing verification.')),[2]):(a=new Array(8).fill(null).map((function(){return"0123456789".charAt(o().randomInt(10))})).join(""),[4,f.insert(e.body.email,a,Math.floor(.001*Date.now())+p.A.auth.emailVerificationTimeoutInSeconds,t)]);case 3:return d.sent(),t.statusCode<200||t.statusCode>=300?[2]:p.A.auth.bypassEmailVerification?(m.A.log("Email transmission bypassed",{email:e.body.email},"low"),t.status(201).send(a),[3,8]):[3,4];case 4:return c=i().createTransport({service:"naver",host:"smtp.naver.com",port:587,secure:!1,requireTLS:!0,auth:{user:"pinkroom77@naver.com",pass:process.env.EMAIL_SENDER_PASS},tls:{rejectUnauthorized:!1}}),s={from:"pinkroom77@naver.com",to:e.body.email,subject:"Here is your email verification code.",text:"Your verification code is ".concat(a)},[4,c.sendMail(s)];case 5:return u=d.sent(),c.close(),u.accepted?(m.A.log("Email sent",{email:e.body.email},"low"),t.sendStatus(201),[3,8]):[3,6];case 6:return m.A.log("Email failed to be sent",{email:e.body.email},"high","pink"),[4,f.updateExpirationTime(e.body.email,Math.floor(.001*Date.now())+120,t)];case 7:if(d.sent(),t.statusCode<200||t.statusCode>=300)return[2];t.status(500).send('Error while sending the verification code to "'.concat(e.body.email,'". Please try again after 2 minutes.')),d.label=8;case 8:return[3,10];case 9:return l=d.sent(),m.A.log("Email Verification Start Error",{err:l},"high","pink"),t.status(500).send("ERROR: Failed to start email verification (".concat(l,").")),[3,10];case 10:return[2]}}))}))},endEmailVerification:function(e,t){return v(void 0,void 0,void 0,(function(){var n,r,o;return b(this,(function(a){switch(a.label){case 0:return null!=(n=h.A.findErrorInEmailAddress(e.body.email))?(m.A.log("Email Input Error",{email:e.body.email,emailError:n},"high","pink"),t.status(400).send(n),[2]):(r=e.body.verificationCode,[4,f.selectByEmail(e.body.email,t)]);case 1:return o=a.sent(),t.statusCode<200||t.statusCode>=300?[2]:o&&0!=o.length?o[0].verificationCode!=r?(m.A.log("Verification Code Mismatch (code entered = '".concat(r,"')"),{email:e.body.email,actualCode:o[0].verificationCode,enteredCode:r},"high","pink"),t.status(403).send('Wrong verification code for email "'.concat(e.body.email,'".')),[2]):(t.status(202),[2]):(m.A.log("No pending email verification found",{email:e.body.email},"high","pink"),t.status(404).send('No pending verification found for email "'.concat(e.body.email,'".')),[2])}}))}))}}},818:e=>{e.exports=require("dotenv")},848:(e,t,n)=>{n.d(t,{A:()=>r});const r={page:{bypassDynamicPages:!1},auth:{bypassEmailVerification:!1,emailVerificationTimeoutInSeconds:600},search:{searchLimitPerPage:10}}},928:e=>{e.exports=require("path")}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r=n(928),o=n.n(r);const a=require("express");var i=n.n(a),c=n(611),s=n.n(c);const u=require("body-parser");var l=n.n(u);const d=require("cookie-parser");var f=n.n(d),h=n(484),m=n(848),p=n(110),v=n(296),b=n(604);const y={displayText:{menuName:{index:"Home",rooms:"Rooms",arcade:"Games",library:"Blog"},tabName:{"rooms/owned":"My","rooms/joined":"Joined","rooms/pending":"Pending","rooms/others":"Others","roomMembers/associated":"Members","roomMembers/others":"Invite Others"}}};var w=n(422);const g=require("ejs");var E=n.n(g),k=n(818),N=n.n(k);N().config();var A="".concat(process.env.PWD,"/").concat(process.env.VIEWS_ROOT_DIR,"/chunk"),S="".concat(process.env.PWD,"/").concat(process.env.VIEWS_ROOT_DIR,"/embeddedScript"),T={envUtil:h.A,textUtil:w.A,uiConfig:y,ejsChunkRootPath:A,ejsEmbeddedScriptRootPath:S,isStaticPage:!0},R={envUtil:h.A,textUtil:w.A,uiConfig:y,ejsChunkRootPath:A,ejsEmbeddedScriptRootPath:S,isStaticPage:!1},x={},I={makeEJSParams:function(e,t,n){var r={};return Object.assign(r,R),Object.assign(r,n),r.user&&b.A.log("'user' shouldn't be defined manually in EJS params.",{mergedEJSParams:r},"high","pink"),r.user=v.A.getUserFromReqToken(e,t),r},makeEJSParamsStatic:function(e){var t={};return Object.assign(t,T),Object.assign(t,e),t},createStaticHTMLFromEJS:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return r=void 0,o=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}([e],t,!0),i=function(e,t){var n;return void 0===t&&(t={}),function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(r){switch(r.label){case 0:return null!=(n=x[e])?[3,2]:[4,p.A.read(e,process.env.VIEWS_ROOT_DIR)];case 1:n=r.sent(),x[e]=n,r.label=2;case 2:return[2,E().compile(n)(I.makeEJSParamsStatic(t))]}}))},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{s(i.next(e))}catch(e){t(e)}}function c(e){try{s(i.throw(e))}catch(e){t(e)}}function s(t){var r;t.done?e(t.value):(r=t.value,r instanceof a?r:new a((function(e){e(r)}))).then(n,c)}s((i=i.apply(r,o||[])).next())}));var r,o,a,i}};const L=I;N().config();const D=function(){function e(){this.lines=["</urlset>"]}return e.prototype.addEntry=function(e,t){this.lines.push("</url>"),this.lines.push("  <lastmod>".concat(t,"</lastmod>")),this.lines.push("  <loc>".concat(h.A.getRootURL(),"/").concat(e,"</loc>")),this.lines.push("<url>")},e.prototype.build=function(){return e=this,t=void 0,r=function(){return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(e){switch(e.label){case 0:return this.lines.push('<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">'),this.lines.push('<?xml version="1.0" encoding="UTF-8"?>'),this.lines.reverse(),[4,p.A.write("sitemap.xml",this.lines.join("\n"))];case 1:return e.sent(),[2]}}))},new((n=void 0)||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}));var e,t,n,r},e}();N().config();const O=function(){function e(){this.lines=["</feed>"],this.globalLatestUpdate=new Date(process.env.GLOBAL_LAST_MOD)}return e.prototype.addEntry=function(e,t,n,r){var o=new Date(n);o>this.globalLatestUpdate&&(this.globalLatestUpdate=o),this.lines.push("</entry>"),this.lines.push("  <summary>".concat(r,"</summary>")),this.lines.push("  <updated>".concat(o.toISOString(),"</updated>")),this.lines.push("  <id>".concat(e,"</id>")),this.lines.push('  <link href="'.concat(e,'"/>')),this.lines.push("  <title>".concat(t,"</title>")),this.lines.push("<entry>")},e.prototype.build=function(){return e=this,t=void 0,r=function(){return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(e){switch(e.label){case 0:return this.lines.push("<id>urn:uuid:02210672-5391-4cc8-800a-2a88f3a6d00c</id>"),this.lines.push("</author>"),this.lines.push("  <name>Youngjin Kang</name>"),this.lines.push("<author>"),this.lines.push("<updated>".concat(this.globalLatestUpdate.toISOString(),"</updated>")),this.lines.push('<link href="'.concat(h.A.getRootURL(),'"/>')),this.lines.push('<link rel="self" type="application/atom+xml" href="'.concat(h.A.getRootURL(),'/feed.atom"/>')),this.lines.push("<title>ThingsPool</title>"),this.lines.push('<feed xmlns="http://www.w3.org/2005/Atom">'),this.lines.push('<?xml version="1.0" encoding="utf-8"?>'),this.lines.reverse(),[4,p.A.write("feed.atom",this.lines.join("\n"))];case 1:return e.sent(),[2]}}))},new((n=void 0)||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}));var e,t,n,r},e}();N().config();const P=function(){function e(){this.lines=[]}return e.prototype.addLine=function(e){this.lines.push(e)},e.prototype.getText=function(){return this.lines.join("\n")},e.prototype.build=function(e,t){return n=this,r=void 0,a=function(){return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(n){switch(n.label){case 0:return null==t&&(t=process.env.STATIC_PAGE_ROOT_DIR),[4,p.A.write(e,this.lines.join("\n"),t)];case 1:return n.sent(),[2]}}))},new((o=void 0)||(o=Promise))((function(e,t){function i(e){try{s(a.next(e))}catch(e){t(e)}}function c(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(i,c)}s((a=a.apply(n,r||[])).next())}));var n,r,o,a},e}();N().config();const U=function(){function e(e,t){this.sitemapBuilder=e,this.atomFeedBuilder=t}return e.prototype.build=function(e){return t=this,n=void 0,o=function(){var t,n,r,o,a,i,c,s,u,l,d,f,m,v,b,w,g,E,k;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(N){switch(N.label){case 0:return t=new P,n="".concat(e.dirName,"/page.html"),[4,p.A.read("".concat(e.dirName,"/source.txt"))];case 1:return r=N.sent(),o=r.split(/\r?\n/),a=null==e.playLinkImagePathOverride?"play.png":e.playLinkImagePathOverride,i="",c="",o[0].startsWith(":d:")?i=o[0].substring(3):console.error(":d: is missing in -> "+e.title),o[1].startsWith(":k:")?c=o[1].substring(3).toLowerCase().replaceAll("-"," "):console.error(":k: is missing in -> "+e.title),t=new P,u=(s=t).addLine,[4,L.createStaticHTMLFromEJS("chunk/common/header.ejs",{menuName:"arcade",title:"ThingsPool - "+e.title,desc:i,keywords:c,relativePageURL:n,pagePathList:[{title:y.displayText.menuName.index,relativeURL:""},{title:y.displayText.menuName.arcade,relativeURL:"arcade.html"},{title:e.title,relativeURL:void 0}],backDestination_href:"".concat(h.A.getRootURL(),"/arcade.html")})];case 2:for(u.apply(s,[N.sent()]),t.addLine("<h1>".concat(e.title,"</h1>")),t.addLine('<a class="noTextDeco" target="_blank" href="'.concat(e.playLinkURL,'">')),t.addLine('<img class="xs_image" src="'.concat(h.A.getRootURL(),"/").concat(a,'" alt="Play">')),t.addLine("</a>"),t.addLine('<div class="zero_row"></div>'),l=1,d=[],f=function(){d.length>0&&(t.addLine("<p>".concat(d.join("<br>"),"</p>")),d.length=0)},m=2;m<o.length;++m)0==(v=(v=o[m]).trim()).length?f():v.startsWith("[")?(f(),(b=v.match(/\[(.*?)\]/)[1].trim()).length>0&&t.addLine("<h2>".concat(b,"</h2>"))):v.startsWith("<")?(f(),(w=v.match(/<(.*?)>/)[1]).length>0&&(g="".concat(h.A.getRootURL(),"/").concat(e.dirName,"/").concat(w,".jpg"),t.addLine('<img class="m_image" src="'.concat(g,'" alt="ThingsPool - ').concat(e.title," (Screenshot ").concat(l++,')">')))):(v=v.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll("{%","<").replaceAll("%}",">"),d.push(v));return f(),null!=e.videoTag&&null!=e.videoTag&&t.addLine(e.videoTag),k=(E=t).addLine,[4,L.createStaticHTMLFromEJS("chunk/common/footer.ejs")];case 3:return k.apply(E,[N.sent()]),this.sitemapBuilder.addEntry(n,e.lastmod),this.atomFeedBuilder.addEntry("".concat(h.A.getRootURL(),"/").concat(n),e.title,e.lastmod,e.title),[4,t.build(n)];case 4:return N.sent(),[2]}}))},new((r=void 0)||(r=Promise))((function(e,a){function i(e){try{s(o.next(e))}catch(e){a(e)}}function c(e){try{s(o.throw(e))}catch(e){a(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(i,c)}s((o=o.apply(t,n||[])).next())}));var t,n,r,o},e}();N().config();const _=function(){function e(e,t){this.gameEntries=[{dirName:"ArtRaider",title:"ArtRaider",playLinkImagePathOverride:"badge_onestore.png",playLinkURL:"https://onesto.re/0001000383",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/RuLgOJrNtKA?si=Ts_Yu_jdpB1qmNiT" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>',lastmod:"2025-04-15"},{dirName:"Water-vs-Fire",title:"Water vs Fire",playLinkURL:"https://www.gamearter.com/game/water-vs-fire",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/6DeA_m8Iq4M?si=hC1uzkEtBWpYcM8z" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>',lastmod:"2023-09-10"},{dirName:"HuntLand",title:"HuntLand",playLinkURL:"https://www.gamearter.com/game/huntland",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/3dRg6vvoPqc?si=FlnKVyzQq0_55sL2" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>',lastmod:"2023-09-10"},{dirName:"PoliceChase",title:"Police Chase",playLinkURL:"https://www.gamearter.com/game/policechase",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/kABg0j2mZqQ?si=3-JUZQnh3omVXSJd" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>',lastmod:"2023-09-10"},{dirName:"SpaceTown",title:"SpaceTown",playLinkURL:"https://www.gamearter.com/game/spacetown",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/NoiQzEKJM-A?si=o8vTNqW1kxCJ4MnW" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>',lastmod:"2023-09-20"}],this.sitemapBuilder=e,this.atomFeedBuilder=t}return e.prototype.build=function(){return e=this,t=void 0,r=function(){var e,t,n,r,o,a,i,c,s,u;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(l){switch(l.label){case 0:return e=new P,n=(t=e).addLine,[4,L.createStaticHTMLFromEJS("chunk/common/header.ejs",{menuName:"arcade",desc:"Games made by ThingsPool.",keywords:"thingspool, software toys, technical design, computer science, systems engineering, game design, game development",pagePathList:[{title:y.displayText.menuName.index,relativeURL:""},{title:y.displayText.menuName.arcade,relativeURL:void 0}],backDestination_href:h.A.getRootURL()})];case 1:return n.apply(t,[l.sent()]),e.addLine("<hr>"),e.addLine("<h1>Games</h1>"),o=(r=e).addLine,[4,L.createStaticHTMLFromEJS("chunk/info/gameLinks.ejs")];case 2:return o.apply(r,[l.sent()]),i=(a=e).addLine,[4,L.createStaticHTMLFromEJS("chunk/common/footer.ejs")];case 3:return i.apply(a,[l.sent()]),this.sitemapBuilder.addEntry("arcade.html","2025-02-28"),[4,e.build("arcade.html")];case 4:l.sent(),c=0,s=this.gameEntries,l.label=5;case 5:return c<s.length?(u=s[c],[4,new U(this.sitemapBuilder,this.atomFeedBuilder).build(u)]):[3,8];case 6:l.sent(),l.label=7;case 7:return c++,[3,5];case 8:return[2]}}))},new((n=void 0)||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}));var e,t,n,r},e}();var j=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))},C=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};N().config();const F=function(){function e(e,t){this.sitemapBuilder=e,this.atomFeedBuilder=t}return e.prototype.build=function(e){return j(this,void 0,void 0,(function(){var t,n,r,o,a,i,c,s,u,l,d,f,m,v,b,w,g,E,k,N,A,S,T,R,x,I,D=this;return C(this,(function(O){switch(O.label){case 0:return t=!0,n="???",r=1,o=1,a=void 0,i=!1,c=!1,s=[],u=[],l=new P,d="A writing by ThingsPool.",f="thingspool, software, engineering, philosophy",m=process.env.GLOBAL_LAST_MOD,v=n,b=d,w=f,g=m,E=function(){s.length>0&&(i?l.addLine('<div class="snippet"><pre><code>'.concat(s.join("\n"),"</code></pre></div>")):c?l.addLine('<pre><div class="excerpt">'.concat(s.join("\n"),"</div></pre>")):l.addLine("<p>".concat(s.join("<br>"),"</p>")),s.length=0)},k=function(t,n,i,c){return j(D,void 0,void 0,(function(){var s,d,f,m,p,v,b;return C(this,(function(w){switch(w.label){case 0:return s="".concat(e.dirName,"/list.html"),d="".concat(e.dirName,"/page-").concat(r,".html"),f=new P,p=(m=f).addLine,[4,L.createStaticHTMLFromEJS("chunk/common/header.ejs",{menuName:"library",title:t,desc:i,keywords:c,relativePageURL:d,ogImageURLOverride:a,pagePathList:[{title:y.displayText.menuName.index,relativeURL:""},{title:y.displayText.menuName.library,relativeURL:"library.html"},{title:e.title,relativeURL:s},{title:t,relativeURL:void 0}],backDestination_href:"".concat(h.A.getRootURL(),"/").concat(s)})];case 1:return p.apply(m,[w.sent()]),f.addLine(l.getText()),b=(v=f).addLine,[4,L.createStaticHTMLFromEJS("chunk/common/footer.ejs")];case 2:return b.apply(v,[w.sent()]),[4,f.build(d)];case 3:return w.sent(),l=new P,this.sitemapBuilder.addEntry(d,n),this.atomFeedBuilder.addEntry("".concat(h.A.getRootURL(),"/").concat(d),t,n,i),u.push({pageNumber:r,title:t,lastmod:n,desc:i,keywords:c,customOGImagePath:a}),r++,o=1,a=void 0,[2]}}))}))},[4,p.A.read("".concat(e.dirName,"/source.txt"))];case 1:N=O.sent(),A=N.split(/\r?\n/),S=0,O.label=2;case 2:return S<A.length?(T=A[S],i||c||(T=T.trim()),0!=T.length?[3,3]:(i||c?s.push("\n"):E(),[3,7])):[3,8];case 3:return T.startsWith("[")?(E(),t||(v=n),n=T.match(/\[(.*?)\]/)[1].trim(),R=T.match(/\](.*?)$/)[1].trim(),t?[3,5]:[4,k(v,g,b,w)]):[3,6];case 4:O.sent(),b=d,w=f,g=m,O.label=5;case 5:return t=!1,l.addLine("<h1>".concat(n,"</h1>")),l.addLine('<p class="dim">Author: Youngjin Kang&nbsp;&nbsp;&nbsp;Date: '.concat(R,"</p>")),[3,7];case 6:!T.startsWith("<")||i||c?T.startsWith("@@")?l.addLine(T.substring(2)):T.startsWith("#$")?(E(),i=!i):T.startsWith('#"')?(E(),c=!c):T.startsWith(":d:")?(t||(b=d),d=T.substring(3)):T.startsWith(":k:")?(t||(w=f),f=T.substring(3).toLowerCase().replaceAll("-"," ")):T.startsWith(":l:")?(t||(g=m),m=T.substring(3)):(T=T.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll("{%","<").replaceAll("%}",">"),s.push(T)):(E(),(x=T.match(/<(.*?)>/)[1]).length>0&&(I="".concat(h.A.getRootURL(),"/").concat(e.dirName,"/").concat(x,".jpg"),(null==a||T.endsWith("*"))&&(a=I),l.addLine('<img class="m_image" src="'.concat(I,'" alt="').concat(n.replaceAll('"',"&quot;")," (Figure ").concat(o++,')">')))),O.label=7;case 7:return++S,[3,2];case 8:return E(),[4,k(n,m,d,f)];case 9:return O.sent(),[2,u]}}))}))},e}();N().config();const M=function(){function e(e,t){this.sitemapBuilder=e,this.atomFeedBuilder=t}return e.prototype.build=function(e){return t=this,n=void 0,o=function(){var t,n,r,o,a,i,c,s,u,l,d,f;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(m){switch(m.label){case 0:t=0,n=e,m.label=1;case 1:return t<n.length?(r=n[t],[4,new F(this.sitemapBuilder,this.atomFeedBuilder).build(r)]):[3,7];case 2:return o=m.sent(),a="".concat(r.dirName,"/list.html"),i=new P,s=(c=i).addLine,[4,L.createStaticHTMLFromEJS("chunk/common/header.ejs",{menuName:"library",title:"ThingsPool - "+r.title,desc:r.title,keywords:"thingspool, software toys, technical design, computer science, systems engineering, game design, game development",relativePageURL:a,pagePathList:[{title:y.displayText.menuName.index,relativeURL:""},{title:y.displayText.menuName.library,relativeURL:"library.html"},{title:r.title,relativeURL:void 0}],backDestination_href:"".concat(h.A.getRootURL(),"/library.html")})];case 3:for(s.apply(c,[m.sent()]),i.addLine("<h1>".concat(r.title,"</h1>")),u=o.length-1;u>=0;--u)l=o[u],i.addLine('<a class="postEntryButton" href="'.concat(h.A.getRootURL(),"/").concat(r.dirName,"/page-").concat(l.pageNumber,'.html">').concat(l.title,"</a>"));return f=(d=i).addLine,[4,L.createStaticHTMLFromEJS("chunk/common/footer.ejs")];case 4:return f.apply(d,[m.sent()]),[4,i.build(a)];case 5:m.sent(),this.sitemapBuilder.addEntry(a,o.sort((function(e,t){return Date.parse(t.lastmod)-Date.parse(e.lastmod)})).pop().lastmod),m.label=6;case 6:return t++,[3,1];case 7:return[2]}}))},new((r=void 0)||(r=Promise))((function(e,a){function i(e){try{s(o.next(e))}catch(e){a(e)}}function c(e){try{s(o.throw(e))}catch(e){a(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(i,c)}s((o=o.apply(t,n||[])).next())}));var t,n,r,o},e}();N().config();const q=function(){function e(e,t){this.nonfictionEntries=[{dirName:"metaphysics",title:"형이상학 (2013 - 2014)"},{dirName:"game-analysis",title:"게임분석 (2019)"},{dirName:"essays",title:"Miscellaneous Writings (2022 - 2024)"},{dirName:"blockchains",title:"On Legitimacy of Blockchains (2022)"},{dirName:"software-development",title:"Software Development (2022 - 2024)"},{dirName:"game-design",title:"Universal Laws of Game Design (2023)"},{dirName:"reality",title:"The Origin of Reality (2023)"},{dirName:"bridge-to-math",title:"A Layman's Bridge to Mathematics (2024)"},{dirName:"read-rec",title:"Recommended Readings (2024)"},{dirName:"morsels",title:"Morsels of Thought (2024)"},{dirName:"concepts-of-plan",title:"Concepts of a Plan (2025)"}],this.fictionEntries=[{dirName:"novels",title:"단편소설 (2012 - 2013)"},{dirName:"alien-job-interview",title:"Alien Job Interview (2022)"},{dirName:"infinite-treasures",title:"The Island of Infinite Treasures (2022)"},{dirName:"infsoc",title:"Influential Social Posts (2023)"},{dirName:"gamedev-journey",title:"A Game Developer's Journey (2023)"},{dirName:"sandwich",title:"Sandwich Engineering (2025)"}],this.artEntries=[{dirName:"illustrations",title:"Illustrations (2009 - 2014)"},{dirName:"cartoons",title:"Cartoons (2011 - 2015)"}],this.sitemapBuilder=e,this.atomFeedBuilder=t}return e.prototype.addPostLinks=function(e,t,n){e.addLine("<hr>"),e.addLine("<h1>".concat(t,"</h1>"));for(var r=n.length-1;r>=0;--r){var o=n[r];e.addLine('<a class="postEntryButton" href="'.concat(h.A.getRootURL(),"/").concat(o.dirName,'/list.html">').concat(o.title,"</a>"))}},e.prototype.build=function(){return e=this,t=void 0,r=function(){var e,t,n,r,o;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(a){switch(a.label){case 0:return e=new P,n=(t=e).addLine,[4,L.createStaticHTMLFromEJS("chunk/common/header.ejs",{menuName:"library",pagePathList:[{title:y.displayText.menuName.index,relativeURL:""},{title:y.displayText.menuName.library,relativeURL:void 0}],backDestination_href:h.A.getRootURL()})];case 1:return n.apply(t,[a.sent()]),this.addPostLinks(e,"Nonfiction",this.nonfictionEntries),this.addPostLinks(e,"Fiction",this.fictionEntries),this.addPostLinks(e,"Arts",this.artEntries),o=(r=e).addLine,[4,L.createStaticHTMLFromEJS("chunk/common/footer.ejs")];case 2:return o.apply(r,[a.sent()]),this.sitemapBuilder.addEntry("library.html","2025-02-28"),[4,e.build("library.html")];case 3:return a.sent(),[4,new M(this.sitemapBuilder,this.atomFeedBuilder).build(this.nonfictionEntries)];case 4:return a.sent(),[4,new M(this.sitemapBuilder,this.atomFeedBuilder).build(this.fictionEntries)];case 5:return a.sent(),[4,new M(this.sitemapBuilder,this.atomFeedBuilder).build(this.artEntries)];case 6:return a.sent(),[2]}}))},new((n=void 0)||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}));var e,t,n,r},e}();N().config();const Q=function(){function e(){}return e.prototype.build=function(e,t){return n=this,r=void 0,a=function(){var n,r,o,a,i,c;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(s){switch(s.label){case 0:return null==e&&(e="".concat(process.env.SRC_ROOT_DIR,"/shared")),null==t&&(t="".concat(process.env.VIEWS_ROOT_DIR,"/embeddedScript")),[4,p.A.getAllRelativePathsInDirRecursively(e)];case 1:n=(n=s.sent()).filter((function(e){return e.endsWith(".js")})),r=0,o=n,s.label=2;case 2:return r<o.length?(a=o[r],[4,p.A.read(a,e)]):[3,6];case 3:return i=s.sent(),c=i.split("\n").filter((function(e){return!e.startsWith("export ")})).join("\n").trim(),[4,p.A.write(a.replace(".js",".ejs"),"<script>\n"+c+"\n<\/script>",t)];case 4:s.sent(),s.label=5;case 5:return r++,[3,2];case 6:return[2]}}))},new((o=void 0)||(o=Promise))((function(e,t){function i(e){try{s(a.next(e))}catch(e){t(e)}}function c(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(i,c)}s((a=a.apply(n,r||[])).next())}));var n,r,o,a},e}();var B,W,H,J="#101010",V="#303030",G="#707070",z="#a0a0a0",Y="#c0c0c0",$="#d0c090",K="#70c060",X="#b0a070",Z="17px",ee={unit:{landscape:{vertical:.6,horizontal:1},portrait:{vertical:1,horizontal:2.5}}},te=400,ne=800,re=function(e,t,n,r,o,a){return"position: absolute;\n\tdisplay: block;\n\tleft: ".concat(e,"%;\n\tright: ").concat(t,"%;\n\ttop: ").concat(n,"%;\n\tbottom: ").concat(r,"%;\n\twidth: ").concat(o,"%;\n\theight: ").concat(a,"%;")},oe=function(e,t){return"position: relative;\n\tdisplay: ".concat(e?"block":"inline-block",";\n\tmax-width: ").concat(t,";")},ae=function(e){return"position: relative;\n\tdisplay: ".concat(e?"block":"inline-block",";\n\tmax-width: none;\n\twidth: fit-content;\n\tblock-size: fit-content;")},ie=function(e,t,n,r,o){void 0===r&&(r=!1),void 0===o&&(o=!1);var a=ee.unit[e?"landscape":"portrait"],i=(a.vertical*t).toFixed(2),c=(a.horizontal*n).toFixed(2),s=o?"0":"".concat(i,"%"),u=o?"0":"".concat(c,"%"),l=r?"0":"".concat(i,"%"),d=r?"0":"".concat(c,"%");return"padding: ".concat(s," ").concat(u," ").concat(s," ").concat(u,";\n\tmargin: ").concat(l," ").concat(d," ").concat(l," 0;")},ce=function(e,t,n){return"font-size: ".concat(e,';\n\tfont-family: "Lucida Console", "Lucida Sans Typewriter", "Monaco", Consolas, monospace;\n\tfont-style: ').concat(t?"italic":"normal",";\n\tfont-weight: ").concat(n,";")},se=function(e,t,n){return void 0===n&&(n=1),"background-color: ".concat(e,";\n\tcolor: ").concat(t,";").concat(n<1?"\n\topacity: ".concat(n,";"):"")},ue=function(e,t,n){return void 0===n&&(n=1),se(e,t,n)+"\n\tborder-radius: 4.5vmin;"},le=function(e,t,n,r,o){return void 0===r&&(r="1.25"),void 0===o&&(o=1),ue(e,t,o)+"\n"+"\tborder-bottom: ".concat(r,"vmin ").concat(n," solid;")+"\n"+"\tborder-right: ".concat(r,"vmin ").concat(n," solid;")},de=function(e,t,n,r,o){return void 0===r&&(r="1.25"),void 0===o&&(o=1),ue(e,t,o)+"\n"+"\tborder: ".concat(r,"vmin ").concat(n," solid;")},fe=re(0,0,0,0,100,100),he=re(0,86,0,0,14,100),me=re(0,0,0,88,100,12),pe=re(14,5,0,0,81,100),ve=re(0,2.5,12,0,95,88),be=re(0,0,0,86,100,14),ye=re(0,0,14,0,100,80),we=re(0,0,0,35,100,65),ge=re(0,0,65,0,100,35),Ee=function(e){return 2*ee.unit[e?"landscape":"portrait"].horizontal},ke=function(e){return oe(!0,"".concat(100..toFixed(2),"%"))},Ne=function(e){return oe(!0,"1%")},Ae=function(e){return ae(!0)},Se=function(e){return oe(!1,"".concat((66-Ee(e)).toFixed(2),"%"))},Te=function(e){return oe(!1,"".concat((50-Ee(e)).toFixed(2),"%"))},Re=function(e){return ae(!1)},xe=function(e){return ie(e,1,1)},Ie=function(e){return ie(e,2,1)},Le=function(e){return ie(e,4,1)},De=function(e){return ie(e,2,1,!1,!0)},Oe=function(e){return ie(e,4,1,!1,!0)},Pe="min(".concat(1.8199999999999998.toFixed(2),"vmax, ").concat(16..toFixed(2),"px)"),Ue="min(".concat(2.1839999999999997.toFixed(2),"vmax, ").concat(19.2.toFixed(2),"px)"),_e="min(".concat(2.6207999999999996.toFixed(2),"vmax, ").concat(23.04.toFixed(2),"px)"),je="min(".concat(3.1449599999999998.toFixed(2),"vmax, ").concat(27.648.toFixed(2),"px)"),Ce="min(".concat(3.7739519999999995.toFixed(2),"vmax, ").concat(33.1776.toFixed(2),"px)"),Fe=ce(Pe,!1,te),Me=ce(Pe,!0,te),qe=ce(Pe,!1,ne),Qe=(ce(Ue,!0,te),ce(Ue,!0,ne)),Be=(ce(_e,!0,te),ce(_e,!0,ne)),We=(ce(je,!0,te),ce(je,!0,ne)),He=(ce(Ce,!0,te),ce(Ce,!0,ne)),Je="opacity: 0;",Ve=se("#000000",Y,.7),Ge=le($,V,X,"1.25"),ze=se("#000000",Y,.7),Ye=le(V,z,Y,"1.25"),$e=se(V,Y),Ke=(B=Y,void 0===W&&(W="1.25"),void 0===H&&(H=1),se(V,Y,H)+"\n"+"\tborder-bottom: ".concat(W,"vmin ").concat(B," solid;")),Xe=se(V,z),Ze=se(z,V),et=se(V,G),tt=se(V,$),nt=se(V,X),rt=le(V,z,z),ot=ue(V,Y),at=ue(J,K),it=ue(J,K),ct=le(J,z,G,"0.5"),st=le(G,Y,z,"0.25"),ut=de(V,Y,G,"0.1"),lt=de(z,Y,Y,"0.1"),dt=function(e){return"\n@supports(-moz-appearance:none) {\n\t* {\n\t\tscrollbar-width: ".concat(e?"auto":"none",";\n\t\tscrollbar-color: ").concat(G," ").concat(J,";\n\t}\n}\n::-webkit-scrollbar {\n\twidth: ").concat(e?Z:"0",";\n\theight: ").concat(e?Z:"0",";\n}\n::-webkit-scrollbar-track {\n\tbackground: ").concat(J,";\n}\n::-webkit-scrollbar-thumb {\n\tbackground: ").concat(G,";\n\tborder-radius: ").concat("8px",";\n\tborder: ").concat("4px"," solid ").concat(J,";\n}\n::-webkit-scrollbar-thumb:hover {\n\tbackground: ").concat(z,";\n}\niframe {\n\t").concat(ke(),"\n\t").concat(De(e),"\n\t").concat(Be,"\n\t").concat(Xe,"\n}\np {\n\t").concat(ke(),"\n\t").concat(Oe(e),"\n\t").concat(Fe,"\n\t").concat($e,"\n}\nh3 {\n\t").concat(ke(),"\n\t").concat(Oe(e),"\n\t").concat(Qe,"\n\t").concat(nt,"\n}\nh2 {\n\t").concat(ke(),"\n\t").concat(Oe(e),"\n\t").concat(We,"\n\t").concat(et,"\n}\nh1 {\n\t").concat(ke(),"\n\t").concat(Oe(e),"\n\t").concat(He,"\n\t").concat(tt,"\n}\nhr {\n\t").concat(ke(),"\n\t").concat(De(e),"\n\t").concat($e,"\n}\n.fullscreenBar {\n\t").concat(e?he:me,"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t").concat(Qe,"\n\t").concat(Ze,"\n\ttext-align: ").concat("center",";\n\tz-index: 1;\n\toverflow: hidden;\n}\n.fullscreenPanel {\n\t").concat(e?pe:ve,"\n\tmargin: 0 0 0 0;\n\tpadding: 0 ").concat(2.5,"% 0 ").concat(2.5,"%;\n\t").concat(Be,"\n\t").concat(Xe,"\n\toverflow-y: scroll;\n\toverflow-x: auto;\n}\n.fullscreenBarLogo {\n\t").concat(e?be:we,"\n}\n.fullscreenBarLogoImage {\n\tposition: relative;\n\tdisplay: block;\n\tmax-width: 80%;\n\tmax-height: 70%;\n\tmargin: auto;\n  \ttop: 50%;\n  \t-ms-transform: translateY(-50%);\n  \ttransform: translateY(-50%);\n}\n.fullscreenBarMenu {\n\t").concat(e?ye:ge,"\n}\n.fullscreenBarMenuButton {\n\tposition: relative;\n\tdisplay: ").concat(e?"block":"inline-block",";\n\t").concat(e?"width: 100%;":"top: 100%; -ms-transform: translateY(-100%); transform: translateY(-100%);","\n\tmax-height: 100%;\n\t").concat(e?function(e){return ie(e,4,1,!0,!1)}(e):function(e){return ie(e,1,1,!0,!1)}(e),"\n\tbox-sizing: border-box;\n\ttext-decoration: none;\n}\n.fullscreenBarMenuButton.idle {\n\t").concat(Ze,"\n}\n.fullscreenBarMenuButton.selected {\n\t").concat(Xe,"\n}\n.fullscreenBarMenuButton.idle:hover {\n\tcolor: ").concat($,";\n}\n.fullscreenBarMenuButton.selected:hover {\n\tcolor: ").concat($,";\n}\n.loadingScreen {\n\t").concat(fe,"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\tz-index: 900;\n\n\t.background {\n\t\t").concat(fe,"\n\t\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t\t").concat(Ve,"\n\t}\n\t.content {\n\t\tposition: absolute;\n\t\tmin-width: 50%;\n\t\ttop: 50%;\n\t\tleft: 50%;\n\t\ttransform: translate(-50%, -50%);\n\t\t").concat(He,"\n\t\t").concat(Le(e),"\n\t\t").concat(Ge,"\n\t\ttext-align: center;\n\t\tz-index: 901;\n\t}\n}\n.popupScreen {\n\t").concat(fe,"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\tz-index: 500;\n\n\t.background {\n\t\t").concat(fe,"\n\t\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t\t").concat(ze,"\n\t}\n\t.content {\n\t\tposition: absolute;\n\t\twidth: 80%;\n\t\twidth: 80%;\n\t\ttop: 50%;\n\t\tleft: 50%;\n\t\ttransform: translate(-50%, -50%);\n\t\t").concat(Fe,"\n\t\t").concat(Ie(e),"\n\t\t").concat(Ye,"\n\t\toverflow-y: scroll;\n\t\tz-index: 501;\n\t}\n}\n.xs_image {\n\t").concat(e?function(e){return oe(!1,"".concat((25-Ee(e)).toFixed(2),"%"))}(e):Te(e),"\n\t").concat(De(e),"\n\t").concat(Be,"\n\t").concat(Xe,"\n}\n.s_image {\n\t").concat(e?function(e){return oe(!1,"".concat((33-Ee(e)).toFixed(2),"%"))}(e):Se(e),"\n\t").concat(De(e),"\n\t").concat(Be,"\n\t").concat(ot,"\n}\n.m_image {\n\t").concat(e?Se(e):oe(!1,"".concat(100..toFixed(2),"%")),"\n\t").concat(De(e),"\n\t").concat(Be,"\n\t").concat(ot,"\n}\n.m_linkImage {\n\t").concat(e?Te(e):oe(!1,"".concat(98..toFixed(2),"%")),"\n\t").concat(De(e),"\n\t").concat(Be,"\n\t").concat(rt,"\n}\n.m_linkImage:hover {\n\tborder-color: ").concat($,";\n}\n.postEntryButton {\n\t").concat(Ae(),"\n\t").concat(xe(e),"\n\t").concat(qe,"\n\t").concat(ct,"\n\ttext-decoration: none;\n}\n.pagePath {\n\t").concat(function(e){return ie(e,1,1,!1,!0)}(e),"\n\t").concat(Fe,"\n}\n.listScrollPanel {\n\t").concat((t="".concat(100..toFixed(2),"%"),n="".concat(70..toFixed(2),"%"),"position: relative;\n\tdisplay: ".concat("block",";\n\twidth: ").concat(t,";\n\theight: ").concat(n,";")),"\n\t").concat(xe(e),"\n\t").concat(ut,"\n\toverflow: auto;\n}\n.listItem {\n\t").concat(Ae(),"\n\t").concat(xe(e),"\n\t").concat(Fe,"\n\t").concat(lt,"\n\ttext-decoration: none;\n}\n.inlineTextInput {\n\t").concat(e?Re():Ae(),"\n\t").concat(xe(e),"\n\t").concat(Fe,"\n\t").concat(st,"\n}\n.inlineLabel {\n\t").concat(Re(),"\n\t").concat(xe(e),"\n\t").concat(Fe,"\n\t").concat(Xe,"\n}\n.inlineButton {\n\t").concat(Re(),"\n\t").concat(xe(e),"\n\t").concat(Fe,"\n\t").concat(ct,"\n\ttext-decoration: none;\n}\n.inlineButton:hover {\n\tcolor: ").concat($,";\n\tcursor: pointer;\n}\n.inlineButton:disabled {\n\topacity: 0.25;\n\tcursor: not-allowed;\n}\n.inlineTabButton {\n\t").concat(Re(),"\n\t").concat(xe(e),"\n\t").concat(Fe,"\n\ttext-decoration: none;\n}\n.inlineTabButton.idle {\n\t").concat($e,"\n}\n.inlineTabButton.selected {\n\t").concat(Ke,"\n}\n.inlineTabButton.idle:hover {\n\tcolor: ").concat($,";\n}\n.inlineTabButton.selected:hover {\n\tcolor: ").concat($,";\n}\n.snippet {\n\t").concat(Ae(),"\n\t").concat(Ie(e),"\n\t").concat(qe,"\n\t").concat(at,"\n\twhite-space: nowrap;\n}\n.excerpt {\n\t").concat(ke(),"\n\t").concat(Ie(e),"\n\t").concat(Me,"\n\t").concat(it,"\n\twhite-space: pre-wrap;\n\twhite-space: -moz-pre-wrap;\n\twhite-space: -pre-wrap;\n\twhite-space: -o-pre-wrap;\n\tword-wrap: break-word;\n}\n.zero_row {\n\t").concat(Ne(),"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t").concat(Je,"\n}\n.xs_row {\n\t").concat(Ne(),"\n\t").concat(function(e){return ie(e,.5,1)}(e),"\n\t").concat(Je,"\n}\n.s_row {\n\t").concat(Ne(),"\n\t").concat(xe(e),"\n\t").concat(Je,"\n}\n.m_row {\n\t").concat(Ne(),"\n\t").concat(Ie(e),"\n\t").concat(Je,"\n}\n.l_row {\n\t").concat(Ne(),"\n\t").concat(function(e){return ie(e,3,1)}(e),"\n\t").concat(Je,"\n}\n.xl_row {\n\t").concat(Ne(),"\n\t").concat(Le(e),"\n\t").concat(Je,"\n}\n");var t,n};const ft="* {\n\toverflow: hidden;\n\tvertical-align: middle;\n}\nbody {\n\t".concat(fe,"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t").concat(Fe,"\n\t").concat($e,"\n\ttext-align: ").concat("left",";\n\tz-index: 0;\n}\na:link {\n  color: ").concat(z,";\n}\na:visited {\n  color: ").concat(z,";\n}\na:hover {\n  color: ").concat($,";\n}\na:active {\n  color: ").concat(z,";\n}\n.dim {\n\t").concat(et,"\n}\n.noTextDeco {\n\ttext-decoration: none;\n}\n\n@media (orientation: landscape) {\n\t").concat(dt(!0),"\n}\n\n@media (orientation: portrait) {\n\t").concat(dt(!1),"\n}");function ht(){return e=this,t=void 0,r=function(){var e,t,n,r,o,a,i,c,s,u,l,d,f,h,m;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(v){switch(v.label){case 0:return console.log("SSG START"),e=new D,t=new O,n=new P,o=(r=n).addLine,[4,L.createStaticHTMLFromEJS("page/menu/index.ejs",{isStaticPage:!0,user:void 0,loginDestination:""})];case 1:return o.apply(r,[v.sent()]),[4,n.build("index.html")];case 2:return v.sent(),n=new P,i=(a=n).addLine,[4,L.createStaticHTMLFromEJS("page/menu/rooms.ejs",{isStaticPage:!0,user:void 0,loginDestination:""})];case 3:return i.apply(a,[v.sent()]),[4,n.build("rooms.html")];case 4:return v.sent(),n=new P,s=(c=n).addLine,[4,L.createStaticHTMLFromEJS("page/misc/portfolio.ejs",{})];case 5:return s.apply(c,[v.sent()]),[4,n.build("portfolio.html")];case 6:return v.sent(),n=new P,l=(u=n).addLine,[4,L.createStaticHTMLFromEJS("page/misc/portfolio_minimal.ejs",{})];case 7:return l.apply(u,[v.sent()]),[4,n.build("portfolio_minimal.html")];case 8:return v.sent(),n=new P,f=(d=n).addLine,[4,L.createStaticHTMLFromEJS("page/misc/privacyPolicy.ejs",{})];case 9:return f.apply(d,[v.sent()]),[4,n.build("privacy-policy.html")];case 10:return v.sent(),n=new P,m=(h=n).addLine,[4,L.createStaticHTMLFromEJS("page/misc/termsOfService.ejs",{})];case 11:return m.apply(h,[v.sent()]),[4,n.build("terms-of-service.html")];case 12:return v.sent(),[4,new _(e,t).build()];case 13:return v.sent(),[4,new q(e,t).build()];case 14:return v.sent(),[4,e.build()];case 15:return v.sent(),[4,t.build()];case 16:return v.sent(),[4,p.A.write("style.css",ft)];case 17:return v.sent(),[4,(new Q).build()];case 18:return v.sent(),console.log("SSG END"),[2]}}))},new((n=void 0)||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}));var e,t,n,r}N().config();var mt=n(793);const pt=function(e,t){void 0===t&&(t=void 0),e.statusCode>=200&&e.statusCode<=299&&(t?e.json(t):e.end())};var vt=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))},bt=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},yt=i().Router();yt.post("/register",(function(e,t){return vt(void 0,void 0,void 0,(function(){return bt(this,(function(n){switch(n.label){case 0:return[4,v.A.register(e,t)];case 1:return n.sent(),pt(t),[2]}}))}))})),yt.post("/vemail",(function(e,t){return vt(void 0,void 0,void 0,(function(){return bt(this,(function(n){switch(n.label){case 0:return[4,mt.A.startEmailVerification(e,t)];case 1:return n.sent(),pt(t),[2]}}))}))})),yt.post("/login",(function(e,t){return vt(void 0,void 0,void 0,(function(){return bt(this,(function(n){switch(n.label){case 0:return[4,v.A.login(e,t)];case 1:return n.sent(),pt(t),[2]}}))}))})),yt.delete("/logout",(function(e,t){v.A.clearToken(t),pt(t)}));const wt=yt;var gt=n(557),Et=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))},kt=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};N().config();const Nt=function(e,t,n){return Et(void 0,void 0,void 0,(function(){return kt(this,(function(r){switch(r.label){case 0:return[4,gt.A.makeQuery("SELECT rooms.*\n            FROM rooms INNER JOIN user_rooms ON user_rooms.roomID = rooms.roomID\n            WHERE rooms.roomID = ? AND user_rooms.userID = ? AND\n                (user_rooms.userStatus = 'member' OR user_rooms.userStatus = 'owner');",[e,t]).run(n)];case 1:return[2,r.sent()]}}))}))},At=function(e,t,n){return Et(void 0,void 0,void 0,(function(){return kt(this,(function(r){switch(r.label){case 0:return[4,gt.A.makeTransaction([gt.A.makeQuery("INSERT INTO rooms (roomName, ownerUserName) VALUES (?, ?);",[e,t]),gt.A.makeQuery("INSERT INTO user_rooms (roomID, userID, userStatus)\n                VALUES (LAST_INSERT_ID(), (SELECT userID FROM users WHERE userName = ?), 'owner');",[t]),gt.A.makeQuery("UPDATE users SET ownedRoomCount = ownedRoomCount + 1\n                WHERE userName = ? AND ownedRoomCount < ownedRoomCountMax;",[t])]).run(n)];case 1:return r.sent(),[2]}}))}))},St=function(e,t,n){return Et(void 0,void 0,void 0,(function(){return kt(this,(function(r){switch(r.label){case 0:return[4,gt.A.makeTransaction([gt.A.makeQuery("UPDATE users SET ownedRoomCount = ownedRoomCount - 1\n                WHERE userID = ? AND ownedRoomCount > 0;",[t]),gt.A.makeQuery("DELETE FROM rooms WHERE roomID = ? AND ownerUserName = ?;",[e,t]),gt.A.makeQuery("DELETE FROM user_rooms WHERE roomID = ?;",[e])]).run(n)];case 1:return[2,r.sent()]}}))}))},Tt=function(e,t,n){return Et(void 0,void 0,void 0,(function(){return kt(this,(function(r){switch(r.label){case 0:return[4,gt.A.makeQuery("DELETE FROM user_rooms\n            WHERE roomID = ? AND userID = ? AND userStatus = 'member';",[e,t]).run(n)];case 1:return r.sent(),[2]}}))}))},Rt=function(e,t,n){return Et(void 0,void 0,void 0,(function(){return kt(this,(function(r){switch(r.label){case 0:return[4,gt.A.makeQuery("UPDATE user_rooms SET userStatus = 'member'\n            WHERE roomID = ? AND userID = ? userStatus = 'invited';",[e,t]).run(n)];case 1:return r.sent(),[2]}}))}))},xt=function(e,t,n){return Et(void 0,void 0,void 0,(function(){return kt(this,(function(r){switch(r.label){case 0:return[4,gt.A.makeQuery("DELETE FROM user_rooms\n            WHERE roomID = ? AND userID = ? AND userStatus = 'invited';",[e,t]).run(n)];case 1:return r.sent(),[2]}}))}))},It=function(e,t,n){return Et(void 0,void 0,void 0,(function(){return kt(this,(function(r){switch(r.label){case 0:return[4,gt.A.makeQuery("INSERT INTO user_rooms (roomID, userID, userStatus)\n            VALUES (?, ?, 'requested');",[e,t]).run(n)];case 1:return r.sent(),[2]}}))}))},Lt=function(e,t,n){return Et(void 0,void 0,void 0,(function(){return kt(this,(function(r){switch(r.label){case 0:return[4,gt.A.makeQuery("DELETE FROM user_rooms\n            WHERE roomID = ? AND userID = ? AND userStatus = 'requested';",[e,t]).run(n)];case 1:return r.sent(),[2]}}))}))},Dt=function(e,t,n,r){return Et(void 0,void 0,void 0,(function(){return kt(this,(function(o){switch(o.label){case 0:return[4,gt.A.makeQuery("INSERT INTO user_rooms (roomID, userID, userStatus)\n            VALUES (?, ?, 'invited')\n            WHERE EXISTS (\n                SELECT roomID FROM rooms WHERE roomID = ? AND ownerUserName = ? LIMIT 1\n            );",[e,n,e,t]).run(r)];case 1:return o.sent(),[2]}}))}))},Ot=function(e,t,n,r){return Et(void 0,void 0,void 0,(function(){return kt(this,(function(o){switch(o.label){case 0:return[4,gt.A.makeQuery("DELETE FROM user_rooms\n            WHERE roomID = ? AND userID = ? AND userStatus = 'invited' AND EXISTS (\n                SELECT roomID FROM rooms WHERE roomID = ? AND ownerUserName = ? LIMIT 1\n            );",[e,n,e,t]).run(r)];case 1:return o.sent(),[2]}}))}))},Pt=function(e,t,n,r){return Et(void 0,void 0,void 0,(function(){return kt(this,(function(o){switch(o.label){case 0:return[4,gt.A.makeQuery("UPDATE user_rooms SET userStatus = 'member'\n            WHERE roomID = ? AND userID = ? userStatus = 'requested' AND EXISTS (\n                SELECT roomID FROM rooms WHERE roomID = ? AND ownerUserName = ? LIMIT 1\n            );",[e,n,e,t]).run(r)];case 1:return o.sent(),[2]}}))}))},Ut=function(e,t,n,r){return Et(void 0,void 0,void 0,(function(){return kt(this,(function(o){switch(o.label){case 0:return[4,gt.A.makeQuery("DELETE FROM user_rooms\n            WHERE roomID = ? AND userID = ? AND userStatus = 'requested' AND EXISTS (\n                SELECT roomID FROM rooms WHERE roomID = ? AND ownerUserName = ? LIMIT 1\n            );",[e,n,e,t]).run(r)];case 1:return o.sent(),[2]}}))}))},_t=function(e,t,n,r){return Et(void 0,void 0,void 0,(function(){return kt(this,(function(o){switch(o.label){case 0:return[4,gt.A.makeQuery("DELETE FROM user_rooms\n            WHERE roomID = ? AND userID = ? AND userStatus = 'member' AND EXISTS (\n                SELECT roomID FROM rooms WHERE roomID = ? AND ownerUserName = ? LIMIT 1\n            );",[e,n,e,t]).run(r)];case 1:return o.sent(),[2]}}))}))};var jt=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))},Ct=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},Ft=i().Router(),Mt=h.A.isDevMode();Ft.get("/",v.A.authenticateTokenOptional,(function(e,t){return jt(void 0,void 0,void 0,(function(){return Ct(this,(function(n){return t.render("page/menu/index",L.makeEJSParams(e,!0,{loginDestination:"",embeddedScripts:["util/textUtil.ejs"]})),[2]}))}))})),Ft.get("/rooms.html",v.A.authenticateTokenOptional,(function(e,t){return jt(void 0,void 0,void 0,(function(){return Ct(this,(function(n){return t.render("page/menu/rooms",L.makeEJSParams(e,!1,{loginDestination:"rooms.html",embeddedScripts:["util/textUtil.ejs"],tabName:e.query.tabname?e.query.tabname:"owned",searchLimitPerPage:m.A.search.searchLimitPerPage})),[2]}))}))})),Ft.get("/register",(function(e,t){t.render("page/form/register",L.makeEJSParams(e,!0,{registerDestination:"",embeddedScripts:["util/textUtil.ejs"]}))})),Ft.get("/room",v.A.authenticateToken,(function(e,t){return jt(void 0,void 0,void 0,(function(){var n,r,o;return Ct(this,(function(a){switch(a.label){case 0:return(n=v.A.getUserFromReqToken(e))?[4,Nt(e.query.roomid,n.userID,t)]:(t.status(404).send("User not found."),[2]);case 1:return r=a.sent(),t.statusCode<200||t.statusCode>=300||(o=r[0],t.render("page/private/room",L.makeEJSParams(e,!1,{roomID:e.query.roomid,roomContent:o,title:o.roomName,desc:o.roomName,keywords:void 0}))),[2]}}))}))})),Mt&&(Ft.get("/console",(function(e,t){t.render("page/misc/console",L.makeEJSParams(e,!0,{}))})),Ft.get("/test-ui",(function(e,t){t.render("page/misc/test_ui",L.makeEJSParams(e,!0,{loginDestination:"",registerDestination:"",embeddedScripts:["util/textUtil.ejs"]}))})));const qt=Ft;var Qt=i().Router();Qt.get("/create-room",v.A.authenticateToken,(function(e,t){t.render("popup/createRoom",L.makeEJSParams(e,!1,{}))})),Qt.get("/room-members",v.A.authenticateToken,(function(e,t){return n=void 0,r=void 0,a=function(){return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(n){return t.render("popup/roomMembers",L.makeEJSParams(e,!1,{roomID:e.query.roomid,tabName:e.query.tabname?e.query.tabname:"associated"})),[2]}))},new((o=void 0)||(o=Promise))((function(e,t){function i(e){try{s(a.next(e))}catch(e){t(e)}}function c(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(i,c)}s((a=a.apply(n,r||[])).next())}));var n,r,o,a}));const Bt=Qt;var Wt=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))},Ht=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},Jt=i().Router(),Vt=function(e,t){return v.A.getUserFromReqToken(e)||(t.status(404).send("User not found."),null)};Jt.post("/create",v.A.authenticateToken,(function(e,t){return Wt(void 0,void 0,void 0,(function(){var n;return Ht(this,(function(r){switch(r.label){case 0:return(n=Vt(e,t))?[4,At(e.body.roomName,n.userName,t)]:[2];case 1:return r.sent(),pt(t),[2]}}))}))})),Jt.delete("/delete",v.A.authenticateToken,(function(e,t){return Wt(void 0,void 0,void 0,(function(){var n;return Ht(this,(function(r){switch(r.label){case 0:return(n=Vt(e,t))?[4,St(e.body.roomID,n.userName,t)]:[2];case 1:return r.sent(),pt(t),[2]}}))}))})),Jt.delete("/leave",v.A.authenticateToken,(function(e,t){return Wt(void 0,void 0,void 0,(function(){var n;return Ht(this,(function(r){switch(r.label){case 0:return(n=Vt(e,t))?[4,Tt(e.body.roomID,n.userName,t)]:[2];case 1:return r.sent(),pt(t),[2]}}))}))})),Jt.put("/accept-invitation",v.A.authenticateToken,(function(e,t){return Wt(void 0,void 0,void 0,(function(){var n;return Ht(this,(function(r){switch(r.label){case 0:return(n=Vt(e,t))?[4,Rt(e.body.roomID,n.userID,t)]:[2];case 1:return r.sent(),pt(t),[2]}}))}))})),Jt.delete("/ignore-invitation",v.A.authenticateToken,(function(e,t){return Wt(void 0,void 0,void 0,(function(){var n;return Ht(this,(function(r){switch(r.label){case 0:return(n=Vt(e,t))?[4,xt(e.body.roomID,n.userID,t)]:[2];case 1:return r.sent(),pt(t),[2]}}))}))})),Jt.post("/request-to-join",v.A.authenticateToken,(function(e,t){return Wt(void 0,void 0,void 0,(function(){var n;return Ht(this,(function(r){switch(r.label){case 0:return(n=Vt(e,t))?[4,It(e.body.roomID,n.userID,t)]:[2];case 1:return r.sent(),pt(t),[2]}}))}))})),Jt.delete("/cancel-request",v.A.authenticateToken,(function(e,t){return Wt(void 0,void 0,void 0,(function(){var n;return Ht(this,(function(r){switch(r.label){case 0:return(n=Vt(e,t))?[4,Lt(e.body.roomID,n.userID,t)]:[2];case 1:return r.sent(),pt(t),[2]}}))}))})),Jt.post("/invite",v.A.authenticateToken,(function(e,t){return Wt(void 0,void 0,void 0,(function(){var n;return Ht(this,(function(r){switch(r.label){case 0:return(n=Vt(e,t))?[4,Dt(e.body.roomID,n.userName,e.body.userID,t)]:[2];case 1:return r.sent(),pt(t),[2]}}))}))})),Jt.delete("/cancel-invite",v.A.authenticateToken,(function(e,t){return Wt(void 0,void 0,void 0,(function(){var n;return Ht(this,(function(r){switch(r.label){case 0:return(n=Vt(e,t))?[4,Ot(e.body.roomID,n.userName,e.body.userID,t)]:[2];case 1:return r.sent(),pt(t),[2]}}))}))})),Jt.put("/accept-request",v.A.authenticateToken,(function(e,t){return Wt(void 0,void 0,void 0,(function(){var n;return Ht(this,(function(r){switch(r.label){case 0:return(n=Vt(e,t))?[4,Pt(e.body.roomID,n.userName,e.body.userID,t)]:[2];case 1:return r.sent(),pt(t),[2]}}))}))})),Jt.delete("/ignore-request",v.A.authenticateToken,(function(e,t){return Wt(void 0,void 0,void 0,(function(){var n;return Ht(this,(function(r){switch(r.label){case 0:return(n=Vt(e,t))?[4,Ut(e.body.roomID,n.userName,e.body.userID,t)]:[2];case 1:return r.sent(),pt(t),[2]}}))}))})),Jt.delete("/kickout",v.A.authenticateToken,(function(e,t){return Wt(void 0,void 0,void 0,(function(){var n;return Ht(this,(function(r){switch(r.label){case 0:return(n=Vt(e,t))?[4,_t(e.body.roomID,n.userName,e.body.userID,t)]:[2];case 1:return r.sent(),pt(t),[2]}}))}))}));const Gt=Jt;var zt=n(563),Yt=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))},$t=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},Kt=i().Router(),Xt=function(e,t){var n=v.A.getUserFromReqToken(e);if(!n)return t.status(404).send("User not found."),null;var r=parseInt(e.query.page);return isNaN(r)?(t.status(400).send("Invalid page number."),null):{user:n,page:r}};Kt.get("/rooms/owned",v.A.authenticateToken,(function(e,t){return Yt(void 0,void 0,void 0,(function(){var n,r;return $t(this,(function(o){switch(o.label){case 0:return(n=Xt(e,t))?[4,zt.A.rooms.whichIOwn(n.user.userID,n.page,t)]:[2];case 1:return r=o.sent(),pt(t,r),[2]}}))}))})),Kt.get("/rooms/joined",v.A.authenticateToken,(function(e,t){return Yt(void 0,void 0,void 0,(function(){var n,r;return $t(this,(function(o){switch(o.label){case 0:return(n=Xt(e,t))?[4,zt.A.rooms.whichIJoined(n.user.userID,n.page,t)]:[2];case 1:return r=o.sent(),pt(t,r),[2]}}))}))})),Kt.get("/rooms/invited",v.A.authenticateToken,(function(e,t){return Yt(void 0,void 0,void 0,(function(){var n,r;return $t(this,(function(o){switch(o.label){case 0:return(n=Xt(e,t))?[4,zt.A.rooms.whichInvitedMe(n.user.userID,n.page,t)]:[2];case 1:return r=o.sent(),pt(t,r),[2]}}))}))})),Kt.get("/rooms/requested",v.A.authenticateToken,(function(e,t){return Yt(void 0,void 0,void 0,(function(){var n,r;return $t(this,(function(o){switch(o.label){case 0:return(n=Xt(e,t))?[4,zt.A.rooms.whichIRequestedToJoin(n.user.userID,n.page,t)]:[2];case 1:return r=o.sent(),pt(t,r),[2]}}))}))})),Kt.get("/rooms/pending",v.A.authenticateToken,(function(e,t){return Yt(void 0,void 0,void 0,(function(){var n,r;return $t(this,(function(o){switch(o.label){case 0:return(n=Xt(e,t))?[4,zt.A.rooms.whichIAmPendingToJoin(n.user.userID,n.page,t)]:[2];case 1:return r=o.sent(),pt(t,r),[2]}}))}))})),Kt.get("/rooms/associated",v.A.authenticateToken,(function(e,t){return Yt(void 0,void 0,void 0,(function(){var n,r;return $t(this,(function(o){switch(o.label){case 0:return(n=Xt(e,t))?[4,zt.A.rooms.whichIAmAssociatedWith(n.user.userID,n.page,t)]:[2];case 1:return r=o.sent(),pt(t,r),[2]}}))}))})),Kt.get("/rooms/others",v.A.authenticateToken,(function(e,t){return Yt(void 0,void 0,void 0,(function(){var n,r;return $t(this,(function(o){switch(o.label){case 0:return(n=Xt(e,t))?[4,zt.A.rooms.others(n.user.userID,n.page,t)]:[2];case 1:return r=o.sent(),pt(t,r),[2]}}))}))})),Kt.get("/users/joined",v.A.authenticateToken,(function(e,t){return Yt(void 0,void 0,void 0,(function(){var n,r;return $t(this,(function(o){switch(o.label){case 0:return(n=Xt(e,t))?[4,zt.A.users.whoJoinedRoom(e.query.roomid,n.page,t)]:[2];case 1:return r=o.sent(),pt(t,r),[2]}}))}))})),Kt.get("/users/invited",v.A.authenticateToken,(function(e,t){return Yt(void 0,void 0,void 0,(function(){var n,r;return $t(this,(function(o){switch(o.label){case 0:return(n=Xt(e,t))?[4,zt.A.users.whoAreInvitedToJoinRoom(e.query.roomid,n.page,t)]:[2];case 1:return r=o.sent(),pt(t,r),[2]}}))}))})),Kt.get("/users/requested",v.A.authenticateToken,(function(e,t){return Yt(void 0,void 0,void 0,(function(){var n,r;return $t(this,(function(o){switch(o.label){case 0:return(n=Xt(e,t))?[4,zt.A.users.whoRequestedToJoinRoom(e.query.roomid,n.page,t)]:[2];case 1:return r=o.sent(),pt(t,r),[2]}}))}))})),Kt.get("/users/pending",v.A.authenticateToken,(function(e,t){return Yt(void 0,void 0,void 0,(function(){var n,r;return $t(this,(function(o){switch(o.label){case 0:return(n=Xt(e,t))?[4,zt.A.users.whoArePendingToJoinRoom(e.query.roomid,n.page,t)]:[2];case 1:return r=o.sent(),pt(t,r),[2]}}))}))})),Kt.get("/users/associated",v.A.authenticateToken,(function(e,t){return Yt(void 0,void 0,void 0,(function(){var n,r;return $t(this,(function(o){switch(o.label){case 0:return(n=Xt(e,t))?[4,zt.A.users.whoAreAssociatedWithRoom(e.query.roomid,n.page,t)]:[2];case 1:return r=o.sent(),pt(t,r),[2]}}))}))})),Kt.get("/users/others",v.A.authenticateToken,(function(e,t){return Yt(void 0,void 0,void 0,(function(){var n,r;return $t(this,(function(o){switch(o.label){case 0:return(n=Xt(e,t))?[4,zt.A.users.others(e.query.roomid,n.page,t)]:[2];case 1:return r=o.sent(),pt(t,r),[2]}}))}))}));const Zt=Kt,en=require("socket.io");var tn=n.n(en),nn=n(482),rn=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))},on=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};const an=function(e){var t=e.of("/chat");t.use((function(e,t){return rn(void 0,void 0,void 0,(function(){var n,r;return on(this,(function(o){switch(o.label){case 0:return n=e.request,r=n.res,[4,v.A.authenticateToken_internal(t,!1,n,r)];case 1:return o.sent()||b.A.logRaw("Socket Auth Failure","high","pink"),[2]}}))}))})),t.on("connection",(function(e){e.on("join chat",(function(t){return rn(void 0,void 0,void 0,(function(){return on(this,(function(n){switch(n.label){case 0:return[4,e.join(t)];case 1:return n.sent(),[2]}}))}))})),e.on("leave chat",(function(t){return rn(void 0,void 0,void 0,(function(){return on(this,(function(n){switch(n.label){case 0:return[4,e.leave(t)];case 1:return n.sent(),[2]}}))}))})),e.on("chat message",(function(n){b.A.log("Chat Message Received",{data:n},"low");var r=e.data.name=n.name,o=e.data.room=n.room,a=n.message;e.join(o),t.to(o).emit("chat message","<b>".concat(r,":</b> ").concat(a))}))}))};N().config();switch(N().config(),n(273),n(718),process.env.TYPE){case"website":!function(){var e,t,n,r;e=this,t=void 0,r=function(){var e,t;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(n){switch(n.label){case 0:return h.A.isDevMode()?[4,ht()]:[3,2];case 1:n.sent(),n.label=2;case 2:return e=i()(),t=s().createServer(e),e.set("view engine","ejs"),e.use(l().json()),e.use(l().urlencoded({extended:!0})),e.use(f()()),m.A.page.bypassDynamicPages||e.use("/",qt),e.use("/popup",Bt),e.use("/api/auth",wt),e.use("/api/search",Zt),e.use("/api/room",Gt),e.use(i().static(o().join(process.env.PWD,process.env.STATIC_PAGE_ROOT_DIR))),t.listen(process.env.PORT,(function(){console.log("---------------------------------------------"),console.log("Listening to port ".concat(process.env.PORT,"."))})),function(e){var t=new(tn().Server)(e);t.listen(8080),nn.A.init(t),an(t)}(t),[2]}}))},new((n=void 0)||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))}();break;case"ssg":ht();break;case"db_clear":gt.A.runSQLFile("clear.sql");break;case"db_init":gt.A.runSQLFile("init.sql");break;default:throw new Error("Unknown TYPE :: ".concat(process.env.TYPE))}})();