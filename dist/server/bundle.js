(()=>{"use strict";var e={52:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(818);n.n(r)().config();const o={getRootURL:function(){switch(process.env.MODE){case"dev":return"http://localhost:".concat(process.env.PORT);case"ssg":case"prod":return process.env.ROOT_URL;default:return console.error("Unknown mode :: ".concat(process.env.MODE)),"_ERROR_"}},isDevMode:function(){return"dev"==process.env.MODE},isSSGMode:function(){return"ssg"==process.env.MODE},isProdMode:function(){return"prod"==process.env.MODE}}},114:(e,t,n)=>{n.d(t,{A:()=>u});var r,o=n(224),a=n(236),i=n(52),c=n(767),s="</td>";const u={init:function(e){r=e.of("/console").on("connection",function(e){console.log("(consoleIO) Client connected"),e.on("command",function(e){console.log("(consoleIO) Command received: [".concat(e,"]"));var t=e.split(" ");switch(t[0]){case"test":t.shift(),0==t.length?a.A.logRaw("Please provide the name of the test.","high","pink"):o.default.get("test")(t[0],1==t.length?"low":t[1]);break;case"print":t.shift(),a.A.logRaw(0==t.length?"-":t.join(" "),"high");break;case"db":i.A.isDevMode()?(t.shift(),c.A.runSQLFile("".concat(t[0],".sql"))):a.A.logRaw('Command "'.concat(t[0],'" is supported only in dev mode.'),"high","pink");break;case"reboot":a.A.logRaw("Rebooting...","high"),process.exit(0);break;default:a.A.logRaw('Unknown command "'.concat(t[0],'".'),"high","pink")}}),e.on("disconnect",function(){console.log("(consoleIO) Client disconnected")})})},log:function(e,t,n){var o,a,i;r?r.emit("log",(o=e,a=t,i=n,"".concat('<td style="color: #e0e020; background-color: #202090;">').concat(o).concat(s).concat('<td style="color: #20e020; background-color: #101010;">').concat(a).concat(s).concat('<td style="color: #303030; background-color: #c0c0c0;">').concat(i).concat(s))):console.log("".concat(e,"\n(ORIGIN: ").concat(t,")\n(DETAILS: ").concat(n,")"))}}},224:(e,t,n)=>{n.r(t),n.d(t,{default:()=>o});var r={};const o={add:function(e,t){if(null!=r[e])throw new Error("Service with key '".concat(e,"' already exists."));r[e]=t},get:function(e){return r[e]}}},236:(e,t,n)=>{n.d(t,{A:()=>i});var r=n(114),o=[],a={thresholdLogLevel:0,setThresholdLogLevel:function(e){a.thresholdLogLevel=isNaN(e)?a.getLogLevelFromName(e):e},getThresholdLogLevel:function(){return a.thresholdLogLevel},getLogLevelFromName:function(e){switch(e){case"low":return 0;case"medium":return 1;case"high":return 2;default:console.error('ERROR: Unknown log level name ("'.concat(e,'")'))}return 0},log:function(e,t,n,o){void 0===t&&(t=void 0),void 0===n&&(n="high");var i="";null!=t&&(i=JSON.stringify(t));var c=a.getStackTrace();a.getLogLevelFromName(n)>=a.thresholdLogLevel&&r.A.log((o?'<b style="color:'.concat(o,'">'):"")+e+(o?"</b>":""),c,i)},logRaw:function(e,t,n){void 0===t&&(t="high"),a.log(e,void 0,t,n)},getStackTrace:function(){for(var e=[],t=o.length-1;t>=0;--t)e.push(o[t]);return e.join(" <- ")},pushStackTrace:function(e){o.push(e),a.logRaw("pushStackTrace: ".concat(e),"high","gray")},popStackTrace:function(e){if(0!=o.length){var t=o.pop();t==e?a.logRaw("popStackTrace: ".concat(e),"high","gray"):a.logRaw("Name mismatch in stackTrace :: (traceName = ".concat(e,", expectedTraceName = ").concat(t,")"),"high","pink")}else a.logRaw("No name to pop in stackTrace :: (traceName = ".concat(e,")"),"high","pink")}};const i=a},415:(e,t,n)=>{n.d(t,{A:()=>g});const r=require("crypto");var o=n.n(r);const a=require("nodemailer");var i=n.n(a),c=n(767),s=n(818),u=n.n(s),l=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})},d=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};u().config();const f={selectByEmail:function(e,t){return l(void 0,void 0,void 0,function(){return d(this,function(n){switch(n.label){case 0:return[4,c.A.makeQuery("SELECT * FROM emailVerifications WHERE email = ?;",[e]).run(t,"EmailDB.verifications.selectByEmail")];case 1:return[2,n.sent()]}})})},insert:function(e,t,n,r){return l(void 0,void 0,void 0,function(){return d(this,function(o){switch(o.label){case 0:return[4,c.A.makeQuery("INSERT INTO emailVerifications (email, verificationCode, expirationTime) VALUES (?, ?, ?);",[e,t,n.toString()]).run(r,"EmailDB.verifications.insert")];case 1:return o.sent(),[2]}})})},updateExpirationTime:function(e,t,n){return l(void 0,void 0,void 0,function(){return d(this,function(r){switch(r.label){case 0:return[4,c.A.makeQuery("UPDATE emailVerifications SET expirationTime = ? WHERE email = ?;",[t.toString(),e]).run(n,"EmailDB.verifications.updateExpirationTime")];case 1:return r.sent(),[2]}})})},deleteExpired:function(e,t){return l(void 0,void 0,void 0,function(){return d(this,function(n){switch(n.label){case 0:return[4,c.A.makeQuery("DELETE FROM emailVerifications WHERE expirationTime < ?;",[e.toString()]).run(t,"EmailDB.verifications.deleteExpired")];case 1:return n.sent(),[2]}})})}};var h=n(790),m=n(236),p=n(958),v=n(467),b=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})},y=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};u().config();const g={startEmailVerification:function(e,t){return b(void 0,void 0,void 0,function(){var n,r,a,c,s,u,l;return y(this,function(d){switch(d.label){case 0:return d.trys.push([0,9,,10]),[4,f.deleteExpired(Math.floor(.001*Date.now()),t)];case 1:return d.sent(),t.statusCode<200||t.statusCode>=300?[2]:null!=(n=h.A.findErrorInEmailAddress(e.body.email))?(m.A.log("Email Input Error",{email:e.body.email,emailError:n},"high","pink"),t.status(400).send(v.A.displayText.message[n]),[2]):[4,f.selectByEmail(e.body.email,t)];case 2:return r=d.sent(),t.statusCode<200||t.statusCode>=300?[2]:r&&r.length>0?(m.A.log("Email is already undergoing verification",{email:e.body.email},"high","pink"),t.status(403).send('Email "'.concat(e.body.email,'" is already undergoing verification.')),[2]):(a=new Array(8).fill(null).map(function(){return"0123456789".charAt(o().randomInt(10))}).join(""),[4,f.insert(e.body.email,a,Math.floor(.001*Date.now())+p.A.auth.emailVerificationTimeoutInSeconds,t)]);case 3:return d.sent(),t.statusCode<200||t.statusCode>=300?[2]:p.A.auth.bypassEmailVerification?(m.A.log("Email transmission bypassed",{email:e.body.email},"low"),t.status(201).send(a),[3,8]):[3,4];case 4:return c=i().createTransport({service:"naver",host:"smtp.naver.com",auth:{user:"pinkroom77@naver.com",pass:process.env.EMAIL_SENDER_PASS}}),s={from:"pinkroom77@naver.com",to:e.body.email,subject:"Here is your email verification code.",text:"Your verification code is ".concat(a)},[4,c.sendMail(s)];case 5:return u=d.sent(),c.close(),u.accepted?(m.A.log("Email sent",{email:e.body.email},"low"),t.sendStatus(201),[3,8]):[3,6];case 6:return m.A.log("Email failed to be sent",{email:e.body.email},"high","pink"),[4,f.updateExpirationTime(e.body.email,Math.floor(.001*Date.now())+120,t)];case 7:if(d.sent(),t.statusCode<200||t.statusCode>=300)return[2];t.status(500).send('Error while sending the verification code to "'.concat(e.body.email,'". Please try again after 2 minutes.')),d.label=8;case 8:return[3,10];case 9:return l=d.sent(),m.A.log("Email Verification Start Error",{err:l},"high","pink"),t.status(500).send("ERROR: Failed to start email verification (".concat(l,").")),[3,10];case 10:return[2]}})})},endEmailVerification:function(e,t){return b(void 0,void 0,void 0,function(){var n,r,o;return y(this,function(a){switch(a.label){case 0:return null!=(n=h.A.findErrorInEmailAddress(e.body.email))?(m.A.log("Email Input Error",{email:e.body.email,emailError:n},"high","pink"),t.status(400).send(v.A.displayText.message[n]),[2]):(r=e.body.verificationCode,[4,f.selectByEmail(e.body.email,t)]);case 1:return o=a.sent(),t.statusCode<200||t.statusCode>=300?[2]:o&&0!=o.length?o[0].verificationCode!=r?(m.A.log("Verification Code Mismatch (code entered = '".concat(r,"')"),{email:e.body.email,actualCode:o[0].verificationCode,enteredCode:r},"high","pink"),t.status(403).send('Wrong verification code for email "'.concat(e.body.email,'".')),[2]):(t.status(202),[2]):(m.A.log("No pending email verification found",{email:e.body.email},"high","pink"),t.status(404).send('No pending verification found for email "'.concat(e.body.email,'".')),[2])}})})}}},467:(e,t,n)=>{n.d(t,{A:()=>r});const r={displayText:{menuName:{index:"Home",rooms:"Rooms",arcade:"Games",library:"Blog"},tabName:{"rooms/owned":"My","rooms/joined":"Joined","rooms/pending":"Pending","rooms/others":"Others","roomMembers/associated":"Members","roomMembers/others":"Invite Others"},message:{"error/userName/length":"Username must be between 4 and 16 characters long.","error/userName/chars":"Username can only contain alphabets, numbers, and underbar(_).","error/password/length":"Password must be between 6 and 24 characters long.","error/password/chars":"Password can only contain alphabets, numbers, and the following special characters: ~`!@#$%^&*()-_+={}[]|\\:;\"'<>,.?/","error/email/length":"Email address must not contain more than 64 characters.","error/email/chars":"Please enter a valid email address.","error/roomName/length":"Room name must be between 4 and 64 characters long.","error/roomName/chars":"Room name can only contain alphabets, numbers, spaces, and the following special characters: ~`!@#$%^&*()-_+={}[]|\\:;\"'<>,.?/","rule/userName/length":"Username must be between 4 and 16 characters long.","rule/userName/chars":"Username can only contain alphabets, numbers, and underbar(_).","rule/password/length":"Password must be between 6 and 24 characters long.","rule/password/chars":"Password can only contain alphabets, numbers, and the following special characters: ~`!@#$%^&*()-_+={}[]|\\:;\"'<>,.?/","rule/email/length":"Email address must not contain more than 64 characters.","rule/roomName/length":"Room name must be between 4 and 64 characters long.","rule/roomName/chars":"Room name can only contain alphabets, numbers, spaces, and the following special characters: ~`!@#$%^&*()-_+={}[]|\\:;\"'<>,.?/"}},search:{searchLimitPerPage:10}}},567:(e,t,n)=>{n.d(t,{A:()=>l});var r=n(767),o=n(467),a=n(818),i=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})},c=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};n.n(a)().config();var s=function(e,t){var n=o.A.search.searchLimitPerPage,r=" AND (".concat(e.map(function(e){return"user_rooms.userStatus = '".concat(e,"'")}).join(" OR "),")");return"SELECT rooms.roomID AS roomID, rooms.roomName AS roomName, user_rooms.userStatus as userStatus, rooms.ownerUserName as ownerUserName\n    FROM rooms INNER JOIN user_rooms ON user_rooms.roomID = rooms.roomID\n    WHERE user_rooms.userID = ?".concat(e.length>0?r:"","\n    ORDER BY rooms.roomID DESC LIMIT ").concat(n,", ").concat(t*n,";")},u=function(e,t){var n=o.A.search.searchLimitPerPage,r=" AND (".concat(e.map(function(e){return"user_rooms.userStatus = '".concat(e,"'")}).join(" OR "),")");return"SELECT users.userID as userID, users.userName AS userName, user_rooms.userStatus as userStatus\n    FROM users INNER JOIN user_rooms ON user_rooms.userID = users.userID\n    WHERE user_rooms.roomID = ?".concat(e.length>0?r:"","\n    ORDER BY users.userID DESC LIMIT ").concat(n,", ").concat(t*n,";")};const l={rooms:{withRoomName:function(e,t){return i(void 0,void 0,void 0,function(){return c(this,function(n){switch(n.label){case 0:return[4,r.A.makeQuery("SELECT * FROM rooms WHERE roomName = ?;",[e]).run(t,"SearchDB.rooms.withRoomName")];case 1:return[2,n.sent()]}})})},whichIOwn:function(e,t,n){return i(void 0,void 0,void 0,function(){return c(this,function(o){switch(o.label){case 0:return[4,r.A.makeQuery(s(["owner"],t),[e]).run(n,"SearchDB.rooms.whichIOwn")];case 1:return[2,o.sent()]}})})},whichIJoined:function(e,t,n){return i(void 0,void 0,void 0,function(){return c(this,function(o){switch(o.label){case 0:return[4,r.A.makeQuery(s(["member"],t),[e]).run(n,"SearchDB.rooms.whichIJoined")];case 1:return[2,o.sent()]}})})},whichInvitedMe:function(e,t,n){return i(void 0,void 0,void 0,function(){return c(this,function(o){switch(o.label){case 0:return[4,r.A.makeQuery(s(["invited"],t),[e]).run(n,"SearchDB.rooms.whichInvitedMe")];case 1:return[2,o.sent()]}})})},whichIRequestedToJoin:function(e,t,n){return i(void 0,void 0,void 0,function(){return c(this,function(o){switch(o.label){case 0:return[4,r.A.makeQuery(s(["requested"],t),[e]).run(n,"SearchDB.rooms.whichIRequestedToJoin")];case 1:return[2,o.sent()]}})})},whichIAmPendingToJoin:function(e,t,n){return i(void 0,void 0,void 0,function(){return c(this,function(o){switch(o.label){case 0:return[4,r.A.makeQuery(s(["invited","requested"],t),[e]).run(n,"SearchDB.rooms.whichIAmPendingToJoin")];case 1:return[2,o.sent()]}})})},whichIAmAssociatedWith:function(e,t,n){return i(void 0,void 0,void 0,function(){return c(this,function(o){switch(o.label){case 0:return[4,r.A.makeQuery(s([],t),[e]).run(n,"SearchDB.rooms.whichIAmAssociatedWith")];case 1:return[2,o.sent()]}})})},others:function(e,t,n){return i(void 0,void 0,void 0,function(){var a;return c(this,function(i){switch(i.label){case 0:return a=o.A.search.searchLimitPerPage,[4,r.A.makeQuery("SELECT roomID, roomName FROM rooms\n                WHERE NOT EXISTS (SELECT roomID FROM user_rooms WHERE userID = ".concat(e," LIMIT 1)\n                ORDER BY roomID DESC LIMIT ").concat(a,", ").concat(t*a,";"),void 0).run(n,"SearchDB.rooms.others")];case 1:return[2,i.sent()]}})})}},users:{withUserName:function(e,t){return i(void 0,void 0,void 0,function(){return c(this,function(n){switch(n.label){case 0:return[4,r.A.makeQuery("SELECT * FROM users WHERE userName = ?;",[e]).run(t,"SearchDB.users.withUserName")];case 1:return[2,n.sent()]}})})},withEmail:function(e,t){return i(void 0,void 0,void 0,function(){return c(this,function(n){switch(n.label){case 0:return[4,r.A.makeQuery("SELECT * FROM users WHERE email = ?;",[e]).run(t,"SearchDB.users.withEmail")];case 1:return[2,n.sent()]}})})},whoJoinedRoom:function(e,t,n){return i(void 0,void 0,void 0,function(){return c(this,function(o){switch(o.label){case 0:return[4,r.A.makeQuery(u(["member"],t),[e]).run(n,"SearchDB.users.whoJoinedRoom")];case 1:return[2,o.sent()]}})})},whoAreInvitedToJoinRoom:function(e,t,n){return i(void 0,void 0,void 0,function(){return c(this,function(o){switch(o.label){case 0:return[4,r.A.makeQuery(u(["invited"],t),[e]).run(n,"SearchDB.users.whoAreInvitedToJoinRoom")];case 1:return[2,o.sent()]}})})},whoRequestedToJoinRoom:function(e,t,n){return i(void 0,void 0,void 0,function(){return c(this,function(o){switch(o.label){case 0:return[4,r.A.makeQuery(u(["requested"],t),[e]).run(n,"SearchDB.users.whoRequestedToJoinRoom")];case 1:return[2,o.sent()]}})})},whoArePendingToJoinRoom:function(e,t,n){return i(void 0,void 0,void 0,function(){return c(this,function(o){switch(o.label){case 0:return[4,r.A.makeQuery(u(["invited","requested"],t),[e]).run(n,"SearchDB.users.whoArePendingToJoinRoom")];case 1:return[2,o.sent()]}})})},whoAreAssociatedWithRoom:function(e,t,n){return i(void 0,void 0,void 0,function(){return c(this,function(o){switch(o.label){case 0:return[4,r.A.makeQuery(u([],t),[e]).run(n,"SearchDB.users.whoAreAssociatedWithRoom")];case 1:return[2,o.sent()]}})})},others:function(e,t,n){return i(void 0,void 0,void 0,function(){var a;return c(this,function(i){switch(i.label){case 0:return a=o.A.search.searchLimitPerPage,[4,r.A.makeQuery("SELECT userID, userName FROM users\n                WHERE NOT EXISTS (SELECT userID FROM user_rooms WHERE roomID = ".concat(e," LIMIT 1)\n                ORDER BY userID DESC LIMIT ").concat(a,", ").concat(t*a,";"),void 0).run(n,"SearchDB.users.others")];case 1:return[2,i.sent()]}})})}}}},611:e=>{e.exports=require("http")},692:(e,t,n)=>{n.r(t),n.d(t,{default:()=>B});var r=n(52),o=n(767),a=n(958),i=n(611),c=n.n(i),s=n(236),u=n(849);const l={limitPropValueTextSize:(e,t,n)=>{const r=l.deepCopyObj(e);return l.limitPropValueTextSize_internal(r,t,n),r},limitPropValueTextSize_internal:(e,t,n)=>{for(const[r,o]of Object.entries(e)){if(r==t){if("string"!=typeof o)throw new Error(`Property "${t}" is not a string. (obj = ${JSON.stringify(e)})`);const a=o.substring(0,n);return void(e[r]=a.length<o.length?a+"...":a)}o.constructor==Object&&l.limitPropValueTextSize_internal(o,t,n)}},deepCopyObj:e=>{const t={};for(const[n,r]of Object.entries(e))if(Array.isArray(r)){const e=new Array(r.length);for(let t=0;t<r.length;++t)e[t]=r[t];t[n]=e}else r.constructor==Object?t[n]=l.deepCopyObj(r):t[n]=r;return t}},d=l;var f=n(818),h=n.n(f);h().config();var m={},p=function(e,t,n){void 0===n&&(n=void 0),s.A.log(t,n,"high","pink");var r="";null!=n&&(r=" :: "+JSON.stringify(n)),e("[".concat(t,"]").concat(r))},v={_reset:function(){m={}},makeRequest:function(e,t,n,r,o){return void 0===o&&(o=!0),new Promise(function(a,i){var l={"Content-Type":"application/json"};if(e){var f=m[e];if(!f)return void p(i,"Token Not Found (".concat(n,")"),{senderUserName:e});l.Cookie="thingspool_token=".concat(f,";")}var h={host:"localhost",port:process.env.PORT,path:n,method:t,headers:l},b=c().request(h,function(e){if(v.resOk(e)){s.A.log("Res Callback (".concat(n,")"),{statusCode:e.statusCode},"low");var t="";e.setEncoding("utf8"),e.on("data",function(r){v.resOk(e)?(s.A.log("Res Data (".concat(n,")"),{statusCode:e.statusCode,chunk:r},"low"),t+=r):p(i,"Res Data ERROR (".concat(n,")"),{statusCode:e.statusCode,chunk:r})}),e.on("end",function(){v.resOk(e)?(s.A.log("Res End (".concat(n,")"),{statusCode:e.statusCode,data:t},"low"),o&&function(e,t){var n=t.headers["set-cookie"];if(n){for(var r=!1,o=0,a=n.join(";").split(";").map(function(e){return e.trim().split("=")});o<a.length;o++){var i=a[o];if("thingspool_token"==i[0]){var c=i[1],l=u.A.getUserFromToken(c);if(!l)return;var d=l.userName;m[d]=c;var f=c.substring(0,20);s.A.log("Token Cached (".concat(d,")"),{token:f.length<c.length?f+"...":c},"low"),r=!0}}r||s.A.log("Token Cache Failed",{setCookie:n},"high","pink")}}(0,e),a({res:e,data:t})):p(i,"Res End ERROR (".concat(n,")"),{statusCode:e.statusCode,data:t})}),e.on("error",function(e){return p(i,"Res Exception (".concat(n,")"),{err:e})})}else p(i,"Res Callback ERROR (".concat(n,")"),{statusCode:e.statusCode})});b.on("error",function(e){return p(i,"Req Exception (".concat(n,")"),{err:e})}),r&&b.write(JSON.stringify(r)),b.end(),s.A.log("Req Sent (".concat(n,")"),{options:d.limitPropValueTextSize(h,"Cookie",40),body:r},"high")})},resOk:function(e){return e.statusCode?e.statusCode>=200&&e.statusCode<300:(s.A.log("Res statusCode is undefined.",{},"high","pink"),!1)}};const b=v;var y=n(790),g={},w={},k={},E={},A=function(e,t){return e.ownerUserName==t.userName},N={_reset:function(){g={},w={},k={},E={}},toString:function(){return JSON.stringify({users:g,rooms:w,user_rooms:k},null,4)},toHTMLString:function(){var e=function(e){return"\n\n<h1>".concat(e,"</h1>\n")},t=function(e){return y.A.escapeHTMLChars(JSON.stringify(e,null,4))};return e("users")+t(g)+e("rooms")+t(w)+e("user_rooms")+t(k)+e("emailVerifications")+t(E)},insertUser:function(e){return null==g[e.userName]&&(g[e.userName]=e,!0)},deleteUser:function(e){return null!=g[e.userName]&&(delete g[e.userName],!0)},insertEmailVerification:function(e){return null==E[e.email]&&(E[e.email]=e,!0)},deleteEmailVerification:function(e){return null!=E[e.email]&&(delete E[e.email],!0)},insertRoom:function(e,t){return null!=g[t.userName]&&null==w[e.roomName]&&(e.ownerUserName=t.userName,w[e.roomName]=e,!!N.insertUserRoom({roomName:e.roomName,userName:t.userName,userStatus:"owner"},t)||(s.A.log("Error: insertRoom succeeded but insertUserRoom failed.",{room:e,roomOwner:t},"high","pink"),e.ownerUserName="",delete w[e.roomName],!1))},deleteRoom:function(e,t){if(null!=g[t.userName]&&null!=w[e.roomName]&&A(e,t)){e.ownerUserName="",delete w[e.roomName];var n=[];Object.values(k).filter(function(t){return t.roomName==e.roomName}).map(function(e){return"".concat(e.roomName," :: ").concat(e.userName)}).forEach(function(e){return n.push(e)});for(var r=0,o=n;r<o.length;r++){var a=o[r];delete k[a]}return!0}return!1},insertUserRoom:function(e,t){var n="".concat(e.roomName," :: ").concat(e.userName);return!(null==g[t.userName]||null!=k[n]||"invited"!=e.userStatus&&"requested"!=e.userStatus&&("owner"!=e.userStatus||e.userName!=t.userName)||null==w[e.roomName]||!A(w[e.roomName],t)||(k[n]=e,0))},updateUserRoomStatus:function(e,t){var n="".concat(e.roomName," :: ").concat(e.userName);return!(null==g[t.userName]||null==k[n]||!("invited"==k[n].userStatus&&"member"==e.userStatus||"requested"==k[n].userStatus&&"member"==e.userStatus)||null==w[e.roomName]||!A(w[e.roomName],t)||(k[n]=e,0))},deleteUserRoom:function(e,t){var n="".concat(e.roomName," :: ").concat(e.userName);return!(null==g[t.userName]||null==k[n]||k[n].userStatus!=e.userStatus||null==w[e.roomName]||!A(w[e.roomName],t)||(delete k[n],0))}};const S=N;var T=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})},R=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},I="/api/auth/";const x={initUser:function(e){return T(void 0,void 0,void 0,function(){var t;return R(this,function(n){switch(n.label){case 0:return S.insertUser(e)?(s.A.log("testActions_auth.initUser",{userName:e.userName},"high","cyan"),[4,(r=e.email,T(void 0,void 0,void 0,function(){var e,t;return R(this,function(n){switch(n.label){case 0:return[4,b.makeRequest(null,"POST","".concat(I,"vemail"),{email:r},!1)];case 1:return e=n.sent(),t=e.data,S.insertEmailVerification({email:r,verificationCode:t,expirationTime:Math.floor(.001*Date.now())+a.A.auth.emailVerificationTimeoutInSeconds}),[2,t]}})}))]):[2];case 1:return t=n.sent(),s.A.logRaw("Verification Code = ".concat(t),"low"),[4,b.makeRequest(null,"POST","".concat(I,"register"),{userName:e.userName,password:e.password,email:e.email,verificationCode:t})];case 2:return n.sent(),[2]}var r})})}};var D=n(567),L=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})},O=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},P="/api/room/",U=function(e,t,n,r,o){return L(void 0,void 0,void 0,function(){var a,i,c,s,u,l;return O(this,function(d){switch(d.label){case 0:return[4,D.A.rooms.withRoomName(n.roomName)];case 1:return a=d.sent(),o?[4,D.A.users.withUserName(o.userName)]:[3,3];case 2:return c=d.sent(),[3,4];case 3:c=void 0,d.label=4;case 4:return i=c,s=a&&0!=a.length?a[0].roomID:Math.floor(1e3*Math.random()),u=i&&0!=i.length?i[0].userID:Math.floor(1e3*Math.random()),l={roomID:s,userID:u},[4,b.makeRequest(r.userName,e,"".concat(P).concat(t),l)];case 5:return d.sent(),[2]}})})};const _={create:function(e,t){return L(void 0,void 0,void 0,function(){return O(this,function(n){switch(n.label){case 0:return S.insertRoom(e,t)?(s.A.log("testActions_room.create",{roomName:e.roomName,userName:t.userName},"high","cyan"),[4,b.makeRequest(t.userName,"POST","".concat(P,"create"),{roomName:e.roomName})]):[2];case 1:return n.sent(),[2]}})})},delete:function(e,t){return L(void 0,void 0,void 0,function(){return O(this,function(n){switch(n.label){case 0:return S.deleteRoom(e,t)?(s.A.log("testActions_room.delete",{roomName:e.roomName,userName:t.userName},"high","cyan"),[4,U("DELETE","delete",e,t)]):[2];case 1:return n.sent(),[2]}})})},leave:function(e,t){return L(void 0,void 0,void 0,function(){return O(this,function(n){switch(n.label){case 0:return S.deleteUserRoom({roomName:e.roomName,userName:t.userName,userStatus:"member"},t)?(s.A.log("testActions_room.leave",{roomName:e.roomName,userName:t.userName},"high","cyan"),[4,U("DELETE","leave",e,t)]):[2];case 1:return n.sent(),[2]}})})},acceptInvitation:function(e,t,n){return L(void 0,void 0,void 0,function(){return O(this,function(r){switch(r.label){case 0:return S.updateUserRoomStatus({roomName:e.roomName,userName:n.userName,userStatus:"member"},t)?(s.A.log("testActions_room.acceptInvitation",{roomName:e.roomName,ownerUserName:t.userName,userName:n.userName},"high","cyan"),[4,U("PUT","accept-invitation",e,n)]):[2];case 1:return r.sent(),[2]}})})},ignoreInvitation:function(e,t,n){return L(void 0,void 0,void 0,function(){return O(this,function(r){switch(r.label){case 0:return S.deleteUserRoom({roomName:e.roomName,userName:n.userName,userStatus:"invited"},t)?(s.A.log("testActions_room.ignoreInvitation",{roomName:e.roomName,ownerUserName:t.userName,userName:n.userName},"high","cyan"),[4,U("DELETE","ignore-invitation",e,n)]):[2];case 1:return r.sent(),[2]}})})},requestToJoin:function(e,t,n){return L(void 0,void 0,void 0,function(){return O(this,function(r){switch(r.label){case 0:return S.insertUserRoom({roomName:e.roomName,userName:n.userName,userStatus:"requested"},t)?(s.A.log("testActions_room.requestToJoin",{roomName:e.roomName,ownerUserName:t.userName,userName:n.userName},"high","cyan"),[4,U("POST","request-to-join",e,n)]):[2];case 1:return r.sent(),[2]}})})},cancelRequest:function(e,t,n){return L(void 0,void 0,void 0,function(){return O(this,function(r){switch(r.label){case 0:return S.deleteUserRoom({roomName:e.roomName,userName:n.userName,userStatus:"requested"},t)?(s.A.log("testActions_room.cancelRequest",{roomName:e.roomName,ownerUserName:t.userName,userName:n.userName},"high","cyan"),[4,U("DELETE","cancel-request",e,n)]):[2];case 1:return r.sent(),[2]}})})},invite:function(e,t,n){return L(void 0,void 0,void 0,function(){return O(this,function(r){switch(r.label){case 0:return S.insertUserRoom({roomName:e.roomName,userName:n.userName,userStatus:"invited"},t)?(s.A.log("testActions_room.invite",{roomName:e.roomName,ownerUserName:t.userName,userName:n.userName},"high","cyan"),[4,U("POST","invite",e,t,n)]):[2];case 1:return r.sent(),[2]}})})},cancelInvite:function(e,t,n){return L(void 0,void 0,void 0,function(){return O(this,function(r){switch(r.label){case 0:return S.deleteUserRoom({roomName:e.roomName,userName:n.userName,userStatus:"invited"},t)?(s.A.log("testActions_room.cancelInvite",{roomName:e.roomName,ownerUserName:t.userName,userName:n.userName},"high","cyan"),[4,U("DELETE","cancel-invite",e,t,n)]):[2];case 1:return r.sent(),[2]}})})},acceptRequest:function(e,t,n){return L(void 0,void 0,void 0,function(){return O(this,function(r){switch(r.label){case 0:return S.updateUserRoomStatus({roomName:e.roomName,userName:n.userName,userStatus:"member"},t)?(s.A.log("testActions_room.acceptRequest",{roomName:e.roomName,ownerUserName:t.userName,userName:n.userName},"high","cyan"),[4,U("PUT","accept-request",e,t,n)]):[2];case 1:return r.sent(),[2]}})})},ignoreRequest:function(e,t,n){return L(void 0,void 0,void 0,function(){return O(this,function(r){switch(r.label){case 0:return S.deleteUserRoom({roomName:e.roomName,userName:n.userName,userStatus:"requested"},t)?(s.A.log("testActions_room.ignoreRequest",{roomName:e.roomName,ownerUserName:t.userName,userName:n.userName},"high","cyan"),[4,U("DELETE","ignore-request",e,t,n)]):[2];case 1:return r.sent(),[2]}})})},kickout:function(e,t,n){return L(void 0,void 0,void 0,function(){return O(this,function(r){switch(r.label){case 0:return S.deleteUserRoom({roomName:e.roomName,userName:n.userName,userStatus:"member"},t)?(s.A.log("testActions_room.kickout",{roomName:e.roomName,ownerUserName:t.userName,userName:n.userName},"high","cyan"),[4,U("DELETE","kickout",e,t,n)]):[2];case 1:return r.sent(),[2]}})})}},j=x;const C={room:function(){return e=void 0,t=void 0,r=function(){var e,t,n,r,o,a,i,c,u,l;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(d){switch(d.label){case 0:for(e=4,t=3,n=[],a=0;a<e;++a)n.push({userName:"testUser_".concat(a),password:"testPass_".concat(a),email:"test_email_".concat(a,"@test.com")});for(r=[],a=0;a<t;++a)r.push({roomName:"testRoom ".concat(a),ownerUserName:""});a=0,d.label=1;case 1:return a<e?[4,j.initUser(n[a])]:[3,4];case 2:d.sent(),d.label=3;case 3:return++a,[3,1];case 4:o=Object.values(_),a=0,d.label=5;case 5:if(!(a<300))return[3,10];i=Math.floor(Math.random()*e),c=Math.floor(Math.random()*e),u=Math.floor(Math.random()*t),l=Math.floor(Math.random()*o.length),s.A.log("RANDOM ACTION: ".concat(a),{action:o[l].name,roomName:r[u].roomName,userName1:n[i].userName,userName2:n[c].userName},"low"),d.label=6;case 6:return d.trys.push([6,8,,9]),[4,o[l](r[u],n[i],n[c])];case 7:case 8:return d.sent(),[3,9];case 9:return++a,[3,5];case 10:return[2]}})},new((n=void 0)||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())});var e,t,n,r}};var F=n(224);h().config();var M=!1;function q(e,t){return n=this,i=void 0,u=function(){var n,i,c;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(u){switch(u.label){case 0:return r.A.isDevMode()?M?(s.A.logRaw("TEST REJECTED (".concat(e,") - There is another test running."),"high","pink"),[2]):(s.A.logRaw("TEST STARTED (".concat(e,")"),"high"),M=!0,b._reset(),S._reset(),n=a.A.auth.bypassEmailVerification,a.A.auth.bypassEmailVerification=!0,i=s.A.getThresholdLogLevel(),s.A.setThresholdLogLevel(t),[4,o.A.runSQLFile("clear.sql")]):(s.A.logRaw("TEST REJECTED (".concat(e,") - You are not allowed to run tests on a non-dev mode."),"high","pink"),[2]);case 1:return u.sent(),[4,o.A.runSQLFile("init.sql")];case 2:return u.sent(),(c=C[e])?[4,c()]:(s.A.logRaw('Test routine "'.concat(e,'" not found.'),"high","pink"),M=!1,[2]);case 3:return u.sent(),s.A.setThresholdLogLevel(i),a.A.auth.bypassEmailVerification=n,M=!1,s.A.logRaw("TEST ENDED (".concat(e,")"),"high"),[2]}})},new((c=void 0)||(c=Promise))(function(e,t){function r(e){try{a(u.next(e))}catch(e){t(e)}}function o(e){try{a(u.throw(e))}catch(e){t(e)}}function a(t){var n;t.done?e(t.value):(n=t.value,n instanceof c?n:new c(function(e){e(n)})).then(r,o)}a((u=u.apply(n,i||[])).next())});var n,i,c,u}const B=q;F.default.add("test",q)},767:(e,t,n)=>{n.d(t,{A:()=>w});const r=require("mysql2/promise");var o=n.n(r),a=n(52),i=n(805),c=n(236),s=n(790),u=n(818),l=n.n(u),d=function(){function e(e,t,n){this.pool=e,this.queryStr=t,this.queryParams=n}return e.prototype.run=function(e,t){return n=this,r=void 0,a=function(){var n,r,o;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(a){switch(a.label){case 0:t&&c.A.pushStackTrace(t),c.A.log("SQL Query Started",{queryStr:this.queryStr,queryParams:this.queryParams},"low"),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.pool.query(this.queryStr,this.queryParams)];case 2:return n=a.sent(),r=n[0],n[1],c.A.log("SQL Query Succeeded",{queryStr:this.queryStr,queryParams:this.queryParams},"medium"),t&&c.A.popStackTrace(t),null==e||e.status(202),[2,r];case 3:return o=a.sent(),c.A.log("SQL Query Error",{err:o},"high","pink"),t&&c.A.popStackTrace(t),null==e||e.status(500).send(o),[2,[]];case 4:return[2]}})},new((o=void 0)||(o=Promise))(function(e,t){function i(e){try{s(a.next(e))}catch(e){t(e)}}function c(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o(function(e){e(n)})).then(i,c)}s((a=a.apply(n,r||[])).next())});var n,r,o,a},e}();const f=d;var h=function(){function e(e,t){this.pool=e,this.queries=t}return e.prototype.run=function(e,t){return n=this,r=void 0,a=function(){var n,r,o,a,i,s,u,l,d;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(f){switch(f.label){case 0:t&&c.A.pushStackTrace(t),c.A.log("SQL Transaction Began",{numQueries:this.queries.length},"low"),n=void 0,r=!1,o=0,f.label=1;case 1:return f.trys.push([1,11,13,14]),[4,this.pool.getConnection()];case 2:return[4,(n=f.sent()).beginTransaction()];case 3:f.sent(),a=0,i=this.queries,f.label=4;case 4:return a<i.length?(s=i[a],o++,c.A.log("SQL Transaction Query Started",{progress:"".concat(o,"/").concat(this.queries.length),query:s},"low"),[4,null==n?void 0:n.query(s.queryStr,s.queryParams)]):[3,9];case 5:return u=f.sent(),l=u[0],u[1],0!=l.affectedRows?[3,7]:[4,null==n?void 0:n.rollback()];case 6:return f.sent(),c.A.log("SQL Transaction Query Made No Change",{progress:"".concat(o,"/").concat(this.queries.length),query:s},"high"),t&&c.A.popStackTrace(t),null==e||e.status(403),[2];case 7:c.A.log("SQL Transaction Query Succeeded",{progress:"".concat(o,"/").concat(this.queries.length),query:s},"low"),f.label=8;case 8:return a++,[3,4];case 9:return[4,null==n?void 0:n.commit()];case 10:return f.sent(),c.A.logRaw("SQL Transaction Committed","medium"),t&&c.A.popStackTrace(t),r=!0,[3,14];case 11:return d=f.sent(),c.A.log("SQL Transaction Error",{progress:"".concat(o,"/").concat(this.queries.length),err:d},"high","pink"),[4,null==n?void 0:n.rollback()];case 12:return f.sent(),t&&c.A.popStackTrace(t),null==e||e.status(500).send(d),[3,14];case 13:return null==n||n.release(),r&&(null==e||e.status(202)),[7];case 14:return[2]}})},new((o=void 0)||(o=Promise))(function(e,t){function i(e){try{s(a.next(e))}catch(e){t(e)}}function c(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o(function(e){e(n)})).then(i,c)}s((a=a.apply(n,r||[])).next())});var n,r,o,a},e}();const m=h;var p=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})},v=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};l().config();var b=a.A.isDevMode(),y=void 0,g={createPool:function(){y?c.A.logRaw("DB connection pool is already created.","high","pink"):(y=o().createPool({host:b?process.env.SQL_HOST_DEV:process.env.SQL_HOST_PROD,user:b?process.env.SQL_USER_DEV:process.env.SQL_USER_PROD,password:b?process.env.SQL_PASS_DEV:process.env.SQL_PASS_PROD,database:"main",waitForConnections:!0,connectionLimit:10,queueLimit:0,enableKeepAlive:!0,keepAliveInitialDelay:0}))||c.A.logRaw("Failed to create a DB connection pool.","high","pink")},makeQuery:function(e,t){return y||g.createPool(),new f(y,e,t)},makeTransaction:function(e){return new m(y,e)},runSQLFile:function(e){return p(void 0,void 0,void 0,function(){var t,n,r,a,s,u,l;return v(this,function(d){switch(d.label){case 0:return c.A.log("Opening SQL File",{fileName:e},"high"),[4,i.A.read(e,"sql")];case 1:t=d.sent(),n=t.split(";").map(function(e){return e.trim()+";"}).filter(function(e){return e.length>1}),r=void 0,d.label=2;case 2:return d.trys.push([2,8,9,10]),[4,o().createConnection({host:b?process.env.SQL_HOST_DEV:process.env.SQL_HOST_PROD,user:b?process.env.SQL_USER_DEV:process.env.SQL_USER_PROD,password:b?process.env.SQL_PASS_DEV:process.env.SQL_PASS_PROD})];case 3:null==(r=d.sent())||r.connect(),a=0,s=n,d.label=4;case 4:return a<s.length?(u=s[a],[4,null==r?void 0:r.query(u)]):[3,7];case 5:d.sent(),d.label=6;case 6:return a++,[3,4];case 7:return[3,10];case 8:return l=d.sent(),c.A.log("SQL File Execution Error",{err:l},"high","pink"),[3,10];case 9:return null==r||r.end(),[7];case 10:return[2]}})})},toHTMLString:function(){return p(void 0,void 0,void 0,function(){var e,t,n,r,o,a,i,c,u,l;return v(this,function(d){switch(d.label){case 0:return t=function(e){return s.A.escapeHTMLChars(JSON.stringify(e,null,4))},n=(e=function(e){return"\n\n<h1>".concat(e,"</h1>\n")})("users"),r=t,[4,g.makeQuery("SELECT * FROM users;").run()];case 1:return o=n+r.apply(void 0,[d.sent()])+e("rooms"),a=t,[4,g.makeQuery("SELECT * FROM rooms;").run()];case 2:return i=o+a.apply(void 0,[d.sent()])+e("user_rooms"),c=t,[4,g.makeQuery("SELECT * FROM user_rooms;").run()];case 3:return u=i+c.apply(void 0,[d.sent()])+e("emailVerifications"),l=t,[4,g.makeQuery("SELECT * FROM emailVerifications;").run()];case 4:return[2,u+l.apply(void 0,[d.sent()])]}})})}};const w=g},790:(e,t,n)=>{n.d(t,{A:()=>o});const r={escapeHTMLChars:e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replaceAll("\n","<br>").replaceAll(" ","&nbsp;"),findErrorInUserName:e=>e.length<4||e.length>16?"error/userName/length":e!=r.sanitizeUserName(e)?"error/userName/chars":null,findErrorInPassword:e=>e.length<6||e.length>24?"error/password/length":e!=r.sanitizePassword(e)?"error/password/chars":null,findErrorInEmailAddress:e=>e.length>64?"error/email/length":/^[^\s@]+@[^\s@]+.[^\s@]+$/.test(e)?null:"error/email/chars",findErrorInRoomName:e=>e.length<4||e.length>64?"error/roomName/length":e!=r.sanitizeRoomName(e)?"error/roomName/chars":null,sanitizeUserName:e=>(e.length>16&&(e=e.substring(0,16)),e.replace(/[^a-zA-Z0-9_]/g,"")),sanitizePassword:e=>(e.length>24&&(e=e.substring(0,24)),e.replace(/[^a-zA-Z0-9~`!@#\$%\^&\*\(\)-_\+=\{\[\}\]\|\\:;"'<>,\.\?\/]/g,"")),sanitizeRoomName:e=>r.sanitizeRoomNameWithoutTrimming(e).trim(),sanitizeRoomNameWithoutTrimming:e=>(e.length>64&&(e=e.substring(0,64)),e.replace(/[^a-zA-Z0-9~`!@#\$%\^&\*\(\)-_\+=\{\[\}\]\|\\:;"'<>,\.\?\/\s]/g,"").replace(/\s+/g," "))},o=r},805:(e,t,n)=>{n.d(t,{A:()=>h});var r=n(928),o=n.n(r);const a=require("fs/promises");var i=n.n(a),c=n(236),s=n(818),u=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})},l=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};function d(e,t){return null==t&&(t=process.env.STATIC_PAGE_ROOT_DIR),o().join(process.env.PWD,t+"/"+e)}function f(e,t,n){return u(this,void 0,void 0,function(){var r,o,a,c,s,u;return l(this,function(l){switch(l.label){case 0:return[4,i().readdir(e)];case 1:r=l.sent(),o=0,a=r,l.label=2;case 2:return o<a.length?(c=a[o],s=t.concat(c),u="".concat(e,"/").concat(c),[4,i().lstat(u)]):[3,7];case 3:return l.sent().isFile()?(n.push(s.join("/")),[3,6]):[3,4];case 4:return[4,f(u,s,n)];case 5:l.sent(),l.label=6;case 6:return o++,[3,2];case 7:return[2]}})})}n.n(s)().config();const h={read:function(e,t){return u(void 0,void 0,void 0,function(){var n,r;return l(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),n=d(e,t),[4,i().readFile(n,{encoding:"utf8"})];case 1:return[2,o.sent()];case 2:return r=o.sent(),c.A.log("Failed to read file",{relativeFilePath:e,err:r},"high","pink"),[2,""];case 3:return[2]}})})},write:function(e,t,n){return u(void 0,void 0,void 0,function(){var r,o;return l(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),r=d(e,n),[4,i().writeFile(r,t)];case 1:return a.sent(),[3,3];case 2:return o=a.sent(),c.A.log("Failed to write file",{relativeFilePath:e,err:o},"high","pink"),[3,3];case 3:return[2]}})})},getAllRelativePathsInDirRecursively:function(e){return u(void 0,void 0,void 0,function(){var t;return l(this,function(n){switch(n.label){case 0:return[4,f(o().join(process.env.PWD,e),[],t=[])];case 1:return n.sent(),[2,t]}})})}}},818:e=>{e.exports=require("dotenv")},849:(e,t,n)=>{n.d(t,{A:()=>k});const r=require("jsonwebtoken");var o=n.n(r);const a=require("bcrypt");var i=n.n(a),c=n(52),s=n(415),u=n(567),l=n(767),d=n(818),f=n.n(d);f().config();const h=function(e,t,n,r){return o=void 0,a=void 0,c=function(){return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(o){switch(o.label){case 0:return[4,l.A.makeQuery("INSERT INTO users (userName, passwordHash, email) VALUES (?, ?, ?);",[e,t,n]).run(r,"AuthDB.registerNewUser")];case 1:return[2,o.sent()]}})},new((i=void 0)||(i=Promise))(function(e,t){function n(e){try{s(c.next(e))}catch(e){t(e)}}function r(e){try{s(c.throw(e))}catch(e){t(e)}}function s(t){var o;t.done?e(t.value):(o=t.value,o instanceof i?o:new i(function(e){e(o)})).then(n,r)}s((c=c.apply(o,a||[])).next())});var o,a,i,c};var m=n(790),p=n(236),v=n(467),b=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})},y=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};f().config();var g=c.A.isDevMode(),w={register:function(e,t){return b(void 0,void 0,void 0,function(){var n,r,o,a;return y(this,function(c){switch(c.label){case 0:return c.trys.push([0,7,,8]),w.validateUserNameAndPassword(e,t)?null!=(n=m.A.findErrorInEmailAddress(e.body.email))?(p.A.log("Email Input Error",{email:e.body.email,emailError:n},"high","pink"),t.status(400).send(v.A.displayText.message[n]),[2]):[4,u.A.users.withUserName(e.body.userName,t)]:[2];case 1:return r=c.sent(),t.statusCode<200||t.statusCode>=300?[2]:r&&r.length>0?(p.A.log("UserName already exists",{userName:e.body.userName,existingUser:r[0]},"high","pink"),t.status(403).send('User "'.concat(e.body.userName,'" already exists.')),[2]):[4,u.A.users.withEmail(e.body.email,t)];case 2:return r=c.sent(),t.statusCode<200||t.statusCode>=300?[2]:r&&r.length>0?(p.A.log("There is already an account with the same email",{email:e.body.email,existingUser:r[0]},"high","pink"),t.status(403).send('There is already an account with the email "'.concat(e.body.email,'".')),[2]):[4,s.A.endEmailVerification(e,t)];case 3:return c.sent(),t.statusCode<200||t.statusCode>=300?[2]:[4,i().hash(e.body.password,10)];case 4:return o=c.sent(),[4,h(e.body.userName,o,e.body.email,t)];case 5:return c.sent(),t.statusCode<200||t.statusCode>=300?[2]:[4,w.addToken(e.body.userName,t)];case 6:return c.sent(),[3,8];case 7:return a=c.sent(),p.A.log("User Registration Error",{err:a},"high","pink"),t.status(500).send("ERROR: Failed to register the user (".concat(a,").")),[3,8];case 8:return[2]}})})},login:function(e,t){return b(void 0,void 0,void 0,function(){var n,r;return y(this,function(o){switch(o.label){case 0:return o.trys.push([0,4,,5]),w.validateUserNameAndPassword(e,t)?[4,w.findExistingUserByUserName(e.body.userName,t)]:[2];case 1:return(n=o.sent())?[4,i().compare(e.body.password,n.passwordHash)]:[2];case 2:return o.sent()?[4,w.addToken(e.body.userName,t)]:(p.A.log("Wrong password",{passwordEntered:g?e.body.password:"(HIDDEN)",passwordHash:n.passwordHash},"high","pink"),t.status(401).send("Wrong password."),[2]);case 3:return o.sent(),[3,5];case 4:return r=o.sent(),p.A.log("Login Error",{err:r},"high","pink"),t.status(500).send("ERROR: Failed to login (".concat(r,").")),[3,5];case 5:return[2]}})})},validateUserNameAndPassword:function(e,t){var n=m.A.findErrorInUserName(e.body.userName);if(null!=n)return p.A.log("UserName Input Error",{userName:e.body.userName,userNameError:n},"high","pink"),t.status(400).send(v.A.displayText.message[n]),!1;var r=m.A.findErrorInPassword(e.body.password);return null==r||(p.A.log("Password Input Error",{password:g?e.body.password:"(HIDDEN)",passwordError:r},"high","pink"),t.status(400).send(v.A.displayText.message[r]),!1)},findExistingUserByUserName:function(e,t){return b(void 0,void 0,void 0,function(){var n;return y(this,function(r){switch(r.label){case 0:return[4,u.A.users.withUserName(e,t)];case 1:return n=r.sent(),t&&(t.statusCode<200||t.statusCode>=300)?[2,null]:n&&0!=n.length?[2,n[0]]:(p.A.log("User Not Found",{userName:e},"high","pink"),null==t||t.status(404).send('There is no account with userName "'.concat(e,'".')),[2,null])}})})},getUserFromReqToken:function(e,t){void 0===t&&(t=!1);var n=e.cookies.thingspool_token;return n?w.getUserFromToken(n):(t||p.A.log("Token Not Found in Request",{},"high","pink"),null)},getUserFromToken:function(e){try{return o().verify(e,process.env.JWT_SECRET_KEY)||(p.A.log("User is not found in the given token.",{token:e},"high","pink"),null)}catch(e){return p.A.log("Token Verification Failed",{err:e},"high","pink"),null}},addToken:function(e,t){return b(void 0,void 0,void 0,function(){var n,r;return y(this,function(a){switch(a.label){case 0:return[4,w.findExistingUserByUserName(e,t)];case 1:return(n=a.sent())?(r=o().sign(n,process.env.JWT_SECRET_KEY,{expiresIn:"60m"}),null==t||t.cookie("thingspool_token",r,{secure:!c.A.isDevMode(),httpOnly:!0,sameSite:"strict"}).status(201),[2]):(p.A.log("AddToken Tried, User Not Found",{userName:e},"high"),null==t||t.status(404).send('Tried to add token, but there is no account with userName "'.concat(e,'".')),[2])}})})},clearToken:function(e){e.clearCookie("thingspool_token").status(204)},authenticateToken:function(e,t,n){return b(void 0,void 0,void 0,function(){return y(this,function(r){switch(r.label){case 0:return[4,w.authenticateToken_internal(n,!1,e,t)];case 1:return r.sent(),[2]}})})},authenticateTokenOptional:function(e,t,n){return b(void 0,void 0,void 0,function(){return y(this,function(r){switch(r.label){case 0:return[4,w.authenticateToken_internal(n,!0,e,t)];case 1:return r.sent(),[2]}})})},authenticateToken_internal:function(e,t,n,r){return b(void 0,void 0,void 0,function(){var o,a;return y(this,function(i){switch(i.label){case 0:return(o=w.getUserFromReqToken(n))?[3,1]:t?(e(),[2,!0]):(p.A.logRaw("Token-Authentication Failed","high","pink"),null==r||r.status(401).send("Token-Authentication Failed (User Not Found)"),[2,!1]);case 1:return i.trys.push([1,3,,4]),[4,w.addToken(o.userName,r)];case 2:return i.sent(),e(),[2,!0];case 3:return a=i.sent(),t?(e(),[2,!0]):(p.A.log("Failed to add token",{err:a},"high"),null==r||r.status(401).send("Failed to add token (error: ".concat(a,")")),[2,!1]);case 4:return[2]}})})}};const k=w},928:e=>{e.exports=require("path")},958:(e,t,n)=>{n.d(t,{A:()=>r});const r={page:{bypassDynamicPages:!1},auth:{bypassEmailVerification:!1,emailVerificationTimeoutInSeconds:600}}}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};const r=require("express");var o=n.n(r),a=n(611),i=n.n(a);const c=require("body-parser");var s=n.n(c);const u=require("cookie-parser");var l=n.n(u),d=n(805),f=n(849),h=n(236),m=n(52),p=n(467),v=n(790);const b=require("ejs");var y=n.n(b),g=n(818),w=n.n(g);w().config();var k="".concat(process.env.PWD,"/").concat(process.env.VIEWS_ROOT_DIR,"/chunk"),E="".concat(process.env.PWD,"/").concat(process.env.VIEWS_ROOT_DIR,"/embeddedScript"),A={EnvUtil:m.A,TextUtil:v.A,UIConfig:p.A,ejsChunkRootPath:k,ejsEmbeddedScriptRootPath:E,isStaticPage:!0},N={EnvUtil:m.A,TextUtil:v.A,UIConfig:p.A,ejsChunkRootPath:k,ejsEmbeddedScriptRootPath:E,isStaticPage:!1,embeddedScripts:["Util/TextUtil.ejs","Config/UIConfig.ejs"]},S={},T={makeEJSParams:function(e,t,n){var r={};return Object.assign(r,N),Object.assign(r,n),r.user&&h.A.log("'user' shouldn't be defined manually in EJS params.",{mergedEJSParams:r},"high","pink"),r.user=f.A.getUserFromReqToken(e,t),r},makeEJSParamsStatic:function(e){var t={};return Object.assign(t,A),Object.assign(t,e),t},createStaticHTMLFromEJS:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return r=void 0,o=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}([e],t,!0),i=function(e,t){var n;return void 0===t&&(t={}),function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(r){switch(r.label){case 0:return null!=(n=S[e])?[3,2]:[4,d.A.read(e,process.env.VIEWS_ROOT_DIR)];case 1:n=r.sent(),S[e]=n,r.label=2;case 2:return[2,y().compile(n)(T.makeEJSParamsStatic(t))]}})},new((a=void 0)||(a=Promise))(function(e,t){function n(e){try{s(i.next(e))}catch(e){t(e)}}function c(e){try{s(i.throw(e))}catch(e){t(e)}}function s(t){var r;t.done?e(t.value):(r=t.value,r instanceof a?r:new a(function(e){e(r)})).then(n,c)}s((i=i.apply(r,o||[])).next())});var r,o,a,i}};const R=T;w().config();const I=function(){function e(){this.lines=["</urlset>"]}return e.prototype.addEntry=function(e,t){this.lines.push("</url>"),this.lines.push("  <lastmod>".concat(t,"</lastmod>")),this.lines.push("  <loc>".concat(m.A.getRootURL(),"/").concat(e,"</loc>")),this.lines.push("<url>")},e.prototype.build=function(){return e=this,t=void 0,r=function(){return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(e){switch(e.label){case 0:return this.lines.push('<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">'),this.lines.push('<?xml version="1.0" encoding="UTF-8"?>'),this.lines.reverse(),[4,d.A.write("sitemap.xml",this.lines.join("\n"))];case 1:return e.sent(),[2]}})},new((n=void 0)||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())});var e,t,n,r},e}();w().config();const x=function(){function e(){this.lines=["</feed>"],this.globalLatestUpdate=new Date(process.env.GLOBAL_LAST_MOD)}return e.prototype.addEntry=function(e,t,n,r){var o=new Date(n);o>this.globalLatestUpdate&&(this.globalLatestUpdate=o),this.lines.push("</entry>"),this.lines.push("  <summary>".concat(r,"</summary>")),this.lines.push("  <updated>".concat(o.toISOString(),"</updated>")),this.lines.push("  <id>".concat(e,"</id>")),this.lines.push('  <link href="'.concat(e,'"/>')),this.lines.push("  <title>".concat(t,"</title>")),this.lines.push("<entry>")},e.prototype.build=function(){return e=this,t=void 0,r=function(){return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(e){switch(e.label){case 0:return this.lines.push("<id>urn:uuid:02210672-5391-4cc8-800a-2a88f3a6d00c</id>"),this.lines.push("</author>"),this.lines.push("  <name>Youngjin Kang</name>"),this.lines.push("<author>"),this.lines.push("<updated>".concat(this.globalLatestUpdate.toISOString(),"</updated>")),this.lines.push('<link href="'.concat(m.A.getRootURL(),'"/>')),this.lines.push('<link rel="self" type="application/atom+xml" href="'.concat(m.A.getRootURL(),'/feed.atom"/>')),this.lines.push("<title>ThingsPool</title>"),this.lines.push('<feed xmlns="http://www.w3.org/2005/Atom">'),this.lines.push('<?xml version="1.0" encoding="utf-8"?>'),this.lines.reverse(),[4,d.A.write("feed.atom",this.lines.join("\n"))];case 1:return e.sent(),[2]}})},new((n=void 0)||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())});var e,t,n,r},e}();w().config();const D=function(){function e(){this.lines=[]}return e.prototype.addLine=function(e){this.lines.push(e)},e.prototype.getText=function(){return this.lines.join("\n")},e.prototype.build=function(e,t){return n=this,r=void 0,a=function(){return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(n){switch(n.label){case 0:return null==t&&(t=process.env.STATIC_PAGE_ROOT_DIR),[4,d.A.write(e,this.lines.join("\n"),t)];case 1:return n.sent(),[2]}})},new((o=void 0)||(o=Promise))(function(e,t){function i(e){try{s(a.next(e))}catch(e){t(e)}}function c(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o(function(e){e(n)})).then(i,c)}s((a=a.apply(n,r||[])).next())});var n,r,o,a},e}();w().config();const L=function(){function e(e,t){this.sitemapBuilder=e,this.atomFeedBuilder=t}return e.prototype.build=function(e){return t=this,n=void 0,o=function(){var t,n,r,o,a,i,c,s,u,l,f,h,v,b,y,g,w,k,E;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(A){switch(A.label){case 0:return t=new D,n="".concat(e.dirName,"/page.html"),[4,d.A.read("".concat(e.dirName,"/source.txt"))];case 1:return r=A.sent(),o=r.split(/\r?\n/),a=null==e.playLinkImagePathOverride?"play.png":e.playLinkImagePathOverride,i="",c="",o[0].startsWith(":d:")?i=o[0].substring(3):console.error(":d: is missing in -> "+e.title),o[1].startsWith(":k:")?c=o[1].substring(3).toLowerCase().replaceAll("-"," "):console.error(":k: is missing in -> "+e.title),t=new D,u=(s=t).addLine,[4,R.createStaticHTMLFromEJS("chunk/common/header.ejs",{menuName:"arcade",title:"ThingsPool - "+e.title,desc:i,keywords:c,relativePageURL:n,pagePathList:[{title:p.A.displayText.menuName.index,relativeURL:""},{title:p.A.displayText.menuName.arcade,relativeURL:"arcade.html"},{title:e.title,relativeURL:void 0}],backDestination_href:"".concat(m.A.getRootURL(),"/arcade.html")})];case 2:for(u.apply(s,[A.sent()]),t.addLine("<h1>".concat(e.title,"</h1>")),t.addLine('<a class="noTextDeco" target="_blank" href="'.concat(e.playLinkURL,'">')),t.addLine('<img class="xs_image" src="'.concat(m.A.getRootURL(),"/").concat(a,'" alt="Play">')),t.addLine("</a>"),t.addLine('<div class="zero_row"></div>'),l=1,f=[],h=function(){f.length>0&&(t.addLine("<p>".concat(f.join("<br>"),"</p>")),f.length=0)},v=2;v<o.length;++v)0==(b=(b=o[v]).trim()).length?h():b.startsWith("[")?(h(),(y=b.match(/\[(.*?)\]/)[1].trim()).length>0&&t.addLine("<h2>".concat(y,"</h2>"))):b.startsWith("<")?(h(),(g=b.match(/<(.*?)>/)[1]).length>0&&(w="".concat(m.A.getRootURL(),"/").concat(e.dirName,"/").concat(g,".jpg"),t.addLine('<img class="m_image" src="'.concat(w,'" alt="ThingsPool - ').concat(e.title," (Screenshot ").concat(l++,')">')))):(b=b.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll("{%","<").replaceAll("%}",">"),f.push(b));return h(),null!=e.videoTag&&null!=e.videoTag&&t.addLine(e.videoTag),E=(k=t).addLine,[4,R.createStaticHTMLFromEJS("chunk/common/footer.ejs")];case 3:return E.apply(k,[A.sent()]),this.sitemapBuilder.addEntry(n,e.lastmod),this.atomFeedBuilder.addEntry("".concat(m.A.getRootURL(),"/").concat(n),e.title,e.lastmod,e.title),[4,t.build(n)];case 4:return A.sent(),[2]}})},new((r=void 0)||(r=Promise))(function(e,a){function i(e){try{s(o.next(e))}catch(e){a(e)}}function c(e){try{s(o.throw(e))}catch(e){a(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r(function(e){e(n)})).then(i,c)}s((o=o.apply(t,n||[])).next())});var t,n,r,o},e}();w().config();const O=function(){function e(e,t){this.gameEntries=[{dirName:"ArtRaider",title:"ArtRaider",playLinkImagePathOverride:"badge_onestore.png",playLinkURL:"https://onesto.re/0001000383",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/RuLgOJrNtKA?si=Ts_Yu_jdpB1qmNiT" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>',lastmod:"2025-04-15"},{dirName:"Water-vs-Fire",title:"Water vs Fire",playLinkURL:"https://www.gamearter.com/game/water-vs-fire",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/6DeA_m8Iq4M?si=hC1uzkEtBWpYcM8z" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>',lastmod:"2023-09-10"},{dirName:"HuntLand",title:"HuntLand",playLinkURL:"https://www.gamearter.com/game/huntland",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/3dRg6vvoPqc?si=FlnKVyzQq0_55sL2" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>',lastmod:"2023-09-10"},{dirName:"PoliceChase",title:"Police Chase",playLinkURL:"https://www.gamearter.com/game/policechase",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/kABg0j2mZqQ?si=3-JUZQnh3omVXSJd" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>',lastmod:"2023-09-10"},{dirName:"SpaceTown",title:"SpaceTown",playLinkURL:"https://www.gamearter.com/game/spacetown",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/NoiQzEKJM-A?si=o8vTNqW1kxCJ4MnW" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>',lastmod:"2023-09-20"}],this.sitemapBuilder=e,this.atomFeedBuilder=t}return e.prototype.build=function(){return e=this,t=void 0,r=function(){var e,t,n,r,o,a,i,c,s,u;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(l){switch(l.label){case 0:return e=new D,n=(t=e).addLine,[4,R.createStaticHTMLFromEJS("chunk/common/header.ejs",{menuName:"arcade",desc:"Games made by ThingsPool.",keywords:"thingspool, software toys, technical design, computer science, systems engineering, game design, game development",pagePathList:[{title:p.A.displayText.menuName.index,relativeURL:""},{title:p.A.displayText.menuName.arcade,relativeURL:void 0}],backDestination_href:m.A.getRootURL()})];case 1:return n.apply(t,[l.sent()]),e.addLine("<hr>"),e.addLine("<h1>Games</h1>"),o=(r=e).addLine,[4,R.createStaticHTMLFromEJS("chunk/info/gameLinks.ejs")];case 2:return o.apply(r,[l.sent()]),i=(a=e).addLine,[4,R.createStaticHTMLFromEJS("chunk/common/footer.ejs")];case 3:return i.apply(a,[l.sent()]),this.sitemapBuilder.addEntry("arcade.html","2025-02-28"),[4,e.build("arcade.html")];case 4:l.sent(),c=0,s=this.gameEntries,l.label=5;case 5:return c<s.length?(u=s[c],[4,new L(this.sitemapBuilder,this.atomFeedBuilder).build(u)]):[3,8];case 6:l.sent(),l.label=7;case 7:return c++,[3,5];case 8:return[2]}})},new((n=void 0)||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())});var e,t,n,r},e}();var P=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})},U=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};w().config();const _=function(){function e(e,t){this.sitemapBuilder=e,this.atomFeedBuilder=t}return e.prototype.build=function(e){return P(this,void 0,void 0,function(){var t,n,r,o,a,i,c,s,u,l,f,h,v,b,y,g,w,k,E,A,N,S,T,I,x,L,O=this;return U(this,function(_){switch(_.label){case 0:return t=!0,n="???",r=1,o=1,a=void 0,i=!1,c=!1,s=[],u=[],l=new D,f="A writing by ThingsPool.",h="thingspool, software, engineering, philosophy",v=process.env.GLOBAL_LAST_MOD,b=n,y=f,g=h,w=v,k=function(){s.length>0&&(i?l.addLine('<div class="snippet"><pre><code>'.concat(s.join("\n"),"</code></pre></div>")):c?l.addLine('<pre><div class="excerpt">'.concat(s.join("\n"),"</div></pre>")):l.addLine("<p>".concat(s.join("<br>"),"</p>")),s.length=0)},E=function(t,n,i,c){return P(O,void 0,void 0,function(){var s,d,f,h,v,b,y;return U(this,function(g){switch(g.label){case 0:return s="".concat(e.dirName,"/list.html"),d="".concat(e.dirName,"/page-").concat(r,".html"),f=new D,v=(h=f).addLine,[4,R.createStaticHTMLFromEJS("chunk/common/header.ejs",{menuName:"library",title:t,desc:i,keywords:c,relativePageURL:d,ogImageURLOverride:a,pagePathList:[{title:p.A.displayText.menuName.index,relativeURL:""},{title:p.A.displayText.menuName.library,relativeURL:"library.html"},{title:e.title,relativeURL:s},{title:t,relativeURL:void 0}],backDestination_href:"".concat(m.A.getRootURL(),"/").concat(s)})];case 1:return v.apply(h,[g.sent()]),f.addLine(l.getText()),y=(b=f).addLine,[4,R.createStaticHTMLFromEJS("chunk/common/footer.ejs")];case 2:return y.apply(b,[g.sent()]),[4,f.build(d)];case 3:return g.sent(),l=new D,this.sitemapBuilder.addEntry(d,n),this.atomFeedBuilder.addEntry("".concat(m.A.getRootURL(),"/").concat(d),t,n,i),u.push({pageNumber:r,title:t,lastmod:n,desc:i,keywords:c,customOGImagePath:a}),r++,o=1,a=void 0,[2]}})})},[4,d.A.read("".concat(e.dirName,"/source.txt"))];case 1:A=_.sent(),N=A.split(/\r?\n/),S=0,_.label=2;case 2:return S<N.length?(T=N[S],i||c||(T=T.trim()),0!=T.length?[3,3]:(i||c?s.push("\n"):k(),[3,7])):[3,8];case 3:return T.startsWith("[")?(k(),t||(b=n),n=T.match(/\[(.*?)\]/)[1].trim(),I=T.match(/\](.*?)$/)[1].trim(),t?[3,5]:[4,E(b,w,y,g)]):[3,6];case 4:_.sent(),y=f,g=h,w=v,_.label=5;case 5:return t=!1,l.addLine("<h1>".concat(n,"</h1>")),l.addLine('<p class="dim">Author: Youngjin Kang&nbsp;&nbsp;&nbsp;Date: '.concat(I,"</p>")),[3,7];case 6:!T.startsWith("<")||i||c?T.startsWith("@@")?l.addLine(T.substring(2)):T.startsWith("#$")?(k(),i=!i):T.startsWith('#"')?(k(),c=!c):T.startsWith(":d:")?(t||(y=f),f=T.substring(3)):T.startsWith(":k:")?(t||(g=h),h=T.substring(3).toLowerCase().replaceAll("-"," ")):T.startsWith(":l:")?(t||(w=v),v=T.substring(3)):(T=T.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll("{%","<").replaceAll("%}",">"),s.push(T)):(k(),(x=T.match(/<(.*?)>/)[1]).length>0&&(L="".concat(m.A.getRootURL(),"/").concat(e.dirName,"/").concat(x,".jpg"),(null==a||T.endsWith("*"))&&(a=L),l.addLine('<img class="m_image" src="'.concat(L,'" alt="').concat(n.replaceAll('"',"&quot;")," (Figure ").concat(o++,')">')))),_.label=7;case 7:return++S,[3,2];case 8:return k(),[4,E(n,v,f,h)];case 9:return _.sent(),[2,u]}})})},e}();w().config();const j=function(){function e(e,t){this.sitemapBuilder=e,this.atomFeedBuilder=t}return e.prototype.build=function(e){return t=this,n=void 0,o=function(){var t,n,r,o,a,i,c,s,u,l,d,f;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(h){switch(h.label){case 0:t=0,n=e,h.label=1;case 1:return t<n.length?(r=n[t],[4,new _(this.sitemapBuilder,this.atomFeedBuilder).build(r)]):[3,7];case 2:return o=h.sent(),a="".concat(r.dirName,"/list.html"),i=new D,s=(c=i).addLine,[4,R.createStaticHTMLFromEJS("chunk/common/header.ejs",{menuName:"library",title:"ThingsPool - "+r.title,desc:r.title,keywords:"thingspool, software toys, technical design, computer science, systems engineering, game design, game development",relativePageURL:a,pagePathList:[{title:p.A.displayText.menuName.index,relativeURL:""},{title:p.A.displayText.menuName.library,relativeURL:"library.html"},{title:r.title,relativeURL:void 0}],backDestination_href:"".concat(m.A.getRootURL(),"/library.html")})];case 3:for(s.apply(c,[h.sent()]),i.addLine("<h1>".concat(r.title,"</h1>")),u=o.length-1;u>=0;--u)l=o[u],i.addLine('<a class="postEntryButton" href="'.concat(m.A.getRootURL(),"/").concat(r.dirName,"/page-").concat(l.pageNumber,'.html">').concat(l.title,"</a>"));return f=(d=i).addLine,[4,R.createStaticHTMLFromEJS("chunk/common/footer.ejs")];case 4:return f.apply(d,[h.sent()]),[4,i.build(a)];case 5:h.sent(),this.sitemapBuilder.addEntry(a,o.sort(function(e,t){return Date.parse(t.lastmod)-Date.parse(e.lastmod)}).pop().lastmod),h.label=6;case 6:return t++,[3,1];case 7:return[2]}})},new((r=void 0)||(r=Promise))(function(e,a){function i(e){try{s(o.next(e))}catch(e){a(e)}}function c(e){try{s(o.throw(e))}catch(e){a(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r(function(e){e(n)})).then(i,c)}s((o=o.apply(t,n||[])).next())});var t,n,r,o},e}();w().config();const C=function(){function e(e,t){this.nonfictionEntries=[{dirName:"metaphysics",title:"형이상학 (2013 - 2014)"},{dirName:"game-analysis",title:"게임분석 (2019)"},{dirName:"essays",title:"Miscellaneous Writings (2022 - 2024)"},{dirName:"blockchains",title:"On Legitimacy of Blockchains (2022)"},{dirName:"software-development",title:"Software Development (2022 - 2024)"},{dirName:"game-design",title:"Universal Laws of Game Design (2023)"},{dirName:"reality",title:"The Origin of Reality (2023)"},{dirName:"bridge-to-math",title:"A Layman's Bridge to Mathematics (2024)"},{dirName:"read-rec",title:"Recommended Readings (2024)"},{dirName:"morsels",title:"Morsels of Thought (2024)"},{dirName:"concepts-of-plan",title:"Concepts of a Plan (2025)"}],this.fictionEntries=[{dirName:"novels",title:"단편소설 (2012 - 2013)"},{dirName:"alien-job-interview",title:"Alien Job Interview (2022)"},{dirName:"infinite-treasures",title:"The Island of Infinite Treasures (2022)"},{dirName:"infsoc",title:"Influential Social Posts (2023)"},{dirName:"gamedev-journey",title:"A Game Developer's Journey (2023)"},{dirName:"sandwich",title:"Sandwich Engineering (2025)"}],this.artEntries=[{dirName:"illustrations",title:"Illustrations (2009 - 2014)"},{dirName:"cartoons",title:"Cartoons (2011 - 2015)"}],this.sitemapBuilder=e,this.atomFeedBuilder=t}return e.prototype.addPostLinks=function(e,t,n){e.addLine("<hr>"),e.addLine("<h1>".concat(t,"</h1>"));for(var r=n.length-1;r>=0;--r){var o=n[r];e.addLine('<a class="postEntryButton" href="'.concat(m.A.getRootURL(),"/").concat(o.dirName,'/list.html">').concat(o.title,"</a>"))}},e.prototype.build=function(){return e=this,t=void 0,r=function(){var e,t,n,r,o;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(a){switch(a.label){case 0:return e=new D,n=(t=e).addLine,[4,R.createStaticHTMLFromEJS("chunk/common/header.ejs",{menuName:"library",pagePathList:[{title:p.A.displayText.menuName.index,relativeURL:""},{title:p.A.displayText.menuName.library,relativeURL:void 0}],backDestination_href:m.A.getRootURL()})];case 1:return n.apply(t,[a.sent()]),this.addPostLinks(e,"Nonfiction",this.nonfictionEntries),this.addPostLinks(e,"Fiction",this.fictionEntries),this.addPostLinks(e,"Arts",this.artEntries),o=(r=e).addLine,[4,R.createStaticHTMLFromEJS("chunk/common/footer.ejs")];case 2:return o.apply(r,[a.sent()]),this.sitemapBuilder.addEntry("library.html","2025-02-28"),[4,e.build("library.html")];case 3:return a.sent(),[4,new j(this.sitemapBuilder,this.atomFeedBuilder).build(this.nonfictionEntries)];case 4:return a.sent(),[4,new j(this.sitemapBuilder,this.atomFeedBuilder).build(this.fictionEntries)];case 5:return a.sent(),[4,new j(this.sitemapBuilder,this.atomFeedBuilder).build(this.artEntries)];case 6:return a.sent(),[2]}})},new((n=void 0)||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())});var e,t,n,r},e}();w().config();const F=function(){function e(){}return e.prototype.build=function(e,t){return n=this,r=void 0,a=function(){var n,r,o,a,i;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(c){switch(c.label){case 0:return null==e&&(e="".concat(process.env.SRC_ROOT_DIR,"/Shared")),null==t&&(t="".concat(process.env.VIEWS_ROOT_DIR,"/embeddedScript")),[4,d.A.getAllRelativePathsInDirRecursively(e)];case 1:n=(n=c.sent()).filter(function(e){return e.endsWith(".js")}),r=0,o=n,c.label=2;case 2:return r<o.length?(a=o[r],[4,d.A.read(a,e)]):[3,6];case 3:return i=c.sent().split("\n").filter(function(e){return!e.startsWith("export ")}).join("\n").trim(),[4,d.A.write(a.replace(".js",".ejs"),"\x3c!-- NOTE: This EJS file is auto-generated by 'EmbeddedScriptBuilder.ts' --\x3e\n<script>\n"+i+"\n<\/script>",t)];case 4:c.sent(),c.label=5;case 5:return r++,[3,2];case 6:return[2]}})},new((o=void 0)||(o=Promise))(function(e,t){function i(e){try{s(a.next(e))}catch(e){t(e)}}function c(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o(function(e){e(n)})).then(i,c)}s((a=a.apply(n,r||[])).next())});var n,r,o,a},e}();var M,q,B,Q="#101010",J="#303030",W="#707070",H="#a0a0a0",V="#c0c0c0",G="#d0c090",z="#70c060",Y="#b0a070",$="17px",K={unit:{landscape:{vertical:.6,horizontal:1},portrait:{vertical:1,horizontal:2.5}}},X=400,Z=800,ee=function(e,t,n,r,o,a){return"position: absolute;\n\tdisplay: block;\n\tleft: ".concat(e,"%;\n\tright: ").concat(t,"%;\n\ttop: ").concat(n,"%;\n\tbottom: ").concat(r,"%;\n\twidth: ").concat(o,"%;\n\theight: ").concat(a,"%;")},te=function(e,t){return"position: relative;\n\tdisplay: ".concat(e?"block":"inline-block",";\n\tmax-width: ").concat(t,";")},ne=function(e){return"position: relative;\n\tdisplay: ".concat(e?"block":"inline-block",";\n\tmax-width: none;\n\twidth: fit-content;\n\tblock-size: fit-content;")},re=function(e,t,n,r,o){void 0===r&&(r=!1),void 0===o&&(o=!1);var a=K.unit[e?"landscape":"portrait"],i=(a.vertical*t).toFixed(2),c=(a.horizontal*n).toFixed(2),s=o?"0":"".concat(i,"%"),u=o?"0":"".concat(c,"%"),l=r?"0":"".concat(i,"%"),d=r?"0":"".concat(c,"%");return"padding: ".concat(s," ").concat(u," ").concat(s," ").concat(u,";\n\tmargin: ").concat(l," ").concat(d," ").concat(l," 0;")},oe=function(e,t,n){return"font-size: ".concat(e,';\n\tfont-family: "Lucida Console", "Lucida Sans Typewriter", "Monaco", Consolas, monospace;\n\tfont-style: ').concat(t?"italic":"normal",";\n\tfont-weight: ").concat(n,";")},ae=function(e,t,n){return void 0===n&&(n=1),"background-color: ".concat(e,";\n\tcolor: ").concat(t,";").concat(n<1?"\n\topacity: ".concat(n,";"):"")},ie=function(e,t,n){return void 0===n&&(n=1),ae(e,t,n)+"\n\tborder-radius: 4.5vmin;"},ce=function(e,t,n,r,o){return void 0===r&&(r="1.25"),void 0===o&&(o=1),ie(e,t,o)+"\n"+"\tborder-bottom: ".concat(r,"vmin ").concat(n," solid;")+"\n"+"\tborder-right: ".concat(r,"vmin ").concat(n," solid;")},se=function(e,t,n,r,o){return void 0===r&&(r="1.25"),void 0===o&&(o=1),ie(e,t,o)+"\n"+"\tborder: ".concat(r,"vmin ").concat(n," solid;")},ue=ee(0,0,0,0,100,100),le=ee(0,86,0,0,14,100),de=ee(0,0,0,88,100,12),fe=ee(14,5,0,0,81,100),he=ee(0,2.5,12,0,95,88),me=ee(0,0,0,86,100,14),pe=ee(0,0,14,0,100,80),ve=ee(0,0,0,35,100,65),be=ee(0,0,65,0,100,35),ye=function(e){return 2*K.unit[e?"landscape":"portrait"].horizontal},ge=function(e){return te(!0,"".concat(100..toFixed(2),"%"))},we=function(e){return te(!0,"1%")},ke=function(e){return ne(!0)},Ee=function(e){return te(!1,"".concat((66-ye(e)).toFixed(2),"%"))},Ae=function(e){return te(!1,"".concat((50-ye(e)).toFixed(2),"%"))},Ne=function(e){return ne(!1)},Se=function(e){return re(e,1,1)},Te=function(e){return re(e,2,1)},Re=function(e){return re(e,4,1)},Ie=function(e){return re(e,2,1,!1,!0)},xe=function(e){return re(e,4,1,!1,!0)},De="min(".concat(1.8199999999999998.toFixed(2),"vmax, ").concat(16..toFixed(2),"px)"),Le="min(".concat(2.1839999999999997.toFixed(2),"vmax, ").concat(19.2.toFixed(2),"px)"),Oe="min(".concat(2.6207999999999996.toFixed(2),"vmax, ").concat(23.04.toFixed(2),"px)"),Pe="min(".concat(3.1449599999999998.toFixed(2),"vmax, ").concat(27.648.toFixed(2),"px)"),Ue="min(".concat(3.7739519999999995.toFixed(2),"vmax, ").concat(33.1776.toFixed(2),"px)"),_e=oe(De,!1,X),je=oe(De,!0,X),Ce=oe(De,!1,Z),Fe=(oe(Le,!0,X),oe(Le,!0,Z)),Me=(oe(Oe,!0,X),oe(Oe,!0,Z)),qe=(oe(Pe,!0,X),oe(Pe,!0,Z)),Be=(oe(Ue,!0,X),oe(Ue,!0,Z)),Qe="opacity: 0;",Je=ae("#000000",V,.7),We=ce(G,J,Y,"1.25"),He=ae("#000000",V,.7),Ve=ce(J,H,V,"1.25"),Ge=ae(J,V),ze=(M=V,void 0===q&&(q="1.25"),void 0===B&&(B=1),ae(J,V,B)+"\n"+"\tborder-bottom: ".concat(q,"vmin ").concat(M," solid;")),Ye=ae(J,H),$e=ae(H,J),Ke=ae(J,W),Xe=ae(J,G),Ze=ae(J,Y),et=ce(J,H,H),tt=ie(J,V),nt=ie(Q,z),rt=ie(Q,z),ot=ce(Q,H,W,"0.5"),at=ce(W,V,H,"0.25"),it=se(J,V,W,"0.1"),ct=se(H,V,V,"0.1"),st=function(e){return"\n@supports(-moz-appearance:none) {\n\t* {\n\t\tscrollbar-width: ".concat(e?"auto":"none",";\n\t\tscrollbar-color: ").concat(W," ").concat(Q,";\n\t}\n}\n::-webkit-scrollbar {\n\twidth: ").concat(e?$:"0",";\n\theight: ").concat(e?$:"0",";\n}\n::-webkit-scrollbar-track {\n\tbackground: ").concat(Q,";\n}\n::-webkit-scrollbar-thumb {\n\tbackground: ").concat(W,";\n\tborder-radius: ").concat("8px",";\n\tborder: ").concat("4px"," solid ").concat(Q,";\n}\n::-webkit-scrollbar-thumb:hover {\n\tbackground: ").concat(H,";\n}\niframe {\n\t").concat(ge(),"\n\t").concat(Ie(e),"\n\t").concat(Me,"\n\t").concat(Ye,"\n}\np {\n\t").concat(ge(),"\n\t").concat(xe(e),"\n\t").concat(_e,"\n\t").concat(Ge,"\n}\nh3 {\n\t").concat(ge(),"\n\t").concat(xe(e),"\n\t").concat(Fe,"\n\t").concat(Ze,"\n}\nh2 {\n\t").concat(ge(),"\n\t").concat(xe(e),"\n\t").concat(qe,"\n\t").concat(Ke,"\n}\nh1 {\n\t").concat(ge(),"\n\t").concat(xe(e),"\n\t").concat(Be,"\n\t").concat(Xe,"\n}\nhr {\n\t").concat(ge(),"\n\t").concat(Ie(e),"\n\t").concat(Ge,"\n}\n.fullscreenBar {\n\t").concat(e?le:de,"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t").concat(Fe,"\n\t").concat($e,"\n\ttext-align: ").concat("center",";\n\tz-index: 1;\n\toverflow: hidden;\n}\n.fullscreenPanel {\n\t").concat(e?fe:he,"\n\tmargin: 0 0 0 0;\n\tpadding: 0 ").concat(2.5,"% 0 ").concat(2.5,"%;\n\t").concat(Me,"\n\t").concat(Ye,"\n\toverflow-y: scroll;\n\toverflow-x: auto;\n}\n.fullscreenBarLogo {\n\t").concat(e?me:ve,"\n}\n.fullscreenBarLogoImage {\n\tposition: relative;\n\tdisplay: block;\n\tmax-width: 80%;\n\tmax-height: 70%;\n\tmargin: auto;\n  \ttop: 50%;\n  \t-ms-transform: translateY(-50%);\n  \ttransform: translateY(-50%);\n}\n.fullscreenBarMenu {\n\t").concat(e?pe:be,"\n}\n.fullscreenBarMenuButton {\n\tposition: relative;\n\tdisplay: ").concat(e?"block":"inline-block",";\n\t").concat(e?"width: 100%;":"top: 100%; -ms-transform: translateY(-100%); transform: translateY(-100%);","\n\tmax-height: 100%;\n\t").concat(e?function(e){return re(e,4,1,!0,!1)}(e):function(e){return re(e,1,1,!0,!1)}(e),"\n\tbox-sizing: border-box;\n\ttext-decoration: none;\n}\n.fullscreenBarMenuButton.idle {\n\t").concat($e,"\n}\n.fullscreenBarMenuButton.selected {\n\t").concat(Ye,"\n}\n.fullscreenBarMenuButton.idle:hover {\n\tcolor: ").concat(G,";\n}\n.fullscreenBarMenuButton.selected:hover {\n\tcolor: ").concat(G,";\n}\n.loadingScreen {\n\t").concat(ue,"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\tz-index: 900;\n\n\t.background {\n\t\t").concat(ue,"\n\t\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t\t").concat(Je,"\n\t}\n\t.content {\n\t\tposition: absolute;\n\t\tmin-width: 50%;\n\t\ttop: 50%;\n\t\tleft: 50%;\n\t\ttransform: translate(-50%, -50%);\n\t\t").concat(Be,"\n\t\t").concat(Re(e),"\n\t\t").concat(We,"\n\t\ttext-align: center;\n\t\tz-index: 901;\n\t}\n}\n.popupScreen {\n\t").concat(ue,"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\tz-index: 500;\n\n\t.background {\n\t\t").concat(ue,"\n\t\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t\t").concat(He,"\n\t}\n\t.content {\n\t\tposition: absolute;\n\t\twidth: 80%;\n\t\twidth: 80%;\n\t\ttop: 50%;\n\t\tleft: 50%;\n\t\ttransform: translate(-50%, -50%);\n\t\t").concat(_e,"\n\t\t").concat(Te(e),"\n\t\t").concat(Ve,"\n\t\toverflow-y: scroll;\n\t\tz-index: 501;\n\t}\n}\n.xs_image {\n\t").concat(e?function(e){return te(!1,"".concat((25-ye(e)).toFixed(2),"%"))}(e):Ae(e),"\n\t").concat(Ie(e),"\n\t").concat(Me,"\n\t").concat(Ye,"\n}\n.s_image {\n\t").concat(e?function(e){return te(!1,"".concat((33-ye(e)).toFixed(2),"%"))}(e):Ee(e),"\n\t").concat(Ie(e),"\n\t").concat(Me,"\n\t").concat(tt,"\n}\n.m_image {\n\t").concat(e?Ee(e):te(!1,"".concat(100..toFixed(2),"%")),"\n\t").concat(Ie(e),"\n\t").concat(Me,"\n\t").concat(tt,"\n}\n.m_linkImage {\n\t").concat(e?Ae(e):te(!1,"".concat(98..toFixed(2),"%")),"\n\t").concat(Ie(e),"\n\t").concat(Me,"\n\t").concat(et,"\n}\n.m_linkImage:hover {\n\tborder-color: ").concat(G,";\n}\n.postEntryButton {\n\t").concat(ke(),"\n\t").concat(Se(e),"\n\t").concat(Ce,"\n\t").concat(ot,"\n\ttext-decoration: none;\n}\n.pagePath {\n\t").concat(function(e){return re(e,1,1,!1,!0)}(e),"\n\t").concat(_e,"\n}\n.listScrollPanel {\n\t").concat((t="".concat(100..toFixed(2),"%"),n="".concat(70..toFixed(2),"%"),"position: relative;\n\tdisplay: ".concat("block",";\n\twidth: ").concat(t,";\n\theight: ").concat(n,";")),"\n\t").concat(Se(e),"\n\t").concat(it,"\n\toverflow: auto;\n}\n.listItem {\n\t").concat(ke(),"\n\t").concat(Se(e),"\n\t").concat(_e,"\n\t").concat(ct,"\n\ttext-decoration: none;\n}\n.inlineTextInput {\n\t").concat(e?Ne():ke(),"\n\t").concat(Se(e),"\n\t").concat(_e,"\n\t").concat(at,"\n}\n.inlineLabel {\n\t").concat(Ne(),"\n\t").concat(Se(e),"\n\t").concat(_e,"\n\t").concat(Ye,"\n}\n.inlineButton {\n\t").concat(Ne(),"\n\t").concat(Se(e),"\n\t").concat(_e,"\n\t").concat(ot,"\n\ttext-decoration: none;\n}\n.inlineButton:hover {\n\tcolor: ").concat(G,";\n\tcursor: pointer;\n}\n.inlineButton:disabled {\n\topacity: 0.25;\n\tcursor: not-allowed;\n}\n.inlineTabButton {\n\t").concat(Ne(),"\n\t").concat(Se(e),"\n\t").concat(_e,"\n\ttext-decoration: none;\n}\n.inlineTabButton.idle {\n\t").concat(Ge,"\n}\n.inlineTabButton.selected {\n\t").concat(ze,"\n}\n.inlineTabButton.idle:hover {\n\tcolor: ").concat(G,";\n}\n.inlineTabButton.selected:hover {\n\tcolor: ").concat(G,";\n}\n.snippet {\n\t").concat(ke(),"\n\t").concat(Te(e),"\n\t").concat(Ce,"\n\t").concat(nt,"\n\twhite-space: nowrap;\n}\n.excerpt {\n\t").concat(ge(),"\n\t").concat(Te(e),"\n\t").concat(je,"\n\t").concat(rt,"\n\twhite-space: pre-wrap;\n\twhite-space: -moz-pre-wrap;\n\twhite-space: -pre-wrap;\n\twhite-space: -o-pre-wrap;\n\tword-wrap: break-word;\n}\n.zero_row {\n\t").concat(we(),"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t").concat(Qe,"\n}\n.xs_row {\n\t").concat(we(),"\n\t").concat(function(e){return re(e,.5,1)}(e),"\n\t").concat(Qe,"\n}\n.s_row {\n\t").concat(we(),"\n\t").concat(Se(e),"\n\t").concat(Qe,"\n}\n.m_row {\n\t").concat(we(),"\n\t").concat(Te(e),"\n\t").concat(Qe,"\n}\n.l_row {\n\t").concat(we(),"\n\t").concat(function(e){return re(e,3,1)}(e),"\n\t").concat(Qe,"\n}\n.xl_row {\n\t").concat(we(),"\n\t").concat(Re(e),"\n\t").concat(Qe,"\n}\n");var t,n};const ut="* {\n\toverflow: hidden;\n\tvertical-align: middle;\n}\nbody {\n\t".concat(ue,"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t").concat(_e,"\n\t").concat(Ge,"\n\ttext-align: ").concat("left",";\n\tz-index: 0;\n}\na:link {\n  color: ").concat(H,";\n}\na:visited {\n  color: ").concat(H,";\n}\na:hover {\n  color: ").concat(G,";\n}\na:active {\n  color: ").concat(H,";\n}\n.dim {\n\t").concat(Ke,"\n}\n.noTextDeco {\n\ttext-decoration: none;\n}\n\n@media (orientation: landscape) {\n\t").concat(st(!0),"\n}\n\n@media (orientation: portrait) {\n\t").concat(st(!1),"\n}");function lt(){return e=this,t=void 0,r=function(){var e,t,n,r,o,a,i,c,s,u,l,f,h,m,p;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(v){switch(v.label){case 0:return console.log("SSG START"),e=new I,t=new x,n=new D,o=(r=n).addLine,[4,R.createStaticHTMLFromEJS("page/menu/index.ejs",{isStaticPage:!0,user:void 0,loginDestination:""})];case 1:return o.apply(r,[v.sent()]),[4,n.build("index.html")];case 2:return v.sent(),n=new D,i=(a=n).addLine,[4,R.createStaticHTMLFromEJS("page/menu/rooms.ejs",{isStaticPage:!0,user:void 0,loginDestination:""})];case 3:return i.apply(a,[v.sent()]),[4,n.build("rooms.html")];case 4:return v.sent(),n=new D,s=(c=n).addLine,[4,R.createStaticHTMLFromEJS("page/misc/portfolio.ejs",{})];case 5:return s.apply(c,[v.sent()]),[4,n.build("portfolio.html")];case 6:return v.sent(),n=new D,l=(u=n).addLine,[4,R.createStaticHTMLFromEJS("page/misc/portfolio_minimal.ejs",{})];case 7:return l.apply(u,[v.sent()]),[4,n.build("portfolio_minimal.html")];case 8:return v.sent(),n=new D,h=(f=n).addLine,[4,R.createStaticHTMLFromEJS("page/misc/privacyPolicy.ejs",{})];case 9:return h.apply(f,[v.sent()]),[4,n.build("privacy-policy.html")];case 10:return v.sent(),n=new D,p=(m=n).addLine,[4,R.createStaticHTMLFromEJS("page/misc/termsOfService.ejs",{})];case 11:return p.apply(m,[v.sent()]),[4,n.build("terms-of-service.html")];case 12:return v.sent(),[4,new O(e,t).build()];case 13:return v.sent(),[4,new C(e,t).build()];case 14:return v.sent(),[4,e.build()];case 15:return v.sent(),[4,t.build()];case 16:return v.sent(),[4,d.A.write("style.css",ut)];case 17:return v.sent(),[4,(new F).build()];case 18:return v.sent(),console.log("SSG END"),[2]}})},new((n=void 0)||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())});var e,t,n,r}w().config();var dt=n(767),ft=n(928),ht=n.n(ft),mt=n(958),pt=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})},vt=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};w().config();const bt=function(e,t,n){return pt(void 0,void 0,void 0,function(){return vt(this,function(r){switch(r.label){case 0:return[4,dt.A.makeQuery("SELECT rooms.*\n            FROM rooms INNER JOIN user_rooms ON user_rooms.roomID = rooms.roomID\n            WHERE rooms.roomID = ? AND user_rooms.userID = ? AND\n                (user_rooms.userStatus = 'member' OR user_rooms.userStatus = 'owner');",[e,t]).run(n,"RoomDB.getRoomContent")];case 1:return[2,r.sent()]}})})},yt=function(e,t,n){return pt(void 0,void 0,void 0,function(){return vt(this,function(r){switch(r.label){case 0:return[4,dt.A.makeTransaction([dt.A.makeQuery("INSERT INTO rooms (roomName, ownerUserName) VALUES (?, ?);",[e,t]),dt.A.makeQuery("INSERT INTO user_rooms (roomID, userID, userStatus)\n                VALUES (LAST_INSERT_ID(), (SELECT userID FROM users WHERE userName = ?), 'owner');",[t]),dt.A.makeQuery("UPDATE users SET ownedRoomCount = ownedRoomCount + 1\n                WHERE userName = ? AND ownedRoomCount < ownedRoomCountMax;",[t])]).run(n,"RoomDB.createRoom")];case 1:return r.sent(),[2]}})})},gt=function(e,t,n){return pt(void 0,void 0,void 0,function(){return vt(this,function(r){switch(r.label){case 0:return[4,dt.A.makeTransaction([dt.A.makeQuery("UPDATE users SET ownedRoomCount = ownedRoomCount - 1\n                WHERE userID = ? AND ownedRoomCount > 0;",[t]),dt.A.makeQuery("DELETE FROM rooms WHERE roomID = ? AND ownerUserName = ?;",[e,t]),dt.A.makeQuery("DELETE FROM user_rooms WHERE roomID = ?;",[e])]).run(n,"RoomDB.deleteRoom")];case 1:return[2,r.sent()]}})})},wt=function(e,t,n){return pt(void 0,void 0,void 0,function(){return vt(this,function(r){switch(r.label){case 0:return[4,dt.A.makeQuery("DELETE FROM user_rooms\n            WHERE roomID = ? AND userID = ? AND userStatus = 'member';",[e,t]).run(n,"RoomDB.leaveRoom")];case 1:return r.sent(),[2]}})})},kt=function(e,t,n){return pt(void 0,void 0,void 0,function(){return vt(this,function(r){switch(r.label){case 0:return[4,dt.A.makeQuery("UPDATE user_rooms SET userStatus = 'member'\n            WHERE roomID = ? AND userID = ? userStatus = 'invited';",[e,t]).run(n,"RoomDB.acceptInvitation")];case 1:return r.sent(),[2]}})})},Et=function(e,t,n){return pt(void 0,void 0,void 0,function(){return vt(this,function(r){switch(r.label){case 0:return[4,dt.A.makeQuery("DELETE FROM user_rooms\n            WHERE roomID = ? AND userID = ? AND userStatus = 'invited';",[e,t]).run(n,"RoomDB.ignoreInvitation")];case 1:return r.sent(),[2]}})})},At=function(e,t,n){return pt(void 0,void 0,void 0,function(){return vt(this,function(r){switch(r.label){case 0:return[4,dt.A.makeQuery("INSERT INTO user_rooms (roomID, userID, userStatus)\n            VALUES (?, ?, 'requested');",[e,t]).run(n,"RoomDB.requestToJoin")];case 1:return r.sent(),[2]}})})},Nt=function(e,t,n){return pt(void 0,void 0,void 0,function(){return vt(this,function(r){switch(r.label){case 0:return[4,dt.A.makeQuery("DELETE FROM user_rooms\n            WHERE roomID = ? AND userID = ? AND userStatus = 'requested';",[e,t]).run(n,"RoomDB.cancelRequest")];case 1:return r.sent(),[2]}})})},St=function(e,t,n,r){return pt(void 0,void 0,void 0,function(){return vt(this,function(o){switch(o.label){case 0:return[4,dt.A.makeQuery("INSERT INTO user_rooms (roomID, userID, userStatus)\n            VALUES (?, ?, 'invited')\n            WHERE EXISTS (\n                SELECT roomID FROM rooms WHERE roomID = ? AND ownerUserName = ? LIMIT 1\n            );",[e,n,e,t]).run(r,"RoomDB.invite")];case 1:return o.sent(),[2]}})})},Tt=function(e,t,n,r){return pt(void 0,void 0,void 0,function(){return vt(this,function(o){switch(o.label){case 0:return[4,dt.A.makeQuery("DELETE FROM user_rooms\n            WHERE roomID = ? AND userID = ? AND userStatus = 'invited' AND EXISTS (\n                SELECT roomID FROM rooms WHERE roomID = ? AND ownerUserName = ? LIMIT 1\n            );",[e,n,e,t]).run(r,"RoomDB.cancelInvite")];case 1:return o.sent(),[2]}})})},Rt=function(e,t,n,r){return pt(void 0,void 0,void 0,function(){return vt(this,function(o){switch(o.label){case 0:return[4,dt.A.makeQuery("UPDATE user_rooms SET userStatus = 'member'\n            WHERE roomID = ? AND userID = ? userStatus = 'requested' AND EXISTS (\n                SELECT roomID FROM rooms WHERE roomID = ? AND ownerUserName = ? LIMIT 1\n            );",[e,n,e,t]).run(r,"RoomDB.acceptRequest")];case 1:return o.sent(),[2]}})})},It=function(e,t,n,r){return pt(void 0,void 0,void 0,function(){return vt(this,function(o){switch(o.label){case 0:return[4,dt.A.makeQuery("DELETE FROM user_rooms\n            WHERE roomID = ? AND userID = ? AND userStatus = 'requested' AND EXISTS (\n                SELECT roomID FROM rooms WHERE roomID = ? AND ownerUserName = ? LIMIT 1\n            );",[e,n,e,t]).run(r,"RoomDB.ignoreRequest")];case 1:return o.sent(),[2]}})})},xt=function(e,t,n,r){return pt(void 0,void 0,void 0,function(){return vt(this,function(o){switch(o.label){case 0:return[4,dt.A.makeQuery("DELETE FROM user_rooms\n            WHERE roomID = ? AND userID = ? AND userStatus = 'member' AND EXISTS (\n                SELECT roomID FROM rooms WHERE roomID = ? AND ownerUserName = ? LIMIT 1\n            );",[e,n,e,t]).run(r,"RoomDB.kickout")];case 1:return o.sent(),[2]}})})};var Dt=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})},Lt=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},Ot=o().Router(),Pt=m.A.isDevMode();Ot.get("/",f.A.authenticateTokenOptional,function(e,t){return Dt(void 0,void 0,void 0,function(){return Lt(this,function(n){return t.render("page/menu/index",R.makeEJSParams(e,!0,{loginDestination:""})),[2]})})}),Ot.get("/rooms.html",f.A.authenticateTokenOptional,function(e,t){return Dt(void 0,void 0,void 0,function(){return Lt(this,function(n){return t.render("page/menu/rooms",R.makeEJSParams(e,!1,{loginDestination:"rooms.html",tabName:e.query.tabname?e.query.tabname:"owned"})),[2]})})}),Ot.get("/register",function(e,t){t.render("page/form/register",R.makeEJSParams(e,!0,{registerDestination:""}))}),Ot.get("/room",f.A.authenticateToken,function(e,t){return Dt(void 0,void 0,void 0,function(){var n,r,o;return Lt(this,function(a){switch(a.label){case 0:return(n=f.A.getUserFromReqToken(e))?[4,bt(e.query.roomid,n.userID,t)]:(t.status(404).send("User not found."),[2]);case 1:return r=a.sent(),t.statusCode<200||t.statusCode>=300||(o=r[0],t.render("page/private/room",R.makeEJSParams(e,!1,{roomID:e.query.roomid,roomContent:o,title:o.roomName,desc:o.roomName,keywords:void 0}))),[2]}})})}),Pt&&(Ot.get("/console",function(e,t){t.render("page/misc/console",R.makeEJSParams(e,!0,{}))}),Ot.get("/test-ui",function(e,t){t.render("page/misc/test_ui",R.makeEJSParams(e,!0,{loginDestination:"",registerDestination:""}))}));const Ut=Ot;var _t=o().Router();_t.get("/create-room",f.A.authenticateToken,function(e,t){t.render("popup/createRoom",R.makeEJSParams(e,!1,{}))}),_t.get("/room-members",f.A.authenticateToken,function(e,t){return n=void 0,r=void 0,a=function(){return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(n){return t.render("popup/roomMembers",R.makeEJSParams(e,!1,{roomID:e.query.roomid,tabName:e.query.tabname?e.query.tabname:"associated"})),[2]})},new((o=void 0)||(o=Promise))(function(e,t){function i(e){try{s(a.next(e))}catch(e){t(e)}}function c(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o(function(e){e(n)})).then(i,c)}s((a=a.apply(n,r||[])).next())});var n,r,o,a});const jt=_t;var Ct=n(415);const Ft=function(e,t){void 0===t&&(t=void 0),e.statusCode>=200&&e.statusCode<=299&&(t?e.json(t):e.end())};var Mt=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})},qt=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},Bt=o().Router();Bt.post("/register",function(e,t){return Mt(void 0,void 0,void 0,function(){return qt(this,function(n){switch(n.label){case 0:return[4,f.A.register(e,t)];case 1:return n.sent(),Ft(t),[2]}})})}),Bt.post("/vemail",function(e,t){return Mt(void 0,void 0,void 0,function(){return qt(this,function(n){switch(n.label){case 0:return[4,Ct.A.startEmailVerification(e,t)];case 1:return n.sent(),Ft(t),[2]}})})}),Bt.post("/login",function(e,t){return Mt(void 0,void 0,void 0,function(){return qt(this,function(n){switch(n.label){case 0:return[4,f.A.login(e,t)];case 1:return n.sent(),Ft(t),[2]}})})}),Bt.delete("/logout",function(e,t){f.A.clearToken(t),Ft(t)});const Qt=Bt;var Jt=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})},Wt=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},Ht=o().Router(),Vt=function(e,t){return f.A.getUserFromReqToken(e)||(t.status(404).send("User not found."),null)};Ht.post("/create",f.A.authenticateToken,function(e,t){return Jt(void 0,void 0,void 0,function(){var n,r;return Wt(this,function(o){switch(o.label){case 0:return(n=Vt(e,t))?null!=(r=v.A.findErrorInRoomName(e.body.roomName))?(h.A.log("UserName Input Error",{userName:e.body.roomName,roomNameError:r},"high","pink"),t.status(400).send(p.A.displayText.message[r]),[2]):[4,yt(e.body.roomName,n.userName,t)]:[2];case 1:return o.sent(),Ft(t),[2]}})})}),Ht.delete("/delete",f.A.authenticateToken,function(e,t){return Jt(void 0,void 0,void 0,function(){var n;return Wt(this,function(r){switch(r.label){case 0:return(n=Vt(e,t))?[4,gt(e.body.roomID,n.userName,t)]:[2];case 1:return r.sent(),Ft(t),[2]}})})}),Ht.delete("/leave",f.A.authenticateToken,function(e,t){return Jt(void 0,void 0,void 0,function(){var n;return Wt(this,function(r){switch(r.label){case 0:return(n=Vt(e,t))?[4,wt(e.body.roomID,n.userName,t)]:[2];case 1:return r.sent(),Ft(t),[2]}})})}),Ht.put("/accept-invitation",f.A.authenticateToken,function(e,t){return Jt(void 0,void 0,void 0,function(){var n;return Wt(this,function(r){switch(r.label){case 0:return(n=Vt(e,t))?[4,kt(e.body.roomID,n.userID,t)]:[2];case 1:return r.sent(),Ft(t),[2]}})})}),Ht.delete("/ignore-invitation",f.A.authenticateToken,function(e,t){return Jt(void 0,void 0,void 0,function(){var n;return Wt(this,function(r){switch(r.label){case 0:return(n=Vt(e,t))?[4,Et(e.body.roomID,n.userID,t)]:[2];case 1:return r.sent(),Ft(t),[2]}})})}),Ht.post("/request-to-join",f.A.authenticateToken,function(e,t){return Jt(void 0,void 0,void 0,function(){var n;return Wt(this,function(r){switch(r.label){case 0:return(n=Vt(e,t))?[4,At(e.body.roomID,n.userID,t)]:[2];case 1:return r.sent(),Ft(t),[2]}})})}),Ht.delete("/cancel-request",f.A.authenticateToken,function(e,t){return Jt(void 0,void 0,void 0,function(){var n;return Wt(this,function(r){switch(r.label){case 0:return(n=Vt(e,t))?[4,Nt(e.body.roomID,n.userID,t)]:[2];case 1:return r.sent(),Ft(t),[2]}})})}),Ht.post("/invite",f.A.authenticateToken,function(e,t){return Jt(void 0,void 0,void 0,function(){var n;return Wt(this,function(r){switch(r.label){case 0:return(n=Vt(e,t))?[4,St(e.body.roomID,n.userName,e.body.userID,t)]:[2];case 1:return r.sent(),Ft(t),[2]}})})}),Ht.delete("/cancel-invite",f.A.authenticateToken,function(e,t){return Jt(void 0,void 0,void 0,function(){var n;return Wt(this,function(r){switch(r.label){case 0:return(n=Vt(e,t))?[4,Tt(e.body.roomID,n.userName,e.body.userID,t)]:[2];case 1:return r.sent(),Ft(t),[2]}})})}),Ht.put("/accept-request",f.A.authenticateToken,function(e,t){return Jt(void 0,void 0,void 0,function(){var n;return Wt(this,function(r){switch(r.label){case 0:return(n=Vt(e,t))?[4,Rt(e.body.roomID,n.userName,e.body.userID,t)]:[2];case 1:return r.sent(),Ft(t),[2]}})})}),Ht.delete("/ignore-request",f.A.authenticateToken,function(e,t){return Jt(void 0,void 0,void 0,function(){var n;return Wt(this,function(r){switch(r.label){case 0:return(n=Vt(e,t))?[4,It(e.body.roomID,n.userName,e.body.userID,t)]:[2];case 1:return r.sent(),Ft(t),[2]}})})}),Ht.delete("/kickout",f.A.authenticateToken,function(e,t){return Jt(void 0,void 0,void 0,function(){var n;return Wt(this,function(r){switch(r.label){case 0:return(n=Vt(e,t))?[4,xt(e.body.roomID,n.userName,e.body.userID,t)]:[2];case 1:return r.sent(),Ft(t),[2]}})})});const Gt=Ht;var zt=n(567),Yt=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})},$t=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},Kt=o().Router(),Xt=function(e,t){var n=f.A.getUserFromReqToken(e);if(!n)return t.status(404).send("User not found."),null;var r=parseInt(e.query.page);return isNaN(r)?(t.status(400).send("Invalid page number."),null):{user:n,page:r}};Kt.get("/rooms/owned",f.A.authenticateToken,function(e,t){return Yt(void 0,void 0,void 0,function(){var n,r;return $t(this,function(o){switch(o.label){case 0:return(n=Xt(e,t))?[4,zt.A.rooms.whichIOwn(n.user.userID,n.page,t)]:[2];case 1:return r=o.sent(),Ft(t,r),[2]}})})}),Kt.get("/rooms/joined",f.A.authenticateToken,function(e,t){return Yt(void 0,void 0,void 0,function(){var n,r;return $t(this,function(o){switch(o.label){case 0:return(n=Xt(e,t))?[4,zt.A.rooms.whichIJoined(n.user.userID,n.page,t)]:[2];case 1:return r=o.sent(),Ft(t,r),[2]}})})}),Kt.get("/rooms/invited",f.A.authenticateToken,function(e,t){return Yt(void 0,void 0,void 0,function(){var n,r;return $t(this,function(o){switch(o.label){case 0:return(n=Xt(e,t))?[4,zt.A.rooms.whichInvitedMe(n.user.userID,n.page,t)]:[2];case 1:return r=o.sent(),Ft(t,r),[2]}})})}),Kt.get("/rooms/requested",f.A.authenticateToken,function(e,t){return Yt(void 0,void 0,void 0,function(){var n,r;return $t(this,function(o){switch(o.label){case 0:return(n=Xt(e,t))?[4,zt.A.rooms.whichIRequestedToJoin(n.user.userID,n.page,t)]:[2];case 1:return r=o.sent(),Ft(t,r),[2]}})})}),Kt.get("/rooms/pending",f.A.authenticateToken,function(e,t){return Yt(void 0,void 0,void 0,function(){var n,r;return $t(this,function(o){switch(o.label){case 0:return(n=Xt(e,t))?[4,zt.A.rooms.whichIAmPendingToJoin(n.user.userID,n.page,t)]:[2];case 1:return r=o.sent(),Ft(t,r),[2]}})})}),Kt.get("/rooms/associated",f.A.authenticateToken,function(e,t){return Yt(void 0,void 0,void 0,function(){var n,r;return $t(this,function(o){switch(o.label){case 0:return(n=Xt(e,t))?[4,zt.A.rooms.whichIAmAssociatedWith(n.user.userID,n.page,t)]:[2];case 1:return r=o.sent(),Ft(t,r),[2]}})})}),Kt.get("/rooms/others",f.A.authenticateToken,function(e,t){return Yt(void 0,void 0,void 0,function(){var n,r;return $t(this,function(o){switch(o.label){case 0:return(n=Xt(e,t))?[4,zt.A.rooms.others(n.user.userID,n.page,t)]:[2];case 1:return r=o.sent(),Ft(t,r),[2]}})})}),Kt.get("/users/joined",f.A.authenticateToken,function(e,t){return Yt(void 0,void 0,void 0,function(){var n,r;return $t(this,function(o){switch(o.label){case 0:return(n=Xt(e,t))?[4,zt.A.users.whoJoinedRoom(e.query.roomid,n.page,t)]:[2];case 1:return r=o.sent(),Ft(t,r),[2]}})})}),Kt.get("/users/invited",f.A.authenticateToken,function(e,t){return Yt(void 0,void 0,void 0,function(){var n,r;return $t(this,function(o){switch(o.label){case 0:return(n=Xt(e,t))?[4,zt.A.users.whoAreInvitedToJoinRoom(e.query.roomid,n.page,t)]:[2];case 1:return r=o.sent(),Ft(t,r),[2]}})})}),Kt.get("/users/requested",f.A.authenticateToken,function(e,t){return Yt(void 0,void 0,void 0,function(){var n,r;return $t(this,function(o){switch(o.label){case 0:return(n=Xt(e,t))?[4,zt.A.users.whoRequestedToJoinRoom(e.query.roomid,n.page,t)]:[2];case 1:return r=o.sent(),Ft(t,r),[2]}})})}),Kt.get("/users/pending",f.A.authenticateToken,function(e,t){return Yt(void 0,void 0,void 0,function(){var n,r;return $t(this,function(o){switch(o.label){case 0:return(n=Xt(e,t))?[4,zt.A.users.whoArePendingToJoinRoom(e.query.roomid,n.page,t)]:[2];case 1:return r=o.sent(),Ft(t,r),[2]}})})}),Kt.get("/users/associated",f.A.authenticateToken,function(e,t){return Yt(void 0,void 0,void 0,function(){var n,r;return $t(this,function(o){switch(o.label){case 0:return(n=Xt(e,t))?[4,zt.A.users.whoAreAssociatedWithRoom(e.query.roomid,n.page,t)]:[2];case 1:return r=o.sent(),Ft(t,r),[2]}})})}),Kt.get("/users/others",f.A.authenticateToken,function(e,t){return Yt(void 0,void 0,void 0,function(){var n,r;return $t(this,function(o){switch(o.label){case 0:return(n=Xt(e,t))?[4,zt.A.users.others(e.query.roomid,n.page,t)]:[2];case 1:return r=o.sent(),Ft(t,r),[2]}})})});const Zt=Kt,en=require("socket.io");var tn=n.n(en),nn=n(114),rn=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})},on=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};const an=function(e){var t=e.of("/chat");t.use(function(e,t){return rn(void 0,void 0,void 0,function(){var n,r;return on(this,function(o){switch(o.label){case 0:return n=e.request,r=n.res,[4,f.A.authenticateToken_internal(t,!1,n,r)];case 1:return o.sent()||h.A.logRaw("Socket Auth Failure","high","pink"),[2]}})})}),t.on("connection",function(e){e.on("join chat",function(t){return rn(void 0,void 0,void 0,function(){return on(this,function(n){switch(n.label){case 0:return[4,e.join(t)];case 1:return n.sent(),[2]}})})}),e.on("leave chat",function(t){return rn(void 0,void 0,void 0,function(){return on(this,function(n){switch(n.label){case 0:return[4,e.leave(t)];case 1:return n.sent(),[2]}})})}),e.on("chat message",function(n){h.A.log("Chat Message Received",{data:n},"low");var r=e.data.name=n.name,o=e.data.room=n.room,a=n.message;e.join(o),t.to(o).emit("chat message","<b>".concat(r,":</b> ").concat(a))})})};w().config();w().config(),n(224),n(692),function(){var e,t,n,r;e=this,t=void 0,r=function(){var e,t;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(n){switch(n.label){case 0:return m.A.isDevMode()?[4,lt()]:[3,2];case 1:return n.sent(),[3,4];case 2:return m.A.isSSGMode()?[4,lt()]:[3,4];case 3:return n.sent(),[2];case 4:return dt.A.runSQLFile("init.sql"),e=o()(),t=i().createServer(e),e.set("view engine","ejs"),e.use(s().json()),e.use(s().urlencoded({extended:!0})),e.use(l()()),function(e){mt.A.page.bypassDynamicPages||e.use("/",Ut),e.use("/popup",jt),e.use("/api/auth",Qt),e.use("/api/search",Zt),e.use("/api/room",Gt),e.use(o().static(ht().join(process.env.PWD,process.env.STATIC_PAGE_ROOT_DIR)))}(e),t.listen(process.env.PORT,function(){console.log("---------------------------------------------"),console.log("Listening to port ".concat(process.env.PORT,"."))}),function(e){var t=new(tn().Server)(e);t.listen(8080),nn.A.init(t),an(t)}(t),[2]}})},new((n=void 0)||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})}()})();