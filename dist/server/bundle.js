(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=require("express");var n=e.n(t);const o=require("http");var r=e.n(o);const a=require("body-parser");var c=e.n(a);const i=require("cookie-parser");var s=e.n(i);const l=require("hpp");var u=e.n(l);const d=require("path");var f=e.n(d);const h=require("fs/promises");var p=e.n(h);const m=require("mysql2/promise");var b=e.n(m);const y=require("dotenv");var v=e.n(y),g=function(){function e(e,t,n){this.pool=e,this.queryStr=t,this.queryParams=n}return e.prototype.run=function(e,t){return n=this,o=void 0,a=function(){var n,o,r;return function(e,t){var n,o,r,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(a){switch(a.label){case 0:t&&D.pushStackTrace(t),D.log("SQL Query Started",{queryStr:this.queryStr,queryParams:this.queryParams},"low"),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.pool.query(this.queryStr,this.queryParams)];case 2:return n=a.sent(),o=n[0],n[1],D.log("SQL Query Succeeded",{queryStr:this.queryStr,queryParams:this.queryParams},"medium"),t&&D.popStackTrace(t),null==e||e.status(202),[2,o];case 3:return r=a.sent(),D.log("SQL Query Error",{err:r},"high","pink"),t&&D.popStackTrace(t),null==e||e.status(500).send(r),[2,[]];case 4:return[2]}})},new((r=void 0)||(r=Promise))(function(e,t){function c(e){try{s(a.next(e))}catch(e){t(e)}}function i(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r(function(e){e(n)})).then(c,i)}s((a=a.apply(n,o||[])).next())});var n,o,r,a},e}();const w=g;var x=function(){function e(e,t){this.pool=e,this.queries=t}return e.prototype.run=function(e,t){return n=this,o=void 0,a=function(){var n,o,r,a,c,i,s,l,u;return function(e,t){var n,o,r,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(d){switch(d.label){case 0:t&&D.pushStackTrace(t),D.log("SQL Transaction Began",{numQueries:this.queries.length},"low"),n=void 0,o=!1,r=0,d.label=1;case 1:return d.trys.push([1,11,13,14]),[4,this.pool.getConnection()];case 2:return[4,(n=d.sent()).beginTransaction()];case 3:d.sent(),a=0,c=this.queries,d.label=4;case 4:return a<c.length?(i=c[a],r++,D.log("SQL Transaction Query Started",{progress:"".concat(r,"/").concat(this.queries.length),query:i},"low"),[4,null==n?void 0:n.query(i.queryStr,i.queryParams)]):[3,9];case 5:return s=d.sent(),l=s[0],s[1],0!=l.affectedRows?[3,7]:[4,null==n?void 0:n.rollback()];case 6:return d.sent(),D.log("SQL Transaction Query Made No Change",{progress:"".concat(r,"/").concat(this.queries.length),query:i},"high"),t&&D.popStackTrace(t),null==e||e.status(403),[2];case 7:D.log("SQL Transaction Query Succeeded",{progress:"".concat(r,"/").concat(this.queries.length),query:i},"low"),d.label=8;case 8:return a++,[3,4];case 9:return[4,null==n?void 0:n.commit()];case 10:return d.sent(),D.logRaw("SQL Transaction Committed","medium"),t&&D.popStackTrace(t),o=!0,[3,14];case 11:return u=d.sent(),D.log("SQL Transaction Error",{progress:"".concat(r,"/").concat(this.queries.length),err:u},"high","pink"),[4,null==n?void 0:n.rollback()];case 12:return d.sent(),t&&D.popStackTrace(t),null==e||e.status(500).send(u),[3,14];case 13:return null==n||n.release(),o&&(null==e||e.status(202)),[7];case 14:return[2]}})},new((r=void 0)||(r=Promise))(function(e,t){function c(e){try{s(a.next(e))}catch(e){t(e)}}function i(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r(function(e){e(n)})).then(c,i)}s((a=a.apply(n,o||[])).next())});var n,o,r,a},e}();const S=x;v().config();var k="dev"==process.env.MODE,I=void 0,R={createPool:function(){I?D.logRaw("DB connection pool is already created.","high","pink"):(I=b().createPool({host:k?process.env.SQL_HOST_DEV:process.env.SQL_HOST_PROD,user:k?process.env.SQL_USER_DEV:process.env.SQL_USER_PROD,password:k?process.env.SQL_PASS_DEV:process.env.SQL_PASS_PROD,database:"main",waitForConnections:!0,connectionLimit:10,queueLimit:0,enableKeepAlive:!0,keepAliveInitialDelay:0}))||D.logRaw("Failed to create a DB connection pool.","high","pink")},makeQuery:function(e,t){return I||R.createPool(),new w(I,e,t)},makeTransaction:function(e){return new S(I,e)},runSQLFile:function(e){return t=void 0,n=void 0,r=function(){var t,n,o,r,a,c,i;return function(e,t){var n,o,r,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(s){switch(s.label){case 0:return D.log("Opening SQL File",{fileName:e},"high"),[4,C.read(e,"sql")];case 1:t=s.sent(),n=t.split(";").map(function(e){return e.trim()+";"}).filter(function(e){return e.length>1}),o=void 0,s.label=2;case 2:return s.trys.push([2,8,9,10]),[4,b().createConnection({host:k?process.env.SQL_HOST_DEV:process.env.SQL_HOST_PROD,user:k?process.env.SQL_USER_DEV:process.env.SQL_USER_PROD,password:k?process.env.SQL_PASS_DEV:process.env.SQL_PASS_PROD})];case 3:null==(o=s.sent())||o.connect(),r=0,a=n,s.label=4;case 4:return r<a.length?(c=a[r],[4,null==o?void 0:o.query(c)]):[3,7];case 5:s.sent(),s.label=6;case 6:return r++,[3,4];case 7:return[3,10];case 8:return i=s.sent(),D.log("SQL File Execution Error",{err:i},"high","pink"),[3,10];case 9:return null==o||o.end(),[7];case 10:return[2]}})},new((o=void 0)||(o=Promise))(function(e,a){function c(e){try{s(r.next(e))}catch(e){a(e)}}function i(e){try{s(r.throw(e))}catch(e){a(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o(function(e){e(n)})).then(c,i)}s((r=r.apply(t,n||[])).next())});var t,n,o,r}};const j=R;var O,T="</td>";const E=function(e,t){(O=e.of("/console_sockets")).use(t),O.on("connection",function(e){console.log("(ConsoleSockets) Client connected :: ".concat(JSON.stringify(e.handshake.auth))),e.on("command",function(t){console.log("(ConsoleSockets) Command received :: [".concat(t,"] - sent by :: ").concat(JSON.stringify(e.handshake.auth.user)));var n=t.split(" ");switch(n[0]){case"print":n.shift(),D.logRaw(0==n.length?"-":n.join(" "),"high");break;case"db":"dev"==process.env.MODE?(n.shift(),j.runSQLFile("".concat(n[0],".sql"))):D.logRaw('Command "'.concat(n[0],'" is supported only in dev mode.'),"high","pink");break;case"reboot":D.logRaw("Rebooting...","high"),process.exit(0);break;default:D.logRaw('Unknown command "'.concat(n[0],'".'),"high","pink")}}),e.on("disconnect",function(){console.log("(ConsoleSockets) Client disconnected :: ".concat(JSON.stringify(e.handshake.auth)))})})},N=function(e,t,n){var o,r,a;O?O.emit("log",(o=e,r=t,a=n,"".concat('<td style="color: #e0e020; background-color: #202090;">').concat(o).concat(T).concat('<td style="color: #20e020; background-color: #101010;">').concat(r).concat(T).concat('<td style="color: #303030; background-color: #c0c0c0;">').concat(a).concat(T))):console.log("".concat(e,"\n(ORIGIN: ").concat(t,")\n(DETAILS: ").concat(n,")"))};var L=[],M={thresholdLogLevel:0,setThresholdLogLevel:function(e){M.thresholdLogLevel=isNaN(e)?M.getLogLevelFromName(e):e},getThresholdLogLevel:function(){return M.thresholdLogLevel},getLogLevelFromName:function(e){switch(e){case"low":return 0;case"medium":return 1;case"high":return 2;default:console.error('ERROR: Unknown log level name ("'.concat(e,'")'))}return 0},log:function(e,t,n,o){void 0===t&&(t=void 0),void 0===n&&(n="high");var r="";null!=t&&(r=JSON.stringify(t));var a=M.getStackTrace();M.getLogLevelFromName(n)>=M.thresholdLogLevel&&N((o?'<b style="color:'.concat(o,'">'):"")+e+(o?"</b>":""),a,r)},logRaw:function(e,t,n){void 0===t&&(t="high"),M.log(e,void 0,t,n)},getStackTrace:function(){for(var e=[],t=L.length-1;t>=0;--t)e.push(L[t]);return e.join(" <- ")},pushStackTrace:function(e){L.push(e),M.logRaw("pushStackTrace: ".concat(e),"high","gray")},popStackTrace:function(e){if(0!=L.length){var t=L.pop();t==e?M.logRaw("popStackTrace: ".concat(e),"high","gray"):M.logRaw("Name mismatch in stackTrace :: (traceName = ".concat(e,", expectedTraceName = ").concat(t,")"),"high","pink")}else M.logRaw("No name to pop in stackTrace :: (traceName = ".concat(e,")"),"high","pink")}};const D=M;var P=function(e,t,n,o){return new(n||(n=Promise))(function(r,a){function c(e){try{s(o.next(e))}catch(e){a(e)}}function i(e){try{s(o.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,i)}s((o=o.apply(e,t||[])).next())})},A=function(e,t){var n,o,r,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};v().config();var _={read:function(e,t){return P(void 0,void 0,void 0,function(){var n,o;return A(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),n=_.getAbsoluteFilePath(e,t),[4,p().readFile(n,{encoding:"utf8"})];case 1:return[2,r.sent()];case 2:return o=r.sent(),D.log("Failed to read file",{relativeFilePath:e,err:o},"high","pink"),[2,""];case 3:return[2]}})})},write:function(e,t,n){return P(void 0,void 0,void 0,function(){var o,r;return A(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),o=_.getAbsoluteFilePath(e,n),[4,p().writeFile(o,t)];case 1:return a.sent(),[3,3];case 2:return r=a.sent(),D.log("Failed to write file",{relativeFilePath:e,err:r},"high","pink"),[3,3];case 3:return[2]}})})},getAllRelativePathsInDirRecursively:function(e){return P(void 0,void 0,void 0,function(){var t,n;return A(this,function(o){switch(o.label){case 0:return t=f().join(process.env.PWD,e),n=[],[4,_.getAllRelativePathsInDirRecursively_internal(t,[],n)];case 1:return o.sent(),[2,n]}})})},getAbsoluteFilePath:function(e,t){return null==t&&(t=process.env.STATIC_PAGE_ROOT_DIR),f().join(process.env.PWD,t+"/"+e)},getAllRelativePathsInDirRecursively_internal:function(e,t,n){return P(this,void 0,void 0,function(){var o,r,a,c,i,s;return A(this,function(l){switch(l.label){case 0:return[4,p().readdir(e)];case 1:o=l.sent(),r=0,a=o,l.label=2;case 2:return r<a.length?(c=a[r],i=t.concat(c),s="".concat(e,"/").concat(c),[4,p().lstat(s)]):[3,7];case 3:return l.sent().isFile()?(n.push(i.join("/")),[3,6]):[3,4];case 4:return[4,_.getAllRelativePathsInDirRecursively_internal(s,i,n)];case 5:l.sent(),l.label=6;case 6:return r++,[3,2];case 7:return[2]}})})}};const C=_,U={displayText:{pageName:{index:"Home",arcade:"Arcade",library:"Library",portfolio:"Portfolio",register:"Create Account",login:"Log In",mypage:"Portal"},message:{"error/userName/length":"Username must be between 4 and 16 characters long.","error/userName/chars":"Username can only contain alphabets, numbers, and underbar(_).","error/password/length":"Password must be between 6 and 24 characters long.","error/password/chars":"Password can only contain alphabets, numbers, and the following special characters: ~`!@#$%^&*()-_+={}[]|\\:;\"'<>,.?/","error/email/length":"Email address must not contain more than 64 characters.","error/email/chars":"Please enter a valid email address.","error/roomName/length":"Room name must be between 4 and 64 characters long.","error/roomName/chars":"Room name can only contain alphabets, numbers, spaces, and the following special characters: ~`!@#$%^&*()-_+={}[]|\\:;\"'<>,.?/","rule/userName/length":"Username must be between 4 and 16 characters long.","rule/userName/chars":"Username can only contain alphabets, numbers, and underbar(_).","rule/password/length":"Password must be between 6 and 24 characters long.","rule/password/chars":"Password can only contain alphabets, numbers, and the following special characters: ~`!@#$%^&*()-_+={}[]|\\:;\"'<>,.?/","rule/email/length":"Email address must not contain more than 64 characters.","rule/roomName/length":"Room name must be between 4 and 64 characters long.","rule/roomName/chars":"Room name can only contain alphabets, numbers, spaces, and the following special characters: ~`!@#$%^&*()-_+={}[]|\\:;\"'<>,.?/"}}},B={escapeHTMLChars:e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replaceAll("\n","<br>").replaceAll(" ","&nbsp;"),findErrorInUserName:e=>e.length<4||e.length>16?"error/userName/length":e!=B.sanitizeUserName(e)?"error/userName/chars":null,findErrorInPassword:e=>e.length<6||e.length>24?"error/password/length":e!=B.sanitizePassword(e)?"error/password/chars":null,findErrorInEmailAddress:e=>e.length>64?"error/email/length":/^[^\s@]+@[^\s@]+.[^\s@]+$/.test(e)?null:"error/email/chars",findErrorInRoomName:e=>e.length<4||e.length>64?"error/roomName/length":e!=B.sanitizeRoomName(e)?"error/roomName/chars":null,sanitizeUserName:e=>(e.length>16&&(e=e.substring(0,16)),e.replace(/[^a-zA-Z0-9_]/g,"")),sanitizePassword:e=>(e.length>24&&(e=e.substring(0,24)),e.replace(/[^a-zA-Z0-9~`!@#\$%\^&\*\(\)-_\+=\{\[\}\]\|\\:;"'<>,\.\?\/]/g,"")),sanitizeRoomName:e=>B.sanitizeRoomNameWithoutTrimming(e).trim(),sanitizeRoomNameWithoutTrimming:e=>(e.length>64&&(e=e.substring(0,64)),e.replace(/[^a-zA-Z0-9~`!@#\$%\^&\*\(\)-_\+=\{\[\}\]\|\\:;"'<>,\.\?\/\s]/g,"").replace(/\s+/g," "))},F=B,z=require("ejs");var G=e.n(z);v().config();var q="".concat(process.env.PWD,"/").concat(process.env.VIEWS_ROOT_DIR,"/partial"),J={TextUtil:F,UIConfig:U,ejsPartialRootPath:q,isStaticPage:!0},Q={TextUtil:F,UIConfig:U,ejsPartialRootPath:q,isStaticPage:!1},W={},H={render:function(e,t,n,o){t.render(n,H.makeEJSParams(e,o),function(e,n){e?t.status(500).send(e.message):(n=H.postProcessHTML(n),t.status(200).setHeader("content-type","text/html").send(n))})},postProcessHTML:function(e){return"dev"==process.env.MODE?e=e.replaceAll("\n","!*NEW_LINE*!").replace(/(PROD_CODE_BEGIN).*?(PROD_CODE_END)/g,"REMOVED_PROD_CODE").replaceAll("!*NEW_LINE*!","\n").replaceAll(process.env.URL_STATIC,"http://localhost:".concat(process.env.PORT)).replaceAll(process.env.URL_DYNAMIC,"http://localhost:".concat(process.env.PORT)):e},makeEJSParams:function(e,t){var n={};return Object.assign(n,Q),Object.assign(n,t),n.user&&D.log("'user' shouldn't be defined manually in EJS params.",{mergedEJSParams:n},"high","pink"),n.user=e.user,n.globalDictionary&&D.log("'globalDictionary' shouldn't be defined manually in EJS params.",{mergedEJSParams:n},"high","pink"),n.globalDictionary={},n},makeEJSParamsStatic:function(e){var t={};return Object.assign(t,J),Object.assign(t,e),t},createStaticHTMLFromEJS:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return o=void 0,r=function(e,t,n){if(n||2===arguments.length)for(var o,r=0,a=t.length;r<a;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))}([e],t,!0),c=function(e,t){var n;return void 0===t&&(t={}),function(e,t){var n,o,r,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(o){switch(o.label){case 0:return null!=(n=W[e])?[3,2]:[4,C.read(e,process.env.VIEWS_ROOT_DIR)];case 1:n=o.sent(),W[e]=n,o.label=2;case 2:return[2,G().compile(n)(H.makeEJSParamsStatic(t))]}})},new((a=void 0)||(a=Promise))(function(e,t){function n(e){try{s(c.next(e))}catch(e){t(e)}}function i(e){try{s(c.throw(e))}catch(e){t(e)}}function s(t){var o;t.done?e(t.value):(o=t.value,o instanceof a?o:new a(function(e){e(o)})).then(n,i)}s((c=c.apply(o,r||[])).next())});var o,r,a,c}};const V=H;v().config();const Y=function(){function e(){this.lines=["</urlset>"]}return e.prototype.addEntry=function(e,t){this.lines.push("</url>"),this.lines.push("  <lastmod>".concat(t,"</lastmod>")),this.lines.push("  <loc>".concat(process.env.URL_STATIC,"/").concat(e,"</loc>")),this.lines.push("<url>")},e.prototype.build=function(){return e=this,t=void 0,o=function(){return function(e,t){var n,o,r,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(e){switch(e.label){case 0:return this.lines.push('<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">'),this.lines.push('<?xml version="1.0" encoding="UTF-8"?>'),this.lines.reverse(),[4,C.write("sitemap.xml",this.lines.join("\n"))];case 1:return e.sent(),[2]}})},new((n=void 0)||(n=Promise))(function(r,a){function c(e){try{s(o.next(e))}catch(e){a(e)}}function i(e){try{s(o.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,i)}s((o=o.apply(e,t||[])).next())});var e,t,n,o},e}();v().config();const X=function(){function e(){this.lines=["</feed>"],this.globalLatestUpdate=new Date(process.env.GLOBAL_LAST_MOD)}return e.prototype.addEntry=function(e,t,n,o){var r=new Date(n);r>this.globalLatestUpdate&&(this.globalLatestUpdate=r),this.lines.push("</entry>"),this.lines.push("  <summary>".concat(o,"</summary>")),this.lines.push("  <updated>".concat(r.toISOString(),"</updated>")),this.lines.push("  <id>".concat(e,"</id>")),this.lines.push('  <link href="'.concat(e,'"/>')),this.lines.push("  <title>".concat(t,"</title>")),this.lines.push("<entry>")},e.prototype.build=function(){return e=this,t=void 0,o=function(){return function(e,t){var n,o,r,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(e){switch(e.label){case 0:return this.lines.push("<id>urn:uuid:02210672-5391-4cc8-800a-2a88f3a6d00c</id>"),this.lines.push("</author>"),this.lines.push("  <name>Youngjin Kang</name>"),this.lines.push("<author>"),this.lines.push("<updated>".concat(this.globalLatestUpdate.toISOString(),"</updated>")),this.lines.push('<link href="'.concat(process.env.URL_STATIC,'"/>')),this.lines.push('<link rel="self" type="application/atom+xml" href="'.concat(process.env.URL_STATIC,'/feed.atom"/>')),this.lines.push("<title>ThingsPool</title>"),this.lines.push('<feed xmlns="http://www.w3.org/2005/Atom">'),this.lines.push('<?xml version="1.0" encoding="utf-8"?>'),this.lines.reverse(),[4,C.write("feed.atom",this.lines.join("\n"))];case 1:return e.sent(),[2]}})},new((n=void 0)||(n=Promise))(function(r,a){function c(e){try{s(o.next(e))}catch(e){a(e)}}function i(e){try{s(o.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,i)}s((o=o.apply(e,t||[])).next())});var e,t,n,o},e}();v().config();const $=function(){function e(){this.lines=[]}return e.prototype.addLine=function(e){this.lines.push(e)},e.prototype.getText=function(){return this.lines.join("\n")},e.prototype.build=function(e,t){return n=this,o=void 0,a=function(){return function(e,t){var n,o,r,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(n){switch(n.label){case 0:return null==t&&(t=process.env.STATIC_PAGE_ROOT_DIR),[4,C.write(e,this.lines.join("\n"),t)];case 1:return n.sent(),[2]}})},new((r=void 0)||(r=Promise))(function(e,t){function c(e){try{s(a.next(e))}catch(e){t(e)}}function i(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r(function(e){e(n)})).then(c,i)}s((a=a.apply(n,o||[])).next())});var n,o,r,a},e}();v().config();var K=function(){function e(e,t){this.sitemapBuilder=e,this.atomFeedBuilder=t}return e.prototype.build=function(e){return t=this,n=void 0,r=function(){var t,n,o,r,a,c,i,s,l,u,d,f,h,p,m,b,y,v;return function(e,t){var n,o,r,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(g){switch(g.label){case 0:return t="".concat(e.dirName,"/page.html"),[4,C.read("".concat(e.dirName,"/source.txt"))];case 1:for(n=g.sent(),o=n.split(/\r?\n/),r=null==e.playLinkImagePathOverride?"play.png":e.playLinkImagePathOverride,a="",c="",o[0].startsWith(":d:")?a=o[0].substring(3):console.error(":d: is missing in -> "+e.title),o[1].startsWith(":k:")?c=o[1].substring(3).toLowerCase().replaceAll("-"," "):console.error(":k: is missing in -> "+e.title),i=[],s=1,l=[],u=function(){l.length>0&&(i.push("<p>".concat(l.join("<br>"),"</p>")),l.length=0)},d=2;d<o.length;++d)0==(f=(f=o[d]).trim()).length?u():f.startsWith("[")?(u(),(h=f.match(/\[(.*?)\]/)[1].trim()).length>0&&i.push("<h2>".concat(h,"</h2>"))):f.startsWith("<")?(u(),(p=f.match(/<(.*?)>/)[1]).length>0&&(m="".concat(process.env.URL_STATIC,"/").concat(e.dirName,"/").concat(p,".jpg"),i.push('<img class="l_image" src="'.concat(m,'" alt="ThingsPool - ').concat(e.title," (Screenshot ").concat(s++,')">')))):(f=f.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll("{%","<").replaceAll("%}",">"),l.push(f));return u(),null!=e.videoTag&&null!=e.videoTag&&i.push(e.videoTag),b=new $,v=(y=b).addLine,[4,V.createStaticHTMLFromEJS("page/static/arcadeGame.ejs",{entry:e,relativeURL:t,description:a,keywords:c,playLinkImagePath:r,content:i.join("\n")})];case 2:return v.apply(y,[g.sent()]),this.sitemapBuilder.addEntry(t,e.lastmod),this.atomFeedBuilder.addEntry("".concat(process.env.URL_STATIC,"/").concat(t),e.title,e.lastmod,e.title),[4,b.build(t)];case 3:return g.sent(),[2]}})},new((o=void 0)||(o=Promise))(function(e,a){function c(e){try{s(r.next(e))}catch(e){a(e)}}function i(e){try{s(r.throw(e))}catch(e){a(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o(function(e){e(n)})).then(c,i)}s((r=r.apply(t,n||[])).next())});var t,n,o,r},e}();const Z=K;var ee={gameEntries:[{dirName:"ArtRaider",title:"ArtRaider",playLinkImagePathOverride:"badge_onestore.png",playLinkURL:"https://onesto.re/0001000383",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/RuLgOJrNtKA?si=Ts_Yu_jdpB1qmNiT" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>',lastmod:"2025-04-15"},{dirName:"Water-vs-Fire",title:"Water vs Fire",playLinkURL:"https://www.gamearter.com/game/water-vs-fire",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/6DeA_m8Iq4M?si=hC1uzkEtBWpYcM8z" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>',lastmod:"2023-09-10"},{dirName:"HuntLand",title:"HuntLand",playLinkURL:"https://www.gamearter.com/game/huntland",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/3dRg6vvoPqc?si=FlnKVyzQq0_55sL2" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>',lastmod:"2023-09-10"},{dirName:"PoliceChase",title:"Police Chase",playLinkURL:"https://www.gamearter.com/game/policechase",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/kABg0j2mZqQ?si=3-JUZQnh3omVXSJd" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>',lastmod:"2023-09-10"},{dirName:"SpaceTown",title:"SpaceTown",playLinkURL:"https://www.gamearter.com/game/spacetown",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/NoiQzEKJM-A?si=o8vTNqW1kxCJ4MnW" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>',lastmod:"2023-09-20"}]};v().config();var te=function(){function e(e,t){this.sitemapBuilder=e,this.atomFeedBuilder=t}return e.prototype.build=function(){return e=this,t=void 0,o=function(){var e,t,n,o,r,a;return function(e,t){var n,o,r,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(c){switch(c.label){case 0:return e=new $,n=(t=e).addLine,[4,V.createStaticHTMLFromEJS("page/static/arcade.ejs",{entries:ee.gameEntries})];case 1:return n.apply(t,[c.sent()]),[4,e.build("arcade.html")];case 2:c.sent(),this.sitemapBuilder.addEntry("arcade.html","2025-02-28"),o=0,r=ee.gameEntries,c.label=3;case 3:return o<r.length?(a=r[o],[4,new Z(this.sitemapBuilder,this.atomFeedBuilder).build(a)]):[3,6];case 4:c.sent(),c.label=5;case 5:return o++,[3,3];case 6:return[2]}})},new((n=void 0)||(n=Promise))(function(r,a){function c(e){try{s(o.next(e))}catch(e){a(e)}}function i(e){try{s(o.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,i)}s((o=o.apply(e,t||[])).next())});var e,t,n,o},e}();const ne=te;var oe=function(e,t,n,o){return new(n||(n=Promise))(function(r,a){function c(e){try{s(o.next(e))}catch(e){a(e)}}function i(e){try{s(o.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,i)}s((o=o.apply(e,t||[])).next())})},re=function(e,t){var n,o,r,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};v().config();var ae=function(){function e(e,t){this.sitemapBuilder=e,this.atomFeedBuilder=t}return e.prototype.build=function(e){return oe(this,void 0,void 0,function(){var t,n,o,r,a,c,i,s,l,u,d,f,h,p,m,b,y,v,g,w,x,S,k,I,R,j,O=this;return re(this,function(T){switch(T.label){case 0:return t=!0,n="???",o=1,r=1,a=void 0,c=!1,i=!1,s=[],l=[],u=[],d="A writing by ThingsPool.",f="thingspool, software, engineering, philosophy",h=process.env.GLOBAL_LAST_MOD,p=n,m=d,b=f,y=h,v=function(){s.length>0&&(c?u.push('<div class="snippet"><pre><code>'.concat(s.join("\n"),"</code></pre></div>")):i?u.push('<pre><div class="excerpt">'.concat(s.join("\n"),"</div></pre>")):u.push("<p>".concat(s.join("<br>"),"</p>")),s.length=0)},g=function(t,n,c,i,s){return oe(O,void 0,void 0,function(){var d,f,h,p;return re(this,function(m){switch(m.label){case 0:return d="".concat(e.dirName,"/page-").concat(o,".html"),f=new $,p=(h=f).addLine,[4,V.createStaticHTMLFromEJS("page/static/libraryPost.ejs",{title:t,desc:c,keywords:i,customOGImagePath:a,entry:e,pageNumber:o,isLastPage:s,content:u.join("\n")})];case 1:return p.apply(h,[m.sent()]),[4,f.build(d)];case 2:return m.sent(),u.length=0,this.sitemapBuilder.addEntry(d,n),this.atomFeedBuilder.addEntry("".concat(process.env.URL_STATIC,"/").concat(d),t,n,c),l.push({pageNumber:o,title:t,lastmod:n,desc:c,keywords:i,customOGImagePath:a}),o++,r=1,a=void 0,[2]}})})},[4,C.read("".concat(e.dirName,"/source.txt"))];case 1:w=T.sent(),x=w.split(/\r?\n/),S=0,T.label=2;case 2:return S<x.length?(k=x[S],c||i||(k=k.trim()),0!=k.length?[3,3]:(c||i?s.push("\n"):v(),[3,7])):[3,8];case 3:return k.startsWith("[")?(v(),t||(p=n),n=k.match(/\[(.*?)\]/)[1].trim(),I=k.match(/\](.*?)$/)[1].trim(),t?[3,5]:[4,g(p,y,m,b,!1)]):[3,6];case 4:T.sent(),m=d,b=f,y=h,T.label=5;case 5:return t=!1,u.push("<h1>".concat(n,"</h1>")),u.push('<p class="dim">Author: Youngjin Kang&nbsp;&nbsp;&nbsp;Date: '.concat(I,"</p>")),[3,7];case 6:!k.startsWith("<")||c||i?k.startsWith("@@")?u.push(k.substring(2)):k.startsWith("#$")?(v(),c=!c):k.startsWith('#"')?(v(),i=!i):k.startsWith(":d:")?(t||(m=d),d=k.substring(3)):k.startsWith(":k:")?(t||(b=f),f=k.substring(3).toLowerCase().replaceAll("-"," ")):k.startsWith(":l:")?(t||(y=h),h=k.substring(3)):(k=k.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll("{%","<").replaceAll("%}",">"),s.push(k)):(v(),(R=k.match(/<(.*?)>/)[1]).length>0&&(j="".concat(process.env.URL_STATIC,"/").concat(e.dirName,"/").concat(R,".jpg"),(null==a||k.endsWith("*"))&&(a=j),u.push('<img class="l_image" src="'.concat(j,'" alt="').concat(n.replaceAll('"',"&quot;")," (Figure ").concat(r++,')">')))),T.label=7;case 7:return++S,[3,2];case 8:return v(),[4,g(n,h,d,f,!0)];case 9:return T.sent(),[2,l]}})})},e}();const ce=ae;v().config();var ie=function(){function e(e,t){this.sitemapBuilder=e,this.atomFeedBuilder=t}return e.prototype.build=function(e,t){return n=this,o=void 0,a=function(){var e,n,o,r,a,c,i;return function(e,t){var n,o,r,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(s){switch(s.label){case 0:e=0,s.label=1;case 1:return e<t.length?(n=t[e],[4,new ce(this.sitemapBuilder,this.atomFeedBuilder).build(n)]):[3,6];case 2:return o=s.sent(),r="".concat(n.dirName,"/list.html"),a=new $,i=(c=a).addLine,[4,V.createStaticHTMLFromEJS("page/static/libraryPostList.ejs",{entry:n,listRelativeURL:r,postInfoList:o})];case 3:return i.apply(c,[s.sent()]),[4,a.build("".concat(n.dirName,"/list.html"))];case 4:s.sent(),this.sitemapBuilder.addEntry("".concat(n.dirName,"/list.html"),o.sort(function(e,t){return Date.parse(t.lastmod)-Date.parse(e.lastmod)}).pop().lastmod),s.label=5;case 5:return++e,[3,1];case 6:return[2]}})},new((r=void 0)||(r=Promise))(function(e,t){function c(e){try{s(a.next(e))}catch(e){t(e)}}function i(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r(function(e){e(n)})).then(c,i)}s((a=a.apply(n,o||[])).next())});var n,o,r,a},e}();const se=ie;var le={entriesByCategory:{Nonfiction:[{dirName:"metaphysics",title:"형이상학 (2013 - 2014)"},{dirName:"game-analysis",title:"게임분석 (2019)"},{dirName:"essays",title:"Miscellaneous Writings (2022 - 2024)"},{dirName:"blockchains",title:"On Legitimacy of Blockchains (2022)"},{dirName:"software-development",title:"Software Development (2022 - 2024)"},{dirName:"game-design",title:"Universal Laws of Game Design (2023)"},{dirName:"reality",title:"The Origin of Reality (2023)"},{dirName:"bridge-to-math",title:"A Layman's Bridge to Mathematics (2024)"},{dirName:"read-rec",title:"Recommended Readings (2024)"},{dirName:"morsels",title:"Morsels of Thought (2024)"},{dirName:"concepts-of-plan",title:"Concepts of a Plan (2025)"}],Fiction:[{dirName:"novels",title:"단편소설 (2012 - 2013)"},{dirName:"alien-job-interview",title:"Alien Job Interview (2022)"},{dirName:"infinite-treasures",title:"The Island of Infinite Treasures (2022)"},{dirName:"infsoc",title:"Influential Social Posts (2023)"},{dirName:"gamedev-journey",title:"A Game Developer's Journey (2023)"},{dirName:"sandwich",title:"Sandwich Engineering (2025)"}],Arts:[{dirName:"illustrations",title:"Illustrations (2009 - 2014)"},{dirName:"cartoons",title:"Cartoons (2011 - 2015)"}]}};v().config();var ue=function(){function e(e,t){this.sitemapBuilder=e,this.atomFeedBuilder=t}return e.prototype.build=function(){return e=this,t=void 0,o=function(){var e,t,n,o,r,a,c,i;return function(e,t){var n,o,r,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(s){switch(s.label){case 0:return e=new $,n=(t=e).addLine,[4,V.createStaticHTMLFromEJS("page/static/library.ejs",{entriesByCategory:le.entriesByCategory,gameEntries:ee.gameEntries})];case 1:return n.apply(t,[s.sent()]),[4,e.build("library.html")];case 2:s.sent(),this.sitemapBuilder.addEntry("library.html","2025-02-28"),o=0,r=Object.entries(le.entriesByCategory),s.label=3;case 3:return o<r.length?(a=r[o],c=a[0],i=a[1],[4,new se(this.sitemapBuilder,this.atomFeedBuilder).build(c,i)]):[3,6];case 4:s.sent(),s.label=5;case 5:return o++,[3,3];case 6:return[2]}})},new((n=void 0)||(n=Promise))(function(r,a){function c(e){try{s(o.next(e))}catch(e){a(e)}}function i(e){try{s(o.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,i)}s((o=o.apply(e,t||[])).next())});var e,t,n,o},e}();const de=ue;v().config();const fe=function(){function e(){}return e.prototype.build=function(e,t){return n=this,o=void 0,a=function(){var n,o,r,a,c;return function(e,t){var n,o,r,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(i){switch(i.label){case 0:return null==e&&(e="".concat(process.env.SRC_ROOT_DIR,"/shared/embeddedScripts")),null==t&&(t="".concat(process.env.VIEWS_ROOT_DIR,"/partial/embeddedScript")),[4,C.getAllRelativePathsInDirRecursively(e)];case 1:n=(n=i.sent()).filter(function(e){return e.endsWith(".js")}),o=0,r=n,i.label=2;case 2:return o<r.length?(a=r[o],[4,C.read(a,e)]):[3,6];case 3:return c=i.sent().split("\n").filter(function(e){return!e.startsWith("export ")}).join("\n").trim(),[4,C.write(a.replace(".js",".ejs"),'\n<%_ if (!locals.globalDictionary["script_included_('.concat(a,")\"]) { _%>\n\x3c!-- NOTE: This EJS partial is auto-generated by 'embeddedScriptBuilder.ts' --\x3e\n<%_ locals.globalDictionary[\"script_included_(").concat(a,')"] = true; _%>\n<script>\n').concat(c,"\n<\/script>\n<%_ } _%>\n").trim(),t)];case 4:i.sent(),i.label=5;case 5:return o++,[3,2];case 6:return[2]}})},new((r=void 0)||(r=Promise))(function(e,t){function c(e){try{s(a.next(e))}catch(e){t(e)}}function i(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r(function(e){e(n)})).then(c,i)}s((a=a.apply(n,o||[])).next())});var n,o,r,a},e}();var he,pe,me,be="#101010",ye="#303030",ve="#707070",ge="#a0a0a0",we="#c0c0c0",xe="#d0c090",Se="#70c060",ke="#b0a070",Ie="17px",Re={unit:{landscape:{vertical:.6,horizontal:1},portrait:{vertical:1,horizontal:2.5}}},je=400,Oe=800,Te=function(e,t,n,o,r,a){return"position: absolute;\n\tdisplay: block;\n\tleft: ".concat(e,"%;\n\tright: ").concat(t,"%;\n\ttop: ").concat(n,"%;\n\tbottom: ").concat(o,"%;\n\twidth: ").concat(r,"%;\n\theight: ").concat(a,"%;")},Ee=function(e,t){return"position: relative;\n\tdisplay: ".concat(e?"block":"inline-block",";\n\tmax-width: ").concat(t,";")},Ne=function(e){return"position: relative;\n\tdisplay: ".concat(e?"block":"inline-block",";\n\tmax-width: none;\n\twidth: fit-content;\n\tblock-size: fit-content;")},Le=function(e,t,n,o,r){void 0===o&&(o=!1),void 0===r&&(r=!1);var a=Re.unit[e?"landscape":"portrait"],c=(a.vertical*t).toFixed(2),i=(a.horizontal*n).toFixed(2),s=r?"0":"".concat(c,"%"),l=r?"0":"".concat(i,"%"),u=o?"0":"".concat(c,"%"),d=o?"0":"".concat(i,"%");return"padding: ".concat(s," ").concat(l," ").concat(s," ").concat(l,";\n\tmargin: ").concat(u," ").concat(d," ").concat(u," 0;")},Me=function(e,t,n){return"font-size: ".concat(e,';\n\tfont-family: "Lucida Console", "Lucida Sans Typewriter", "Monaco", Consolas, monospace;\n\tfont-style: ').concat(t?"italic":"normal",";\n\tfont-weight: ").concat(n,";")},De=function(e,t,n){return void 0===n&&(n=1),"background-color: ".concat(e,";\n\tcolor: ").concat(t,";").concat(n<1?"\n\topacity: ".concat(n,";"):"")},Pe=function(e,t,n){return void 0===n&&(n=1),De(e,t,n)+"\n\tborder-radius: 2vmin;"},Ae=function(e,t,n,o,r){return void 0===o&&(o="1.25"),void 0===r&&(r=1),Pe(e,t,r)+"\n"+"\tborder-bottom: ".concat(o,"vmin ").concat(n," solid;")+"\n"+"\tborder-right: ".concat(o,"vmin ").concat(n," solid;")},_e=function(e,t,n,o,r){return void 0===o&&(o="1.25"),void 0===r&&(r=1),Pe(e,t,r)+"\n"+"\tborder: ".concat(o,"vmin ").concat(n," solid;")},Ce=Te(0,0,0,0,100,100),Ue=Te(0,86,0,0,14,100),Be=Te(0,0,0,88,100,12),Fe=Te(14,5,0,0,81,100),ze=Te(0,2.5,12,0,95,88),Ge=Te(0,0,0,86,100,14),qe=Te(0,0,14,0,100,80),Je=Te(0,0,0,35,100,65),Qe=Te(0,0,65,0,100,35),We=function(e){return 2*Re.unit[e?"landscape":"portrait"].horizontal},He=function(e){return Ee(!0,"".concat(100..toFixed(2),"%"))},Ve=function(e){return Ee(!0,"1%")},Ye=function(e){return Ne(!0)},Xe=function(e){return Ee(!1,"".concat(100..toFixed(2),"%"))},$e=function(e){return Ee(!1,"".concat((50-We(e)).toFixed(2),"%"))},Ke=function(e){return Ee(!1,"".concat((33-We(e)).toFixed(2),"%"))},Ze=function(e){return Ne(!1)},et=function(e){return Le(e,1,1)},tt=function(e){return Le(e,2,2)},nt=function(e){return Le(e,4,4)},ot=function(e){return Le(e,2,1,!1,!0)},rt=function(e){return Le(e,4,1,!1,!0)},at="min(".concat(1.8199999999999998.toFixed(2),"vmax, ").concat(16..toFixed(2),"px)"),ct="min(".concat(2.1839999999999997.toFixed(2),"vmax, ").concat(19.2.toFixed(2),"px)"),it="min(".concat(2.6207999999999996.toFixed(2),"vmax, ").concat(23.04.toFixed(2),"px)"),st="min(".concat(3.1449599999999998.toFixed(2),"vmax, ").concat(27.648.toFixed(2),"px)"),lt="min(".concat(3.7739519999999995.toFixed(2),"vmax, ").concat(33.1776.toFixed(2),"px)"),ut=Me(at,!1,je),dt=Me(at,!0,je),ft=Me(at,!1,Oe),ht=(Me(ct,!0,je),Me(ct,!0,Oe)),pt=(Me(it,!0,je),Me(it,!0,Oe)),mt=(Me(st,!0,je),Me(st,!0,Oe)),bt=(Me(lt,!0,je),Me(lt,!0,Oe)),yt="opacity: 0;",vt=De("#000000",we,.7),gt=Ae(xe,ye,ke,"1.25"),wt=De("#000000",we,.7),xt=Ae(ye,ge,we,"1.25"),St=De(ye,we),kt=(he=we,void 0===pe&&(pe="1.25"),void 0===me&&(me=1),De(ye,we,me)+"\n"+"\tborder-bottom: ".concat(pe,"vmin ").concat(he," solid;")),It=De(ye,ge),Rt=De(ge,ye),jt=De(ye,ve),Ot=De(ye,xe),Tt=De(ye,ke),Et=Ae(ye,ge,ge),Nt=Pe(ye,we),Lt=Pe(be,Se),Mt=Pe(be,Se),Dt=Ae(be,ge,ve,"0.5"),Pt=Ae(be,ge,ve,"0.75"),At=Ae(ve,we,ge,"0.25"),_t=_e(ye,we,ve,"0.1"),Ct=_e(ge,we,we,"0.1"),Ut=function(e){return"\n@supports(-moz-appearance:none) {\n\t* {\n\t\tscrollbar-width: ".concat(e?"auto":"none",";\n\t\tscrollbar-color: ").concat(ve," ").concat(be,";\n\t}\n}\n::-webkit-scrollbar {\n\twidth: ").concat(e?Ie:"0",";\n\theight: ").concat(e?Ie:"0",";\n}\n::-webkit-scrollbar-track {\n\tbackground: ").concat(be,";\n}\n::-webkit-scrollbar-thumb {\n\tbackground: ").concat(ve,";\n\tborder-radius: ").concat("8px",";\n\tborder: ").concat("4px"," solid ").concat(be,";\n}\n::-webkit-scrollbar-thumb:hover {\n\tbackground: ").concat(ge,";\n}\niframe {\n\t").concat(He(),"\n\t").concat(ot(e),"\n\t").concat(pt,"\n\t").concat(It,"\n}\np {\n\t").concat(He(),"\n\t").concat(rt(e),"\n\t").concat(ut,"\n\t").concat(St,"\n}\nh3 {\n\t").concat(He(),"\n\t").concat(rt(e),"\n\t").concat(ht,"\n\t").concat(Tt,"\n}\nh2 {\n\t").concat(He(),"\n\t").concat(rt(e),"\n\t").concat(mt,"\n\t").concat(jt,"\n}\nh1 {\n\t").concat(He(),"\n\t").concat(rt(e),"\n\t").concat(bt,"\n\t").concat(Ot,"\n}\nhr {\n\t").concat(He(),"\n\t").concat(ot(e),"\n\t").concat(St,"\n}\n.fullscreenBar {\n\t").concat(e?Ue:Be,"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t").concat(ht,"\n\t").concat(Rt,"\n\ttext-align: ").concat("center",";\n\tz-index: 1;\n\toverflow: hidden;\n}\n.fullscreenPanel {\n\t").concat(e?Fe:ze,"\n\tmargin: 0 0 0 0;\n\tpadding: 0 ").concat(2.5,"% 0 ").concat(2.5,"%;\n\t").concat(pt,"\n\t").concat(It,"\n\toverflow-y: scroll;\n\toverflow-x: auto;\n}\n.fullscreenBarLogo {\n\t").concat(e?Ge:Je,"\n}\n.fullscreenBarLogoImage {\n\tposition: relative;\n\tdisplay: block;\n\tmax-width: 80%;\n\tmax-height: 70%;\n\tmargin: auto;\n  \ttop: 50%;\n  \t-ms-transform: translateY(-50%);\n  \ttransform: translateY(-50%);\n}\n.fullscreenBarMenu {\n\t").concat(e?qe:Qe,"\n}\n.fullscreenBarMenuButton {\n\tposition: relative;\n\tdisplay: ").concat(e?"block":"inline-block",";\n\t").concat(e?"width: 100%;":"top: 100%; -ms-transform: translateY(-100%); transform: translateY(-100%);","\n\tmax-height: 100%;\n\t").concat(e?function(e){return Le(e,4,1,!0,!1)}(e):function(e){return Le(e,1,1,!0,!1)}(e),"\n\tbox-sizing: border-box;\n\ttext-decoration: none;\n}\n.fullscreenBarMenuButton.idle {\n\t").concat(Rt,"\n}\n.fullscreenBarMenuButton.selected {\n\t").concat(It,"\n}\n.fullscreenBarMenuButton.idle:hover {\n\tcolor: ").concat(xe,";\n}\n.fullscreenBarMenuButton.selected:hover {\n\tcolor: ").concat(xe,";\n}\n.loadingScreen {\n\t").concat(Ce,"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\tz-index: 900;\n\n\t.background {\n\t\t").concat(Ce,"\n\t\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t\t").concat(vt,"\n\t}\n\t.content {\n\t\tposition: absolute;\n\t\tmin-width: 50%;\n\t\ttop: 50%;\n\t\tleft: 50%;\n\t\ttransform: translate(-50%, -50%);\n\t\t").concat(bt,"\n\t\t").concat(nt(e),"\n\t\t").concat(gt,"\n\t\ttext-align: center;\n\t\tz-index: 901;\n\t}\n}\n.popupScreen {\n\t").concat(Ce,"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\tz-index: 500;\n\n\t.background {\n\t\t").concat(Ce,"\n\t\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t\t").concat(wt,"\n\t}\n\t.content {\n\t\tposition: absolute;\n\t\twidth: 80%;\n\t\twidth: 80%;\n\t\ttop: 50%;\n\t\tleft: 50%;\n\t\ttransform: translate(-50%, -50%);\n\t\t").concat(ut,"\n\t\t").concat(tt(e),"\n\t\t").concat(xt,"\n\t\toverflow-y: scroll;\n\t\tz-index: 501;\n\t}\n}\n.s_image {\n\t").concat(e?function(e){return Ee(!1,"".concat((25-We(e)).toFixed(2),"%"))}(e):$e(e),"\n\t").concat(ot(e),"\n\t").concat(pt,"\n\t").concat(Nt,"\n}\n.m_image {\n\t").concat(e?Ke(e):Xe(),"\n\t").concat(ot(e),"\n\t").concat(pt,"\n\t").concat(Nt,"\n}\n.m_linkImage {\n\t").concat(e?Ke(e):Ee(!1,"".concat(98..toFixed(2),"%")),"\n\t").concat(ot(e),"\n\t").concat(pt,"\n\t").concat(Et,"\n}\n.m_linkImage:hover {\n\tborder-color: ").concat(xe,";\n}\n.l_image {\n\t").concat(e?$e(e):Xe(),"\n\t").concat(ot(e),"\n\t").concat(pt,"\n\t").concat(Nt,"\n}\n.portal {\n\tposition: relative;\n\tdisplay: block;\n\tmargin: ").concat(e?"5%":"12.5%"," 0;\n\tpadding: 0 0;\n\tmax-width: ").concat(e?"30%":"70%",";\n}\n.postEntryButton {\n\t").concat(Ye(),"\n\t").concat(et(e),"\n\t").concat(ft,"\n\t").concat(Dt,"\n\ttext-decoration: none;\n}\n.postEntryButton:hover {\n\tborder-color: ").concat(xe,";\n}\n.bigButton {\n\t").concat(Ye(),"\n\t").concat(function(e){return Le(e,6,6)}(e),"\n\t").concat(ht,"\n\t").concat(Pt,"\n\ttext-decoration: none;\n\ttext-align: center;\n}\n.bigButton:hover {\n\tborder-color: ").concat(xe,";\n}\n.pagePath {\n\t").concat(function(e){return Le(e,1,1,!1,!0)}(e),"\n\t").concat(ut,"\n}\n.listScrollPanel {\n\t").concat((t="".concat(100..toFixed(2),"%"),n="".concat(70..toFixed(2),"%"),"position: relative;\n\tdisplay: ".concat("block",";\n\twidth: ").concat(t,";\n\theight: ").concat(n,";")),"\n\t").concat(et(e),"\n\t").concat(_t,"\n\toverflow: auto;\n}\n.listItem {\n\t").concat(Ye(),"\n\t").concat(et(e),"\n\t").concat(ut,"\n\t").concat(Ct,"\n\ttext-decoration: none;\n}\n.inlineTextInput {\n\t").concat(e?Ze():Ye(),"\n\t").concat(et(e),"\n\t").concat(ut,"\n\t").concat(At,"\n}\n.inlineLabel {\n\t").concat(Ze(),"\n\t").concat(et(e),"\n\t").concat(ut,"\n\t").concat(It,"\n}\n.inlineButton {\n\t").concat(Ze(),"\n\t").concat(et(e),"\n\t").concat(ut,"\n\t").concat(Dt,"\n\ttext-decoration: none;\n}\n.inlineButton:hover {\n\tborder-color: ").concat(xe,";\n\tcursor: pointer;\n}\n.inlineButton:disabled {\n\topacity: 0.25;\n\tcursor: not-allowed;\n}\n.inlineTabButton {\n\t").concat(Ze(),"\n\t").concat(et(e),"\n\t").concat(ut,"\n\ttext-decoration: none;\n}\n.inlineTabButton.idle {\n\t").concat(St,"\n}\n.inlineTabButton.selected {\n\t").concat(kt,"\n}\n.inlineTabButton.idle:hover {\n\tcolor: ").concat(xe,";\n}\n.inlineTabButton.selected:hover {\n\tcolor: ").concat(xe,";\n}\n.snippet {\n\t").concat(Ye(),"\n\t").concat(tt(e),"\n\t").concat(ft,"\n\t").concat(Lt,"\n\twhite-space: nowrap;\n}\n.excerpt {\n\t").concat(He(),"\n\t").concat(tt(e),"\n\t").concat(dt,"\n\t").concat(Mt,"\n\twhite-space: pre-wrap;\n\twhite-space: -moz-pre-wrap;\n\twhite-space: -pre-wrap;\n\twhite-space: -o-pre-wrap;\n\tword-wrap: break-word;\n}\n.zero_row {\n\t").concat(Ve(),"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t").concat(yt,"\n}\n.xs_row {\n\t").concat(Ve(),"\n\t").concat(function(e){return Le(e,.5,1)}(e),"\n\t").concat(yt,"\n}\n.s_row {\n\t").concat(Ve(),"\n\t").concat(et(e),"\n\t").concat(yt,"\n}\n.m_row {\n\t").concat(Ve(),"\n\t").concat(tt(e),"\n\t").concat(yt,"\n}\n.l_row {\n\t").concat(Ve(),"\n\t").concat(function(e){return Le(e,3,3)}(e),"\n\t").concat(yt,"\n}\n.xl_row {\n\t").concat(Ve(),"\n\t").concat(nt(e),"\n\t").concat(yt,"\n}\n");var t,n};const Bt="* {\n\toverflow: hidden;\n\tvertical-align: middle;\n}\nbody {\n\t".concat(Ce,"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t").concat(ut,"\n\t").concat(St,"\n\ttext-align: ").concat("left",";\n\tz-index: 0;\n}\na:link {\n  color: ").concat(ge,";\n}\na:visited {\n  color: ").concat(ge,";\n}\na:hover {\n  color: ").concat(xe,";\n}\na:active {\n  color: ").concat(ge,";\n}\n.dim {\n\t").concat(jt,"\n}\n.noTextDeco {\n\ttext-decoration: none;\n}\n.horizontallyCentered {\n\tleft: 50%;\n\ttransform: translate(-50%, 0);\n}\n\n@media (orientation: landscape) {\n\t").concat(Ut(!0),"\n}\n\n@media (orientation: portrait) {\n\t").concat(Ut(!1),"\n}");v().config();const Ft=function(){function e(){}return e.prototype.build=function(e,t){return n=this,o=void 0,a=function(){var n,o,r,a,c,i,s;return function(e,t){var n,o,r,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(l){switch(l.label){case 0:return null==e&&(e="".concat(process.env.VIEWS_ROOT_DIR,"/page/static/error")),null==t&&(t="".concat(process.env.STATIC_PAGE_ROOT_DIR,"/error")),[4,C.getAllRelativePathsInDirRecursively(e)];case 1:n=(n=l.sent()).filter(function(e){return e.endsWith(".ejs")}),o=0,r=n,l.label=2;case 2:return o<r.length?(a=r[o],c=new $,s=(i=c).addLine,[4,V.createStaticHTMLFromEJS("/page/static/error/"+a,{})]):[3,6];case 3:return s.apply(i,[l.sent()]),[4,c.build(a.replace(".ejs",".html"),t)];case 4:l.sent(),l.label=5;case 5:return o++,[3,2];case 6:return[2]}})},new((r=void 0)||(r=Promise))(function(e,t){function c(e){try{s(a.next(e))}catch(e){t(e)}}function i(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r(function(e){e(n)})).then(c,i)}s((a=a.apply(n,o||[])).next())});var n,o,r,a},e}();function zt(){return e=this,t=void 0,o=function(){var e,t,n,o,r,a,c,i,s,l,u,d,f;return function(e,t){var n,o,r,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(h){switch(h.label){case 0:return console.log("SSG START"),e=new Y,t=new X,n=new $,r=(o=n).addLine,[4,V.createStaticHTMLFromEJS("page/static/index.ejs",{})];case 1:return r.apply(o,[h.sent()]),[4,n.build("index.html")];case 2:return h.sent(),n=new $,c=(a=n).addLine,[4,V.createStaticHTMLFromEJS("page/static/portfolio.ejs",{})];case 3:return c.apply(a,[h.sent()]),[4,n.build("portfolio.html")];case 4:return h.sent(),n=new $,s=(i=n).addLine,[4,V.createStaticHTMLFromEJS("page/static/portfolio_minimal.ejs",{})];case 5:return s.apply(i,[h.sent()]),[4,n.build("portfolio_minimal.html")];case 6:return h.sent(),n=new $,u=(l=n).addLine,[4,V.createStaticHTMLFromEJS("page/static/privacyPolicy.ejs",{})];case 7:return u.apply(l,[h.sent()]),[4,n.build("privacy-policy.html")];case 8:return h.sent(),n=new $,f=(d=n).addLine,[4,V.createStaticHTMLFromEJS("page/static/termsOfService.ejs",{})];case 9:return f.apply(d,[h.sent()]),[4,n.build("terms-of-service.html")];case 10:return h.sent(),[4,new ne(e,t).build()];case 11:return h.sent(),[4,new de(e,t).build()];case 12:return h.sent(),[4,(new Ft).build()];case 13:return h.sent(),[4,e.build()];case 14:return h.sent(),[4,t.build()];case 15:return h.sent(),[4,C.write("style.css",Bt)];case 16:return h.sent(),[4,(new fe).build()];case 17:return h.sent(),console.log("SSG END"),[2]}})},new((n=void 0)||(n=Promise))(function(r,a){function c(e){try{s(o.next(e))}catch(e){a(e)}}function i(e){try{s(o.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,i)}s((o=o.apply(e,t||[])).next())});var e,t,n,o}v().config();const Gt=require("jsonwebtoken");var qt=e.n(Gt);require("bcrypt");require("crypto");require("nodemailer");v().config();v().config();var Jt=function(e,t,n,o){return new(n||(n=Promise))(function(r,a){function c(e){try{s(o.next(e))}catch(e){a(e)}}function i(e){try{s(o.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,i)}s((o=o.apply(e,t||[])).next())})},Qt=function(e,t){var n,o,r,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};v().config();var Wt=function(e,t){var n=" AND (".concat(e.map(function(e){return"roomMemberships.userStatus = '".concat(e,"'")}).join(" OR "),")");return"SELECT users.userID as userID, users.userName AS userName, roomMemberships.userStatus as userStatus\n    FROM users INNER JOIN roomMemberships ON roomMemberships.userID = users.userID\n    WHERE roomMemberships.roomID = ?".concat(e.length>0?n:"","\n    ORDER BY users.userID DESC LIMIT ").concat(10,", ").concat(10*t,";")};const Ht={withUserName:function(e,t){return Jt(void 0,void 0,void 0,function(){return Qt(this,function(n){switch(n.label){case 0:return[4,j.makeQuery("SELECT * FROM users WHERE userName = ?;",[e]).run(t,"SearchDB.users.withUserName")];case 1:return[2,n.sent()]}})})},withEmail:function(e,t){return Jt(void 0,void 0,void 0,function(){return Qt(this,function(n){switch(n.label){case 0:return[4,j.makeQuery("SELECT * FROM users WHERE email = ?;",[e]).run(t,"SearchDB.users.withEmail")];case 1:return[2,n.sent()]}})})},whoJoinedRoom:function(e,t,n){return Jt(void 0,void 0,void 0,function(){return Qt(this,function(o){switch(o.label){case 0:return[4,j.makeQuery(Wt(["member"],t),[e]).run(n,"SearchDB.users.whoJoinedRoom")];case 1:return[2,o.sent()]}})})},whoAreInvitedToJoinRoom:function(e,t,n){return Jt(void 0,void 0,void 0,function(){return Qt(this,function(o){switch(o.label){case 0:return[4,j.makeQuery(Wt(["invited"],t),[e]).run(n,"SearchDB.users.whoAreInvitedToJoinRoom")];case 1:return[2,o.sent()]}})})},whoRequestedToJoinRoom:function(e,t,n){return Jt(void 0,void 0,void 0,function(){return Qt(this,function(o){switch(o.label){case 0:return[4,j.makeQuery(Wt(["requested"],t),[e]).run(n,"SearchDB.users.whoRequestedToJoinRoom")];case 1:return[2,o.sent()]}})})},whoArePendingToJoinRoom:function(e,t,n){return Jt(void 0,void 0,void 0,function(){return Qt(this,function(o){switch(o.label){case 0:return[4,j.makeQuery(Wt(["invited","requested"],t),[e]).run(n,"SearchDB.users.whoArePendingToJoinRoom")];case 1:return[2,o.sent()]}})})},whoAreAssociatedWithRoom:function(e,t,n){return Jt(void 0,void 0,void 0,function(){return Qt(this,function(o){switch(o.label){case 0:return[4,j.makeQuery(Wt([],t),[e]).run(n,"SearchDB.users.whoAreAssociatedWithRoom")];case 1:return[2,o.sent()]}})})},others:function(e,t,n){return Jt(void 0,void 0,void 0,function(){return Qt(this,function(o){switch(o.label){case 0:return[4,j.makeQuery("SELECT userID, userName FROM users\n                WHERE NOT EXISTS (SELECT userID FROM roomMemberships WHERE roomID = ".concat(e," LIMIT 1)\n                ORDER BY userID DESC LIMIT ").concat(10,", ").concat(10*t,";"),void 0).run(n,"SearchDB.users.others")];case 1:return[2,o.sent()]}})})}};v().config();var Vt=function(e,t,n,o){return new(n||(n=Promise))(function(r,a){function c(e){try{s(o.next(e))}catch(e){a(e)}}function i(e){try{s(o.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,i)}s((o=o.apply(e,t||[])).next())})},Yt=function(e,t){var n,o,r,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};v().config();var Xt="dev"==process.env.MODE,$t=0;function Kt(e,t,n,o){return Vt(this,void 0,void 0,function(){var r,a,c;return Yt(this,function(i){switch(i.label){case 0:if(r=function(e){var t=e.cookies.thingspool_token;if(t)return Zt(t);var n=10*(Math.floor(Date.now()/1e3)-17578e5)+$t;$t=($t+1)%10;var o=n.toString(16);return{userID:"0",userName:"Guest-".concat(o),userType:"guest",passwordHash:"NO_PASSWORD",email:"NO_EMAIL"}}(e),!r)return[3,9];if(!n(r))return D.log("User doesn't satisfy the pass-condition.",{user:r},"high","pink"),t.status(403).send("User doesn't satisfy the pass-condition."),[2,!1];switch(r.userType){case"admin":case"member":return[3,1];case"guest":return[3,4]}return[3,7];case 1:return i.trys.push([1,3,,4]),[4,tn(r.userName,t)];case 2:case 5:return i.sent(),e.user=r,o(),[2,!0];case 3:return a=i.sent(),D.log("Failed to add token (registered user)",{err:a},"high","pink"),t.status(401).send("Failed to add token (error: ".concat(a,")")),[2,!1];case 4:return i.trys.push([4,6,,7]),[4,en(r,t)];case 6:return c=i.sent(),D.log("Failed to add token (guest)",{err:c},"high","pink"),t.status(401).send("Failed to add token (error: ".concat(c,")")),[2,!1];case 7:return D.log("Unknown user type",{userType:r.userType},"high","pink"),t.status(500).send("Unknown user type :: ".concat(r.userType)),[2,!1];case 8:return[3,10];case 9:return D.logRaw("Authentication Failed","high","pink"),t.status(401).send("Authentication Failed"),[2,!1];case 10:return[2]}})})}function Zt(e){try{return qt().verify(e,process.env.JWT_SECRET_KEY)||(D.log("User is not found in the given token.",{tokenLength:e.length},"high","yellow"),null)}catch(e){return D.log("Token Verification Failed",{err:e},"high","pink"),null}}function en(e,t){return Vt(this,void 0,void 0,function(){var n;return Yt(this,function(o){return n=qt().sign(e,process.env.JWT_SECRET_KEY),null==t||t.cookie("thingspool_token",n,{secure:!Xt,httpOnly:!0,sameSite:"strict",maxAge:31556926e5}).status(201),[2]})})}function tn(e,t){return Vt(this,void 0,void 0,function(){var n,o;return Yt(this,function(r){switch(r.label){case 0:return[4,nn(e,t)];case 1:return(n=r.sent())?(o=qt().sign(n,process.env.JWT_SECRET_KEY),null==t||t.cookie("thingspool_token",o,{secure:!Xt,httpOnly:!0,sameSite:"strict",maxAge:31556926e5}).status(201),[2]):(D.log("Failed to add token (user not found)",{userName:e},"high"),null==t||t.status(404).send('Tried to add token, but there is no account with userName "'.concat(e,'".')),[2])}})})}function nn(e,t){return Vt(this,void 0,void 0,function(){var n;return Yt(this,function(o){switch(o.label){case 0:return[4,Ht.withUserName(e,t)];case 1:return n=o.sent(),t&&(t.statusCode<200||t.statusCode>=300)?[2,null]:n&&0!=n.length?[2,n[0]]:(D.log("User Not Found",{userName:e},"high","pink"),null==t||t.clearCookie("thingspool_token").status(404).send('There is no account with userName "'.concat(e,'".')),[2,null])}})})}const on=function(e){return Zt(e)},rn=function(e,t){t.clearCookie("thingspool_token").status(200)},an=function(e,t,n){return Vt(void 0,void 0,void 0,function(){return Yt(this,function(o){switch(o.label){case 0:return[4,Kt(e,t,function(e){return"admin"==e.userType},n)];case 1:return o.sent(),[2]}})})},cn=function(e,t,n){return Vt(void 0,void 0,void 0,function(){return Yt(this,function(o){switch(o.label){case 0:return[4,Kt(e,t,function(e){return!0},n)];case 1:return o.sent(),[2]}})})};v().config();var sn=n().Router();sn.get("/mypage",cn,function(e,t){V.render(e,t,"page/dynamic/mypage",{loginDestination:"".concat(process.env.URL_DYNAMIC,"/mypage")})}),sn.get("/register",function(e,t){V.render(e,t,"page/dynamic/register",{registerDestination:"".concat(process.env.URL_DYNAMIC,"/mypage")})}),sn.get("/login",function(e,t){V.render(e,t,"page/dynamic/login",{loginDestination:"".concat(process.env.URL_DYNAMIC,"/mypage")})}),"dev"==process.env.MODE?(sn.get("/admin",function(e,t){V.render(e,t,"page/development/admin",{})}),sn.get("/console",function(e,t){V.render(e,t,"page/development/console",{})}),sn.get("/test-ui",function(e,t){V.render(e,t,"page/development/test_ui",{gameEntries:ee.gameEntries})})):(sn.get("/admin",an,function(e,t){V.render(e,t,"page/development/admin",{})}),sn.get("/console",an,function(e,t){V.render(e,t,"page/development/console",{})}));const ln=sn;v().config();const un=function(e,t){void 0===t&&(t=void 0),e.statusCode>=200&&e.statusCode<=299&&(t?e.json(t):e.end())},dn=function(e){return"".concat("dev"==process.env.MODE?"http://localhost:".concat(process.env.PORT):process.env.URL_STATIC,"/error/").concat(e,".html")};var fn=n().Router();fn.get("/clear-token",function(e,t){rn(e,t),un(t)});const hn=fn;var pn=function(e,t,n,o){return new(n||(n=Promise))(function(r,a){function c(e){try{s(o.next(e))}catch(e){a(e)}}function i(e){try{s(o.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,i)}s((o=o.apply(e,t||[])).next())})},mn=function(e,t){var n,o,r,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};const bn=require("socket.io");var yn=e.n(bn);const vn=function(e){var t=Math.sqrt(e.x*e.x+e.y*e.y);if(0==t)return{x:0,y:0};var n=1/t;return{x:e.x*n,y:e.y*n}},gn=function(e,t){return{x:e.x*t,y:e.y*t}},wn=function(e,t){return{x:e.x+t.x,y:e.y+t.y}},xn=function(e,t){return{x:e.x-t.x,y:e.y-t.y}},Sn=function(e,t){return e.x*t.y-e.y*t.x},kn=function(e,t){return e.x*t.x+e.y*t.y},In=function(e,t){var n=t.x-e.x,o=t.y-e.y;return n*n+o*o};var Rn={castAABBAgainstAABB:function(e,t,n){var o,r,a=n.x-n.halfSizeX-e.halfSizeX,c=n.y-n.halfSizeY-e.halfSizeY,i=n.x+n.halfSizeX+e.halfSizeX,s=n.y+n.halfSizeY+e.halfSizeY,l={x:a,y:c},u={x:i,y:c},d={x:a,y:s},f={x:i,y:s},h={start:l,end:u},p={start:u,end:f},m={start:f,end:d},b={start:d,end:l},y={start:{x:e.x,y:e.y},end:t},v=1;return(o=Math.min(v,Rn.raycastToLine(y,h,!0)))<v&&(v=o,r=h),(o=Math.min(v,Rn.raycastToLine(y,p,!0)))<v&&(v=o,r=p),(o=Math.min(v,Rn.raycastToLine(y,m,!0)))<v&&(v=o,r=m),(o=Math.min(v,Rn.raycastToLine(y,b,!0)))<v&&(v=o,r=b),{hitRayScale:v,hitLine:r}},raycastToLine:function(e,t,n){void 0===n&&(n=!1);var o=xn(e.end,e.start),r=xn(t.end,t.start),a=Sn(o,r);if(0==a)return 1;if(n&&a>0)return 1;var c=1/a,i=xn(t.start,e.start),s=Sn(i,r)*c,l=Sn(i,o)*c;return s<0||s>1||l<0||l>1?1:s}};const jn=Rn;var On={},Tn=new Array,En={minHitRayScale:1,hitLine:void 0};function Nn(e,t,n,o){var r=jn.castAABBAgainstAABB(e,t,n);return r.hitRayScale<=o.minHitRayScale&&(o.minHitRayScale=r.hitRayScale,o.hitLine=r.hitLine),o}function Ln(e,t){for(var n=!1,o=0;o<t.intersectingObjects.length;++o)t.intersectingObjects[o].objectId==e.objectId&&(console.error("Object already added to voxel (object = ".concat(JSON.stringify(e),", voxel = ").concat(JSON.stringify(t),")")),n=!0);for(n||t.intersectingObjects.push(e),n=!1,o=0;o<e.intersectingVoxels.length;++o)e.intersectingVoxels[o]==t&&(console.error("Voxel already added to object (object = ".concat(JSON.stringify(e),", voxel = ").concat(JSON.stringify(t),")")),n=!0);n||e.intersectingVoxels.push(t)}function Mn(e){Tn.length=0;for(var t=0,n=e.intersectingVoxels;t<n.length;t++){var o=n[t];Tn.push(o)}for(var r=0,a=Tn;r<a.length;r++)Dn(e,o=a[r])}function Dn(e,t){for(var n=!1,o=t.intersectingObjects,r=0;r<o.length;++r)if(o[r].objectId==e.objectId){for(var a=r+1;a<o.length;++a)o[r]=o[a];--o.length,n=!0}n||console.error("Object not found in voxel (object = ".concat(JSON.stringify(e),", voxel = ").concat(JSON.stringify(t),")"))}function Pn(e,t){var n=On[e];if(null==On[e])throw new Error("Physics-room doesn't exist (roomID = ".concat(e,")"));Tn.length=0;for(var o=Math.floor(t.y-t.halfSizeY),r=Math.floor(t.x-t.halfSizeX),a=Math.floor(t.y+t.halfSizeY),c=Math.floor(t.x+t.halfSizeX),i=o;i<=a;++i)for(var s=r;s<=c;++s)Tn.push(n.voxels[i*n.numGridCols+s]);return Tn}function An(e,t,n,o){var r=On[e];if(null==On[e])throw new Error("Physics-room doesn't exist (roomID = ".concat(e,")"));return r.voxels[t*r.numGridCols+n].collisionLayerMask>>o&1}const _n={loadRoom:function(e,t){if(null!=On[e.room.roomID])throw new Error("Physics-room already exists (roomID = ".concat(e.room.roomID,")"));On[e.room.roomID]={numGridRows:t.numGridRows,numGridCols:t.numGridCols,voxels:t.voxels.map(function(e){var t=e.row,n=e.col,o=new Array(4);return o.length=0,{row:t,col:n,collisionLayerMask:e.collisionLayerMask,hitbox:{x:n+.5,y:t+.5,halfSizeX:.5,halfSizeY:.5},intersectingObjects:o}}),objectById:{}}},unloadRoom:function(e){if(null==On[e])throw new Error("Physics-room doesn't exist (roomID = ".concat(e,")"));delete On[e]},hasRoom:function(e){return null!=On[e]},addObject:function(e,t,n,o){var r=On[e];if(null==r)throw new Error("Physics-room doesn't exist (roomID = ".concat(e,", objectId = ").concat(t,")"));if(null==r.objectById[t]){var a=new Array(4);a.length=0;var c={objectId:t,collisionLayer:o,hitbox:n,intersectingVoxels:a};r.objectById[t]=c,function(e,t,n){var o=On[e];if(null==On[e])throw new Error("Physics-room doesn't exist (roomID = ".concat(e,")"));var r=o.objectById[t];if(null==r)throw new Error("PhysicsObject is not registered (objectId = ".concat(t,")"));var a=Pn(e,r.hitbox);r.hitbox.x=n.x,r.hitbox.y=n.y,Mn(r);for(var c=0,i=a;c<i.length;c++)Ln(r,i[c])}(e,t,{x:n.x,y:n.y})}else console.warn("PhysicsObjct is already added (roomID = ".concat(e,", objectId = ").concat(t,")"))},removeObject:function(e,t){var n=On[e];if(null==n)throw new Error("Physics-room doesn't exist (roomID = ".concat(e,", objectId = ").concat(t,")"));var o=n.objectById[t];if(null==o)throw new Error("PhysicsObject is not registered (roomID = ".concat(e,", objectId = ").concat(t,")"));delete n.objectById[t],Mn(o)},tryMoveObject:function(e,t,n){var o=On[e];if(null==On[e])throw new Error("Physics-room doesn't exist (roomID = ".concat(e,")"));var r=o.objectById[t];if(null==r)throw new Error("PhysicsObject is not registered (objectId = ".concat(t,")"));var a={x:r.hitbox.x,y:r.hitbox.y},c=In(n,a);if(c>=9)return console.warn("Physics-position desync due to distance gap (startPos = (".concat(a.x.toFixed(3),", ").concat(a.y.toFixed(3),"), targetPos = (").concat(n.x.toFixed(3),", ").concat(n.y.toFixed(3),"), dist = ").concat(Math.sqrt(c),")")),{resolvedPos:a,desyncDetected:!0};if(c<1e-6)return{resolvedPos:a,desyncDetected:!1};var i=vn(xn(n,a));a=xn(a,gn(i,.01));var s=Math.min(a.x,n.x)-r.hitbox.halfSizeX,l=Math.max(a.x,n.x)+r.hitbox.halfSizeX,u=Math.min(a.y,n.y)-r.hitbox.halfSizeY,d=Math.max(a.y,n.y)+r.hitbox.halfSizeY,f=Math.floor(s),h=Math.floor(l),p=Math.floor(u),m=Math.floor(d);if(f<0||p<0||h>=o.numGridCols||m>=o.numGridRows)return console.warn("Physics-position desync due to room boundary limit (startPos = (".concat(a.x.toFixed(3),", ").concat(a.y.toFixed(3),"), targetPos = (").concat(n.x.toFixed(3),", ").concat(n.y.toFixed(3),", minCol = ").concat(f,", minRow = ").concat(p,", maxCol = ").concat(h,", maxRow = ").concat(m,"))")),{resolvedPos:a,desyncDetected:!0};En.minHitRayScale=1,En.hitLine=void 0;for(var b=p;b<=m;++b)for(var y=f;y<=h;++y){var v=o.voxels[b*o.numGridCols+y];0!=An(e,b,y,r.collisionLayer)&&Nn(r.hitbox,n,v.hitbox,En)}for(var g=0,w=Object.values(o.objectById);g<w.length;g++){var x=w[g];r.objectId!=x.objectId&&r.collisionLayer==x.collisionLayer&&(En=Nn(r.hitbox,n,x.hitbox,En))}var S=n;if(null!=En.hitLine){var k=gn(xn(n,a),En.minHitRayScale),I=wn(a,k),R=xn(n,I),j=xn(En.hitLine.end,En.hitLine.start),O=kn(R,j);O<0&&(j=xn(En.hitLine.start,En.hitLine.end),O=kn(R,j));for(var T=gn(j,O/kn(j,j)),E=wn(I,T),N=!1,L=0,M=Pn(e,{x:E.x,y:E.y,halfSizeX:r.hitbox.halfSizeX,halfSizeY:r.hitbox.halfSizeY});L<M.length;L++)0!=An(e,(v=M[L]).row,v.col,r.collisionLayer)&&(N=!0);S=N?I:E}return r.hitbox.x=S.x,r.hitbox.y=S.y,{resolvedPos:S,desyncDetected:!1}},forceMoveObject:function(e,t,n){var o=On[e];if(null==On[e])throw new Error("Physics-room doesn't exist (roomID = ".concat(e,")"));var r=o.objectById[t];if(null==r)throw new Error("PhysicsObject is not registered (objectId = ".concat(t,")"));r.hitbox.x=n.x,r.hitbox.y=n.y}};function Cn(e,t,n){if(0==e.quads.length)throw new Error("Voxel has no quad in it (row = ".concat(e.row,", col = ").concat(e.col,")"));if(e.quads.length>16)throw new Error("No more than 16 quads are allowed in a voxel (row = ".concat(e.row,", col = ").concat(e.col,", number of quads detected = ").concat(e.quads.length,")"));if(e.row<0||e.col<0||e.row>=t.numGridRows||e.col>=t.numGridCols)throw new Error("Voxel's coordinates are out of range (row = ".concat(e.row,", col = ").concat(e.col,", numGridRows = ").concat(t.numGridRows,", numGridCols = ").concat(t.numGridCols,")"));if(e.collisionLayerMask<0||e.collisionLayerMask>15)throw new Error("Voxel's collisionLayerMask is out of its range (value found = ".concat(e.collisionLayerMask,", range = [").concat(0,":").concat(15,"])"));n.view[n.index++]=(15&e.collisionLayerMask)<<4|e.quads.length-1&15;for(var o=0,r=e.quads;o<r.length;o++){var a=r[o];if(a.textureIndex<0||a.textureIndex>63)throw new Error("VoxelQuad's texture index is out of range (range = [0,63])");n.view[n.index++]=("x"==a.facingAxis?0:"y"==a.facingAxis?1:2)<<6|("-"==a.orientation?0:1)<<5|(7&Math.round(2*a.yOffset))<<2,n.view[n.index++]=(63&a.textureIndex)<<2}}function Un(e,t,n){for(var o=n.view[n.index++],r=o>>4&15,a=1+(15&o),c=new Array(a),i=0;i<a;++i){var s=n.view[n.index++],l=s>>6&3,u=0==l?"x":1==l?"y":"z",d=s>>5&1?"+":"-",f=.5*(s>>2&7),h=n.view[n.index++]>>2&63;c[i]={facingAxis:u,orientation:d,yOffset:f,textureIndex:h}}return{row:e,col:t,collisionLayerMask:r,quads:c}}const Bn={encode:function(e){for(var t=2,n=0,o=e.voxels;n<o.length;n++)t+=1+2*o[n].quads.length;var r={view:new Uint8Array(t),index:0};r.view[r.index++]=e.numGridRows,r.view[r.index++]=e.numGridCols;for(var a=0,c=e.voxels;a<c.length;a++)Cn(c[a],e,r);return r.view.buffer},decode:function(e){var t={view:new Uint8Array(e),index:0},n=t.view[t.index++],o=t.view[t.index++],r=n*o,a=new Array(r);a.length=0;for(var c=1/o,i=0;t.index<t.view.length;){if(i>=r)throw new Error("Voxel index exceeded the supposed number of voxels (voxelIndex = ".concat(i,", numVoxels = ").concat(r,")"));var s=Math.floor(i*c),l=i%o;if(s<0||l<0||s>=n||l>=o)throw new Error("Decoded voxel coordinates are out of range (row = ".concat(s,", col = ").concat(l,", numGridRows = ").concat(n,", numGridCols = ").concat(o,")"));a[i++]=Un(s,l,t)}return{numGridRows:n,numGridCols:o,voxels:a}}};function Fn(e,t,n,o,r){qn(e,t,n,o,[function(e){return Jn("x","+",r,e)},function(e){return Jn("x","-",r,e)},function(e){return Jn("z","+",r,e)},function(e){return Jn("z","-",r,e)}])}function zn(e,t,n,o,r){qn(e,t,n,o,[function(e){return function(e,t){return t.push({facingAxis:"y",orientation:"+",yOffset:0,textureIndex:e}),0}(r,e)}])}function Gn(e,t,n,o,r,a,c){qn(e,t,n,o,[function(e){return Jn(a,c,r,e)}])}function qn(e,t,n,o,r){for(var a=[],c=0,i=0,s=r;i<s.length;i++)c|=(0,s[i])(a);e[n*t+o]={row:n,col:o,collisionLayerMask:c,quads:a}}function Jn(e,t,n,o){for(var r=.5;r<=3.5;++r)o.push({facingAxis:e,orientation:t,yOffset:r,textureIndex:n});return 1}const Qn={generateEmptyRoom:function(e,t,n,o,r){for(var a=new Array(t*n),c=0;c<t;++c)for(var i=0;i<n;++i)0==c?Gn(a,n,c,i,r,"z","+"):0==i?Gn(a,n,c,i,r,"x","+"):c==t-1?Gn(a,n,c,i,r,"z","-"):i==n-1?Gn(a,n,c,i,r,"x","-"):zn(a,n,c,i,o);return Fn(a,n,3,3,r),Fn(a,n,t-4,n-4,r),Fn(a,n,3,n-4,r),Fn(a,n,t-4,3,r),{voxelGrid:{numGridRows:t,numGridCols:n,voxels:a},persistentObjects:[]}}};var Wn={},Hn=new Array(1024);const Vn={loadRoom:function(e){var t=Bn.decode(e.room.encodedVoxelGrid);if(null!=Wn[e.room.roomID])throw new Error("VoxelGrid already exists (roomID = ".concat(e.room.roomID,")"));return Wn[e.room.roomID]=t,t},unloadRoom:function(e){if(null==Wn[e])throw new Error("VoxelGrid doesn't exist (roomID = ".concat(e,")"));delete Wn[e]},getEncodedVoxelGrid:function(e){var t=Wn[e];if(null==t)throw new Error("VoxelGrid doesn't exist (roomID = ".concat(e,")"));return Bn.encode(t)},getVoxelsInCircle:function(e,t,n,o){Hn.length=0;var r=Wn[e];if(null==r)throw new Error("VoxelGrid doesn't exist (roomID = ".concat(e,")"));for(var a=Math.max(0,Math.floor(n-o)),c=Math.min(r.numGridRows-1,Math.floor(n+o)),i=Math.max(0,Math.floor(t-o)),s=Math.min(r.numGridCols-1,Math.floor(t+o)),l=o*o,u=a;u<=c;++u){var d=u-n;d*=d;for(var f=i;f<=s;++f){var h=f-t;d+(h*=h)<=l&&Hn.push(r.voxels[u*r.numGridCols+f])}}return Hn}},Yn=function(){function e(){this.socketUserContexts={}}return e.prototype.multicastSignal=function(e,t,n){void 0===n&&(n=void 0);for(var o=0,r=Object.entries(this.socketUserContexts);o<r.length;o++){var a=r[o],c=a[0],i=a[1];c!=n&&i.addIncomingSignal(e,t)}},e.prototype.unicastSignal=function(e,t,n){var o=this.socketUserContexts[n];null!=o?o.addIncomingSignal(e,t):console.error("SocketUserContext not found (targetUserName = ".concat(n,")"))},e.prototype.addSocketUserContext=function(e,t){null==this.socketUserContexts[e]?this.socketUserContexts[e]=t:console.error("SocketUserContext already exists (userName = ".concat(e,")"))},e.prototype.removeSocketUserContext=function(e){null!=this.socketUserContexts[e]?delete this.socketUserContexts[e]:console.error("SocketUserContext doesn't exist (userName = ".concat(e,")"))},e}();var Xn=[],$n={encode:function(e){for(var t=0,n=0,o=e;n<o.length;n++)t+=4+o[n].metadata.length;for(var r={view:new Uint8Array(t),index:0},a=0,c=e;a<c.length;a++)Kn(c[a],r);return r.view.buffer},decode:function(e){for(var t={view:new Uint8Array(e),index:0},n=new Array;t.index<t.view.length;)n.push(Zn(t));return n}};function Kn(e,t){if(e.objectTypeIndex<0||e.objectTypeIndex>63)throw new Error("Object type index out of range (objectTypeIndex = ".concat(e.objectTypeIndex,")"));if(e.x<0||e.x>32)throw new Error("Object x out of range (x = ".concat(e.x,")"));if(e.z<0||e.z>32)throw new Error("Object z out of range (z = ".concat(e.z,")"));if(e.y<0||e.y>4)throw new Error("Object y out of range (y = ".concat(e.y,")"));if(e.metadata.length>255)throw new Error("Object metadata length out of range (length = ".concat(e.metadata.length,")"));t.view[t.index++]=e.objectTypeIndex<<2|("+z"==e.direction?0:"+x"==e.direction?1:"-z"==e.direction?2:3);var n=Math.floor(4*e.y),o=(12&n)>>2,r=3&n;t.view[t.index++]=Math.floor(2*e.x)<<2|o,t.view[t.index++]=Math.floor(2*e.z)<<2|r,t.view[t.index++]=e.metadata.length}function Zn(e){var t=e.view[e.index++],n=t>>2&63,o=3&t,r=o<=1?0==o?"+z":"+x":2==o?"-z":"-x",a=e.view[e.index++],c=.5*(a>>2&63),i=3&a,s=e.view[e.index++],l=.5*(s>>2&63),u=.25*(i<<2|3&s),d=e.view[e.index++];Xn.length;for(var f=0;f<d;++f)Xn.push(String.fromCharCode(e.view[e.index++]));var h=Xn.join("");return{objectId:"p".concat(c,"-").concat(u,"-").concat(l),objectTypeIndex:n,direction:r,x:c,y:u,z:l,metadata:h}}const eo=$n;var to={};const no=function(e){var t=eo.decode(e.room.encodedPersistentObjects);if(null!=to[e.room.roomID])throw new Error("PersistentObjects already exists (roomID = ".concat(e.room.roomID,")"));return to[e.room.roomID]=t,t},oo=function(e){if(null==to[e])throw new Error("PersistentObjects doesn't exist (roomID = ".concat(e,")"));delete to[e]},ro=function(e){var t=to[e];if(null==t)throw new Error("PersistentObjects doesn't exist (roomID = ".concat(e,")"));return eo.encode(t)};var ao={},co={};[[0,{objectType:"Voxel",components:{spawnedByAny:{instancedMeshGraphics:{},voxelObject:{}}}}],[1,{objectType:"Player",components:{spawnedByAny:{collider:{collisionLayer:0,hitboxSize:{sizeX:.6,sizeZ:.6}}},spawnedByMe:{firstPersonController:{},objectSyncEmitter:{}},spawnedByOther:{modelGraphics:{path:"lowpolyghost/lowpolyghost.glb",localPosition:{x:0,y:.13,z:0},scale:{x:.7,y:.7,z:.7}},objectSyncReceiver:{},speechBubble:{yOffset:3}}}}]].forEach(function(e){ao[e[0]]=e[1],co[e[1].objectType]=e[0]});const io=function(e){var t=ao[e];if(null==t)throw new Error("getConfigByIndex :: Invalid object type index (objectTypeIndex = ".concat(e,")"));return t},so=function(e){var t=co[e];if(null==t)throw new Error("getIndexByType :: Invalid object type (objectType = ".concat(e,")"));return t};var lo=function(e,t,n,o){return new(n||(n=Promise))(function(r,a){function c(e){try{s(o.next(e))}catch(e){a(e)}}function i(e){try{s(o.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,i)}s((o=o.apply(e,t||[])).next())})},uo=function(e,t){var n,o,r,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};v().config();var fo={},ho={},po={},mo=0,bo={changeUserRoom:function(e,t,n){return lo(void 0,void 0,void 0,function(){var o,r;return uo(this,function(a){switch(a.label){case 0:return o=e.socket.handshake.auth,console.log("RoomManager.changeUserRoom :: roomID = ".concat(t,", userName = ").concat(o.userName)),function(e,t){var n=e.socket.handshake.auth,o=po[n.userName];if(console.log("RoomManager.removeUserFromRoom :: roomID = ".concat(o,", userName = ").concat(n.userName)),null!=o){var r=fo[o];if(null!=r){for(var a=function(e,t){var n=fo[e];if(null==n)return console.error("RoomManager.getIdsOfObjectsSpawnedByUser :: RoomRuntimeMemory doesn't exist (roomID = ".concat(e,")")),[];for(var o=[],r=0,a=Object.entries(n.objectRuntimeMemories);r<a.length;r++){var c=a[r],i=c[0];c[1].objectSpawnParams.sourceUserName==t&&o.push(i)}return o}(o,n.userName),c=0,i=a;c<i.length;c++)vo(e,i[c]);if(null!=r.participantUserNames[n.userName]){delete po[n.userName],delete r.participantUserNames[n.userName];var s=ho[o];s?s.removeSocketUserContext(n.userName):console.error("RoomManager.removeUserFromRoom :: SocketRoomContext not found (roomID = ".concat(o,")")),0==Object.keys(r.participantUserNames).length&&function(e){console.log("RoomManager.unloadRoom :: roomID = ".concat(e));var t=fo[e];if(null==fo[e])throw new Error("RoomManager.unloadRoom :: RoomRuntimeMemory doesn't exist (roomID = ".concat(e,")"));if(Object.keys(t.participantUserNames).length>0)throw new Error("RoomManager.unloadRoom :: There are still participants in the room (participants = [".concat(JSON.stringify(t.participantUserNames),"])"));delete fo[e],delete ho[e],oo(e),_n.unloadRoom(e),Vn.unloadRoom(e)}(o)}else console.error("RoomManager.removeUserFromRoom :: User is not registered as the room's participant (userName = ".concat(n.userName,", roomID = ").concat(o,")"))}else console.error("RoomManager.removeUserFromRoom :: RoomRuntimeMemory doesn't exist (roomID = ".concat(o,")"))}else t&&console.warn("RoomManager.removeUserFromRoom :: Previous room not found :: userName = ".concat(n.userName))}(e,n),t?null!=fo[t]?[3,2]:[4,yo(t)]:[2];case 1:a.sent(),a.label=2;case 2:return function(e,t,n){var o=e.socket.handshake.auth;console.log("RoomManager.addUserToRoom :: roomID = ".concat(t,", userName = ").concat(n));var r=fo[t];if(null!=r)if(null==r.participantUserNames[n]){po[n]=t,r.participantUserNames[n]=!0;var a=ho[t];a?a.addSocketUserContext(n,e):console.error("RoomManager.addUserToRoom :: SocketRoomContext not found (roomID = ".concat(t,")")),function(e,t){var n,o=e.socket.handshake.auth,r=po[o.userName],a=t.objectSpawnParams.objectId;if(console.log("RoomManager.addObject :: roomID = ".concat(r,", userName = ").concat(o.userName,", objectId = ").concat(a)),null!=r){var c=fo[r];if(null!=c)if(null==c.objectRuntimeMemories[a]){c.objectRuntimeMemories[a]=t;var i=null===(n=io(t.objectSpawnParams.objectTypeIndex).components.spawnedByAny)||void 0===n?void 0:n.collider;if(i){var s=.5*i.hitboxSize.sizeX,l=.5*i.hitboxSize.sizeZ,u={x:t.objectSpawnParams.transform.x,y:t.objectSpawnParams.transform.z,halfSizeX:s,halfSizeY:l};_n.addObject(r,a,u,i.collisionLayer)}var d=ho[r];d?d.multicastSignal("objectSpawn",t.objectSpawnParams,o.userName):console.error("RoomManager.addObject :: SocketRoomContext not found (roomID = ".concat(r,")"))}else console.error("RoomManager.addObject :: ObjectRuntimeMemory already exists (roomID = ".concat(r,", objectId = ").concat(a,")"));else console.error("RoomManager.addObject :: RoomRuntimeMemory doesn't exist (roomID = ".concat(r,", objectId = ").concat(a,")"))}else console.error("RoomManager.addObject :: RoomID not found (userName = ".concat(o.userName,", objectId = ").concat(a,")"))}(e,{objectSpawnParams:{sourceUserName:o.userName,objectTypeIndex:so("Player"),objectId:"#".concat(++mo),transform:{x:16,y:0,z:16,eulerX:0,eulerY:Math.PI,eulerZ:0},metadata:""}})}else console.error("RoomManager.addUserToRoom :: User is already registered (roomID = ".concat(t,", userName = ").concat(n,")"));else console.error("RoomManager.addUserToRoom :: RoomRuntimeMemory doesn't exist (roomID = ".concat(t,")"))}(e,t,o.userName),(r=fo[t]).room.encodedVoxelGrid=Vn.getEncodedVoxelGrid(t),r.room.encodedPersistentObjects=ro(t),e.socket.emit("changeRoom",r),[2]}})})},sendObjectMessage:function(e,t){var n=e.socket.handshake.auth,o=po[n.userName];if(null!=o){var r=fo[o];if(null!=r){var a=r.objectRuntimeMemories[t.senderObjectId];if(null!=a)if(a.objectSpawnParams.sourceUserName==n.userName){t.message=t.message.trim().substring(0,32);var c=ho[o];c?c.multicastSignal("objectMessage",t,n.userName):console.error("RoomManager.sendObjectMessage :: SocketRoomContext not found (roomID = ".concat(o,")"))}else console.error("RoomManager.sendObjectMessage :: User has no authority to control this object (roomID = ".concat(o,", objectId = ").concat(t.senderObjectId,")"));else console.error("RoomManager.sendObjectMessage :: ObjectRuntimeMemory doesn't exist (roomID = ".concat(o,", objectId = ").concat(t.senderObjectId,")"))}else console.error("RoomManager.sendObjectMessage :: RoomRuntimeMemory doesn't exist (roomID = ".concat(o,")"))}else console.error("RoomManager.sendObjectMessage :: RoomID not found (userName = ".concat(n.userName,")"))},updateObjectTransform:function(e,t,n){var o=e.socket.handshake.auth,r=po[o.userName];if(null!=r){var a=fo[r];if(null!=a){var c=a.objectRuntimeMemories[t];if(null!=c)if(c.objectSpawnParams.sourceUserName==o.userName){var i={x:n.x,y:n.z},s=_n.tryMoveObject(r,t,i);if(n.x=s.resolvedPos.x,n.z=s.resolvedPos.y,Object.assign(c.objectSpawnParams.transform,n),s.desyncDetected){var l={objectId:t,resolvedPos:s.resolvedPos};(u=ho[r])?u.multicastSignal("objectDesyncResolve",l):console.error("RoomManager.updateObjectTransform :: SocketRoomContext not found (roomID = ".concat(r,")"))}else{var u;l={objectId:t,transform:n},(u=ho[r])?u.multicastSignal("objectSync",l,o.userName):console.error("RoomManager.updateObjectTransform :: SocketRoomContext not found (roomID = ".concat(r,")"))}}else console.error("RoomManager.updateObjectTransform :: User has no authority to control this object (roomID = ".concat(r,", objectId = ").concat(t,")"));else console.error("RoomManager.updateObjectTransform :: ObjectRuntimeMemory doesn't exist (roomID = ".concat(r,", objectId = ").concat(t,")"))}else console.error("RoomManager.updateObjectTransform :: RoomRuntimeMemory doesn't exist (roomID = ".concat(r,")"))}else console.error("RoomManager.updateObjectTransform :: RoomID not found (userName = ".concat(o.userName,")"))}};function yo(e){return lo(this,void 0,void 0,function(){var t,n,o,r;return uo(this,function(a){if(console.log("RoomManager.loadRoom :: roomID = ".concat(e)),null!=fo[e])throw new Error("RoomManager.loadRoom :: RoomRuntimeMemory already exists (roomID = ".concat(e,")"));if(!e.startsWith("s"))throw new Error("Fetching room from database is not supported yet (roomID = ".concat(e,")"));return n=Qn.generateEmptyRoom(e,32,32,0,1),t={roomID:e,roomName:e,ownerUserName:"",texturePackURL:"".concat("dev"==process.env.MODE?"http://localhost:".concat(process.env.PORT):process.env.URL_STATIC,"/app/assets/texture_packs/default.jpg"),encodedVoxelGrid:Bn.encode(n.voxelGrid),encodedPersistentObjects:eo.encode(n.persistentObjects)},o={room:t,participantUserNames:{},objectRuntimeMemories:{}},fo[e]=o,ho[e]=new Yn,r=Vn.loadRoom(o),_n.loadRoom(o,r),no(o),[2,o]})})}function vo(e,t){var n,o=e.socket.handshake.auth,r=po[o.userName];if(console.log("RoomManager.removeObject :: roomID = ".concat(r,", userName = ").concat(o.userName,", objectId = ").concat(t)),null!=r){var a=fo[r];if(null!=a){var c=a.objectRuntimeMemories[t];if(null!=c){delete a.objectRuntimeMemories[t],(null===(n=io(c.objectSpawnParams.objectTypeIndex).components.spawnedByAny)||void 0===n?void 0:n.collider)&&_n.removeObject(r,t);var i={objectId:t},s=ho[r];s?s.multicastSignal("objectDespawn",i,o.userName):console.error("RoomManager.removeObject :: SocketRoomContext not found (roomID = ".concat(r,")"))}else console.error("RoomManager.removeObject :: ObjectRuntimeMemory doesn't exist (roomID = ".concat(r,", objectId = ").concat(t,")"))}else console.error("RoomManager.removeObject :: RoomRuntimeMemory doesn't exist (roomID = ".concat(r,", objectId = ").concat(t,")"))}else console.error("RoomManager.removeObject :: RoomID not found (userName = ".concat(o.userName,", objectId = ").concat(t,")"))}const go=bo,wo=function(){function e(e){this.socket=e,this.incomingSignalsByType={}}return e.prototype.addIncomingSignal=function(e,t){var n=this.incomingSignalsByType[e];null==n&&(n=[],this.incomingSignalsByType[e]=n),n.push(t)},e.prototype.processAllIncomingSignals=function(){for(var e=0,t=Object.entries(this.incomingSignalsByType);e<t.length;e++){var n=t[e],o=n[0],r=n[1];this.socket.emit(o,r),r.length=0}},e}();var xo,So=function(e,t,n,o){return new(n||(n=Promise))(function(r,a){function c(e){try{s(o.next(e))}catch(e){a(e)}}function i(e){try{s(o.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,i)}s((o=o.apply(e,t||[])).next())})},ko=function(e,t){var n,o,r,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Io={};const Ro=function(e,t){(xo=e.of("/game_sockets")).use(t),xo.on("connection",function(e){return So(void 0,void 0,void 0,function(){var t,n;return ko(this,function(o){switch(o.label){case 0:return t=new wo(e),n=e.handshake.auth,console.log("(GameSockets) Client connected :: ".concat(JSON.stringify(n))),null!=Io[n.userName]?(console.error("SocketUserContext with userName already exists (userName = ".concat(n.userName,")")),[2]):(Io[n.userName]=t,e.on("objectMessage",function(e){go.sendObjectMessage(t,e)}),e.on("objectSync",function(e){go.updateObjectTransform(t,e.objectId,e.transform)}),e.on("roomChangeRequest",function(e){return So(void 0,void 0,void 0,function(){return ko(this,function(n){switch(n.label){case 0:return[4,go.changeUserRoom(t,e.roomID,!0)];case 1:return n.sent(),[2]}})})}),e.on("disconnect",function(){return So(void 0,void 0,void 0,function(){return ko(this,function(e){switch(e.label){case 0:return console.log("(GameSockets) Client disconnected :: ".concat(JSON.stringify(n))),null==Io[n.userName]?(console.error("SocketUserContext with userName doesn't exist (userName = ".concat(n.userName,")")),[2]):(delete Io[n.userName],[4,go.changeUserRoom(t,void 0,!1)]);case 1:return e.sent(),[2]}})})}),[4,go.changeUserRoom(t,"s1",!1)]);case 1:return o.sent(),[2]}})})}),setInterval(function(){for(var e=0,t=Object.values(Io);e<t.length;e++)t[e].processAllIncomingSignals()},200)},jo=require("cookie");v().config();var Oo=new Set;function To(e){return function(t,n){var o=t.request.headers.cookie;if(console.log("Authenticating socket (ID: ".concat(t.id,")")),o){var r=jo.parse(o).thingspool_token;if(r){var a=on(r);a?Oo.has(a.userName)?n(new Error(dn("auth-duplication"))):e(a)?(Oo.add(a.userName),t.on("disconnect",function(){Oo.has(a.userName)?Oo.delete(a.userName):console.error('User "'.concat(a.userName,'" is already disconnected.'))}),t.handshake.auth=a,n()):n(new Error(dn("auth-no-permission"))):n(new Error(dn("auth-failure")))}else n(new Error(dn("auth-failure")))}else n(new Error(dn("auth-failure")))}}v().config(),function(){var e,t,o,a;e=this,t=void 0,a=function(){var e,t;return function(e,t){var n,o,r,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(o){switch(o.label){case 0:return"dev"!=process.env.MODE?[3,2]:[4,zt()];case 1:return o.sent(),[3,4];case 2:return"ssg"!=process.env.MODE?[3,4]:[4,zt()];case 3:return o.sent(),[2];case 4:return[4,j.runSQLFile("clear.sql")];case 5:return o.sent(),[4,j.runSQLFile("init.sql")];case 6:return o.sent(),e=n()(),t=r().createServer(e),e.set("view engine","ejs"),e.use(c().json()),e.use(c().urlencoded({extended:!0})),e.use(s()()),e.use(u()()),function(e){var t=this;"dev"==process.env.MODE&&(e.get("/",function(e,n){return pn(t,void 0,void 0,function(){var t;return mn(this,function(o){switch(o.label){case 0:return[4,C.read(e.url+"index.html")];case 1:return t=o.sent(),n.status(200).setHeader("content-type","text/html").send(V.postProcessHTML(t)),[2]}})})}),e.get(/.*\.html$/,function(e,n){return pn(t,void 0,void 0,function(){var t;return mn(this,function(o){switch(o.label){case 0:return[4,C.read(e.url)];case 1:return t=o.sent(),n.status(200).setHeader("content-type","text/html").send(V.postProcessHTML(t)),[2]}})})}),e.get(/.*\.js$/,function(e,n){return pn(t,void 0,void 0,function(){return mn(this,function(t){return n.status(200).setHeader("content-type","text/javascript").sendFile(C.getAbsoluteFilePath(e.url)),[2]})})}),e.get(/(.*\.css)|(.*\.jpg)|(.*\.png)|(.*\.ico)|(.*\.atom)|(.*\.xml)|(.*\.pdf)|(.*\.glb)$/,function(e,n){return pn(t,void 0,void 0,function(){return mn(this,function(t){return n.sendFile(C.getAbsoluteFilePath(e.url)),[2]})})})),e.use("/api/auth",hn),e.use("/",ln)}(e),t.listen(process.env.PORT,function(){console.log("---------------------------------------------"),console.log("Listening to port ".concat(process.env.PORT,"."))}),function(e){var t=new(yn().Server)(e);E(t,"dev"==process.env.MODE?function(e,t){return t()}:To(function(e){return"admin"==e.userType})),Ro(t,To(function(e){return!0}))}(t),[2]}})},new((o=void 0)||(o=Promise))(function(n,r){function c(e){try{s(a.next(e))}catch(e){r(e)}}function i(e){try{s(a.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(c,i)}s((a=a.apply(e,t||[])).next())})}()})();