(()=>{"use strict";var e={110:(e,t,n)=>{n.d(t,{A:()=>f});var r=n(928),o=n.n(r);const a=require("fs/promises");var i=n.n(a),c=n(604),s=n(818),u=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})},l=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};n.n(s)().config();var d={read:function(e,t){return u(void 0,void 0,void 0,function(){var n,r;return l(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),n=d.getAbsoluteFilePath(e,t),[4,i().readFile(n,{encoding:"utf8"})];case 1:return[2,o.sent()];case 2:return r=o.sent(),c.A.log("Failed to read file",{relativeFilePath:e,err:r},"high","pink"),[2,""];case 3:return[2]}})})},write:function(e,t,n){return u(void 0,void 0,void 0,function(){var r,o;return l(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),r=d.getAbsoluteFilePath(e,n),[4,i().writeFile(r,t)];case 1:return a.sent(),[3,3];case 2:return o=a.sent(),c.A.log("Failed to write file",{relativeFilePath:e,err:o},"high","pink"),[3,3];case 3:return[2]}})})},getAllRelativePathsInDirRecursively:function(e){return u(void 0,void 0,void 0,function(){var t,n;return l(this,function(r){switch(r.label){case 0:return t=o().join(process.env.PWD,e),n=[],[4,d.getAllRelativePathsInDirRecursively_internal(t,[],n)];case 1:return r.sent(),[2,n]}})})},getAbsoluteFilePath:function(e,t){return null==t&&(t=process.env.STATIC_PAGE_ROOT_DIR),o().join(process.env.PWD,t+"/"+e)},getAllRelativePathsInDirRecursively_internal:function(e,t,n){return u(this,void 0,void 0,function(){var r,o,a,c,s,u;return l(this,function(l){switch(l.label){case 0:return[4,i().readdir(e)];case 1:r=l.sent(),o=0,a=r,l.label=2;case 2:return o<a.length?(c=a[o],s=t.concat(c),u="".concat(e,"/").concat(c),[4,i().lstat(u)]):[3,7];case 3:return l.sent().isFile()?(n.push(s.join("/")),[3,6]):[3,4];case 4:return[4,d.getAllRelativePathsInDirRecursively_internal(u,s,n)];case 5:l.sent(),l.label=6;case 6:return o++,[3,2];case 7:return[2]}})})}};const f=d},422:(e,t,n)=>{n.d(t,{A:()=>o});const r={escapeHTMLChars:e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replaceAll("\n","<br>").replaceAll(" ","&nbsp;"),findErrorInUserName:e=>e.length<4||e.length>16?"error/userName/length":e!=r.sanitizeUserName(e)?"error/userName/chars":null,findErrorInPassword:e=>e.length<6||e.length>24?"error/password/length":e!=r.sanitizePassword(e)?"error/password/chars":null,findErrorInEmailAddress:e=>e.length>64?"error/email/length":/^[^\s@]+@[^\s@]+.[^\s@]+$/.test(e)?null:"error/email/chars",findErrorInRoomName:e=>e.length<4||e.length>64?"error/roomName/length":e!=r.sanitizeRoomName(e)?"error/roomName/chars":null,sanitizeUserName:e=>(e.length>16&&(e=e.substring(0,16)),e.replace(/[^a-zA-Z0-9_]/g,"")),sanitizePassword:e=>(e.length>24&&(e=e.substring(0,24)),e.replace(/[^a-zA-Z0-9~`!@#\$%\^&\*\(\)-_\+=\{\[\}\]\|\\:;"'<>,\.\?\/]/g,"")),sanitizeRoomName:e=>r.sanitizeRoomNameWithoutTrimming(e).trim(),sanitizeRoomNameWithoutTrimming:e=>(e.length>64&&(e=e.substring(0,64)),e.replace(/[^a-zA-Z0-9~`!@#\$%\^&\*\(\)-_\+=\{\[\}\]\|\\:;"'<>,\.\?\/\s]/g,"").replace(/\s+/g," "))},o=r},506:(e,t,n)=>{n.d(t,{A:()=>s});var r,o=n(604),a=n(557),i=n(936),c="</td>";const s={init:function(e,t){(r=e.of("/sockets_console")).use(t),r.on("connection",function(e){console.log("(ConsoleSockets) Client connected :: ".concat(JSON.stringify(e.handshake.auth.user))),e.on("command",function(t){console.log("(ConsoleSockets) Command received :: [".concat(t,"] - sent by :: ").concat(JSON.stringify(e.handshake.auth.user)));var n=t.split(" ");switch(n[0]){case"test":n.shift(),0==n.length?o.A.logRaw("Please provide the name of the test.","high","pink"):i.default.get("test")(n[0],1==n.length?"low":n[1]);break;case"print":n.shift(),o.A.logRaw(0==n.length?"-":n.join(" "),"high");break;case"db":"dev"==process.env.MODE?(n.shift(),a.A.runSQLFile("".concat(n[0],".sql"))):o.A.logRaw('Command "'.concat(n[0],'" is supported only in dev mode.'),"high","pink");break;case"reboot":o.A.logRaw("Rebooting...","high"),process.exit(0);break;default:o.A.logRaw('Unknown command "'.concat(n[0],'".'),"high","pink")}}),e.on("disconnect",function(){console.log("(ConsoleSockets) Client disconnected :: ".concat(JSON.stringify(e.handshake.auth.user)))})})},log:function(e,t,n){var o,a,i;r?r.emit("log",(o=e,a=t,i=n,"".concat('<td style="color: #e0e020; background-color: #202090;">').concat(o).concat(c).concat('<td style="color: #20e020; background-color: #101010;">').concat(a).concat(c).concat('<td style="color: #303030; background-color: #c0c0c0;">').concat(i).concat(c))):console.log("".concat(e,"\n(ORIGIN: ").concat(t,")\n(DETAILS: ").concat(n,")"))}}},531:(e,t,n)=>{n.d(t,{A:()=>r});const r={displayText:{menuName:{index:"Home",rooms:"Rooms",arcade:"Games",library:"Blog",admin:"Admin"},tabName:{"rooms/owned":"My","rooms/joined":"Joined","rooms/pending":"Pending","rooms/others":"Others","roomMembers/associated":"Members","roomMembers/others":"Invite Others"},message:{"error/userName/length":"Username must be between 4 and 16 characters long.","error/userName/chars":"Username can only contain alphabets, numbers, and underbar(_).","error/password/length":"Password must be between 6 and 24 characters long.","error/password/chars":"Password can only contain alphabets, numbers, and the following special characters: ~`!@#$%^&*()-_+={}[]|\\:;\"'<>,.?/","error/email/length":"Email address must not contain more than 64 characters.","error/email/chars":"Please enter a valid email address.","error/roomName/length":"Room name must be between 4 and 64 characters long.","error/roomName/chars":"Room name can only contain alphabets, numbers, spaces, and the following special characters: ~`!@#$%^&*()-_+={}[]|\\:;\"'<>,.?/","rule/userName/length":"Username must be between 4 and 16 characters long.","rule/userName/chars":"Username can only contain alphabets, numbers, and underbar(_).","rule/password/length":"Password must be between 6 and 24 characters long.","rule/password/chars":"Password can only contain alphabets, numbers, and the following special characters: ~`!@#$%^&*()-_+={}[]|\\:;\"'<>,.?/","rule/email/length":"Email address must not contain more than 64 characters.","rule/roomName/length":"Room name must be between 4 and 64 characters long.","rule/roomName/chars":"Room name can only contain alphabets, numbers, spaces, and the following special characters: ~`!@#$%^&*()-_+={}[]|\\:;\"'<>,.?/"}},search:{searchLimitPerPage:10}}},557:(e,t,n)=>{n.d(t,{A:()=>g});const r=require("mysql2/promise");var o=n.n(r),a=n(110),i=n(604),c=n(422),s=n(818),u=n.n(s),l=function(){function e(e,t,n){this.pool=e,this.queryStr=t,this.queryParams=n}return e.prototype.run=function(e,t){return n=this,r=void 0,a=function(){var n,r,o;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(a){switch(a.label){case 0:t&&i.A.pushStackTrace(t),i.A.log("SQL Query Started",{queryStr:this.queryStr,queryParams:this.queryParams},"low"),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.pool.query(this.queryStr,this.queryParams)];case 2:return n=a.sent(),r=n[0],n[1],i.A.log("SQL Query Succeeded",{queryStr:this.queryStr,queryParams:this.queryParams},"medium"),t&&i.A.popStackTrace(t),null==e||e.status(202),[2,r];case 3:return o=a.sent(),i.A.log("SQL Query Error",{err:o},"high","pink"),t&&i.A.popStackTrace(t),null==e||e.status(500).send(o),[2,[]];case 4:return[2]}})},new((o=void 0)||(o=Promise))(function(e,t){function i(e){try{s(a.next(e))}catch(e){t(e)}}function c(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o(function(e){e(n)})).then(i,c)}s((a=a.apply(n,r||[])).next())});var n,r,o,a},e}();const d=l;var f=function(){function e(e,t){this.pool=e,this.queries=t}return e.prototype.run=function(e,t){return n=this,r=void 0,a=function(){var n,r,o,a,c,s,u,l,d;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(f){switch(f.label){case 0:t&&i.A.pushStackTrace(t),i.A.log("SQL Transaction Began",{numQueries:this.queries.length},"low"),n=void 0,r=!1,o=0,f.label=1;case 1:return f.trys.push([1,11,13,14]),[4,this.pool.getConnection()];case 2:return[4,(n=f.sent()).beginTransaction()];case 3:f.sent(),a=0,c=this.queries,f.label=4;case 4:return a<c.length?(s=c[a],o++,i.A.log("SQL Transaction Query Started",{progress:"".concat(o,"/").concat(this.queries.length),query:s},"low"),[4,null==n?void 0:n.query(s.queryStr,s.queryParams)]):[3,9];case 5:return u=f.sent(),l=u[0],u[1],0!=l.affectedRows?[3,7]:[4,null==n?void 0:n.rollback()];case 6:return f.sent(),i.A.log("SQL Transaction Query Made No Change",{progress:"".concat(o,"/").concat(this.queries.length),query:s},"high"),t&&i.A.popStackTrace(t),null==e||e.status(403),[2];case 7:i.A.log("SQL Transaction Query Succeeded",{progress:"".concat(o,"/").concat(this.queries.length),query:s},"low"),f.label=8;case 8:return a++,[3,4];case 9:return[4,null==n?void 0:n.commit()];case 10:return f.sent(),i.A.logRaw("SQL Transaction Committed","medium"),t&&i.A.popStackTrace(t),r=!0,[3,14];case 11:return d=f.sent(),i.A.log("SQL Transaction Error",{progress:"".concat(o,"/").concat(this.queries.length),err:d},"high","pink"),[4,null==n?void 0:n.rollback()];case 12:return f.sent(),t&&i.A.popStackTrace(t),null==e||e.status(500).send(d),[3,14];case 13:return null==n||n.release(),r&&(null==e||e.status(202)),[7];case 14:return[2]}})},new((o=void 0)||(o=Promise))(function(e,t){function i(e){try{s(a.next(e))}catch(e){t(e)}}function c(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o(function(e){e(n)})).then(i,c)}s((a=a.apply(n,r||[])).next())});var n,r,o,a},e}();const h=f;var m=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})},p=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};u().config();var v="dev"==process.env.MODE,b=void 0,y={createPool:function(){b?i.A.logRaw("DB connection pool is already created.","high","pink"):(b=o().createPool({host:v?process.env.SQL_HOST_DEV:process.env.SQL_HOST_PROD,user:v?process.env.SQL_USER_DEV:process.env.SQL_USER_PROD,password:v?process.env.SQL_PASS_DEV:process.env.SQL_PASS_PROD,database:"main",waitForConnections:!0,connectionLimit:10,queueLimit:0,enableKeepAlive:!0,keepAliveInitialDelay:0}))||i.A.logRaw("Failed to create a DB connection pool.","high","pink")},makeQuery:function(e,t){return b||y.createPool(),new d(b,e,t)},makeTransaction:function(e){return new h(b,e)},runSQLFile:function(e){return m(void 0,void 0,void 0,function(){var t,n,r,c,s,u,l;return p(this,function(d){switch(d.label){case 0:return i.A.log("Opening SQL File",{fileName:e},"high"),[4,a.A.read(e,"sql")];case 1:t=d.sent(),n=t.split(";").map(function(e){return e.trim()+";"}).filter(function(e){return e.length>1}),r=void 0,d.label=2;case 2:return d.trys.push([2,8,9,10]),[4,o().createConnection({host:v?process.env.SQL_HOST_DEV:process.env.SQL_HOST_PROD,user:v?process.env.SQL_USER_DEV:process.env.SQL_USER_PROD,password:v?process.env.SQL_PASS_DEV:process.env.SQL_PASS_PROD})];case 3:null==(r=d.sent())||r.connect(),c=0,s=n,d.label=4;case 4:return c<s.length?(u=s[c],[4,null==r?void 0:r.query(u)]):[3,7];case 5:d.sent(),d.label=6;case 6:return c++,[3,4];case 7:return[3,10];case 8:return l=d.sent(),i.A.log("SQL File Execution Error",{err:l},"high","pink"),[3,10];case 9:return null==r||r.end(),[7];case 10:return[2]}})})},toHTMLString:function(){return m(void 0,void 0,void 0,function(){var e,t,n,r,o,a,i,s,u,l;return p(this,function(d){switch(d.label){case 0:return t=function(e){return c.A.escapeHTMLChars(JSON.stringify(e,null,4))},n=(e=function(e){return"\n\n<h1>".concat(e,"</h1>\n")})("users"),r=t,[4,y.makeQuery("SELECT * FROM users;").run()];case 1:return o=n+r.apply(void 0,[d.sent()])+e("rooms"),a=t,[4,y.makeQuery("SELECT * FROM rooms;").run()];case 2:return i=o+a.apply(void 0,[d.sent()])+e("roomMemberships"),s=t,[4,y.makeQuery("SELECT * FROM roomMemberships;").run()];case 3:return u=i+s.apply(void 0,[d.sent()])+e("emailVerifications"),l=t,[4,y.makeQuery("SELECT * FROM emailVerifications;").run()];case 4:return[2,u+l.apply(void 0,[d.sent()])]}})})}};const g=y},604:(e,t,n)=>{n.d(t,{A:()=>i});var r=n(506),o=[],a={thresholdLogLevel:0,setThresholdLogLevel:function(e){a.thresholdLogLevel=isNaN(e)?a.getLogLevelFromName(e):e},getThresholdLogLevel:function(){return a.thresholdLogLevel},getLogLevelFromName:function(e){switch(e){case"low":return 0;case"medium":return 1;case"high":return 2;default:console.error('ERROR: Unknown log level name ("'.concat(e,'")'))}return 0},log:function(e,t,n,o){void 0===t&&(t=void 0),void 0===n&&(n="high");var i="";null!=t&&(i=JSON.stringify(t));var c=a.getStackTrace();a.getLogLevelFromName(n)>=a.thresholdLogLevel&&r.A.log((o?'<b style="color:'.concat(o,'">'):"")+e+(o?"</b>":""),c,i)},logRaw:function(e,t,n){void 0===t&&(t="high"),a.log(e,void 0,t,n)},getStackTrace:function(){for(var e=[],t=o.length-1;t>=0;--t)e.push(o[t]);return e.join(" <- ")},pushStackTrace:function(e){o.push(e),a.logRaw("pushStackTrace: ".concat(e),"high","gray")},popStackTrace:function(e){if(0!=o.length){var t=o.pop();t==e?a.logRaw("popStackTrace: ".concat(e),"high","gray"):a.logRaw("Name mismatch in stackTrace :: (traceName = ".concat(e,", expectedTraceName = ").concat(t,")"),"high","pink")}else a.logRaw("No name to pop in stackTrace :: (traceName = ".concat(e,")"),"high","pink")}};const i=a},611:e=>{e.exports=require("http")},654:(e,t,n)=>{n.d(t,{A:()=>r});const r={auth:{bypassEmailVerification:!1,emailVerificationTimeoutInSeconds:600}}},718:(e,t,n)=>{n.r(t),n.d(t,{default:()=>q});var r=n(557),o=n(654),a=n(611),i=n.n(a),c=n(604),s=n(893);const u={limitPropValueTextSize:(e,t,n)=>{const r=u.deepCopyObj(e);return u.limitPropValueTextSize_internal(r,t,n),r},limitPropValueTextSize_internal:(e,t,n)=>{for(const[r,o]of Object.entries(e)){if(r==t){if("string"!=typeof o)throw new Error(`Property "${t}" is not a string. (obj = ${JSON.stringify(e)})`);const a=o.substring(0,n);return void(e[r]=a.length<o.length?a+"...":a)}o.constructor==Object&&u.limitPropValueTextSize_internal(o,t,n)}},deepCopyObj:e=>{const t={};for(const[n,r]of Object.entries(e))if(Array.isArray(r)){const e=new Array(r.length);for(let t=0;t<r.length;++t)e[t]=r[t];t[n]=e}else r.constructor==Object?t[n]=u.deepCopyObj(r):t[n]=r;return t}},l=u;var d=n(818),f=n.n(d);f().config();var h={},m=function(e,t,n){void 0===n&&(n=void 0),c.A.log(t,n,"high","pink");var r="";null!=n&&(r=" :: "+JSON.stringify(n)),e("[".concat(t,"]").concat(r))},p={_reset:function(){h={}},makeRequest:function(e,t,n,r,o){return void 0===o&&(o=!0),new Promise(function(a,u){var d={"Content-Type":"application/json"};if(e){var f=h[e];if(!f)return void m(u,"Token Not Found (".concat(n,")"),{senderUserName:e});d.Cookie="thingspool_token=".concat(f,";")}var v={host:"localhost",port:process.env.PORT,path:n,method:t,headers:d},b=i().request(v,function(e){if(p.resOk(e)){c.A.log("Res Callback (".concat(n,")"),{statusCode:e.statusCode},"low");var t="";e.setEncoding("utf8"),e.on("data",function(r){p.resOk(e)?(c.A.log("Res Data (".concat(n,")"),{statusCode:e.statusCode,partial:r},"low"),t+=r):m(u,"Res Data ERROR (".concat(n,")"),{statusCode:e.statusCode,partial:r})}),e.on("end",function(){p.resOk(e)?(c.A.log("Res End (".concat(n,")"),{statusCode:e.statusCode,data:t},"low"),o&&function(e,t){var n=t.headers["set-cookie"];if(n){for(var r=!1,o=0,a=n.join(";").split(";").map(function(e){return e.trim().split("=")});o<a.length;o++){var i=a[o];if("thingspool_token"==i[0]){var u=i[1],l=s.A.getUserFromToken(u);if(!l)return;var d=l.userName;h[d]=u;var f=u.substring(0,20);c.A.log("Token Cached (".concat(d,")"),{token:f.length<u.length?f+"...":u},"low"),r=!0}}r||c.A.log("Token Cache Failed",{setCookie:n},"high","pink")}}(0,e),a({res:e,data:t})):m(u,"Res End ERROR (".concat(n,")"),{statusCode:e.statusCode,data:t})}),e.on("error",function(e){return m(u,"Res Exception (".concat(n,")"),{err:e})})}else m(u,"Res Callback ERROR (".concat(n,")"),{statusCode:e.statusCode})});b.on("error",function(e){return m(u,"Req Exception (".concat(n,")"),{err:e})}),r&&b.write(JSON.stringify(r)),b.end(),c.A.log("Req Sent (".concat(n,")"),{options:l.limitPropValueTextSize(v,"Cookie",40),body:r},"high")})},resOk:function(e){return e.statusCode?e.statusCode>=200&&e.statusCode<300:(c.A.log("Res statusCode is undefined.",{},"high","pink"),!1)}};const v=p;var b=n(422),y={},g={},w={},E={},k=function(e,t){return e.ownerUserName==t.userName},N={_reset:function(){y={},g={},w={},E={}},toString:function(){return JSON.stringify({users:y,rooms:g,roomMemberships:w},null,4)},toHTMLString:function(){var e=function(e){return"\n\n<h1>".concat(e,"</h1>\n")},t=function(e){return b.A.escapeHTMLChars(JSON.stringify(e,null,4))};return e("users")+t(y)+e("rooms")+t(g)+e("roomMemberships")+t(w)+e("emailVerifications")+t(E)},insertUser:function(e){return null==y[e.userName]&&(y[e.userName]=e,!0)},deleteUser:function(e){return null!=y[e.userName]&&(delete y[e.userName],!0)},insertEmailVerification:function(e){return null==E[e.email]&&(E[e.email]=e,!0)},deleteEmailVerification:function(e){return null!=E[e.email]&&(delete E[e.email],!0)},insertRoom:function(e,t){return null!=y[t.userName]&&null==g[e.roomName]&&(e.ownerUserName=t.userName,g[e.roomName]=e,!!N.insertRoomMembership({roomName:e.roomName,userName:t.userName,userStatus:"owner"},t)||(c.A.log("Error: insertRoom succeeded but insertUserRoom failed.",{room:e,roomOwner:t},"high","pink"),e.ownerUserName="",delete g[e.roomName],!1))},deleteRoom:function(e,t){if(null!=y[t.userName]&&null!=g[e.roomName]&&k(e,t)){e.ownerUserName="",delete g[e.roomName];var n=[];Object.values(w).filter(function(t){return t.roomName==e.roomName}).map(function(e){return"".concat(e.roomName," :: ").concat(e.userName)}).forEach(function(e){return n.push(e)});for(var r=0,o=n;r<o.length;r++){var a=o[r];delete w[a]}return!0}return!1},insertRoomMembership:function(e,t){var n="".concat(e.roomName," :: ").concat(e.userName);return!(null==y[t.userName]||null!=w[n]||"invited"!=e.userStatus&&"requested"!=e.userStatus&&("owner"!=e.userStatus||e.userName!=t.userName)||null==g[e.roomName]||!k(g[e.roomName],t)||(w[n]=e,0))},updateUserRoomStatus:function(e,t){var n="".concat(e.roomName," :: ").concat(e.userName);return!(null==y[t.userName]||null==w[n]||!("invited"==w[n].userStatus&&"member"==e.userStatus||"requested"==w[n].userStatus&&"member"==e.userStatus)||null==g[e.roomName]||!k(g[e.roomName],t)||(w[n]=e,0))},deleteUserRoom:function(e,t){var n="".concat(e.roomName," :: ").concat(e.userName);return!(null==y[t.userName]||null==w[n]||w[n].userStatus!=e.userStatus||null==g[e.roomName]||!k(g[e.roomName],t)||(delete w[n],0))}};const A=N;var T=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})},S=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},R="/api/auth/";const x={initUser:function(e){return T(void 0,void 0,void 0,function(){var t;return S(this,function(n){switch(n.label){case 0:return A.insertUser(e)?(c.A.log("testActions_auth.initUser",{userName:e.userName},"high","cyan"),[4,(r=e.email,T(void 0,void 0,void 0,function(){var e,t;return S(this,function(n){switch(n.label){case 0:return[4,v.makeRequest(null,"POST","".concat(R,"vemail"),{email:r},!1)];case 1:return e=n.sent(),t=e.data,A.insertEmailVerification({email:r,verificationCode:t,expirationTime:Math.floor(.001*Date.now())+o.A.auth.emailVerificationTimeoutInSeconds}),[2,t]}})}))]):[2];case 1:return t=n.sent(),c.A.logRaw("Verification Code = ".concat(t),"low"),[4,v.makeRequest(null,"POST","".concat(R,"register"),{userName:e.userName,password:e.password,email:e.email,verificationCode:t})];case 2:return n.sent(),[2]}var r})})}};var I=n(951),D=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})},L=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},O="/api/room/",P=function(e,t,n,r,o){return D(void 0,void 0,void 0,function(){var a,i,c,s,u,l;return L(this,function(d){switch(d.label){case 0:return[4,I.A.rooms.withRoomName(n.roomName)];case 1:return a=d.sent(),o?[4,I.A.users.withUserName(o.userName)]:[3,3];case 2:return c=d.sent(),[3,4];case 3:c=void 0,d.label=4;case 4:return i=c,s=a&&0!=a.length?a[0].roomID:Math.floor(1e3*Math.random()),u=i&&0!=i.length?i[0].userID:Math.floor(1e3*Math.random()),l={roomID:s,userID:u},[4,v.makeRequest(r.userName,e,"".concat(O).concat(t),l)];case 5:return d.sent(),[2]}})})};const _={create:function(e,t){return D(void 0,void 0,void 0,function(){return L(this,function(n){switch(n.label){case 0:return A.insertRoom(e,t)?(c.A.log("testActions_room.create",{roomName:e.roomName,userName:t.userName},"high","cyan"),[4,v.makeRequest(t.userName,"POST","".concat(O,"create"),{roomName:e.roomName})]):[2];case 1:return n.sent(),[2]}})})},delete:function(e,t){return D(void 0,void 0,void 0,function(){return L(this,function(n){switch(n.label){case 0:return A.deleteRoom(e,t)?(c.A.log("testActions_room.delete",{roomName:e.roomName,userName:t.userName},"high","cyan"),[4,P("DELETE","delete",e,t)]):[2];case 1:return n.sent(),[2]}})})},leave:function(e,t){return D(void 0,void 0,void 0,function(){return L(this,function(n){switch(n.label){case 0:return A.deleteUserRoom({roomName:e.roomName,userName:t.userName,userStatus:"member"},t)?(c.A.log("testActions_room.leave",{roomName:e.roomName,userName:t.userName},"high","cyan"),[4,P("DELETE","leave",e,t)]):[2];case 1:return n.sent(),[2]}})})},acceptInvitation:function(e,t,n){return D(void 0,void 0,void 0,function(){return L(this,function(r){switch(r.label){case 0:return A.updateUserRoomStatus({roomName:e.roomName,userName:n.userName,userStatus:"member"},t)?(c.A.log("testActions_room.acceptInvitation",{roomName:e.roomName,ownerUserName:t.userName,userName:n.userName},"high","cyan"),[4,P("PUT","accept-invitation",e,n)]):[2];case 1:return r.sent(),[2]}})})},ignoreInvitation:function(e,t,n){return D(void 0,void 0,void 0,function(){return L(this,function(r){switch(r.label){case 0:return A.deleteUserRoom({roomName:e.roomName,userName:n.userName,userStatus:"invited"},t)?(c.A.log("testActions_room.ignoreInvitation",{roomName:e.roomName,ownerUserName:t.userName,userName:n.userName},"high","cyan"),[4,P("DELETE","ignore-invitation",e,n)]):[2];case 1:return r.sent(),[2]}})})},requestToJoin:function(e,t,n){return D(void 0,void 0,void 0,function(){return L(this,function(r){switch(r.label){case 0:return A.insertRoomMembership({roomName:e.roomName,userName:n.userName,userStatus:"requested"},t)?(c.A.log("testActions_room.requestToJoin",{roomName:e.roomName,ownerUserName:t.userName,userName:n.userName},"high","cyan"),[4,P("POST","request-to-join",e,n)]):[2];case 1:return r.sent(),[2]}})})},cancelRequest:function(e,t,n){return D(void 0,void 0,void 0,function(){return L(this,function(r){switch(r.label){case 0:return A.deleteUserRoom({roomName:e.roomName,userName:n.userName,userStatus:"requested"},t)?(c.A.log("testActions_room.cancelRequest",{roomName:e.roomName,ownerUserName:t.userName,userName:n.userName},"high","cyan"),[4,P("DELETE","cancel-request",e,n)]):[2];case 1:return r.sent(),[2]}})})},invite:function(e,t,n){return D(void 0,void 0,void 0,function(){return L(this,function(r){switch(r.label){case 0:return A.insertRoomMembership({roomName:e.roomName,userName:n.userName,userStatus:"invited"},t)?(c.A.log("testActions_room.invite",{roomName:e.roomName,ownerUserName:t.userName,userName:n.userName},"high","cyan"),[4,P("POST","invite",e,t,n)]):[2];case 1:return r.sent(),[2]}})})},cancelInvite:function(e,t,n){return D(void 0,void 0,void 0,function(){return L(this,function(r){switch(r.label){case 0:return A.deleteUserRoom({roomName:e.roomName,userName:n.userName,userStatus:"invited"},t)?(c.A.log("testActions_room.cancelInvite",{roomName:e.roomName,ownerUserName:t.userName,userName:n.userName},"high","cyan"),[4,P("DELETE","cancel-invite",e,t,n)]):[2];case 1:return r.sent(),[2]}})})},acceptRequest:function(e,t,n){return D(void 0,void 0,void 0,function(){return L(this,function(r){switch(r.label){case 0:return A.updateUserRoomStatus({roomName:e.roomName,userName:n.userName,userStatus:"member"},t)?(c.A.log("testActions_room.acceptRequest",{roomName:e.roomName,ownerUserName:t.userName,userName:n.userName},"high","cyan"),[4,P("PUT","accept-request",e,t,n)]):[2];case 1:return r.sent(),[2]}})})},ignoreRequest:function(e,t,n){return D(void 0,void 0,void 0,function(){return L(this,function(r){switch(r.label){case 0:return A.deleteUserRoom({roomName:e.roomName,userName:n.userName,userStatus:"requested"},t)?(c.A.log("testActions_room.ignoreRequest",{roomName:e.roomName,ownerUserName:t.userName,userName:n.userName},"high","cyan"),[4,P("DELETE","ignore-request",e,t,n)]):[2];case 1:return r.sent(),[2]}})})},kickout:function(e,t,n){return D(void 0,void 0,void 0,function(){return L(this,function(r){switch(r.label){case 0:return A.deleteUserRoom({roomName:e.roomName,userName:n.userName,userStatus:"member"},t)?(c.A.log("testActions_room.kickout",{roomName:e.roomName,ownerUserName:t.userName,userName:n.userName},"high","cyan"),[4,P("DELETE","kickout",e,t,n)]):[2];case 1:return r.sent(),[2]}})})}},M=x;const U={room:function(){return e=void 0,t=void 0,r=function(){var e,t,n,r,o,a,i,s,u,l;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(d){switch(d.label){case 0:for(e=4,t=3,n=[],a=0;a<e;++a)n.push({userName:"testUser_".concat(a),userType:"member",password:"testPass_".concat(a),email:"test_email_".concat(a,"@test.com")});for(r=[],a=0;a<t;++a)r.push({roomName:"testRoom ".concat(a),ownerUserName:""});a=0,d.label=1;case 1:return a<e?[4,M.initUser(n[a])]:[3,4];case 2:d.sent(),d.label=3;case 3:return++a,[3,1];case 4:o=Object.values(_),a=0,d.label=5;case 5:if(!(a<300))return[3,10];i=Math.floor(Math.random()*e),s=Math.floor(Math.random()*e),u=Math.floor(Math.random()*t),l=Math.floor(Math.random()*o.length),c.A.log("RANDOM ACTION: ".concat(a),{action:o[l].name,roomName:r[u].roomName,userName1:n[i].userName,userName2:n[s].userName},"low"),d.label=6;case 6:return d.trys.push([6,8,,9]),[4,o[l](r[u],n[i],n[s])];case 7:case 8:return d.sent(),[3,9];case 9:return++a,[3,5];case 10:return[2]}})},new((n=void 0)||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())});var e,t,n,r}};var j=n(936);f().config();var C=!1;function F(e,t){return n=this,a=void 0,s=function(){var n,a,i;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(s){switch(s.label){case 0:return C?(c.A.logRaw("TEST REJECTED (".concat(e,") - There is another test running."),"high","pink"),[2]):(c.A.logRaw("TEST STARTED (".concat(e,")"),"high"),C=!0,v._reset(),A._reset(),n=o.A.auth.bypassEmailVerification,o.A.auth.bypassEmailVerification=!0,a=c.A.getThresholdLogLevel(),c.A.setThresholdLogLevel(t),[4,r.A.runSQLFile("clear.sql")]);case 1:return s.sent(),[4,r.A.runSQLFile("init.sql")];case 2:return s.sent(),(i=U[e])?[4,i()]:(c.A.logRaw('Test routine "'.concat(e,'" not found.'),"high","pink"),C=!1,[2]);case 3:return s.sent(),c.A.setThresholdLogLevel(a),o.A.auth.bypassEmailVerification=n,C=!1,c.A.logRaw("TEST ENDED (".concat(e,")"),"high"),[2]}})},new((i=void 0)||(i=Promise))(function(e,t){function r(e){try{c(s.next(e))}catch(e){t(e)}}function o(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i(function(e){e(n)})).then(r,o)}c((s=s.apply(n,a||[])).next())});var n,a,i,s}const q=F;j.default.add("test",F)},818:e=>{e.exports=require("dotenv")},828:(e,t,n)=>{n.d(t,{A:()=>g});const r=require("crypto");var o=n.n(r);const a=require("nodemailer");var i=n.n(a),c=n(557),s=n(818),u=n.n(s),l=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})},d=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};u().config();const f={selectByEmail:function(e,t){return l(void 0,void 0,void 0,function(){return d(this,function(n){switch(n.label){case 0:return[4,c.A.makeQuery("SELECT * FROM emailVerifications WHERE email = ?;",[e]).run(t,"EmailDB.verifications.selectByEmail")];case 1:return[2,n.sent()]}})})},insert:function(e,t,n,r){return l(void 0,void 0,void 0,function(){return d(this,function(o){switch(o.label){case 0:return[4,c.A.makeQuery("INSERT INTO emailVerifications (email, verificationCode, expirationTime) VALUES (?, ?, ?);",[e,t,n.toString()]).run(r,"EmailDB.verifications.insert")];case 1:return o.sent(),[2]}})})},updateExpirationTime:function(e,t,n){return l(void 0,void 0,void 0,function(){return d(this,function(r){switch(r.label){case 0:return[4,c.A.makeQuery("UPDATE emailVerifications SET expirationTime = ? WHERE email = ?;",[t.toString(),e]).run(n,"EmailDB.verifications.updateExpirationTime")];case 1:return r.sent(),[2]}})})},deleteExpired:function(e,t){return l(void 0,void 0,void 0,function(){return d(this,function(n){switch(n.label){case 0:return[4,c.A.makeQuery("DELETE FROM emailVerifications WHERE expirationTime < ?;",[e.toString()]).run(t,"EmailDB.verifications.deleteExpired")];case 1:return n.sent(),[2]}})})}};var h=n(422),m=n(604),p=n(654),v=n(531),b=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})},y=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};u().config();const g={startEmailVerification:function(e,t){return b(void 0,void 0,void 0,function(){var n,r,a,c,s,u,l;return y(this,function(d){switch(d.label){case 0:return d.trys.push([0,9,,10]),[4,f.deleteExpired(Math.floor(.001*Date.now()),t)];case 1:return d.sent(),t.statusCode<200||t.statusCode>=300?[2]:null!=(n=h.A.findErrorInEmailAddress(e.body.email))?(m.A.log("Email Input Error",{email:e.body.email,emailError:n},"high","pink"),t.status(400).send(v.A.displayText.message[n]),[2]):[4,f.selectByEmail(e.body.email,t)];case 2:return r=d.sent(),t.statusCode<200||t.statusCode>=300?[2]:r&&r.length>0?(m.A.log("Email is already undergoing verification",{email:e.body.email},"high","pink"),t.status(403).send('Email "'.concat(e.body.email,'" is already undergoing verification.')),[2]):(a=new Array(8).fill(null).map(function(){return"0123456789".charAt(o().randomInt(10))}).join(""),[4,f.insert(e.body.email,a,Math.floor(.001*Date.now())+p.A.auth.emailVerificationTimeoutInSeconds,t)]);case 3:return d.sent(),t.statusCode<200||t.statusCode>=300?[2]:p.A.auth.bypassEmailVerification?(m.A.log("Email transmission bypassed",{email:e.body.email},"low"),t.status(201).send(a),[3,8]):[3,4];case 4:return c=i().createTransport({service:"naver",host:"smtp.naver.com",auth:{user:"pinkroom77@naver.com",pass:process.env.EMAIL_SENDER_PASS}}),s={from:"pinkroom77@naver.com",to:e.body.email,subject:"Here is your email verification code.",text:"Your verification code is ".concat(a)},[4,c.sendMail(s)];case 5:return u=d.sent(),c.close(),u.accepted?(m.A.log("Email sent",{email:e.body.email},"low"),t.sendStatus(201),[3,8]):[3,6];case 6:return m.A.log("Email failed to be sent",{email:e.body.email},"high","pink"),[4,f.updateExpirationTime(e.body.email,Math.floor(.001*Date.now())+120,t)];case 7:if(d.sent(),t.statusCode<200||t.statusCode>=300)return[2];t.status(500).send('Error while sending the verification code to "'.concat(e.body.email,'". Please try again after 2 minutes.')),d.label=8;case 8:return[3,10];case 9:return l=d.sent(),m.A.log("Email Verification Start Error",{err:l},"high","pink"),t.status(500).send("ERROR: Failed to start email verification (".concat(l,").")),[3,10];case 10:return[2]}})})},endEmailVerification:function(e,t){return b(void 0,void 0,void 0,function(){var n,r,o;return y(this,function(a){switch(a.label){case 0:return null!=(n=h.A.findErrorInEmailAddress(e.body.email))?(m.A.log("Email Input Error",{email:e.body.email,emailError:n},"high","pink"),t.status(400).send(v.A.displayText.message[n]),[2]):(r=e.body.verificationCode,[4,f.selectByEmail(e.body.email,t)]);case 1:return o=a.sent(),t.statusCode<200||t.statusCode>=300?[2]:o&&0!=o.length?o[0].verificationCode!=r?(m.A.log("Verification Code Mismatch (code entered = '".concat(r,"')"),{email:e.body.email,actualCode:o[0].verificationCode,enteredCode:r},"high","pink"),t.status(403).send('Wrong verification code for email "'.concat(e.body.email,'".')),[2]):(t.status(202),[2]):(m.A.log("No pending email verification found",{email:e.body.email},"high","pink"),t.status(404).send('No pending verification found for email "'.concat(e.body.email,'".')),[2])}})})}}},893:(e,t,n)=>{n.d(t,{A:()=>w});const r=require("jsonwebtoken");var o=n.n(r);const a=require("bcrypt");var i=n.n(a),c=n(828),s=n(951),u=n(557),l=n(818),d=n.n(l);d().config();const f=function(e,t,n,r){return o=void 0,a=void 0,c=function(){return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(o){switch(o.label){case 0:return[4,u.A.makeQuery("INSERT INTO users (userName, userType, passwordHash, email) VALUES (?, ?, ?, ?);",[e,"member",t,n]).run(r,"AuthDB.registerNewUser")];case 1:return[2,o.sent()]}})},new((i=void 0)||(i=Promise))(function(e,t){function n(e){try{s(c.next(e))}catch(e){t(e)}}function r(e){try{s(c.throw(e))}catch(e){t(e)}}function s(t){var o;t.done?e(t.value):(o=t.value,o instanceof i?o:new i(function(e){e(o)})).then(n,r)}s((c=c.apply(o,a||[])).next())});var o,a,i,c};var h=n(422),m=n(604),p=n(531),v=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})},b=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};d().config();var y="dev"==process.env.MODE,g={register:function(e,t){return v(void 0,void 0,void 0,function(){var n,r,o,a;return b(this,function(u){switch(u.label){case 0:return u.trys.push([0,7,,8]),g.validateUserNameAndPassword(e,t)?null!=(n=h.A.findErrorInEmailAddress(e.body.email))?(m.A.log("Email Input Error",{email:e.body.email,emailError:n},"high","pink"),t.status(400).send(p.A.displayText.message[n]),[2]):[4,s.A.users.withUserName(e.body.userName,t)]:[2];case 1:return r=u.sent(),t.statusCode<200||t.statusCode>=300?[2]:r&&r.length>0?(m.A.log("UserName already exists",{userName:e.body.userName,existingUser:r[0]},"high","pink"),t.status(403).send('User "'.concat(e.body.userName,'" already exists.')),[2]):[4,s.A.users.withEmail(e.body.email,t)];case 2:return r=u.sent(),t.statusCode<200||t.statusCode>=300?[2]:r&&r.length>0?(m.A.log("There is already an account with the same email",{email:e.body.email,existingUser:r[0]},"high","pink"),t.status(403).send('There is already an account with the email "'.concat(e.body.email,'".')),[2]):[4,c.A.endEmailVerification(e,t)];case 3:return u.sent(),t.statusCode<200||t.statusCode>=300?[2]:[4,i().hash(e.body.password,10)];case 4:return o=u.sent(),[4,f(e.body.userName,o,e.body.email,t)];case 5:return u.sent(),t.statusCode<200||t.statusCode>=300?[2]:[4,g.addToken(e.body.userName,t)];case 6:return u.sent(),[3,8];case 7:return a=u.sent(),m.A.log("User Registration Error",{err:a},"high","pink"),t.status(500).send("ERROR: Failed to register the user (".concat(a,").")),[3,8];case 8:return[2]}})})},login:function(e,t){return v(void 0,void 0,void 0,function(){var n,r;return b(this,function(o){switch(o.label){case 0:return o.trys.push([0,4,,5]),g.validateUserNameAndPassword(e,t)?[4,g.findExistingUserByUserName(e.body.userName,t)]:[2];case 1:return(n=o.sent())?[4,i().compare(e.body.password,n.passwordHash)]:[2];case 2:return o.sent()?[4,g.addToken(e.body.userName,t)]:(m.A.log("Wrong password",{passwordEntered:y?e.body.password:"(HIDDEN)",passwordHash:n.passwordHash},"high","pink"),t.status(401).send("Wrong password."),[2]);case 3:return o.sent(),[3,5];case 4:return r=o.sent(),m.A.log("Login Error",{err:r},"high","pink"),t.status(500).send("ERROR: Failed to login (".concat(r,").")),[3,5];case 5:return[2]}})})},validateUserNameAndPassword:function(e,t){var n=h.A.findErrorInUserName(e.body.userName);if(null!=n)return m.A.log("UserName Input Error",{userName:e.body.userName,userNameError:n},"high","pink"),t.status(400).send(p.A.displayText.message[n]),!1;var r=h.A.findErrorInPassword(e.body.password);return null==r||(m.A.log("Password Input Error",{password:y?e.body.password:"(HIDDEN)",passwordError:r},"high","pink"),t.status(400).send(p.A.displayText.message[r]),!1)},findExistingUserByUserName:function(e,t){return v(void 0,void 0,void 0,function(){var n;return b(this,function(r){switch(r.label){case 0:return[4,s.A.users.withUserName(e,t)];case 1:return n=r.sent(),t&&(t.statusCode<200||t.statusCode>=300)?[2,null]:n&&0!=n.length?[2,n[0]]:(m.A.log("User Not Found",{userName:e},"high","pink"),null==t||t.clearCookie("thingspool_token").status(404).send('There is no account with userName "'.concat(e,'".')),[2,null])}})})},getUserFromReqToken:function(e,t){void 0===t&&(t=!1);var n=e.cookies.thingspool_token;return n?g.getUserFromToken(n):(t||m.A.log("Token Not Found in Request",{},"high","pink"),null)},getUserFromToken:function(e){try{return o().verify(e,process.env.JWT_SECRET_KEY)||(m.A.log("User is not found in the given token.",{token:e},"high","pink"),null)}catch(e){return m.A.log("Token Verification Failed",{err:e},"high","pink"),null}},addToken:function(e,t){return v(void 0,void 0,void 0,function(){var n,r;return b(this,function(a){switch(a.label){case 0:return[4,g.findExistingUserByUserName(e,t)];case 1:return(n=a.sent())?(r=o().sign(n,process.env.JWT_SECRET_KEY,{expiresIn:"60m"}),null==t||t.cookie("thingspool_token",r,{secure:!y,httpOnly:!0,sameSite:"strict"}).status(201),[2]):(m.A.log("AddToken Tried, User Not Found",{userName:e},"high"),null==t||t.status(404).send('Tried to add token, but there is no account with userName "'.concat(e,'".')),[2])}})})},clearToken:function(e){e.clearCookie("thingspool_token").status(204)},authenticateToken:function(e,t,n){return v(void 0,void 0,void 0,function(){return b(this,function(r){switch(r.label){case 0:return[4,g.authenticateToken_internal(n,!1,e,t)];case 1:return r.sent(),[2]}})})},authenticateTokenOptional:function(e,t,n){return v(void 0,void 0,void 0,function(){return b(this,function(r){switch(r.label){case 0:return[4,g.authenticateToken_internal(n,!0,e,t)];case 1:return r.sent(),[2]}})})},authenticateToken_internal:function(e,t,n,r){return v(void 0,void 0,void 0,function(){var o,a;return b(this,function(i){switch(i.label){case 0:return(o=g.getUserFromReqToken(n))?[3,1]:t?(e(),[2,!0]):(m.A.logRaw("Token-Authentication Failed","high","pink"),null==r||r.status(401).send("Token-Authentication Failed (User Not Found)"),[2,!1]);case 1:return i.trys.push([1,3,,4]),[4,g.addToken(o.userName,r)];case 2:return i.sent(),n.user=o,e(),[2,!0];case 3:return a=i.sent(),t?(e(),[2,!0]):(m.A.log("Failed to add token",{err:a},"high"),null==r||r.status(401).send("Failed to add token (error: ".concat(a,")")),[2,!1]);case 4:return[2]}})})}};const w=g},928:e=>{e.exports=require("path")},936:(e,t,n)=>{n.r(t),n.d(t,{default:()=>o});var r={};const o={add:function(e,t){if(null!=r[e])throw new Error("Service with key '".concat(e,"' already exists."));r[e]=t},get:function(e){return r[e]}}},951:(e,t,n)=>{n.d(t,{A:()=>l});var r=n(557),o=n(531),a=n(818),i=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})},c=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};n.n(a)().config();var s=function(e,t){var n=o.A.search.searchLimitPerPage,r=" AND (".concat(e.map(function(e){return"roomMemberships.userStatus = '".concat(e,"'")}).join(" OR "),")");return"SELECT rooms.roomID AS roomID, rooms.roomName AS roomName, roomMemberships.userStatus as userStatus, rooms.ownerUserName as ownerUserName\n    FROM rooms INNER JOIN roomMemberships ON roomMemberships.roomID = rooms.roomID\n    WHERE roomMemberships.userID = ?".concat(e.length>0?r:"","\n    ORDER BY rooms.roomID DESC LIMIT ").concat(n,", ").concat(t*n,";")},u=function(e,t){var n=o.A.search.searchLimitPerPage,r=" AND (".concat(e.map(function(e){return"roomMemberships.userStatus = '".concat(e,"'")}).join(" OR "),")");return"SELECT users.userID as userID, users.userName AS userName, roomMemberships.userStatus as userStatus\n    FROM users INNER JOIN roomMemberships ON roomMemberships.userID = users.userID\n    WHERE roomMemberships.roomID = ?".concat(e.length>0?r:"","\n    ORDER BY users.userID DESC LIMIT ").concat(n,", ").concat(t*n,";")};const l={rooms:{withRoomName:function(e,t){return i(void 0,void 0,void 0,function(){return c(this,function(n){switch(n.label){case 0:return[4,r.A.makeQuery("SELECT * FROM rooms WHERE roomName = ?;",[e]).run(t,"SearchDB.rooms.withRoomName")];case 1:return[2,n.sent()]}})})},whichIOwn:function(e,t,n){return i(void 0,void 0,void 0,function(){return c(this,function(o){switch(o.label){case 0:return[4,r.A.makeQuery(s(["owner"],t),[e]).run(n,"SearchDB.rooms.whichIOwn")];case 1:return[2,o.sent()]}})})},whichIJoined:function(e,t,n){return i(void 0,void 0,void 0,function(){return c(this,function(o){switch(o.label){case 0:return[4,r.A.makeQuery(s(["member"],t),[e]).run(n,"SearchDB.rooms.whichIJoined")];case 1:return[2,o.sent()]}})})},whichInvitedMe:function(e,t,n){return i(void 0,void 0,void 0,function(){return c(this,function(o){switch(o.label){case 0:return[4,r.A.makeQuery(s(["invited"],t),[e]).run(n,"SearchDB.rooms.whichInvitedMe")];case 1:return[2,o.sent()]}})})},whichIRequestedToJoin:function(e,t,n){return i(void 0,void 0,void 0,function(){return c(this,function(o){switch(o.label){case 0:return[4,r.A.makeQuery(s(["requested"],t),[e]).run(n,"SearchDB.rooms.whichIRequestedToJoin")];case 1:return[2,o.sent()]}})})},whichIAmPendingToJoin:function(e,t,n){return i(void 0,void 0,void 0,function(){return c(this,function(o){switch(o.label){case 0:return[4,r.A.makeQuery(s(["invited","requested"],t),[e]).run(n,"SearchDB.rooms.whichIAmPendingToJoin")];case 1:return[2,o.sent()]}})})},whichIAmAssociatedWith:function(e,t,n){return i(void 0,void 0,void 0,function(){return c(this,function(o){switch(o.label){case 0:return[4,r.A.makeQuery(s([],t),[e]).run(n,"SearchDB.rooms.whichIAmAssociatedWith")];case 1:return[2,o.sent()]}})})},others:function(e,t,n){return i(void 0,void 0,void 0,function(){var a;return c(this,function(i){switch(i.label){case 0:return a=o.A.search.searchLimitPerPage,[4,r.A.makeQuery("SELECT roomID, roomName FROM rooms\n                WHERE NOT EXISTS (SELECT roomID FROM roomMemberships WHERE userID = ".concat(e," LIMIT 1)\n                ORDER BY roomID DESC LIMIT ").concat(a,", ").concat(t*a,";"),void 0).run(n,"SearchDB.rooms.others")];case 1:return[2,i.sent()]}})})}},users:{withUserName:function(e,t){return i(void 0,void 0,void 0,function(){return c(this,function(n){switch(n.label){case 0:return[4,r.A.makeQuery("SELECT * FROM users WHERE userName = ?;",[e]).run(t,"SearchDB.users.withUserName")];case 1:return[2,n.sent()]}})})},withEmail:function(e,t){return i(void 0,void 0,void 0,function(){return c(this,function(n){switch(n.label){case 0:return[4,r.A.makeQuery("SELECT * FROM users WHERE email = ?;",[e]).run(t,"SearchDB.users.withEmail")];case 1:return[2,n.sent()]}})})},whoJoinedRoom:function(e,t,n){return i(void 0,void 0,void 0,function(){return c(this,function(o){switch(o.label){case 0:return[4,r.A.makeQuery(u(["member"],t),[e]).run(n,"SearchDB.users.whoJoinedRoom")];case 1:return[2,o.sent()]}})})},whoAreInvitedToJoinRoom:function(e,t,n){return i(void 0,void 0,void 0,function(){return c(this,function(o){switch(o.label){case 0:return[4,r.A.makeQuery(u(["invited"],t),[e]).run(n,"SearchDB.users.whoAreInvitedToJoinRoom")];case 1:return[2,o.sent()]}})})},whoRequestedToJoinRoom:function(e,t,n){return i(void 0,void 0,void 0,function(){return c(this,function(o){switch(o.label){case 0:return[4,r.A.makeQuery(u(["requested"],t),[e]).run(n,"SearchDB.users.whoRequestedToJoinRoom")];case 1:return[2,o.sent()]}})})},whoArePendingToJoinRoom:function(e,t,n){return i(void 0,void 0,void 0,function(){return c(this,function(o){switch(o.label){case 0:return[4,r.A.makeQuery(u(["invited","requested"],t),[e]).run(n,"SearchDB.users.whoArePendingToJoinRoom")];case 1:return[2,o.sent()]}})})},whoAreAssociatedWithRoom:function(e,t,n){return i(void 0,void 0,void 0,function(){return c(this,function(o){switch(o.label){case 0:return[4,r.A.makeQuery(u([],t),[e]).run(n,"SearchDB.users.whoAreAssociatedWithRoom")];case 1:return[2,o.sent()]}})})},others:function(e,t,n){return i(void 0,void 0,void 0,function(){var a;return c(this,function(i){switch(i.label){case 0:return a=o.A.search.searchLimitPerPage,[4,r.A.makeQuery("SELECT userID, userName FROM users\n                WHERE NOT EXISTS (SELECT userID FROM roomMemberships WHERE roomID = ".concat(e," LIMIT 1)\n                ORDER BY userID DESC LIMIT ").concat(a,", ").concat(t*a,";"),void 0).run(n,"SearchDB.users.others")];case 1:return[2,i.sent()]}})})}}}}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};const r=require("express");var o=n.n(r),a=n(611),i=n.n(a);const c=require("body-parser");var s=n.n(c);const u=require("cookie-parser");var l=n.n(u);const d=require("hpp");var f=n.n(d),h=n(110),m=n(604),p=n(531),v=n(422);const b=require("ejs");var y=n.n(b),g=n(818),w=n.n(g);w().config();var E="".concat(process.env.PWD,"/").concat(process.env.VIEWS_ROOT_DIR,"/partial"),k={TextUtil:v.A,UIConfig:p.A,ejsPartialRootPath:E,isStaticPage:!0},N={TextUtil:v.A,UIConfig:p.A,ejsPartialRootPath:E,isStaticPage:!1},A={},T={render:function(e,t,n,r){t.render(n,T.makeEJSParams(e,r),function(e,n){e?t.status(500).send(e.message):(n=T.postProcessHTML(n),t.status(200).setHeader("content-type","text/html").send(n))})},postProcessHTML:function(e){return"dev"==process.env.MODE?e=e.replaceAll("\n","!*NEW_LINE*!").replace(/(PROD_CODE_BEGIN).*?(PROD_CODE_END)/g,"REMOVED_PROD_CODE").replaceAll("!*NEW_LINE*!","\n").replaceAll(process.env.ROOT_URL,"http://localhost:".concat(process.env.PORT)):e},makeEJSParams:function(e,t){var n={};return Object.assign(n,N),Object.assign(n,t),n.user&&m.A.log("'user' shouldn't be defined manually in EJS params.",{mergedEJSParams:n},"high","pink"),n.user=e.user,n.globalDictionary&&m.A.log("'globalDictionary' shouldn't be defined manually in EJS params.",{mergedEJSParams:n},"high","pink"),n.globalDictionary={},n},makeEJSParamsStatic:function(e){var t={};return Object.assign(t,k),Object.assign(t,e),t},createStaticHTMLFromEJS:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return r=void 0,o=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}([e],t,!0),i=function(e,t){var n;return void 0===t&&(t={}),function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(r){switch(r.label){case 0:return null!=(n=A[e])?[3,2]:[4,h.A.read(e,process.env.VIEWS_ROOT_DIR)];case 1:n=r.sent(),A[e]=n,r.label=2;case 2:return[2,y().compile(n)(T.makeEJSParamsStatic(t))]}})},new((a=void 0)||(a=Promise))(function(e,t){function n(e){try{s(i.next(e))}catch(e){t(e)}}function c(e){try{s(i.throw(e))}catch(e){t(e)}}function s(t){var r;t.done?e(t.value):(r=t.value,r instanceof a?r:new a(function(e){e(r)})).then(n,c)}s((i=i.apply(r,o||[])).next())});var r,o,a,i}};const S=T;w().config();const R=function(){function e(){this.lines=["</urlset>"]}return e.prototype.addEntry=function(e,t){this.lines.push("</url>"),this.lines.push("  <lastmod>".concat(t,"</lastmod>")),this.lines.push("  <loc>".concat(process.env.ROOT_URL,"/").concat(e,"</loc>")),this.lines.push("<url>")},e.prototype.build=function(){return e=this,t=void 0,r=function(){return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(e){switch(e.label){case 0:return this.lines.push('<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">'),this.lines.push('<?xml version="1.0" encoding="UTF-8"?>'),this.lines.reverse(),[4,h.A.write("sitemap.xml",this.lines.join("\n"))];case 1:return e.sent(),[2]}})},new((n=void 0)||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())});var e,t,n,r},e}();w().config();const x=function(){function e(){this.lines=["</feed>"],this.globalLatestUpdate=new Date(process.env.GLOBAL_LAST_MOD)}return e.prototype.addEntry=function(e,t,n,r){var o=new Date(n);o>this.globalLatestUpdate&&(this.globalLatestUpdate=o),this.lines.push("</entry>"),this.lines.push("  <summary>".concat(r,"</summary>")),this.lines.push("  <updated>".concat(o.toISOString(),"</updated>")),this.lines.push("  <id>".concat(e,"</id>")),this.lines.push('  <link href="'.concat(e,'"/>')),this.lines.push("  <title>".concat(t,"</title>")),this.lines.push("<entry>")},e.prototype.build=function(){return e=this,t=void 0,r=function(){return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(e){switch(e.label){case 0:return this.lines.push("<id>urn:uuid:02210672-5391-4cc8-800a-2a88f3a6d00c</id>"),this.lines.push("</author>"),this.lines.push("  <name>Youngjin Kang</name>"),this.lines.push("<author>"),this.lines.push("<updated>".concat(this.globalLatestUpdate.toISOString(),"</updated>")),this.lines.push('<link href="'.concat(process.env.ROOT_URL,'"/>')),this.lines.push('<link rel="self" type="application/atom+xml" href="'.concat(process.env.ROOT_URL,'/feed.atom"/>')),this.lines.push("<title>ThingsPool</title>"),this.lines.push('<feed xmlns="http://www.w3.org/2005/Atom">'),this.lines.push('<?xml version="1.0" encoding="utf-8"?>'),this.lines.reverse(),[4,h.A.write("feed.atom",this.lines.join("\n"))];case 1:return e.sent(),[2]}})},new((n=void 0)||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())});var e,t,n,r},e}();w().config();const I=function(){function e(){this.lines=[]}return e.prototype.addLine=function(e){this.lines.push(e)},e.prototype.prependLine=function(e){this.lines.unshift(e)},e.prototype.getText=function(){return this.lines.join("\n")},e.prototype.build=function(e,t){return n=this,r=void 0,a=function(){return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(n){switch(n.label){case 0:return null==t&&(t=process.env.STATIC_PAGE_ROOT_DIR),[4,h.A.write(e,this.lines.join("\n"),t)];case 1:return n.sent(),[2]}})},new((o=void 0)||(o=Promise))(function(e,t){function i(e){try{s(a.next(e))}catch(e){t(e)}}function c(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o(function(e){e(n)})).then(i,c)}s((a=a.apply(n,r||[])).next())});var n,r,o,a},e}();w().config();var D=function(){function e(e,t){this.sitemapBuilder=e,this.atomFeedBuilder=t}return e.prototype.build=function(e){return t=this,n=void 0,o=function(){var t,n,r,o,a,i,c,s,u,l,d,f,m,v,b,y,g,w,E;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(k){switch(k.label){case 0:return t=new I,n="".concat(e.dirName,"/page.html"),[4,h.A.read("".concat(e.dirName,"/source.txt"))];case 1:return r=k.sent(),o=r.split(/\r?\n/),a=null==e.playLinkImagePathOverride?"play.png":e.playLinkImagePathOverride,i="",c="",o[0].startsWith(":d:")?i=o[0].substring(3):console.error(":d: is missing in -> "+e.title),o[1].startsWith(":k:")?c=o[1].substring(3).toLowerCase().replaceAll("-"," "):console.error(":k: is missing in -> "+e.title),t=new I,u=(s=t).addLine,[4,S.createStaticHTMLFromEJS("partial/common/header.ejs",{menuName:"arcade",title:"ThingsPool - "+e.title,desc:i,keywords:c,relativePageURL:n,pagePathList:[{title:p.A.displayText.menuName.index,relativeURL:""},{title:p.A.displayText.menuName.arcade,relativeURL:"arcade.html"},{title:e.title,relativeURL:void 0}],backDestination_href:"".concat(process.env.ROOT_URL,"/arcade.html")})];case 2:for(u.apply(s,[k.sent()]),t.addLine("<h1>".concat(e.title,"</h1>")),t.addLine('<a class="noTextDeco" target="_blank" href="'.concat(e.playLinkURL,'">')),t.addLine('<img class="xs_image" src="'.concat(process.env.ROOT_URL,"/").concat(a,'" alt="Play">')),t.addLine("</a>"),t.addLine('<div class="zero_row"></div>'),l=1,d=[],f=function(){d.length>0&&(t.addLine("<p>".concat(d.join("<br>"),"</p>")),d.length=0)},m=2;m<o.length;++m)0==(v=(v=o[m]).trim()).length?f():v.startsWith("[")?(f(),(b=v.match(/\[(.*?)\]/)[1].trim()).length>0&&t.addLine("<h2>".concat(b,"</h2>"))):v.startsWith("<")?(f(),(y=v.match(/<(.*?)>/)[1]).length>0&&(g="".concat(process.env.ROOT_URL,"/").concat(e.dirName,"/").concat(y,".jpg"),t.addLine('<img class="m_image" src="'.concat(g,'" alt="ThingsPool - ').concat(e.title," (Screenshot ").concat(l++,')">')))):(v=v.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll("{%","<").replaceAll("%}",">"),d.push(v));return f(),null!=e.videoTag&&null!=e.videoTag&&t.addLine(e.videoTag),E=(w=t).addLine,[4,S.createStaticHTMLFromEJS("partial/common/footer.ejs")];case 3:return E.apply(w,[k.sent()]),this.sitemapBuilder.addEntry(n,e.lastmod),this.atomFeedBuilder.addEntry("".concat(process.env.ROOT_URL,"/").concat(n),e.title,e.lastmod,e.title),[4,t.build(n)];case 4:return k.sent(),[2]}})},new((r=void 0)||(r=Promise))(function(e,a){function i(e){try{s(o.next(e))}catch(e){a(e)}}function c(e){try{s(o.throw(e))}catch(e){a(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r(function(e){e(n)})).then(i,c)}s((o=o.apply(t,n||[])).next())});var t,n,r,o},e}();const L=D;w().config();var O=function(){function e(e,t){this.gameEntries=[{dirName:"ArtRaider",title:"ArtRaider",playLinkImagePathOverride:"badge_onestore.png",playLinkURL:"https://onesto.re/0001000383",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/RuLgOJrNtKA?si=Ts_Yu_jdpB1qmNiT" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>',lastmod:"2025-04-15"},{dirName:"Water-vs-Fire",title:"Water vs Fire",playLinkURL:"https://www.gamearter.com/game/water-vs-fire",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/6DeA_m8Iq4M?si=hC1uzkEtBWpYcM8z" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>',lastmod:"2023-09-10"},{dirName:"HuntLand",title:"HuntLand",playLinkURL:"https://www.gamearter.com/game/huntland",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/3dRg6vvoPqc?si=FlnKVyzQq0_55sL2" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>',lastmod:"2023-09-10"},{dirName:"PoliceChase",title:"Police Chase",playLinkURL:"https://www.gamearter.com/game/policechase",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/kABg0j2mZqQ?si=3-JUZQnh3omVXSJd" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>',lastmod:"2023-09-10"},{dirName:"SpaceTown",title:"SpaceTown",playLinkURL:"https://www.gamearter.com/game/spacetown",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/NoiQzEKJM-A?si=o8vTNqW1kxCJ4MnW" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>',lastmod:"2023-09-20"}],this.sitemapBuilder=e,this.atomFeedBuilder=t}return e.prototype.build=function(){return e=this,t=void 0,r=function(){var e,t,n,r,o,a,i,c,s,u;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(l){switch(l.label){case 0:return e=new I,n=(t=e).addLine,[4,S.createStaticHTMLFromEJS("partial/common/header.ejs",{menuName:"arcade",desc:"Games made by ThingsPool.",keywords:"thingspool, software toys, technical design, computer science, systems engineering, game design, game development",pagePathList:[{title:p.A.displayText.menuName.index,relativeURL:""},{title:p.A.displayText.menuName.arcade,relativeURL:void 0}],backDestination_href:process.env.ROOT_URL})];case 1:return n.apply(t,[l.sent()]),e.addLine("<hr>"),e.addLine("<h1>Games</h1>"),o=(r=e).addLine,[4,S.createStaticHTMLFromEJS("partial/info/gameLinks.ejs")];case 2:return o.apply(r,[l.sent()]),i=(a=e).addLine,[4,S.createStaticHTMLFromEJS("partial/common/footer.ejs")];case 3:return i.apply(a,[l.sent()]),this.sitemapBuilder.addEntry("arcade.html","2025-02-28"),[4,e.build("arcade.html")];case 4:return l.sent(),e.prependLine("\x3c!-- NOTE: This EJS file is auto-generated by 'arcadePageBuilder.ts' --\x3e"),[4,e.build("page/menu/arcade.ejs",process.env.VIEWS_ROOT_DIR)];case 5:l.sent(),c=0,s=this.gameEntries,l.label=6;case 6:return c<s.length?(u=s[c],[4,new L(this.sitemapBuilder,this.atomFeedBuilder).build(u)]):[3,9];case 7:l.sent(),l.label=8;case 8:return c++,[3,6];case 9:return[2]}})},new((n=void 0)||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())});var e,t,n,r},e}();const P=O;var _=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})},M=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};w().config();var U=function(){function e(e,t){this.sitemapBuilder=e,this.atomFeedBuilder=t}return e.prototype.build=function(e){return _(this,void 0,void 0,function(){var t,n,r,o,a,i,c,s,u,l,d,f,m,v,b,y,g,w,E,k,N,A,T,R,x,D,L=this;return M(this,function(O){switch(O.label){case 0:return t=!0,n="???",r=1,o=1,a=void 0,i=!1,c=!1,s=[],u=[],l=new I,d="A writing by ThingsPool.",f="thingspool, software, engineering, philosophy",m=process.env.GLOBAL_LAST_MOD,v=n,b=d,y=f,g=m,w=function(){s.length>0&&(i?l.addLine('<div class="snippet"><pre><code>'.concat(s.join("\n"),"</code></pre></div>")):c?l.addLine('<pre><div class="excerpt">'.concat(s.join("\n"),"</div></pre>")):l.addLine("<p>".concat(s.join("<br>"),"</p>")),s.length=0)},E=function(t,n,i,c){return _(L,void 0,void 0,function(){var s,d,f,h,m,v,b;return M(this,function(y){switch(y.label){case 0:return s="".concat(e.dirName,"/list.html"),d="".concat(e.dirName,"/page-").concat(r,".html"),f=new I,m=(h=f).addLine,[4,S.createStaticHTMLFromEJS("partial/common/header.ejs",{menuName:"library",title:t,desc:i,keywords:c,relativePageURL:d,ogImageURLOverride:a,pagePathList:[{title:p.A.displayText.menuName.index,relativeURL:""},{title:p.A.displayText.menuName.library,relativeURL:"library.html"},{title:e.title,relativeURL:s},{title:t,relativeURL:void 0}],backDestination_href:"".concat(process.env.ROOT_URL,"/").concat(s)})];case 1:return m.apply(h,[y.sent()]),f.addLine(l.getText()),b=(v=f).addLine,[4,S.createStaticHTMLFromEJS("partial/common/footer.ejs")];case 2:return b.apply(v,[y.sent()]),[4,f.build(d)];case 3:return y.sent(),l=new I,this.sitemapBuilder.addEntry(d,n),this.atomFeedBuilder.addEntry("".concat(process.env.ROOT_URL,"/").concat(d),t,n,i),u.push({pageNumber:r,title:t,lastmod:n,desc:i,keywords:c,customOGImagePath:a}),r++,o=1,a=void 0,[2]}})})},[4,h.A.read("".concat(e.dirName,"/source.txt"))];case 1:k=O.sent(),N=k.split(/\r?\n/),A=0,O.label=2;case 2:return A<N.length?(T=N[A],i||c||(T=T.trim()),0!=T.length?[3,3]:(i||c?s.push("\n"):w(),[3,7])):[3,8];case 3:return T.startsWith("[")?(w(),t||(v=n),n=T.match(/\[(.*?)\]/)[1].trim(),R=T.match(/\](.*?)$/)[1].trim(),t?[3,5]:[4,E(v,g,b,y)]):[3,6];case 4:O.sent(),b=d,y=f,g=m,O.label=5;case 5:return t=!1,l.addLine("<h1>".concat(n,"</h1>")),l.addLine('<p class="dim">Author: Youngjin Kang&nbsp;&nbsp;&nbsp;Date: '.concat(R,"</p>")),[3,7];case 6:!T.startsWith("<")||i||c?T.startsWith("@@")?l.addLine(T.substring(2)):T.startsWith("#$")?(w(),i=!i):T.startsWith('#"')?(w(),c=!c):T.startsWith(":d:")?(t||(b=d),d=T.substring(3)):T.startsWith(":k:")?(t||(y=f),f=T.substring(3).toLowerCase().replaceAll("-"," ")):T.startsWith(":l:")?(t||(g=m),m=T.substring(3)):(T=T.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll("{%","<").replaceAll("%}",">"),s.push(T)):(w(),(x=T.match(/<(.*?)>/)[1]).length>0&&(D="".concat(process.env.ROOT_URL,"/").concat(e.dirName,"/").concat(x,".jpg"),(null==a||T.endsWith("*"))&&(a=D),l.addLine('<img class="m_image" src="'.concat(D,'" alt="').concat(n.replaceAll('"',"&quot;")," (Figure ").concat(o++,')">')))),O.label=7;case 7:return++A,[3,2];case 8:return w(),[4,E(n,m,d,f)];case 9:return O.sent(),[2,u]}})})},e}();const j=U;w().config();var C=function(){function e(e,t){this.sitemapBuilder=e,this.atomFeedBuilder=t}return e.prototype.build=function(e){return t=this,n=void 0,o=function(){var t,n,r,o,a,i,c,s,u,l,d,f;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(h){switch(h.label){case 0:t=0,n=e,h.label=1;case 1:return t<n.length?(r=n[t],[4,new j(this.sitemapBuilder,this.atomFeedBuilder).build(r)]):[3,7];case 2:return o=h.sent(),a="".concat(r.dirName,"/list.html"),i=new I,s=(c=i).addLine,[4,S.createStaticHTMLFromEJS("partial/common/header.ejs",{menuName:"library",title:"ThingsPool - "+r.title,desc:r.title,keywords:"thingspool, software toys, technical design, computer science, systems engineering, game design, game development",relativePageURL:a,pagePathList:[{title:p.A.displayText.menuName.index,relativeURL:""},{title:p.A.displayText.menuName.library,relativeURL:"library.html"},{title:r.title,relativeURL:void 0}],backDestination_href:"".concat(process.env.ROOT_URL,"/library.html")})];case 3:for(s.apply(c,[h.sent()]),i.addLine("<h1>".concat(r.title,"</h1>")),u=o.length-1;u>=0;--u)l=o[u],i.addLine('<a class="postEntryButton" href="'.concat(process.env.ROOT_URL,"/").concat(r.dirName,"/page-").concat(l.pageNumber,'.html">').concat(l.title,"</a>"));return f=(d=i).addLine,[4,S.createStaticHTMLFromEJS("partial/common/footer.ejs")];case 4:return f.apply(d,[h.sent()]),[4,i.build(a)];case 5:h.sent(),this.sitemapBuilder.addEntry(a,o.sort(function(e,t){return Date.parse(t.lastmod)-Date.parse(e.lastmod)}).pop().lastmod),h.label=6;case 6:return t++,[3,1];case 7:return[2]}})},new((r=void 0)||(r=Promise))(function(e,a){function i(e){try{s(o.next(e))}catch(e){a(e)}}function c(e){try{s(o.throw(e))}catch(e){a(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r(function(e){e(n)})).then(i,c)}s((o=o.apply(t,n||[])).next())});var t,n,r,o},e}();const F=C;w().config();var q=function(){function e(e,t){this.nonfictionEntries=[{dirName:"metaphysics",title:"형이상학 (2013 - 2014)"},{dirName:"game-analysis",title:"게임분석 (2019)"},{dirName:"essays",title:"Miscellaneous Writings (2022 - 2024)"},{dirName:"blockchains",title:"On Legitimacy of Blockchains (2022)"},{dirName:"software-development",title:"Software Development (2022 - 2024)"},{dirName:"game-design",title:"Universal Laws of Game Design (2023)"},{dirName:"reality",title:"The Origin of Reality (2023)"},{dirName:"bridge-to-math",title:"A Layman's Bridge to Mathematics (2024)"},{dirName:"read-rec",title:"Recommended Readings (2024)"},{dirName:"morsels",title:"Morsels of Thought (2024)"},{dirName:"concepts-of-plan",title:"Concepts of a Plan (2025)"}],this.fictionEntries=[{dirName:"novels",title:"단편소설 (2012 - 2013)"},{dirName:"alien-job-interview",title:"Alien Job Interview (2022)"},{dirName:"infinite-treasures",title:"The Island of Infinite Treasures (2022)"},{dirName:"infsoc",title:"Influential Social Posts (2023)"},{dirName:"gamedev-journey",title:"A Game Developer's Journey (2023)"},{dirName:"sandwich",title:"Sandwich Engineering (2025)"}],this.artEntries=[{dirName:"illustrations",title:"Illustrations (2009 - 2014)"},{dirName:"cartoons",title:"Cartoons (2011 - 2015)"}],this.sitemapBuilder=e,this.atomFeedBuilder=t}return e.prototype.addPostLinks=function(e,t,n){e.addLine("<hr>"),e.addLine("<h1>".concat(t,"</h1>"));for(var r=n.length-1;r>=0;--r){var o=n[r];e.addLine('<a class="postEntryButton" href="'.concat(process.env.ROOT_URL,"/").concat(o.dirName,'/list.html">').concat(o.title,"</a>"))}},e.prototype.build=function(){return e=this,t=void 0,r=function(){var e,t,n,r,o;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(a){switch(a.label){case 0:return e=new I,n=(t=e).addLine,[4,S.createStaticHTMLFromEJS("partial/common/header.ejs",{menuName:"library",pagePathList:[{title:p.A.displayText.menuName.index,relativeURL:""},{title:p.A.displayText.menuName.library,relativeURL:void 0}],backDestination_href:process.env.ROOT_URL})];case 1:return n.apply(t,[a.sent()]),this.addPostLinks(e,"Nonfiction",this.nonfictionEntries),this.addPostLinks(e,"Fiction",this.fictionEntries),this.addPostLinks(e,"Arts",this.artEntries),o=(r=e).addLine,[4,S.createStaticHTMLFromEJS("partial/common/footer.ejs")];case 2:return o.apply(r,[a.sent()]),this.sitemapBuilder.addEntry("library.html","2025-02-28"),[4,e.build("library.html")];case 3:return a.sent(),e.prependLine("\x3c!-- NOTE: This EJS file is auto-generated by 'libraryPageBuilder.ts' --\x3e"),[4,e.build("page/menu/library.ejs",process.env.VIEWS_ROOT_DIR)];case 4:return a.sent(),[4,new F(this.sitemapBuilder,this.atomFeedBuilder).build(this.nonfictionEntries)];case 5:return a.sent(),[4,new F(this.sitemapBuilder,this.atomFeedBuilder).build(this.fictionEntries)];case 6:return a.sent(),[4,new F(this.sitemapBuilder,this.atomFeedBuilder).build(this.artEntries)];case 7:return a.sent(),[2]}})},new((n=void 0)||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())});var e,t,n,r},e}();const B=q;w().config();const Q=function(){function e(){}return e.prototype.build=function(e,t){return n=this,r=void 0,a=function(){var n,r,o,a,i;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(c){switch(c.label){case 0:return null==e&&(e="".concat(process.env.SRC_ROOT_DIR,"/shared")),null==t&&(t="".concat(process.env.VIEWS_ROOT_DIR,"/partial/embeddedScript")),[4,h.A.getAllRelativePathsInDirRecursively(e)];case 1:n=(n=c.sent()).filter(function(e){return e.endsWith(".js")}),r=0,o=n,c.label=2;case 2:return r<o.length?(a=o[r],[4,h.A.read(a,e)]):[3,6];case 3:return i=c.sent().split("\n").filter(function(e){return!e.startsWith("export ")}).join("\n").trim(),[4,h.A.write(a.replace(".js",".ejs"),'\n<%_ if (!locals.globalDictionary["script_included_('.concat(a,")\"]) { _%>\n\x3c!-- NOTE: This EJS partial is auto-generated by 'embeddedScriptBuilder.ts' --\x3e\n<%_ locals.globalDictionary[\"script_included_(").concat(a,')"] = true; _%>\n<script>\n').concat(i,"\n<\/script>\n<%_ } _%>\n").trim(),t)];case 4:c.sent(),c.label=5;case 5:return r++,[3,2];case 6:return[2]}})},new((o=void 0)||(o=Promise))(function(e,t){function i(e){try{s(a.next(e))}catch(e){t(e)}}function c(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o(function(e){e(n)})).then(i,c)}s((a=a.apply(n,r||[])).next())});var n,r,o,a},e}();var J,W,H,V="#101010",G="#303030",z="#707070",Y="#a0a0a0",$="#c0c0c0",K="#d0c090",X="#70c060",Z="#b0a070",ee="17px",te={unit:{landscape:{vertical:.6,horizontal:1},portrait:{vertical:1,horizontal:2.5}}},ne=400,re=800,oe=function(e,t,n,r,o,a){return"position: absolute;\n\tdisplay: block;\n\tleft: ".concat(e,"%;\n\tright: ").concat(t,"%;\n\ttop: ").concat(n,"%;\n\tbottom: ").concat(r,"%;\n\twidth: ").concat(o,"%;\n\theight: ").concat(a,"%;")},ae=function(e,t){return"position: relative;\n\tdisplay: ".concat(e?"block":"inline-block",";\n\tmax-width: ").concat(t,";")},ie=function(e){return"position: relative;\n\tdisplay: ".concat(e?"block":"inline-block",";\n\tmax-width: none;\n\twidth: fit-content;\n\tblock-size: fit-content;")},ce=function(e,t,n,r,o){void 0===r&&(r=!1),void 0===o&&(o=!1);var a=te.unit[e?"landscape":"portrait"],i=(a.vertical*t).toFixed(2),c=(a.horizontal*n).toFixed(2),s=o?"0":"".concat(i,"%"),u=o?"0":"".concat(c,"%"),l=r?"0":"".concat(i,"%"),d=r?"0":"".concat(c,"%");return"padding: ".concat(s," ").concat(u," ").concat(s," ").concat(u,";\n\tmargin: ").concat(l," ").concat(d," ").concat(l," 0;")},se=function(e,t,n){return"font-size: ".concat(e,';\n\tfont-family: "Lucida Console", "Lucida Sans Typewriter", "Monaco", Consolas, monospace;\n\tfont-style: ').concat(t?"italic":"normal",";\n\tfont-weight: ").concat(n,";")},ue=function(e,t,n){return void 0===n&&(n=1),"background-color: ".concat(e,";\n\tcolor: ").concat(t,";").concat(n<1?"\n\topacity: ".concat(n,";"):"")},le=function(e,t,n){return void 0===n&&(n=1),ue(e,t,n)+"\n\tborder-radius: 4.5vmin;"},de=function(e,t,n,r,o){return void 0===r&&(r="1.25"),void 0===o&&(o=1),le(e,t,o)+"\n"+"\tborder-bottom: ".concat(r,"vmin ").concat(n," solid;")+"\n"+"\tborder-right: ".concat(r,"vmin ").concat(n," solid;")},fe=function(e,t,n,r,o){return void 0===r&&(r="1.25"),void 0===o&&(o=1),le(e,t,o)+"\n"+"\tborder: ".concat(r,"vmin ").concat(n," solid;")},he=oe(0,0,0,0,100,100),me=oe(0,86,0,0,14,100),pe=oe(0,0,0,88,100,12),ve=oe(14,5,0,0,81,100),be=oe(0,2.5,12,0,95,88),ye=oe(0,0,0,86,100,14),ge=oe(0,0,14,0,100,80),we=oe(0,0,0,35,100,65),Ee=oe(0,0,65,0,100,35),ke=function(e){return 2*te.unit[e?"landscape":"portrait"].horizontal},Ne=function(e){return ae(!0,"".concat(100..toFixed(2),"%"))},Ae=function(e){return ae(!0,"1%")},Te=function(e){return ie(!0)},Se=function(e){return ae(!1,"".concat((66-ke(e)).toFixed(2),"%"))},Re=function(e){return ae(!1,"".concat((50-ke(e)).toFixed(2),"%"))},xe=function(e){return ie(!1)},Ie=function(e){return ce(e,1,1)},De=function(e){return ce(e,2,1)},Le=function(e){return ce(e,4,1)},Oe=function(e){return ce(e,2,1,!1,!0)},Pe=function(e){return ce(e,4,1,!1,!0)},_e="min(".concat(1.8199999999999998.toFixed(2),"vmax, ").concat(16..toFixed(2),"px)"),Me="min(".concat(2.1839999999999997.toFixed(2),"vmax, ").concat(19.2.toFixed(2),"px)"),Ue="min(".concat(2.6207999999999996.toFixed(2),"vmax, ").concat(23.04.toFixed(2),"px)"),je="min(".concat(3.1449599999999998.toFixed(2),"vmax, ").concat(27.648.toFixed(2),"px)"),Ce="min(".concat(3.7739519999999995.toFixed(2),"vmax, ").concat(33.1776.toFixed(2),"px)"),Fe=se(_e,!1,ne),qe=se(_e,!0,ne),Be=se(_e,!1,re),Qe=(se(Me,!0,ne),se(Me,!0,re)),Je=(se(Ue,!0,ne),se(Ue,!0,re)),We=(se(je,!0,ne),se(je,!0,re)),He=(se(Ce,!0,ne),se(Ce,!0,re)),Ve="opacity: 0;",Ge=ue("#000000",$,.7),ze=de(K,G,Z,"1.25"),Ye=ue("#000000",$,.7),$e=de(G,Y,$,"1.25"),Ke=ue(G,$),Xe=(J=$,void 0===W&&(W="1.25"),void 0===H&&(H=1),ue(G,$,H)+"\n"+"\tborder-bottom: ".concat(W,"vmin ").concat(J," solid;")),Ze=ue(G,Y),et=ue(Y,G),tt=ue(G,z),nt=ue(G,K),rt=ue(G,Z),ot=de(G,Y,Y),at=le(G,$),it=le(V,X),ct=le(V,X),st=de(V,Y,z,"0.5"),ut=de(z,$,Y,"0.25"),lt=fe(G,$,z,"0.1"),dt=fe(Y,$,$,"0.1"),ft=function(e){return"\n@supports(-moz-appearance:none) {\n\t* {\n\t\tscrollbar-width: ".concat(e?"auto":"none",";\n\t\tscrollbar-color: ").concat(z," ").concat(V,";\n\t}\n}\n::-webkit-scrollbar {\n\twidth: ").concat(e?ee:"0",";\n\theight: ").concat(e?ee:"0",";\n}\n::-webkit-scrollbar-track {\n\tbackground: ").concat(V,";\n}\n::-webkit-scrollbar-thumb {\n\tbackground: ").concat(z,";\n\tborder-radius: ").concat("8px",";\n\tborder: ").concat("4px"," solid ").concat(V,";\n}\n::-webkit-scrollbar-thumb:hover {\n\tbackground: ").concat(Y,";\n}\niframe {\n\t").concat(Ne(),"\n\t").concat(Oe(e),"\n\t").concat(Je,"\n\t").concat(Ze,"\n}\np {\n\t").concat(Ne(),"\n\t").concat(Pe(e),"\n\t").concat(Fe,"\n\t").concat(Ke,"\n}\nh3 {\n\t").concat(Ne(),"\n\t").concat(Pe(e),"\n\t").concat(Qe,"\n\t").concat(rt,"\n}\nh2 {\n\t").concat(Ne(),"\n\t").concat(Pe(e),"\n\t").concat(We,"\n\t").concat(tt,"\n}\nh1 {\n\t").concat(Ne(),"\n\t").concat(Pe(e),"\n\t").concat(He,"\n\t").concat(nt,"\n}\nhr {\n\t").concat(Ne(),"\n\t").concat(Oe(e),"\n\t").concat(Ke,"\n}\n.fullscreenBar {\n\t").concat(e?me:pe,"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t").concat(Qe,"\n\t").concat(et,"\n\ttext-align: ").concat("center",";\n\tz-index: 1;\n\toverflow: hidden;\n}\n.fullscreenPanel {\n\t").concat(e?ve:be,"\n\tmargin: 0 0 0 0;\n\tpadding: 0 ").concat(2.5,"% 0 ").concat(2.5,"%;\n\t").concat(Je,"\n\t").concat(Ze,"\n\toverflow-y: scroll;\n\toverflow-x: auto;\n}\n.fullscreenBarLogo {\n\t").concat(e?ye:we,"\n}\n.fullscreenBarLogoImage {\n\tposition: relative;\n\tdisplay: block;\n\tmax-width: 80%;\n\tmax-height: 70%;\n\tmargin: auto;\n  \ttop: 50%;\n  \t-ms-transform: translateY(-50%);\n  \ttransform: translateY(-50%);\n}\n.fullscreenBarMenu {\n\t").concat(e?ge:Ee,"\n}\n.fullscreenBarMenuButton {\n\tposition: relative;\n\tdisplay: ").concat(e?"block":"inline-block",";\n\t").concat(e?"width: 100%;":"top: 100%; -ms-transform: translateY(-100%); transform: translateY(-100%);","\n\tmax-height: 100%;\n\t").concat(e?function(e){return ce(e,4,1,!0,!1)}(e):function(e){return ce(e,1,1,!0,!1)}(e),"\n\tbox-sizing: border-box;\n\ttext-decoration: none;\n}\n.fullscreenBarMenuButton.idle {\n\t").concat(et,"\n}\n.fullscreenBarMenuButton.selected {\n\t").concat(Ze,"\n}\n.fullscreenBarMenuButton.idle:hover {\n\tcolor: ").concat(K,";\n}\n.fullscreenBarMenuButton.selected:hover {\n\tcolor: ").concat(K,";\n}\n.loadingScreen {\n\t").concat(he,"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\tz-index: 900;\n\n\t.background {\n\t\t").concat(he,"\n\t\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t\t").concat(Ge,"\n\t}\n\t.content {\n\t\tposition: absolute;\n\t\tmin-width: 50%;\n\t\ttop: 50%;\n\t\tleft: 50%;\n\t\ttransform: translate(-50%, -50%);\n\t\t").concat(He,"\n\t\t").concat(Le(e),"\n\t\t").concat(ze,"\n\t\ttext-align: center;\n\t\tz-index: 901;\n\t}\n}\n.popupScreen {\n\t").concat(he,"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\tz-index: 500;\n\n\t.background {\n\t\t").concat(he,"\n\t\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t\t").concat(Ye,"\n\t}\n\t.content {\n\t\tposition: absolute;\n\t\twidth: 80%;\n\t\twidth: 80%;\n\t\ttop: 50%;\n\t\tleft: 50%;\n\t\ttransform: translate(-50%, -50%);\n\t\t").concat(Fe,"\n\t\t").concat(De(e),"\n\t\t").concat($e,"\n\t\toverflow-y: scroll;\n\t\tz-index: 501;\n\t}\n}\n.xs_image {\n\t").concat(e?function(e){return ae(!1,"".concat((25-ke(e)).toFixed(2),"%"))}(e):Re(e),"\n\t").concat(Oe(e),"\n\t").concat(Je,"\n\t").concat(Ze,"\n}\n.s_image {\n\t").concat(e?function(e){return ae(!1,"".concat((33-ke(e)).toFixed(2),"%"))}(e):Se(e),"\n\t").concat(Oe(e),"\n\t").concat(Je,"\n\t").concat(at,"\n}\n.m_image {\n\t").concat(e?Se(e):ae(!1,"".concat(100..toFixed(2),"%")),"\n\t").concat(Oe(e),"\n\t").concat(Je,"\n\t").concat(at,"\n}\n.m_linkImage {\n\t").concat(e?Re(e):ae(!1,"".concat(98..toFixed(2),"%")),"\n\t").concat(Oe(e),"\n\t").concat(Je,"\n\t").concat(ot,"\n}\n.m_linkImage:hover {\n\tborder-color: ").concat(K,";\n}\n.postEntryButton {\n\t").concat(Te(),"\n\t").concat(Ie(e),"\n\t").concat(Be,"\n\t").concat(st,"\n\ttext-decoration: none;\n}\n.pagePath {\n\t").concat(function(e){return ce(e,1,1,!1,!0)}(e),"\n\t").concat(Fe,"\n}\n.listScrollPanel {\n\t").concat((t="".concat(100..toFixed(2),"%"),n="".concat(70..toFixed(2),"%"),"position: relative;\n\tdisplay: ".concat("block",";\n\twidth: ").concat(t,";\n\theight: ").concat(n,";")),"\n\t").concat(Ie(e),"\n\t").concat(lt,"\n\toverflow: auto;\n}\n.listItem {\n\t").concat(Te(),"\n\t").concat(Ie(e),"\n\t").concat(Fe,"\n\t").concat(dt,"\n\ttext-decoration: none;\n}\n.inlineTextInput {\n\t").concat(e?xe():Te(),"\n\t").concat(Ie(e),"\n\t").concat(Fe,"\n\t").concat(ut,"\n}\n.inlineLabel {\n\t").concat(xe(),"\n\t").concat(Ie(e),"\n\t").concat(Fe,"\n\t").concat(Ze,"\n}\n.inlineButton {\n\t").concat(xe(),"\n\t").concat(Ie(e),"\n\t").concat(Fe,"\n\t").concat(st,"\n\ttext-decoration: none;\n}\n.inlineButton:hover {\n\tcolor: ").concat(K,";\n\tcursor: pointer;\n}\n.inlineButton:disabled {\n\topacity: 0.25;\n\tcursor: not-allowed;\n}\n.inlineTabButton {\n\t").concat(xe(),"\n\t").concat(Ie(e),"\n\t").concat(Fe,"\n\ttext-decoration: none;\n}\n.inlineTabButton.idle {\n\t").concat(Ke,"\n}\n.inlineTabButton.selected {\n\t").concat(Xe,"\n}\n.inlineTabButton.idle:hover {\n\tcolor: ").concat(K,";\n}\n.inlineTabButton.selected:hover {\n\tcolor: ").concat(K,";\n}\n.snippet {\n\t").concat(Te(),"\n\t").concat(De(e),"\n\t").concat(Be,"\n\t").concat(it,"\n\twhite-space: nowrap;\n}\n.excerpt {\n\t").concat(Ne(),"\n\t").concat(De(e),"\n\t").concat(qe,"\n\t").concat(ct,"\n\twhite-space: pre-wrap;\n\twhite-space: -moz-pre-wrap;\n\twhite-space: -pre-wrap;\n\twhite-space: -o-pre-wrap;\n\tword-wrap: break-word;\n}\n.zero_row {\n\t").concat(Ae(),"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t").concat(Ve,"\n}\n.xs_row {\n\t").concat(Ae(),"\n\t").concat(function(e){return ce(e,.5,1)}(e),"\n\t").concat(Ve,"\n}\n.s_row {\n\t").concat(Ae(),"\n\t").concat(Ie(e),"\n\t").concat(Ve,"\n}\n.m_row {\n\t").concat(Ae(),"\n\t").concat(De(e),"\n\t").concat(Ve,"\n}\n.l_row {\n\t").concat(Ae(),"\n\t").concat(function(e){return ce(e,3,1)}(e),"\n\t").concat(Ve,"\n}\n.xl_row {\n\t").concat(Ae(),"\n\t").concat(Le(e),"\n\t").concat(Ve,"\n}\n");var t,n};const ht="* {\n\toverflow: hidden;\n\tvertical-align: middle;\n}\nbody {\n\t".concat(he,"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t").concat(Fe,"\n\t").concat(Ke,"\n\ttext-align: ").concat("left",";\n\tz-index: 0;\n}\na:link {\n  color: ").concat(Y,";\n}\na:visited {\n  color: ").concat(Y,";\n}\na:hover {\n  color: ").concat(K,";\n}\na:active {\n  color: ").concat(Y,";\n}\n.dim {\n\t").concat(tt,"\n}\n.noTextDeco {\n\ttext-decoration: none;\n}\n\n@media (orientation: landscape) {\n\t").concat(ft(!0),"\n}\n\n@media (orientation: portrait) {\n\t").concat(ft(!1),"\n}");function mt(){return e=this,t=void 0,r=function(){var e,t,n,r,o,a,i,c,s,u,l,d,f,m,p;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(v){switch(v.label){case 0:return console.log("SSG START"),e=new R,t=new x,n=new I,o=(r=n).addLine,[4,S.createStaticHTMLFromEJS("page/menu/index.ejs",{isStaticPage:!0,user:void 0,loginDestination:""})];case 1:return o.apply(r,[v.sent()]),[4,n.build("index.html")];case 2:return v.sent(),n=new I,i=(a=n).addLine,[4,S.createStaticHTMLFromEJS("page/menu/rooms.ejs",{isStaticPage:!0,user:void 0,loginDestination:""})];case 3:return i.apply(a,[v.sent()]),[4,n.build("rooms.html")];case 4:return v.sent(),n=new I,s=(c=n).addLine,[4,S.createStaticHTMLFromEJS("page/misc/portfolio.ejs",{})];case 5:return s.apply(c,[v.sent()]),[4,n.build("portfolio.html")];case 6:return v.sent(),n=new I,l=(u=n).addLine,[4,S.createStaticHTMLFromEJS("page/misc/portfolio_minimal.ejs",{})];case 7:return l.apply(u,[v.sent()]),[4,n.build("portfolio_minimal.html")];case 8:return v.sent(),n=new I,f=(d=n).addLine,[4,S.createStaticHTMLFromEJS("page/misc/privacyPolicy.ejs",{})];case 9:return f.apply(d,[v.sent()]),[4,n.build("privacy-policy.html")];case 10:return v.sent(),n=new I,p=(m=n).addLine,[4,S.createStaticHTMLFromEJS("page/misc/termsOfService.ejs",{})];case 11:return p.apply(m,[v.sent()]),[4,n.build("terms-of-service.html")];case 12:return v.sent(),[4,new P(e,t).build()];case 13:return v.sent(),[4,new B(e,t).build()];case 14:return v.sent(),[4,e.build()];case 15:return v.sent(),[4,t.build()];case 16:return v.sent(),[4,h.A.write("style.css",ht)];case 17:return v.sent(),[4,(new Q).build()];case 18:return v.sent(),console.log("SSG END"),[2]}})},new((n=void 0)||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())});var e,t,n,r}w().config();var pt=n(557),vt=n(928),bt=n.n(vt),yt=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})},gt=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};w().config();const wt=function(e,t,n){return yt(void 0,void 0,void 0,function(){return gt(this,function(r){switch(r.label){case 0:return[4,pt.A.makeQuery("SELECT rooms.*\n            FROM rooms INNER JOIN roomMemberships ON roomMemberships.roomID = rooms.roomID\n            WHERE rooms.roomID = ? AND roomMemberships.userID = ? AND\n                (roomMemberships.userStatus = 'member' OR roomMemberships.userStatus = 'owner');",[e,t]).run(n,"RoomDB.getRoomContent")];case 1:return[2,r.sent()]}})})},Et=function(e,t,n){return yt(void 0,void 0,void 0,function(){return gt(this,function(r){switch(r.label){case 0:return[4,pt.A.makeTransaction([pt.A.makeQuery("INSERT INTO rooms (roomName, ownerUserName) VALUES (?, ?);",[e,t]),pt.A.makeQuery("INSERT INTO roomMemberships (roomID, userID, userStatus)\n                VALUES (LAST_INSERT_ID(), (SELECT userID FROM users WHERE userName = ?), 'owner');",[t]),pt.A.makeQuery("UPDATE users SET ownedRoomCount = ownedRoomCount + 1\n                WHERE userName = ? AND ownedRoomCount < ownedRoomCountMax;",[t])]).run(n,"RoomDB.createRoom")];case 1:return r.sent(),[2]}})})},kt=function(e,t,n){return yt(void 0,void 0,void 0,function(){return gt(this,function(r){switch(r.label){case 0:return[4,pt.A.makeTransaction([pt.A.makeQuery("UPDATE users SET ownedRoomCount = ownedRoomCount - 1\n                WHERE userID = ? AND ownedRoomCount > 0;",[t]),pt.A.makeQuery("DELETE FROM rooms WHERE roomID = ? AND ownerUserName = ?;",[e,t]),pt.A.makeQuery("DELETE FROM roomMemberships WHERE roomID = ?;",[e])]).run(n,"RoomDB.deleteRoom")];case 1:return[2,r.sent()]}})})},Nt=function(e,t,n){return yt(void 0,void 0,void 0,function(){return gt(this,function(r){switch(r.label){case 0:return[4,pt.A.makeQuery("DELETE FROM roomMemberships\n            WHERE roomID = ? AND userID = ? AND userStatus = 'member';",[e,t]).run(n,"RoomDB.leaveRoom")];case 1:return r.sent(),[2]}})})},At=function(e,t,n){return yt(void 0,void 0,void 0,function(){return gt(this,function(r){switch(r.label){case 0:return[4,pt.A.makeQuery("UPDATE roomMemberships SET userStatus = 'member'\n            WHERE roomID = ? AND userID = ? userStatus = 'invited';",[e,t]).run(n,"RoomDB.acceptInvitation")];case 1:return r.sent(),[2]}})})},Tt=function(e,t,n){return yt(void 0,void 0,void 0,function(){return gt(this,function(r){switch(r.label){case 0:return[4,pt.A.makeQuery("DELETE FROM roomMemberships\n            WHERE roomID = ? AND userID = ? AND userStatus = 'invited';",[e,t]).run(n,"RoomDB.ignoreInvitation")];case 1:return r.sent(),[2]}})})},St=function(e,t,n){return yt(void 0,void 0,void 0,function(){return gt(this,function(r){switch(r.label){case 0:return[4,pt.A.makeQuery("INSERT INTO roomMemberships (roomID, userID, userStatus)\n            VALUES (?, ?, 'requested');",[e,t]).run(n,"RoomDB.requestToJoin")];case 1:return r.sent(),[2]}})})},Rt=function(e,t,n){return yt(void 0,void 0,void 0,function(){return gt(this,function(r){switch(r.label){case 0:return[4,pt.A.makeQuery("DELETE FROM roomMemberships\n            WHERE roomID = ? AND userID = ? AND userStatus = 'requested';",[e,t]).run(n,"RoomDB.cancelRequest")];case 1:return r.sent(),[2]}})})},xt=function(e,t,n,r){return yt(void 0,void 0,void 0,function(){return gt(this,function(o){switch(o.label){case 0:return[4,pt.A.makeQuery("INSERT INTO roomMemberships (roomID, userID, userStatus)\n            VALUES (?, ?, 'invited')\n            WHERE EXISTS (\n                SELECT roomID FROM rooms WHERE roomID = ? AND ownerUserName = ? LIMIT 1\n            );",[e,n,e,t]).run(r,"RoomDB.invite")];case 1:return o.sent(),[2]}})})},It=function(e,t,n,r){return yt(void 0,void 0,void 0,function(){return gt(this,function(o){switch(o.label){case 0:return[4,pt.A.makeQuery("DELETE FROM roomMemberships\n            WHERE roomID = ? AND userID = ? AND userStatus = 'invited' AND EXISTS (\n                SELECT roomID FROM rooms WHERE roomID = ? AND ownerUserName = ? LIMIT 1\n            );",[e,n,e,t]).run(r,"RoomDB.cancelInvite")];case 1:return o.sent(),[2]}})})},Dt=function(e,t,n,r){return yt(void 0,void 0,void 0,function(){return gt(this,function(o){switch(o.label){case 0:return[4,pt.A.makeQuery("UPDATE roomMemberships SET userStatus = 'member'\n            WHERE roomID = ? AND userID = ? userStatus = 'requested' AND EXISTS (\n                SELECT roomID FROM rooms WHERE roomID = ? AND ownerUserName = ? LIMIT 1\n            );",[e,n,e,t]).run(r,"RoomDB.acceptRequest")];case 1:return o.sent(),[2]}})})},Lt=function(e,t,n,r){return yt(void 0,void 0,void 0,function(){return gt(this,function(o){switch(o.label){case 0:return[4,pt.A.makeQuery("DELETE FROM roomMemberships\n            WHERE roomID = ? AND userID = ? AND userStatus = 'requested' AND EXISTS (\n                SELECT roomID FROM rooms WHERE roomID = ? AND ownerUserName = ? LIMIT 1\n            );",[e,n,e,t]).run(r,"RoomDB.ignoreRequest")];case 1:return o.sent(),[2]}})})},Ot=function(e,t,n,r){return yt(void 0,void 0,void 0,function(){return gt(this,function(o){switch(o.label){case 0:return[4,pt.A.makeQuery("DELETE FROM roomMemberships\n            WHERE roomID = ? AND userID = ? AND userStatus = 'member' AND EXISTS (\n                SELECT roomID FROM rooms WHERE roomID = ? AND ownerUserName = ? LIMIT 1\n            );",[e,n,e,t]).run(r,"RoomDB.kickout")];case 1:return o.sent(),[2]}})})};var Pt=n(893),_t=o().Router();_t.get("/",Pt.A.authenticateTokenOptional,function(e,t){S.render(e,t,"page/menu/index",{loginDestination:""})}),_t.get("/rooms",Pt.A.authenticateTokenOptional,function(e,t){S.render(e,t,"page/menu/rooms",{loginDestination:"rooms",tabName:e.query.tabname?e.query.tabname:"owned"})}),_t.get("/arcade",function(e,t){S.render(e,t,"page/menu/arcade",{})}),_t.get("/library",function(e,t){S.render(e,t,"page/menu/library",{})}),_t.get("/admin",Pt.A.authenticateToken,function(e,t){var n=e.user;n&&"admin"==n.userType?S.render(e,t,"page/menu/admin",{}):t.status(403).send("Only the admin can access this page.")}),_t.get("/register",function(e,t){S.render(e,t,"page/form/register",{registerDestination:""})}),_t.get("/room",Pt.A.authenticateToken,function(e,t){return n=void 0,r=void 0,a=function(){var n,r,o;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(a){switch(a.label){case 0:return(n=e.user)?[4,wt(e.query.roomid,n.userID,t)]:(t.status(404).send("User not found."),[2]);case 1:return r=a.sent(),t.statusCode<200||t.statusCode>=300||(o=r[0],S.render(e,t,"page/private/room",{roomID:e.query.roomid,roomContent:o,title:o.roomName,desc:o.roomName,keywords:void 0})),[2]}})},new((o=void 0)||(o=Promise))(function(e,t){function i(e){try{s(a.next(e))}catch(e){t(e)}}function c(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o(function(e){e(n)})).then(i,c)}s((a=a.apply(n,r||[])).next())});var n,r,o,a}),_t.get("/console",Pt.A.authenticateToken,function(e,t){var n=e.user;n&&"admin"==n.userType?S.render(e,t,"page/misc/console",{}):t.status(403).send("Only the admin can access this page.")}),_t.get("/test-ui",function(e,t){S.render(e,t,"page/misc/test_ui",{loginDestination:"",registerDestination:""})});const Mt=_t;var Ut=o().Router();Ut.get("/create-room",Pt.A.authenticateToken,function(e,t){S.render(e,t,"popup/createRoom",{})}),Ut.get("/room-members",Pt.A.authenticateToken,function(e,t){return n=void 0,r=void 0,a=function(){return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(n){return S.render(e,t,"popup/roomMembers",{roomID:e.query.roomid,tabName:e.query.tabname?e.query.tabname:"associated"}),[2]})},new((o=void 0)||(o=Promise))(function(e,t){function i(e){try{s(a.next(e))}catch(e){t(e)}}function c(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o(function(e){e(n)})).then(i,c)}s((a=a.apply(n,r||[])).next())});var n,r,o,a});const jt=Ut;var Ct=n(828);const Ft=function(e,t){void 0===t&&(t=void 0),e.statusCode>=200&&e.statusCode<=299&&(t?e.json(t):e.end())};var qt=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})},Bt=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},Qt=o().Router();Qt.post("/register",function(e,t){return qt(void 0,void 0,void 0,function(){return Bt(this,function(n){switch(n.label){case 0:return[4,Pt.A.register(e,t)];case 1:return n.sent(),Ft(t),[2]}})})}),Qt.post("/vemail",function(e,t){return qt(void 0,void 0,void 0,function(){return Bt(this,function(n){switch(n.label){case 0:return[4,Ct.A.startEmailVerification(e,t)];case 1:return n.sent(),Ft(t),[2]}})})}),Qt.post("/login",function(e,t){return qt(void 0,void 0,void 0,function(){return Bt(this,function(n){switch(n.label){case 0:return[4,Pt.A.login(e,t)];case 1:return n.sent(),Ft(t),[2]}})})}),Qt.delete("/logout",function(e,t){Pt.A.clearToken(t),Ft(t)});const Jt=Qt;var Wt=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})},Ht=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},Vt=o().Router(),Gt=function(e,t){return e.user||(t.status(404).send("User not found."),null)};Vt.post("/create",Pt.A.authenticateToken,function(e,t){return Wt(void 0,void 0,void 0,function(){var n,r;return Ht(this,function(o){switch(o.label){case 0:return(n=Gt(e,t))?null!=(r=v.A.findErrorInRoomName(e.body.roomName))?(m.A.log("UserName Input Error",{userName:e.body.roomName,roomNameError:r},"high","pink"),t.status(400).send(p.A.displayText.message[r]),[2]):[4,Et(e.body.roomName,n.userName,t)]:[2];case 1:return o.sent(),Ft(t),[2]}})})}),Vt.delete("/delete",Pt.A.authenticateToken,function(e,t){return Wt(void 0,void 0,void 0,function(){var n;return Ht(this,function(r){switch(r.label){case 0:return(n=Gt(e,t))?[4,kt(e.body.roomID,n.userName,t)]:[2];case 1:return r.sent(),Ft(t),[2]}})})}),Vt.delete("/leave",Pt.A.authenticateToken,function(e,t){return Wt(void 0,void 0,void 0,function(){var n;return Ht(this,function(r){switch(r.label){case 0:return(n=Gt(e,t))?[4,Nt(e.body.roomID,n.userName,t)]:[2];case 1:return r.sent(),Ft(t),[2]}})})}),Vt.put("/accept-invitation",Pt.A.authenticateToken,function(e,t){return Wt(void 0,void 0,void 0,function(){var n;return Ht(this,function(r){switch(r.label){case 0:return(n=Gt(e,t))?[4,At(e.body.roomID,n.userID,t)]:[2];case 1:return r.sent(),Ft(t),[2]}})})}),Vt.delete("/ignore-invitation",Pt.A.authenticateToken,function(e,t){return Wt(void 0,void 0,void 0,function(){var n;return Ht(this,function(r){switch(r.label){case 0:return(n=Gt(e,t))?[4,Tt(e.body.roomID,n.userID,t)]:[2];case 1:return r.sent(),Ft(t),[2]}})})}),Vt.post("/request-to-join",Pt.A.authenticateToken,function(e,t){return Wt(void 0,void 0,void 0,function(){var n;return Ht(this,function(r){switch(r.label){case 0:return(n=Gt(e,t))?[4,St(e.body.roomID,n.userID,t)]:[2];case 1:return r.sent(),Ft(t),[2]}})})}),Vt.delete("/cancel-request",Pt.A.authenticateToken,function(e,t){return Wt(void 0,void 0,void 0,function(){var n;return Ht(this,function(r){switch(r.label){case 0:return(n=Gt(e,t))?[4,Rt(e.body.roomID,n.userID,t)]:[2];case 1:return r.sent(),Ft(t),[2]}})})}),Vt.post("/invite",Pt.A.authenticateToken,function(e,t){return Wt(void 0,void 0,void 0,function(){var n;return Ht(this,function(r){switch(r.label){case 0:return(n=Gt(e,t))?[4,xt(e.body.roomID,n.userName,e.body.userID,t)]:[2];case 1:return r.sent(),Ft(t),[2]}})})}),Vt.delete("/cancel-invite",Pt.A.authenticateToken,function(e,t){return Wt(void 0,void 0,void 0,function(){var n;return Ht(this,function(r){switch(r.label){case 0:return(n=Gt(e,t))?[4,It(e.body.roomID,n.userName,e.body.userID,t)]:[2];case 1:return r.sent(),Ft(t),[2]}})})}),Vt.put("/accept-request",Pt.A.authenticateToken,function(e,t){return Wt(void 0,void 0,void 0,function(){var n;return Ht(this,function(r){switch(r.label){case 0:return(n=Gt(e,t))?[4,Dt(e.body.roomID,n.userName,e.body.userID,t)]:[2];case 1:return r.sent(),Ft(t),[2]}})})}),Vt.delete("/ignore-request",Pt.A.authenticateToken,function(e,t){return Wt(void 0,void 0,void 0,function(){var n;return Ht(this,function(r){switch(r.label){case 0:return(n=Gt(e,t))?[4,Lt(e.body.roomID,n.userName,e.body.userID,t)]:[2];case 1:return r.sent(),Ft(t),[2]}})})}),Vt.delete("/kickout",Pt.A.authenticateToken,function(e,t){return Wt(void 0,void 0,void 0,function(){var n;return Ht(this,function(r){switch(r.label){case 0:return(n=Gt(e,t))?[4,Ot(e.body.roomID,n.userName,e.body.userID,t)]:[2];case 1:return r.sent(),Ft(t),[2]}})})});const zt=Vt;var Yt=n(951),$t=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})},Kt=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},Xt=o().Router(),Zt=function(e,t){var n=e.user;if(!n)return t.status(404).send("User not found."),null;var r=parseInt(e.query.page);return isNaN(r)?(t.status(400).send("Invalid page number."),null):{user:n,page:r}};Xt.get("/rooms/owned",Pt.A.authenticateToken,function(e,t){return $t(void 0,void 0,void 0,function(){var n,r;return Kt(this,function(o){switch(o.label){case 0:return(n=Zt(e,t))?[4,Yt.A.rooms.whichIOwn(n.user.userID,n.page,t)]:[2];case 1:return r=o.sent(),Ft(t,r),[2]}})})}),Xt.get("/rooms/joined",Pt.A.authenticateToken,function(e,t){return $t(void 0,void 0,void 0,function(){var n,r;return Kt(this,function(o){switch(o.label){case 0:return(n=Zt(e,t))?[4,Yt.A.rooms.whichIJoined(n.user.userID,n.page,t)]:[2];case 1:return r=o.sent(),Ft(t,r),[2]}})})}),Xt.get("/rooms/invited",Pt.A.authenticateToken,function(e,t){return $t(void 0,void 0,void 0,function(){var n,r;return Kt(this,function(o){switch(o.label){case 0:return(n=Zt(e,t))?[4,Yt.A.rooms.whichInvitedMe(n.user.userID,n.page,t)]:[2];case 1:return r=o.sent(),Ft(t,r),[2]}})})}),Xt.get("/rooms/requested",Pt.A.authenticateToken,function(e,t){return $t(void 0,void 0,void 0,function(){var n,r;return Kt(this,function(o){switch(o.label){case 0:return(n=Zt(e,t))?[4,Yt.A.rooms.whichIRequestedToJoin(n.user.userID,n.page,t)]:[2];case 1:return r=o.sent(),Ft(t,r),[2]}})})}),Xt.get("/rooms/pending",Pt.A.authenticateToken,function(e,t){return $t(void 0,void 0,void 0,function(){var n,r;return Kt(this,function(o){switch(o.label){case 0:return(n=Zt(e,t))?[4,Yt.A.rooms.whichIAmPendingToJoin(n.user.userID,n.page,t)]:[2];case 1:return r=o.sent(),Ft(t,r),[2]}})})}),Xt.get("/rooms/associated",Pt.A.authenticateToken,function(e,t){return $t(void 0,void 0,void 0,function(){var n,r;return Kt(this,function(o){switch(o.label){case 0:return(n=Zt(e,t))?[4,Yt.A.rooms.whichIAmAssociatedWith(n.user.userID,n.page,t)]:[2];case 1:return r=o.sent(),Ft(t,r),[2]}})})}),Xt.get("/rooms/others",Pt.A.authenticateToken,function(e,t){return $t(void 0,void 0,void 0,function(){var n,r;return Kt(this,function(o){switch(o.label){case 0:return(n=Zt(e,t))?[4,Yt.A.rooms.others(n.user.userID,n.page,t)]:[2];case 1:return r=o.sent(),Ft(t,r),[2]}})})}),Xt.get("/users/joined",Pt.A.authenticateToken,function(e,t){return $t(void 0,void 0,void 0,function(){var n,r;return Kt(this,function(o){switch(o.label){case 0:return(n=Zt(e,t))?[4,Yt.A.users.whoJoinedRoom(e.query.roomid,n.page,t)]:[2];case 1:return r=o.sent(),Ft(t,r),[2]}})})}),Xt.get("/users/invited",Pt.A.authenticateToken,function(e,t){return $t(void 0,void 0,void 0,function(){var n,r;return Kt(this,function(o){switch(o.label){case 0:return(n=Zt(e,t))?[4,Yt.A.users.whoAreInvitedToJoinRoom(e.query.roomid,n.page,t)]:[2];case 1:return r=o.sent(),Ft(t,r),[2]}})})}),Xt.get("/users/requested",Pt.A.authenticateToken,function(e,t){return $t(void 0,void 0,void 0,function(){var n,r;return Kt(this,function(o){switch(o.label){case 0:return(n=Zt(e,t))?[4,Yt.A.users.whoRequestedToJoinRoom(e.query.roomid,n.page,t)]:[2];case 1:return r=o.sent(),Ft(t,r),[2]}})})}),Xt.get("/users/pending",Pt.A.authenticateToken,function(e,t){return $t(void 0,void 0,void 0,function(){var n,r;return Kt(this,function(o){switch(o.label){case 0:return(n=Zt(e,t))?[4,Yt.A.users.whoArePendingToJoinRoom(e.query.roomid,n.page,t)]:[2];case 1:return r=o.sent(),Ft(t,r),[2]}})})}),Xt.get("/users/associated",Pt.A.authenticateToken,function(e,t){return $t(void 0,void 0,void 0,function(){var n,r;return Kt(this,function(o){switch(o.label){case 0:return(n=Zt(e,t))?[4,Yt.A.users.whoAreAssociatedWithRoom(e.query.roomid,n.page,t)]:[2];case 1:return r=o.sent(),Ft(t,r),[2]}})})}),Xt.get("/users/others",Pt.A.authenticateToken,function(e,t){return $t(void 0,void 0,void 0,function(){var n,r;return Kt(this,function(o){switch(o.label){case 0:return(n=Zt(e,t))?[4,Yt.A.users.others(e.query.roomid,n.page,t)]:[2];case 1:return r=o.sent(),Ft(t,r),[2]}})})});const en=Xt;var tn=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})},nn=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};const rn=require("socket.io");var on=n.n(rn);const an=require("cookie");var cn,sn=n(506);const un=function(e,t){(cn=e.of("/sockets_chat")).use(t),cn.on("connection",function(e){console.log("(ChatSockets) Client connected :: ".concat(JSON.stringify(e.handshake.auth.user))),e.on("disconnect",function(){console.log("(ChatSockets) Client disconnected :: ".concat(JSON.stringify(e.handshake.auth.user)))})})};function ln(e){return function(t,n){var r=t.request.headers.cookie;if(console.log("Authenticating socket (ID: ".concat(t.id,")")),r){var o=an.parse(r).thingspool_token;if(o){var a=Pt.A.getUserFromToken(o);a?e(a)?(t.handshake.auth.user=a,n()):n(new Error('Authorization Failed (User "'.concat(a.userName,'" does not satisfy the pass-condition)'))):n(new Error("Authorization Failed (Cause: User not found in the token)"))}else n(new Error("Authorization Failed (Token not found in cookieStr)"))}else n(new Error("Authorization Failed (Cookie not found in the socket request header)"))}}w().config();w().config(),n(936),n(718),function(){var e,t,n,r;e=this,t=void 0,r=function(){var e,t;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(n){switch(n.label){case 0:return"dev"!=process.env.MODE?[3,2]:[4,mt()];case 1:return n.sent(),[3,4];case 2:return"ssg"!=process.env.MODE?[3,4]:[4,mt()];case 3:return n.sent(),[2];case 4:return[4,pt.A.runSQLFile("clear.sql")];case 5:return n.sent(),[4,pt.A.runSQLFile("init.sql")];case 6:return n.sent(),e=o()(),t=i().createServer(e),e.set("view engine","ejs"),e.use(s().json()),e.use(s().urlencoded({extended:!0})),e.use(l()()),e.use(f()()),function(e){var t=this;e.use("/popup",jt),e.use("/api/auth",Jt),e.use("/api/search",en),e.use("/api/room",zt),e.use("/",Mt),"dev"==process.env.MODE&&(e.get(/.*\.html$/,function(e,n){return tn(t,void 0,void 0,function(){var t;return nn(this,function(r){switch(r.label){case 0:return[4,h.A.read(e.url)];case 1:return t=r.sent(),n.status(200).setHeader("content-type","text/html").send(S.postProcessHTML(t)),[2]}})})}),e.get(/(.*\.css)|(.*\.jpg)|(.*\.png)|(.*\.ico)|(.*\.atom)|(.*\.xml)|(.*\.pdf)$/,function(e,n){return tn(t,void 0,void 0,function(){return nn(this,function(t){return n.sendFile(h.A.getAbsoluteFilePath(e.url)),[2]})})})),o().static(bt().join(process.env.PWD,process.env.STATIC_PAGE_ROOT_DIR))}(e),t.listen(process.env.PORT,function(){console.log("---------------------------------------------"),console.log("Listening to port ".concat(process.env.PORT,"."))}),function(e){var t=new(on().Server)(e);sn.A.init(t,ln(function(e){return"admin"==e.userType})),un(t,ln(function(e){return!0}))}(t),[2]}})},new((n=void 0)||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})}()})();