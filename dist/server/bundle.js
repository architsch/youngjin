(()=>{"use strict";var t={n:e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};const e=require("express");var n=t.n(e);const r=require("http");var o=t.n(r);const a=require("body-parser");var c=t.n(a);const i=require("cookie-parser");var s=t.n(i);const l=require("hpp");var u=t.n(l);const p=require("path");var h=t.n(p);const d=require("fs/promises");var f=t.n(d);const m=require("mysql2/promise");var b=t.n(m);const g=require("dotenv");var v=t.n(g),y=function(){function t(t,e,n){this.pool=t,this.queryStr=e,this.queryParams=n}return t.prototype.run=function(t,e){return n=this,r=void 0,a=function(){var n,r,o;return function(t,e){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(a){switch(a.label){case 0:e&&_.pushStackTrace(e),_.log("SQL Query Started",{queryStr:this.queryStr,queryParams:this.queryParams},"low"),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.pool.query(this.queryStr,this.queryParams)];case 2:return n=a.sent(),r=n[0],n[1],_.log("SQL Query Succeeded",{queryStr:this.queryStr,queryParams:this.queryParams},"medium"),e&&_.popStackTrace(e),null==t||t.status(202),[2,r];case 3:return o=a.sent(),_.log("SQL Query Error",{err:o},"high","pink"),e&&_.popStackTrace(e),null==t||t.status(500).send(o),[2,[]];case 4:return[2]}})},new((o=void 0)||(o=Promise))(function(t,e){function c(t){try{s(a.next(t))}catch(t){e(t)}}function i(t){try{s(a.throw(t))}catch(t){e(t)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof o?n:new o(function(t){t(n)})).then(c,i)}s((a=a.apply(n,r||[])).next())});var n,r,o,a},t}();const w=y;var S=function(){function t(t,e){this.pool=t,this.queries=e}return t.prototype.run=function(t,e){return n=this,r=void 0,a=function(){var n,r,o,a,c,i,s,l,u;return function(t,e){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(p){switch(p.label){case 0:e&&_.pushStackTrace(e),_.log("SQL Transaction Began",{numQueries:this.queries.length},"low"),n=void 0,r=!1,o=0,p.label=1;case 1:return p.trys.push([1,11,13,14]),[4,this.pool.getConnection()];case 2:return[4,(n=p.sent()).beginTransaction()];case 3:p.sent(),a=0,c=this.queries,p.label=4;case 4:return a<c.length?(i=c[a],o++,_.log("SQL Transaction Query Started",{progress:"".concat(o,"/").concat(this.queries.length),query:i},"low"),[4,null==n?void 0:n.query(i.queryStr,i.queryParams)]):[3,9];case 5:return s=p.sent(),l=s[0],s[1],0!=l.affectedRows?[3,7]:[4,null==n?void 0:n.rollback()];case 6:return p.sent(),_.log("SQL Transaction Query Made No Change",{progress:"".concat(o,"/").concat(this.queries.length),query:i},"high"),e&&_.popStackTrace(e),null==t||t.status(403),[2];case 7:_.log("SQL Transaction Query Succeeded",{progress:"".concat(o,"/").concat(this.queries.length),query:i},"low"),p.label=8;case 8:return a++,[3,4];case 9:return[4,null==n?void 0:n.commit()];case 10:return p.sent(),_.logRaw("SQL Transaction Committed","medium"),e&&_.popStackTrace(e),r=!0,[3,14];case 11:return u=p.sent(),_.log("SQL Transaction Error",{progress:"".concat(o,"/").concat(this.queries.length),err:u},"high","pink"),[4,null==n?void 0:n.rollback()];case 12:return p.sent(),e&&_.popStackTrace(e),null==t||t.status(500).send(u),[3,14];case 13:return null==n||n.release(),r&&(null==t||t.status(202)),[7];case 14:return[2]}})},new((o=void 0)||(o=Promise))(function(t,e){function c(t){try{s(a.next(t))}catch(t){e(t)}}function i(t){try{s(a.throw(t))}catch(t){e(t)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof o?n:new o(function(t){t(n)})).then(c,i)}s((a=a.apply(n,r||[])).next())});var n,r,o,a},t}();const k=S;v().config();var x="dev"==process.env.MODE,T=void 0,L={createPool:function(){T?_.logRaw("DB connection pool is already created.","high","pink"):(T=b().createPool({host:x?process.env.SQL_HOST_DEV:process.env.SQL_HOST_PROD,user:x?process.env.SQL_USER_DEV:process.env.SQL_USER_PROD,password:x?process.env.SQL_PASS_DEV:process.env.SQL_PASS_PROD,database:"main",waitForConnections:!0,connectionLimit:10,queueLimit:0,enableKeepAlive:!0,keepAliveInitialDelay:0}))||_.logRaw("Failed to create a DB connection pool.","high","pink")},makeQuery:function(t,e){return T||L.createPool(),new w(T,t,e)},makeTransaction:function(t){return new k(T,t)},runSQLFile:function(t){return e=void 0,n=void 0,o=function(){var e,n,r,o,a,c,i;return function(t,e){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(s){switch(s.label){case 0:return _.log("Opening SQL File",{fileName:t},"high"),[4,C.read(t,"sql")];case 1:e=s.sent(),n=e.split(";").map(function(t){return t.trim()+";"}).filter(function(t){return t.length>1}),r=void 0,s.label=2;case 2:return s.trys.push([2,8,9,10]),[4,b().createConnection({host:x?process.env.SQL_HOST_DEV:process.env.SQL_HOST_PROD,user:x?process.env.SQL_USER_DEV:process.env.SQL_USER_PROD,password:x?process.env.SQL_PASS_DEV:process.env.SQL_PASS_PROD})];case 3:null==(r=s.sent())||r.connect(),o=0,a=n,s.label=4;case 4:return o<a.length?(c=a[o],[4,null==r?void 0:r.query(c)]):[3,7];case 5:s.sent(),s.label=6;case 6:return o++,[3,4];case 7:return[3,10];case 8:return i=s.sent(),_.log("SQL File Execution Error",{err:i},"high","pink"),[3,10];case 9:return null==r||r.end(),[7];case 10:return[2]}})},new((r=void 0)||(r=Promise))(function(t,a){function c(t){try{s(o.next(t))}catch(t){a(t)}}function i(t){try{s(o.throw(t))}catch(t){a(t)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r(function(t){t(n)})).then(c,i)}s((o=o.apply(e,n||[])).next())});var e,n,r,o}};const E=L;var R,N="</td>";const O=function(t,e){(R=t.of("/console_sockets")).use(e),R.on("connection",function(t){console.log("(ConsoleSockets) Client connected :: ".concat(JSON.stringify(t.handshake.auth))),t.on("command",function(e){console.log("(ConsoleSockets) Command received :: [".concat(e,"] - sent by :: ").concat(JSON.stringify(t.handshake.auth.user)));var n=e.split(" ");switch(n[0]){case"print":n.shift(),_.logRaw(0==n.length?"-":n.join(" "),"high");break;case"db":"dev"==process.env.MODE?(n.shift(),E.runSQLFile("".concat(n[0],".sql"))):_.logRaw('Command "'.concat(n[0],'" is supported only in dev mode.'),"high","pink");break;case"reboot":_.logRaw("Rebooting...","high"),process.exit(0);break;default:_.logRaw('Unknown command "'.concat(n[0],'".'),"high","pink")}}),t.on("disconnect",function(){console.log("(ConsoleSockets) Client disconnected :: ".concat(JSON.stringify(t.handshake.auth)))})})},j=function(t,e,n){var r,o,a;R?R.emit("log",(r=t,o=e,a=n,"".concat('<td style="color: #e0e020; background-color: #202090;">').concat(r).concat(N).concat('<td style="color: #20e020; background-color: #101010;">').concat(o).concat(N).concat('<td style="color: #303030; background-color: #c0c0c0;">').concat(a).concat(N))):console.log("".concat(t,"\n(ORIGIN: ").concat(e,")\n(DETAILS: ").concat(n,")"))};var I=[],D={thresholdLogLevel:0,setThresholdLogLevel:function(t){D.thresholdLogLevel=isNaN(t)?D.getLogLevelFromName(t):t},getThresholdLogLevel:function(){return D.thresholdLogLevel},getLogLevelFromName:function(t){switch(t){case"low":return 0;case"medium":return 1;case"high":return 2;default:console.error('ERROR: Unknown log level name ("'.concat(t,'")'))}return 0},log:function(t,e,n,r){void 0===e&&(e=void 0),void 0===n&&(n="high");var o="";null!=e&&(o=JSON.stringify(e));var a=D.getStackTrace();D.getLogLevelFromName(n)>=D.thresholdLogLevel&&j((r?'<b style="color:'.concat(r,'">'):"")+t+(r?"</b>":""),a,o)},logRaw:function(t,e,n){void 0===e&&(e="high"),D.log(t,void 0,e,n)},getStackTrace:function(){for(var t=[],e=I.length-1;e>=0;--e)t.push(I[e]);return t.join(" <- ")},pushStackTrace:function(t){I.push(t),D.logRaw("pushStackTrace: ".concat(t),"high","gray")},popStackTrace:function(t){if(0!=I.length){var e=I.pop();e==t?D.logRaw("popStackTrace: ".concat(t),"high","gray"):D.logRaw("Name mismatch in stackTrace :: (traceName = ".concat(t,", expectedTraceName = ").concat(e,")"),"high","pink")}else D.logRaw("No name to pop in stackTrace :: (traceName = ".concat(t,")"),"high","pink")}};const _=D;var P=function(t,e,n,r){return new(n||(n=Promise))(function(o,a){function c(t){try{s(r.next(t))}catch(t){a(t)}}function i(t){try{s(r.throw(t))}catch(t){a(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(c,i)}s((r=r.apply(t,e||[])).next())})},q=function(t,e){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};v().config();var A={read:function(t,e){return P(void 0,void 0,void 0,function(){var n,r;return q(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),n=A.getAbsoluteFilePath(t,e),[4,f().readFile(n,{encoding:"utf8"})];case 1:return[2,o.sent()];case 2:return r=o.sent(),_.log("Failed to read file",{relativeFilePath:t,err:r},"high","pink"),[2,""];case 3:return[2]}})})},write:function(t,e,n){return P(void 0,void 0,void 0,function(){var r,o;return q(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),r=A.getAbsoluteFilePath(t,n),[4,f().writeFile(r,e)];case 1:return a.sent(),[3,3];case 2:return o=a.sent(),_.log("Failed to write file",{relativeFilePath:t,err:o},"high","pink"),[3,3];case 3:return[2]}})})},getAllRelativePathsInDirRecursively:function(t){return P(void 0,void 0,void 0,function(){var e,n;return q(this,function(r){switch(r.label){case 0:return e=h().join(process.env.PWD,t),n=[],[4,A.getAllRelativePathsInDirRecursively_internal(e,[],n)];case 1:return r.sent(),[2,n]}})})},getAbsoluteFilePath:function(t,e){return null==e&&(e=process.env.STATIC_PAGE_ROOT_DIR),h().join(process.env.PWD,e+"/"+t)},getAllRelativePathsInDirRecursively_internal:function(t,e,n){return P(this,void 0,void 0,function(){var r,o,a,c,i,s;return q(this,function(l){switch(l.label){case 0:return[4,f().readdir(t)];case 1:r=l.sent(),o=0,a=r,l.label=2;case 2:return o<a.length?(c=a[o],i=e.concat(c),s="".concat(t,"/").concat(c),[4,f().lstat(s)]):[3,7];case 3:return l.sent().isFile()?(n.push(i.join("/")),[3,6]):[3,4];case 4:return[4,A.getAllRelativePathsInDirRecursively_internal(s,i,n)];case 5:l.sent(),l.label=6;case 6:return o++,[3,2];case 7:return[2]}})})}};const C=A,B={displayText:{pageName:{index:"Home",arcade:"Arcade",library:"Library",portfolio:"Portfolio",register:"Create Account",login:"Log In",mypage:"Portal"},message:{"error/userName/length":"Username must be between 4 and 16 characters long.","error/userName/chars":"Username can only contain alphabets, numbers, and underbar(_).","error/password/length":"Password must be between 6 and 24 characters long.","error/password/chars":"Password can only contain alphabets, numbers, and the following special characters: ~`!@#$%^&*()-_+={}[]|\\:;\"'<>,.?/","error/email/length":"Email address must not contain more than 64 characters.","error/email/chars":"Please enter a valid email address.","error/roomName/length":"Room name must be between 4 and 64 characters long.","error/roomName/chars":"Room name can only contain alphabets, numbers, spaces, and the following special characters: ~`!@#$%^&*()-_+={}[]|\\:;\"'<>,.?/","rule/userName/length":"Username must be between 4 and 16 characters long.","rule/userName/chars":"Username can only contain alphabets, numbers, and underbar(_).","rule/password/length":"Password must be between 6 and 24 characters long.","rule/password/chars":"Password can only contain alphabets, numbers, and the following special characters: ~`!@#$%^&*()-_+={}[]|\\:;\"'<>,.?/","rule/email/length":"Email address must not contain more than 64 characters.","rule/roomName/length":"Room name must be between 4 and 64 characters long.","rule/roomName/chars":"Room name can only contain alphabets, numbers, spaces, and the following special characters: ~`!@#$%^&*()-_+={}[]|\\:;\"'<>,.?/"}}},F={escapeHTMLChars:t=>t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replaceAll("\n","<br>").replaceAll(" ","&nbsp;"),findErrorInUserName:t=>t.length<4||t.length>16?"error/userName/length":t!=F.sanitizeUserName(t)?"error/userName/chars":null,findErrorInPassword:t=>t.length<6||t.length>24?"error/password/length":t!=F.sanitizePassword(t)?"error/password/chars":null,findErrorInEmailAddress:t=>t.length>64?"error/email/length":/^[^\s@]+@[^\s@]+.[^\s@]+$/.test(t)?null:"error/email/chars",findErrorInRoomName:t=>t.length<4||t.length>64?"error/roomName/length":t!=F.sanitizeRoomName(t)?"error/roomName/chars":null,sanitizeUserName:t=>(t.length>16&&(t=t.substring(0,16)),t.replace(/[^a-zA-Z0-9_]/g,"")),sanitizePassword:t=>(t.length>24&&(t=t.substring(0,24)),t.replace(/[^a-zA-Z0-9~`!@#\$%\^&\*\(\)-_\+=\{\[\}\]\|\\:;"'<>,\.\?\/]/g,"")),sanitizeRoomName:t=>F.sanitizeRoomNameWithoutTrimming(t).trim(),sanitizeRoomNameWithoutTrimming:t=>(t.length>64&&(t=t.substring(0,64)),t.replace(/[^a-zA-Z0-9~`!@#\$%\^&\*\(\)-_\+=\{\[\}\]\|\\:;"'<>,\.\?\/\s]/g,"").replace(/\s+/g," "))},Q=F,M=require("ejs");var G=t.n(M);v().config();var U="".concat(process.env.PWD,"/").concat(process.env.VIEWS_ROOT_DIR,"/partial"),J={TextUtil:Q,UIConfig:B,ejsPartialRootPath:U,isStaticPage:!0},W={TextUtil:Q,UIConfig:B,ejsPartialRootPath:U,isStaticPage:!1},H={},z={render:function(t,e,n,r){e.render(n,z.makeEJSParams(t,r),function(t,n){t?e.status(500).send(t.message):(n=z.postProcessHTML(n),e.status(200).setHeader("content-type","text/html").send(n))})},postProcessHTML:function(t){return"dev"==process.env.MODE?t=t.replaceAll("\n","!*NEW_LINE*!").replace(/(PROD_CODE_BEGIN).*?(PROD_CODE_END)/g,"REMOVED_PROD_CODE").replaceAll("!*NEW_LINE*!","\n").replaceAll(process.env.URL_STATIC,"http://localhost:".concat(process.env.PORT)).replaceAll(process.env.URL_DYNAMIC,"http://localhost:".concat(process.env.PORT)):t},makeEJSParams:function(t,e){var n={};return Object.assign(n,W),Object.assign(n,e),n.user&&_.log("'user' shouldn't be defined manually in EJS params.",{mergedEJSParams:n},"high","pink"),n.user=t.user,n.globalDictionary&&_.log("'globalDictionary' shouldn't be defined manually in EJS params.",{mergedEJSParams:n},"high","pink"),n.globalDictionary={},n},makeEJSParamsStatic:function(t){var e={};return Object.assign(e,J),Object.assign(e,t),e},createStaticHTMLFromEJS:function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return r=void 0,o=function(t,e,n){if(n||2===arguments.length)for(var r,o=0,a=e.length;o<a;o++)!r&&o in e||(r||(r=Array.prototype.slice.call(e,0,o)),r[o]=e[o]);return t.concat(r||Array.prototype.slice.call(e))}([t],e,!0),c=function(t,e){var n;return void 0===e&&(e={}),function(t,e){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(r){switch(r.label){case 0:return null!=(n=H[t])?[3,2]:[4,C.read(t,process.env.VIEWS_ROOT_DIR)];case 1:n=r.sent(),H[t]=n,r.label=2;case 2:return[2,G().compile(n)(z.makeEJSParamsStatic(e))]}})},new((a=void 0)||(a=Promise))(function(t,e){function n(t){try{s(c.next(t))}catch(t){e(t)}}function i(t){try{s(c.throw(t))}catch(t){e(t)}}function s(e){var r;e.done?t(e.value):(r=e.value,r instanceof a?r:new a(function(t){t(r)})).then(n,i)}s((c=c.apply(r,o||[])).next())});var r,o,a,c}};const Y=z;v().config();const V=function(){function t(){this.lines=["</urlset>"]}return t.prototype.addEntry=function(t,e){this.lines.push("</url>"),this.lines.push("  <lastmod>".concat(e,"</lastmod>")),this.lines.push("  <loc>".concat(process.env.URL_STATIC,"/").concat(t,"</loc>")),this.lines.push("<url>")},t.prototype.build=function(){return t=this,e=void 0,r=function(){return function(t,e){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(t){switch(t.label){case 0:return this.lines.push('<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">'),this.lines.push('<?xml version="1.0" encoding="UTF-8"?>'),this.lines.reverse(),[4,C.write("sitemap.xml",this.lines.join("\n"))];case 1:return t.sent(),[2]}})},new((n=void 0)||(n=Promise))(function(o,a){function c(t){try{s(r.next(t))}catch(t){a(t)}}function i(t){try{s(r.throw(t))}catch(t){a(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(c,i)}s((r=r.apply(t,e||[])).next())});var t,e,n,r},t}();v().config();const K=function(){function t(){this.lines=["</feed>"],this.globalLatestUpdate=new Date(process.env.GLOBAL_LAST_MOD)}return t.prototype.addEntry=function(t,e,n,r){var o=new Date(n);o>this.globalLatestUpdate&&(this.globalLatestUpdate=o),this.lines.push("</entry>"),this.lines.push("  <summary>".concat(r,"</summary>")),this.lines.push("  <updated>".concat(o.toISOString(),"</updated>")),this.lines.push("  <id>".concat(t,"</id>")),this.lines.push('  <link href="'.concat(t,'"/>')),this.lines.push("  <title>".concat(e,"</title>")),this.lines.push("<entry>")},t.prototype.build=function(){return t=this,e=void 0,r=function(){return function(t,e){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(t){switch(t.label){case 0:return this.lines.push("<id>urn:uuid:02210672-5391-4cc8-800a-2a88f3a6d00c</id>"),this.lines.push("</author>"),this.lines.push("  <name>Youngjin Kang</name>"),this.lines.push("<author>"),this.lines.push("<updated>".concat(this.globalLatestUpdate.toISOString(),"</updated>")),this.lines.push('<link href="'.concat(process.env.URL_STATIC,'"/>')),this.lines.push('<link rel="self" type="application/atom+xml" href="'.concat(process.env.URL_STATIC,'/feed.atom"/>')),this.lines.push("<title>ThingsPool</title>"),this.lines.push('<feed xmlns="http://www.w3.org/2005/Atom">'),this.lines.push('<?xml version="1.0" encoding="utf-8"?>'),this.lines.reverse(),[4,C.write("feed.atom",this.lines.join("\n"))];case 1:return t.sent(),[2]}})},new((n=void 0)||(n=Promise))(function(o,a){function c(t){try{s(r.next(t))}catch(t){a(t)}}function i(t){try{s(r.throw(t))}catch(t){a(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(c,i)}s((r=r.apply(t,e||[])).next())});var t,e,n,r},t}();v().config();const $=function(){function t(){this.lines=[]}return t.prototype.addLine=function(t){this.lines.push(t)},t.prototype.getText=function(){return this.lines.join("\n")},t.prototype.build=function(t,e){return n=this,r=void 0,a=function(){return function(t,e){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(n){switch(n.label){case 0:return null==e&&(e=process.env.STATIC_PAGE_ROOT_DIR),[4,C.write(t,this.lines.join("\n"),e)];case 1:return n.sent(),[2]}})},new((o=void 0)||(o=Promise))(function(t,e){function c(t){try{s(a.next(t))}catch(t){e(t)}}function i(t){try{s(a.throw(t))}catch(t){e(t)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof o?n:new o(function(t){t(n)})).then(c,i)}s((a=a.apply(n,r||[])).next())});var n,r,o,a},t}();v().config();var Z=function(){function t(t,e){this.sitemapBuilder=t,this.atomFeedBuilder=e}return t.prototype.build=function(t){return e=this,n=void 0,o=function(){var e,n,r,o,a,c,i,s,l,u,p,h,d,f,m,b,g,v;return function(t,e){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(y){switch(y.label){case 0:return e="".concat(t.dirName,"/page.html"),[4,C.read("".concat(t.dirName,"/source.txt"))];case 1:for(n=y.sent(),r=n.split(/\r?\n/),o=null==t.playLinkImagePathOverride?"play.png":t.playLinkImagePathOverride,a="",c="",r[0].startsWith(":d:")?a=r[0].substring(3):console.error(":d: is missing in -> "+t.title),r[1].startsWith(":k:")?c=r[1].substring(3).toLowerCase().replaceAll("-"," "):console.error(":k: is missing in -> "+t.title),i=[],s=1,l=[],u=function(){l.length>0&&(i.push("<p>".concat(l.join("<br>"),"</p>")),l.length=0)},p=2;p<r.length;++p)0==(h=(h=r[p]).trim()).length?u():h.startsWith("[")?(u(),(d=h.match(/\[(.*?)\]/)[1].trim()).length>0&&i.push("<h2>".concat(d,"</h2>"))):h.startsWith("<")?(u(),(f=h.match(/<(.*?)>/)[1]).length>0&&(m="".concat(process.env.URL_STATIC,"/").concat(t.dirName,"/").concat(f,".jpg"),i.push('<img class="l_image" src="'.concat(m,'" alt="ThingsPool - ').concat(t.title," (Screenshot ").concat(s++,')">')))):(h=h.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll("{%","<").replaceAll("%}",">"),l.push(h));return u(),null!=t.videoTag&&null!=t.videoTag&&i.push(t.videoTag),b=new $,v=(g=b).addLine,[4,Y.createStaticHTMLFromEJS("page/static/arcadeGame.ejs",{entry:t,relativeURL:e,description:a,keywords:c,playLinkImagePath:o,content:i.join("\n")})];case 2:return v.apply(g,[y.sent()]),this.sitemapBuilder.addEntry(e,t.lastmod),this.atomFeedBuilder.addEntry("".concat(process.env.URL_STATIC,"/").concat(e),t.title,t.lastmod,t.title),[4,b.build(e)];case 3:return y.sent(),[2]}})},new((r=void 0)||(r=Promise))(function(t,a){function c(t){try{s(o.next(t))}catch(t){a(t)}}function i(t){try{s(o.throw(t))}catch(t){a(t)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r(function(t){t(n)})).then(c,i)}s((o=o.apply(e,n||[])).next())});var e,n,r,o},t}();const X=Z;var tt={gameEntries:[{dirName:"ArtRaider",title:"ArtRaider",playLinkImagePathOverride:"badge_onestore.png",playLinkURL:"https://onesto.re/0001000383",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/RuLgOJrNtKA?si=Ts_Yu_jdpB1qmNiT" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>',lastmod:"2025-04-15"},{dirName:"Water-vs-Fire",title:"Water vs Fire",playLinkURL:"https://www.gamearter.com/game/water-vs-fire",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/6DeA_m8Iq4M?si=hC1uzkEtBWpYcM8z" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>',lastmod:"2023-09-10"},{dirName:"HuntLand",title:"HuntLand",playLinkURL:"https://www.gamearter.com/game/huntland",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/3dRg6vvoPqc?si=FlnKVyzQq0_55sL2" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>',lastmod:"2023-09-10"},{dirName:"PoliceChase",title:"Police Chase",playLinkURL:"https://www.gamearter.com/game/policechase",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/kABg0j2mZqQ?si=3-JUZQnh3omVXSJd" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>',lastmod:"2023-09-10"},{dirName:"SpaceTown",title:"SpaceTown",playLinkURL:"https://www.gamearter.com/game/spacetown",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/NoiQzEKJM-A?si=o8vTNqW1kxCJ4MnW" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>',lastmod:"2023-09-20"}]};v().config();var et=function(){function t(t,e){this.sitemapBuilder=t,this.atomFeedBuilder=e}return t.prototype.build=function(){return t=this,e=void 0,r=function(){var t,e,n,r,o,a;return function(t,e){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(c){switch(c.label){case 0:return t=new $,n=(e=t).addLine,[4,Y.createStaticHTMLFromEJS("page/static/arcade.ejs",{entries:tt.gameEntries})];case 1:return n.apply(e,[c.sent()]),[4,t.build("arcade.html")];case 2:c.sent(),this.sitemapBuilder.addEntry("arcade.html","2025-02-28"),r=0,o=tt.gameEntries,c.label=3;case 3:return r<o.length?(a=o[r],[4,new X(this.sitemapBuilder,this.atomFeedBuilder).build(a)]):[3,6];case 4:c.sent(),c.label=5;case 5:return r++,[3,3];case 6:return[2]}})},new((n=void 0)||(n=Promise))(function(o,a){function c(t){try{s(r.next(t))}catch(t){a(t)}}function i(t){try{s(r.throw(t))}catch(t){a(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(c,i)}s((r=r.apply(t,e||[])).next())});var t,e,n,r},t}();const nt=et;var rt=function(t,e,n,r){return new(n||(n=Promise))(function(o,a){function c(t){try{s(r.next(t))}catch(t){a(t)}}function i(t){try{s(r.throw(t))}catch(t){a(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(c,i)}s((r=r.apply(t,e||[])).next())})},ot=function(t,e){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};v().config();var at=function(){function t(t,e){this.sitemapBuilder=t,this.atomFeedBuilder=e}return t.prototype.build=function(t){return rt(this,void 0,void 0,function(){var e,n,r,o,a,c,i,s,l,u,p,h,d,f,m,b,g,v,y,w,S,k,x,T,L,E,R=this;return ot(this,function(N){switch(N.label){case 0:return e=!0,n="???",r=1,o=1,a=void 0,c=!1,i=!1,s=[],l=[],u=[],p="A writing by ThingsPool.",h="thingspool, software, engineering, philosophy",d=process.env.GLOBAL_LAST_MOD,f=n,m=p,b=h,g=d,v=function(){s.length>0&&(c?u.push('<div class="snippet"><pre><code>'.concat(s.join("\n"),"</code></pre></div>")):i?u.push('<pre><div class="excerpt">'.concat(s.join("\n"),"</div></pre>")):u.push("<p>".concat(s.join("<br>"),"</p>")),s.length=0)},y=function(e,n,c,i,s){return rt(R,void 0,void 0,function(){var p,h,d,f;return ot(this,function(m){switch(m.label){case 0:return p="".concat(t.dirName,"/page-").concat(r,".html"),h=new $,f=(d=h).addLine,[4,Y.createStaticHTMLFromEJS("page/static/libraryPost.ejs",{title:e,desc:c,keywords:i,customOGImagePath:a,entry:t,pageNumber:r,isLastPage:s,content:u.join("\n")})];case 1:return f.apply(d,[m.sent()]),[4,h.build(p)];case 2:return m.sent(),u.length=0,this.sitemapBuilder.addEntry(p,n),this.atomFeedBuilder.addEntry("".concat(process.env.URL_STATIC,"/").concat(p),e,n,c),l.push({pageNumber:r,title:e,lastmod:n,desc:c,keywords:i,customOGImagePath:a}),r++,o=1,a=void 0,[2]}})})},[4,C.read("".concat(t.dirName,"/source.txt"))];case 1:w=N.sent(),S=w.split(/\r?\n/),k=0,N.label=2;case 2:return k<S.length?(x=S[k],c||i||(x=x.trim()),0!=x.length?[3,3]:(c||i?s.push("\n"):v(),[3,7])):[3,8];case 3:return x.startsWith("[")?(v(),e||(f=n),n=x.match(/\[(.*?)\]/)[1].trim(),T=x.match(/\](.*?)$/)[1].trim(),e?[3,5]:[4,y(f,g,m,b,!1)]):[3,6];case 4:N.sent(),m=p,b=h,g=d,N.label=5;case 5:return e=!1,u.push("<h1>".concat(n,"</h1>")),u.push('<p class="dim">Author: Youngjin Kang&nbsp;&nbsp;&nbsp;Date: '.concat(T,"</p>")),[3,7];case 6:!x.startsWith("<")||c||i?x.startsWith("@@")?u.push(x.substring(2)):x.startsWith("#$")?(v(),c=!c):x.startsWith('#"')?(v(),i=!i):x.startsWith(":d:")?(e||(m=p),p=x.substring(3)):x.startsWith(":k:")?(e||(b=h),h=x.substring(3).toLowerCase().replaceAll("-"," ")):x.startsWith(":l:")?(e||(g=d),d=x.substring(3)):(x=x.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll("{%","<").replaceAll("%}",">"),s.push(x)):(v(),(L=x.match(/<(.*?)>/)[1]).length>0&&(E="".concat(process.env.URL_STATIC,"/").concat(t.dirName,"/").concat(L,".jpg"),(null==a||x.endsWith("*"))&&(a=E),u.push('<img class="l_image" src="'.concat(E,'" alt="').concat(n.replaceAll('"',"&quot;")," (Figure ").concat(o++,')">')))),N.label=7;case 7:return++k,[3,2];case 8:return v(),[4,y(n,d,p,h,!0)];case 9:return N.sent(),[2,l]}})})},t}();const ct=at;v().config();var it=function(){function t(t,e){this.sitemapBuilder=t,this.atomFeedBuilder=e}return t.prototype.build=function(t,e){return n=this,r=void 0,a=function(){var t,n,r,o,a,c,i;return function(t,e){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(s){switch(s.label){case 0:t=0,s.label=1;case 1:return t<e.length?(n=e[t],[4,new ct(this.sitemapBuilder,this.atomFeedBuilder).build(n)]):[3,6];case 2:return r=s.sent(),o="".concat(n.dirName,"/list.html"),a=new $,i=(c=a).addLine,[4,Y.createStaticHTMLFromEJS("page/static/libraryPostList.ejs",{entry:n,listRelativeURL:o,postInfoList:r})];case 3:return i.apply(c,[s.sent()]),[4,a.build("".concat(n.dirName,"/list.html"))];case 4:s.sent(),this.sitemapBuilder.addEntry("".concat(n.dirName,"/list.html"),r.sort(function(t,e){return Date.parse(e.lastmod)-Date.parse(t.lastmod)}).pop().lastmod),s.label=5;case 5:return++t,[3,1];case 6:return[2]}})},new((o=void 0)||(o=Promise))(function(t,e){function c(t){try{s(a.next(t))}catch(t){e(t)}}function i(t){try{s(a.throw(t))}catch(t){e(t)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof o?n:new o(function(t){t(n)})).then(c,i)}s((a=a.apply(n,r||[])).next())});var n,r,o,a},t}();const st=it;var lt={entriesByCategory:{Nonfiction:[{dirName:"metaphysics",title:"형이상학 (2013 - 2014)"},{dirName:"game-analysis",title:"게임분석 (2019)"},{dirName:"essays",title:"Miscellaneous Writings (2022 - 2024)"},{dirName:"blockchains",title:"On Legitimacy of Blockchains (2022)"},{dirName:"software-development",title:"Software Development (2022 - 2024)"},{dirName:"game-design",title:"Universal Laws of Game Design (2023)"},{dirName:"reality",title:"The Origin of Reality (2023)"},{dirName:"bridge-to-math",title:"A Layman's Bridge to Mathematics (2024)"},{dirName:"read-rec",title:"Recommended Readings (2024)"},{dirName:"morsels",title:"Morsels of Thought (2024)"},{dirName:"concepts-of-plan",title:"Concepts of a Plan (2025)"}],Fiction:[{dirName:"novels",title:"단편소설 (2012 - 2013)"},{dirName:"alien-job-interview",title:"Alien Job Interview (2022)"},{dirName:"infinite-treasures",title:"The Island of Infinite Treasures (2022)"},{dirName:"infsoc",title:"Influential Social Posts (2023)"},{dirName:"gamedev-journey",title:"A Game Developer's Journey (2023)"},{dirName:"sandwich",title:"Sandwich Engineering (2025)"}],Arts:[{dirName:"illustrations",title:"Illustrations (2009 - 2014)"},{dirName:"cartoons",title:"Cartoons (2011 - 2015)"}]}};v().config();var ut=function(){function t(t,e){this.sitemapBuilder=t,this.atomFeedBuilder=e}return t.prototype.build=function(){return t=this,e=void 0,r=function(){var t,e,n,r,o,a,c,i;return function(t,e){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(s){switch(s.label){case 0:return t=new $,n=(e=t).addLine,[4,Y.createStaticHTMLFromEJS("page/static/library.ejs",{entriesByCategory:lt.entriesByCategory,gameEntries:tt.gameEntries})];case 1:return n.apply(e,[s.sent()]),[4,t.build("library.html")];case 2:s.sent(),this.sitemapBuilder.addEntry("library.html","2025-02-28"),r=0,o=Object.entries(lt.entriesByCategory),s.label=3;case 3:return r<o.length?(a=o[r],c=a[0],i=a[1],[4,new st(this.sitemapBuilder,this.atomFeedBuilder).build(c,i)]):[3,6];case 4:s.sent(),s.label=5;case 5:return r++,[3,3];case 6:return[2]}})},new((n=void 0)||(n=Promise))(function(o,a){function c(t){try{s(r.next(t))}catch(t){a(t)}}function i(t){try{s(r.throw(t))}catch(t){a(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(c,i)}s((r=r.apply(t,e||[])).next())});var t,e,n,r},t}();const pt=ut;v().config();const ht=function(){function t(){}return t.prototype.build=function(t,e){return n=this,r=void 0,a=function(){var n,r,o,a,c;return function(t,e){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(i){switch(i.label){case 0:return null==t&&(t="".concat(process.env.SRC_ROOT_DIR,"/shared/embeddedScripts")),null==e&&(e="".concat(process.env.VIEWS_ROOT_DIR,"/partial/embeddedScript")),[4,C.getAllRelativePathsInDirRecursively(t)];case 1:n=(n=i.sent()).filter(function(t){return t.endsWith(".js")}),r=0,o=n,i.label=2;case 2:return r<o.length?(a=o[r],[4,C.read(a,t)]):[3,6];case 3:return c=i.sent().split("\n").filter(function(t){return!t.startsWith("export ")}).join("\n").trim(),[4,C.write(a.replace(".js",".ejs"),'\n<%_ if (!locals.globalDictionary["script_included_('.concat(a,")\"]) { _%>\n\x3c!-- NOTE: This EJS partial is auto-generated by 'embeddedScriptBuilder.ts' --\x3e\n<%_ locals.globalDictionary[\"script_included_(").concat(a,')"] = true; _%>\n<script>\n').concat(c,"\n<\/script>\n<%_ } _%>\n").trim(),e)];case 4:i.sent(),i.label=5;case 5:return r++,[3,2];case 6:return[2]}})},new((o=void 0)||(o=Promise))(function(t,e){function c(t){try{s(a.next(t))}catch(t){e(t)}}function i(t){try{s(a.throw(t))}catch(t){e(t)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof o?n:new o(function(t){t(n)})).then(c,i)}s((a=a.apply(n,r||[])).next())});var n,r,o,a},t}();var dt,ft,mt,bt="#101010",gt="#303030",vt="#707070",yt="#a0a0a0",wt="#c0c0c0",St="#d0c090",kt="#70c060",xt="#b0a070",Tt="17px",Lt={unit:{landscape:{vertical:.6,horizontal:1},portrait:{vertical:1,horizontal:2.5}}},Et=400,Rt=800,Nt=function(t,e,n,r,o,a){return"position: absolute;\n\tdisplay: block;\n\tleft: ".concat(t,"%;\n\tright: ").concat(e,"%;\n\ttop: ").concat(n,"%;\n\tbottom: ").concat(r,"%;\n\twidth: ").concat(o,"%;\n\theight: ").concat(a,"%;")},Ot=function(t,e){return"position: relative;\n\tdisplay: ".concat(t?"block":"inline-block",";\n\tmax-width: ").concat(e,";")},jt=function(t){return"position: relative;\n\tdisplay: ".concat(t?"block":"inline-block",";\n\tmax-width: none;\n\twidth: fit-content;\n\tblock-size: fit-content;")},It=function(t,e,n,r,o){void 0===r&&(r=!1),void 0===o&&(o=!1);var a=Lt.unit[t?"landscape":"portrait"],c=(a.vertical*e).toFixed(2),i=(a.horizontal*n).toFixed(2),s=o?"0":"".concat(c,"%"),l=o?"0":"".concat(i,"%"),u=r?"0":"".concat(c,"%"),p=r?"0":"".concat(i,"%");return"padding: ".concat(s," ").concat(l," ").concat(s," ").concat(l,";\n\tmargin: ").concat(u," ").concat(p," ").concat(u," 0;")},Dt=function(t,e,n){return"font-size: ".concat(t,';\n\tfont-family: "Lucida Console", "Lucida Sans Typewriter", "Monaco", Consolas, monospace;\n\tfont-style: ').concat(e?"italic":"normal",";\n\tfont-weight: ").concat(n,";")},_t=function(t,e,n){return void 0===n&&(n=1),"background-color: ".concat(t,";\n\tcolor: ").concat(e,";").concat(n<1?"\n\topacity: ".concat(n,";"):"")},Pt=function(t,e,n){return void 0===n&&(n=1),_t(t,e,n)+"\n\tborder-radius: 2vmin;"},qt=function(t,e,n,r,o){return void 0===r&&(r="1.25"),void 0===o&&(o=1),Pt(t,e,o)+"\n"+"\tborder-bottom: ".concat(r,"vmin ").concat(n," solid;")+"\n"+"\tborder-right: ".concat(r,"vmin ").concat(n," solid;")},At=function(t,e,n,r,o){return void 0===r&&(r="1.25"),void 0===o&&(o=1),Pt(t,e,o)+"\n"+"\tborder: ".concat(r,"vmin ").concat(n," solid;")},Ct=Nt(0,0,0,0,100,100),Bt=Nt(0,86,0,0,14,100),Ft=Nt(0,0,0,88,100,12),Qt=Nt(14,5,0,0,81,100),Mt=Nt(0,2.5,12,0,95,88),Gt=Nt(0,0,0,86,100,14),Ut=Nt(0,0,14,0,100,80),Jt=Nt(0,0,0,35,100,65),Wt=Nt(0,0,65,0,100,35),Ht=function(t){return 2*Lt.unit[t?"landscape":"portrait"].horizontal},zt=function(t){return Ot(!0,"".concat(100..toFixed(2),"%"))},Yt=function(t){return Ot(!0,"1%")},Vt=function(t){return jt(!0)},Kt=function(t){return Ot(!1,"".concat(100..toFixed(2),"%"))},$t=function(t){return Ot(!1,"".concat((50-Ht(t)).toFixed(2),"%"))},Zt=function(t){return Ot(!1,"".concat((33-Ht(t)).toFixed(2),"%"))},Xt=function(t){return jt(!1)},te=function(t){return It(t,1,1)},ee=function(t){return It(t,2,2)},ne=function(t){return It(t,4,4)},re=function(t){return It(t,2,1,!1,!0)},oe=function(t){return It(t,4,1,!1,!0)},ae="min(".concat(1.8199999999999998.toFixed(2),"vmax, ").concat(16..toFixed(2),"px)"),ce="min(".concat(2.1839999999999997.toFixed(2),"vmax, ").concat(19.2.toFixed(2),"px)"),ie="min(".concat(2.6207999999999996.toFixed(2),"vmax, ").concat(23.04.toFixed(2),"px)"),se="min(".concat(3.1449599999999998.toFixed(2),"vmax, ").concat(27.648.toFixed(2),"px)"),le="min(".concat(3.7739519999999995.toFixed(2),"vmax, ").concat(33.1776.toFixed(2),"px)"),ue=Dt(ae,!1,Et),pe=Dt(ae,!0,Et),he=Dt(ae,!1,Rt),de=(Dt(ce,!0,Et),Dt(ce,!0,Rt)),fe=(Dt(ie,!0,Et),Dt(ie,!0,Rt)),me=(Dt(se,!0,Et),Dt(se,!0,Rt)),be=(Dt(le,!0,Et),Dt(le,!0,Rt)),ge="opacity: 0;",ve=_t("#000000",wt,.7),ye=qt(St,gt,xt,"1.25"),we=_t("#000000",wt,.7),Se=qt(gt,yt,wt,"1.25"),ke=_t(gt,wt),xe=(dt=wt,void 0===ft&&(ft="1.25"),void 0===mt&&(mt=1),_t(gt,wt,mt)+"\n"+"\tborder-bottom: ".concat(ft,"vmin ").concat(dt," solid;")),Te=_t(gt,yt),Le=_t(yt,gt),Ee=_t(gt,vt),Re=_t(gt,St),Ne=_t(gt,xt),Oe=qt(gt,yt,yt),je=Pt(gt,wt),Ie=Pt(bt,kt),De=Pt(bt,kt),_e=qt(bt,yt,vt,"0.5"),Pe=qt(bt,yt,vt,"0.75"),qe=qt(vt,wt,yt,"0.25"),Ae=At(gt,wt,vt,"0.1"),Ce=At(yt,wt,wt,"0.1"),Be=function(t){return"\n@supports(-moz-appearance:none) {\n\t* {\n\t\tscrollbar-width: ".concat(t?"auto":"none",";\n\t\tscrollbar-color: ").concat(vt," ").concat(bt,";\n\t}\n}\n::-webkit-scrollbar {\n\twidth: ").concat(t?Tt:"0",";\n\theight: ").concat(t?Tt:"0",";\n}\n::-webkit-scrollbar-track {\n\tbackground: ").concat(bt,";\n}\n::-webkit-scrollbar-thumb {\n\tbackground: ").concat(vt,";\n\tborder-radius: ").concat("8px",";\n\tborder: ").concat("4px"," solid ").concat(bt,";\n}\n::-webkit-scrollbar-thumb:hover {\n\tbackground: ").concat(yt,";\n}\niframe {\n\t").concat(zt(),"\n\t").concat(re(t),"\n\t").concat(fe,"\n\t").concat(Te,"\n}\np {\n\t").concat(zt(),"\n\t").concat(oe(t),"\n\t").concat(ue,"\n\t").concat(ke,"\n}\nh3 {\n\t").concat(zt(),"\n\t").concat(oe(t),"\n\t").concat(de,"\n\t").concat(Ne,"\n}\nh2 {\n\t").concat(zt(),"\n\t").concat(oe(t),"\n\t").concat(me,"\n\t").concat(Ee,"\n}\nh1 {\n\t").concat(zt(),"\n\t").concat(oe(t),"\n\t").concat(be,"\n\t").concat(Re,"\n}\nhr {\n\t").concat(zt(),"\n\t").concat(re(t),"\n\t").concat(ke,"\n}\n.fullscreenBar {\n\t").concat(t?Bt:Ft,"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t").concat(de,"\n\t").concat(Le,"\n\ttext-align: ").concat("center",";\n\tz-index: 1;\n\toverflow: hidden;\n}\n.fullscreenPanel {\n\t").concat(t?Qt:Mt,"\n\tmargin: 0 0 0 0;\n\tpadding: 0 ").concat(2.5,"% 0 ").concat(2.5,"%;\n\t").concat(fe,"\n\t").concat(Te,"\n\toverflow-y: scroll;\n\toverflow-x: auto;\n}\n.fullscreenBarLogo {\n\t").concat(t?Gt:Jt,"\n}\n.fullscreenBarLogoImage {\n\tposition: relative;\n\tdisplay: block;\n\tmax-width: 80%;\n\tmax-height: 70%;\n\tmargin: auto;\n  \ttop: 50%;\n  \t-ms-transform: translateY(-50%);\n  \ttransform: translateY(-50%);\n}\n.fullscreenBarMenu {\n\t").concat(t?Ut:Wt,"\n}\n.fullscreenBarMenuButton {\n\tposition: relative;\n\tdisplay: ").concat(t?"block":"inline-block",";\n\t").concat(t?"width: 100%;":"top: 100%; -ms-transform: translateY(-100%); transform: translateY(-100%);","\n\tmax-height: 100%;\n\t").concat(t?function(t){return It(t,4,1,!0,!1)}(t):function(t){return It(t,1,1,!0,!1)}(t),"\n\tbox-sizing: border-box;\n\ttext-decoration: none;\n}\n.fullscreenBarMenuButton.idle {\n\t").concat(Le,"\n}\n.fullscreenBarMenuButton.selected {\n\t").concat(Te,"\n}\n.fullscreenBarMenuButton.idle:hover {\n\tcolor: ").concat(St,";\n}\n.fullscreenBarMenuButton.selected:hover {\n\tcolor: ").concat(St,";\n}\n.loadingScreen {\n\t").concat(Ct,"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\tz-index: 900;\n\n\t.background {\n\t\t").concat(Ct,"\n\t\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t\t").concat(ve,"\n\t}\n\t.content {\n\t\tposition: absolute;\n\t\tmin-width: 50%;\n\t\ttop: 50%;\n\t\tleft: 50%;\n\t\ttransform: translate(-50%, -50%);\n\t\t").concat(be,"\n\t\t").concat(ne(t),"\n\t\t").concat(ye,"\n\t\ttext-align: center;\n\t\tz-index: 901;\n\t}\n}\n.popupScreen {\n\t").concat(Ct,"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\tz-index: 500;\n\n\t.background {\n\t\t").concat(Ct,"\n\t\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t\t").concat(we,"\n\t}\n\t.content {\n\t\tposition: absolute;\n\t\twidth: 80%;\n\t\twidth: 80%;\n\t\ttop: 50%;\n\t\tleft: 50%;\n\t\ttransform: translate(-50%, -50%);\n\t\t").concat(ue,"\n\t\t").concat(ee(t),"\n\t\t").concat(Se,"\n\t\toverflow-y: scroll;\n\t\tz-index: 501;\n\t}\n}\n.s_image {\n\t").concat(t?function(t){return Ot(!1,"".concat((25-Ht(t)).toFixed(2),"%"))}(t):$t(t),"\n\t").concat(re(t),"\n\t").concat(fe,"\n\t").concat(je,"\n}\n.m_image {\n\t").concat(t?Zt(t):Kt(),"\n\t").concat(re(t),"\n\t").concat(fe,"\n\t").concat(je,"\n}\n.m_linkImage {\n\t").concat(t?Zt(t):Ot(!1,"".concat(98..toFixed(2),"%")),"\n\t").concat(re(t),"\n\t").concat(fe,"\n\t").concat(Oe,"\n}\n.m_linkImage:hover {\n\tborder-color: ").concat(St,";\n}\n.l_image {\n\t").concat(t?$t(t):Kt(),"\n\t").concat(re(t),"\n\t").concat(fe,"\n\t").concat(je,"\n}\n.portal {\n\tposition: relative;\n\tdisplay: block;\n\tmargin: ").concat(t?"5%":"12.5%"," 0;\n\tpadding: 0 0;\n\tmax-width: ").concat(t?"30%":"70%",";\n}\n.postEntryButton {\n\t").concat(Vt(),"\n\t").concat(te(t),"\n\t").concat(he,"\n\t").concat(_e,"\n\ttext-decoration: none;\n}\n.postEntryButton:hover {\n\tborder-color: ").concat(St,";\n}\n.bigButton {\n\t").concat(Vt(),"\n\t").concat(function(t){return It(t,6,6)}(t),"\n\t").concat(de,"\n\t").concat(Pe,"\n\ttext-decoration: none;\n\ttext-align: center;\n}\n.bigButton:hover {\n\tborder-color: ").concat(St,";\n}\n.pagePath {\n\t").concat(function(t){return It(t,1,1,!1,!0)}(t),"\n\t").concat(ue,"\n}\n.listScrollPanel {\n\t").concat((e="".concat(100..toFixed(2),"%"),n="".concat(70..toFixed(2),"%"),"position: relative;\n\tdisplay: ".concat("block",";\n\twidth: ").concat(e,";\n\theight: ").concat(n,";")),"\n\t").concat(te(t),"\n\t").concat(Ae,"\n\toverflow: auto;\n}\n.listItem {\n\t").concat(Vt(),"\n\t").concat(te(t),"\n\t").concat(ue,"\n\t").concat(Ce,"\n\ttext-decoration: none;\n}\n.inlineTextInput {\n\t").concat(t?Xt():Vt(),"\n\t").concat(te(t),"\n\t").concat(ue,"\n\t").concat(qe,"\n}\n.inlineLabel {\n\t").concat(Xt(),"\n\t").concat(te(t),"\n\t").concat(ue,"\n\t").concat(Te,"\n}\n.inlineButton {\n\t").concat(Xt(),"\n\t").concat(te(t),"\n\t").concat(ue,"\n\t").concat(_e,"\n\ttext-decoration: none;\n}\n.inlineButton:hover {\n\tborder-color: ").concat(St,";\n\tcursor: pointer;\n}\n.inlineButton:disabled {\n\topacity: 0.25;\n\tcursor: not-allowed;\n}\n.inlineTabButton {\n\t").concat(Xt(),"\n\t").concat(te(t),"\n\t").concat(ue,"\n\ttext-decoration: none;\n}\n.inlineTabButton.idle {\n\t").concat(ke,"\n}\n.inlineTabButton.selected {\n\t").concat(xe,"\n}\n.inlineTabButton.idle:hover {\n\tcolor: ").concat(St,";\n}\n.inlineTabButton.selected:hover {\n\tcolor: ").concat(St,";\n}\n.snippet {\n\t").concat(Vt(),"\n\t").concat(ee(t),"\n\t").concat(he,"\n\t").concat(Ie,"\n\twhite-space: nowrap;\n}\n.excerpt {\n\t").concat(zt(),"\n\t").concat(ee(t),"\n\t").concat(pe,"\n\t").concat(De,"\n\twhite-space: pre-wrap;\n\twhite-space: -moz-pre-wrap;\n\twhite-space: -pre-wrap;\n\twhite-space: -o-pre-wrap;\n\tword-wrap: break-word;\n}\n.zero_row {\n\t").concat(Yt(),"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t").concat(ge,"\n}\n.xs_row {\n\t").concat(Yt(),"\n\t").concat(function(t){return It(t,.5,1)}(t),"\n\t").concat(ge,"\n}\n.s_row {\n\t").concat(Yt(),"\n\t").concat(te(t),"\n\t").concat(ge,"\n}\n.m_row {\n\t").concat(Yt(),"\n\t").concat(ee(t),"\n\t").concat(ge,"\n}\n.l_row {\n\t").concat(Yt(),"\n\t").concat(function(t){return It(t,3,3)}(t),"\n\t").concat(ge,"\n}\n.xl_row {\n\t").concat(Yt(),"\n\t").concat(ne(t),"\n\t").concat(ge,"\n}\n");var e,n};const Fe="* {\n\toverflow: hidden;\n\tvertical-align: middle;\n}\nbody {\n\t".concat(Ct,"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t").concat(ue,"\n\t").concat(ke,"\n\ttext-align: ").concat("left",";\n\tz-index: 0;\n}\na:link {\n  color: ").concat(yt,";\n}\na:visited {\n  color: ").concat(yt,";\n}\na:hover {\n  color: ").concat(St,";\n}\na:active {\n  color: ").concat(yt,";\n}\n.dim {\n\t").concat(Ee,"\n}\n.noTextDeco {\n\ttext-decoration: none;\n}\n.horizontallyCentered {\n\tleft: 50%;\n\ttransform: translate(-50%, 0);\n}\n\n@media (orientation: landscape) {\n\t").concat(Be(!0),"\n}\n\n@media (orientation: portrait) {\n\t").concat(Be(!1),"\n}");v().config();const Qe=function(){function t(){}return t.prototype.build=function(t,e){return n=this,r=void 0,a=function(){var n,r,o,a,c,i,s;return function(t,e){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(l){switch(l.label){case 0:return null==t&&(t="".concat(process.env.VIEWS_ROOT_DIR,"/page/static/error")),null==e&&(e="".concat(process.env.STATIC_PAGE_ROOT_DIR,"/error")),[4,C.getAllRelativePathsInDirRecursively(t)];case 1:n=(n=l.sent()).filter(function(t){return t.endsWith(".ejs")}),r=0,o=n,l.label=2;case 2:return r<o.length?(a=o[r],c=new $,s=(i=c).addLine,[4,Y.createStaticHTMLFromEJS("/page/static/error/"+a,{})]):[3,6];case 3:return s.apply(i,[l.sent()]),[4,c.build(a.replace(".ejs",".html"),e)];case 4:l.sent(),l.label=5;case 5:return r++,[3,2];case 6:return[2]}})},new((o=void 0)||(o=Promise))(function(t,e){function c(t){try{s(a.next(t))}catch(t){e(t)}}function i(t){try{s(a.throw(t))}catch(t){e(t)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof o?n:new o(function(t){t(n)})).then(c,i)}s((a=a.apply(n,r||[])).next())});var n,r,o,a},t}();function Me(){return t=this,e=void 0,r=function(){var t,e,n,r,o,a,c,i,s,l,u,p,h;return function(t,e){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(d){switch(d.label){case 0:return console.log("SSG START"),t=new V,e=new K,n=new $,o=(r=n).addLine,[4,Y.createStaticHTMLFromEJS("page/static/index.ejs",{})];case 1:return o.apply(r,[d.sent()]),[4,n.build("index.html")];case 2:return d.sent(),n=new $,c=(a=n).addLine,[4,Y.createStaticHTMLFromEJS("page/static/portfolio.ejs",{})];case 3:return c.apply(a,[d.sent()]),[4,n.build("portfolio.html")];case 4:return d.sent(),n=new $,s=(i=n).addLine,[4,Y.createStaticHTMLFromEJS("page/static/portfolio_minimal.ejs",{})];case 5:return s.apply(i,[d.sent()]),[4,n.build("portfolio_minimal.html")];case 6:return d.sent(),n=new $,u=(l=n).addLine,[4,Y.createStaticHTMLFromEJS("page/static/privacyPolicy.ejs",{})];case 7:return u.apply(l,[d.sent()]),[4,n.build("privacy-policy.html")];case 8:return d.sent(),n=new $,h=(p=n).addLine,[4,Y.createStaticHTMLFromEJS("page/static/termsOfService.ejs",{})];case 9:return h.apply(p,[d.sent()]),[4,n.build("terms-of-service.html")];case 10:return d.sent(),[4,new nt(t,e).build()];case 11:return d.sent(),[4,new pt(t,e).build()];case 12:return d.sent(),[4,(new Qe).build()];case 13:return d.sent(),[4,t.build()];case 14:return d.sent(),[4,e.build()];case 15:return d.sent(),[4,C.write("style.css",Fe)];case 16:return d.sent(),[4,(new ht).build()];case 17:return d.sent(),console.log("SSG END"),[2]}})},new((n=void 0)||(n=Promise))(function(o,a){function c(t){try{s(r.next(t))}catch(t){a(t)}}function i(t){try{s(r.throw(t))}catch(t){a(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(c,i)}s((r=r.apply(t,e||[])).next())});var t,e,n,r}v().config();const Ge=require("jsonwebtoken");var Ue=t.n(Ge);require("bcrypt");require("crypto");require("nodemailer");v().config();v().config();var Je=function(t,e,n,r){return new(n||(n=Promise))(function(o,a){function c(t){try{s(r.next(t))}catch(t){a(t)}}function i(t){try{s(r.throw(t))}catch(t){a(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(c,i)}s((r=r.apply(t,e||[])).next())})},We=function(t,e){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};v().config();var He=function(t,e){var n=" AND (".concat(t.map(function(t){return"roomMemberships.userStatus = '".concat(t,"'")}).join(" OR "),")");return"SELECT users.userID as userID, users.userName AS userName, roomMemberships.userStatus as userStatus\n    FROM users INNER JOIN roomMemberships ON roomMemberships.userID = users.userID\n    WHERE roomMemberships.roomID = ?".concat(t.length>0?n:"","\n    ORDER BY users.userID DESC LIMIT ").concat(10,", ").concat(10*e,";")};const ze={withUserName:function(t,e){return Je(void 0,void 0,void 0,function(){return We(this,function(n){switch(n.label){case 0:return[4,E.makeQuery("SELECT * FROM users WHERE userName = ?;",[t]).run(e,"SearchDB.users.withUserName")];case 1:return[2,n.sent()]}})})},withEmail:function(t,e){return Je(void 0,void 0,void 0,function(){return We(this,function(n){switch(n.label){case 0:return[4,E.makeQuery("SELECT * FROM users WHERE email = ?;",[t]).run(e,"SearchDB.users.withEmail")];case 1:return[2,n.sent()]}})})},whoJoinedRoom:function(t,e,n){return Je(void 0,void 0,void 0,function(){return We(this,function(r){switch(r.label){case 0:return[4,E.makeQuery(He(["member"],e),[t]).run(n,"SearchDB.users.whoJoinedRoom")];case 1:return[2,r.sent()]}})})},whoAreInvitedToJoinRoom:function(t,e,n){return Je(void 0,void 0,void 0,function(){return We(this,function(r){switch(r.label){case 0:return[4,E.makeQuery(He(["invited"],e),[t]).run(n,"SearchDB.users.whoAreInvitedToJoinRoom")];case 1:return[2,r.sent()]}})})},whoRequestedToJoinRoom:function(t,e,n){return Je(void 0,void 0,void 0,function(){return We(this,function(r){switch(r.label){case 0:return[4,E.makeQuery(He(["requested"],e),[t]).run(n,"SearchDB.users.whoRequestedToJoinRoom")];case 1:return[2,r.sent()]}})})},whoArePendingToJoinRoom:function(t,e,n){return Je(void 0,void 0,void 0,function(){return We(this,function(r){switch(r.label){case 0:return[4,E.makeQuery(He(["invited","requested"],e),[t]).run(n,"SearchDB.users.whoArePendingToJoinRoom")];case 1:return[2,r.sent()]}})})},whoAreAssociatedWithRoom:function(t,e,n){return Je(void 0,void 0,void 0,function(){return We(this,function(r){switch(r.label){case 0:return[4,E.makeQuery(He([],e),[t]).run(n,"SearchDB.users.whoAreAssociatedWithRoom")];case 1:return[2,r.sent()]}})})},others:function(t,e,n){return Je(void 0,void 0,void 0,function(){return We(this,function(r){switch(r.label){case 0:return[4,E.makeQuery("SELECT userID, userName FROM users\n                WHERE NOT EXISTS (SELECT userID FROM roomMemberships WHERE roomID = ".concat(t," LIMIT 1)\n                ORDER BY userID DESC LIMIT ").concat(10,", ").concat(10*e,";"),void 0).run(n,"SearchDB.users.others")];case 1:return[2,r.sent()]}})})}};v().config();var Ye=function(t,e,n,r){return new(n||(n=Promise))(function(o,a){function c(t){try{s(r.next(t))}catch(t){a(t)}}function i(t){try{s(r.throw(t))}catch(t){a(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(c,i)}s((r=r.apply(t,e||[])).next())})},Ve=function(t,e){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};v().config();var Ke="dev"==process.env.MODE,$e=0;function Ze(t,e,n,r){return Ye(this,void 0,void 0,function(){var o,a,c;return Ve(this,function(i){switch(i.label){case 0:if(o=function(t){var e=t.cookies.thingspool_token;if(e)return Xe(e);var n=10*(Math.floor(Date.now()/1e3)-17578e5)+$e;$e=($e+1)%10;var r=n.toString(16);return{userID:"0",userName:"Guest-".concat(r),userType:"guest",passwordHash:"NO_PASSWORD",email:"NO_EMAIL"}}(t),!o)return[3,9];if(!n(o))return _.log("User doesn't satisfy the pass-condition.",{user:o},"high","pink"),e.status(403).send("User doesn't satisfy the pass-condition."),[2,!1];switch(o.userType){case"admin":case"member":return[3,1];case"guest":return[3,4]}return[3,7];case 1:return i.trys.push([1,3,,4]),[4,en(o.userName,e)];case 2:case 5:return i.sent(),t.user=o,r(),[2,!0];case 3:return a=i.sent(),_.log("Failed to add token (registered user)",{err:a},"high","pink"),e.status(401).send("Failed to add token (error: ".concat(a,")")),[2,!1];case 4:return i.trys.push([4,6,,7]),[4,tn(o,e)];case 6:return c=i.sent(),_.log("Failed to add token (guest)",{err:c},"high","pink"),e.status(401).send("Failed to add token (error: ".concat(c,")")),[2,!1];case 7:return _.log("Unknown user type",{userType:o.userType},"high","pink"),e.status(500).send("Unknown user type :: ".concat(o.userType)),[2,!1];case 8:return[3,10];case 9:return _.logRaw("Authentication Failed","high","pink"),e.status(401).send("Authentication Failed"),[2,!1];case 10:return[2]}})})}function Xe(t){try{return Ue().verify(t,process.env.JWT_SECRET_KEY)||(_.log("User is not found in the given token.",{tokenLength:t.length},"high","yellow"),null)}catch(t){return _.log("Token Verification Failed",{err:t},"high","pink"),null}}function tn(t,e){return Ye(this,void 0,void 0,function(){var n;return Ve(this,function(r){return n=Ue().sign(t,process.env.JWT_SECRET_KEY),null==e||e.cookie("thingspool_token",n,{secure:!Ke,httpOnly:!0,sameSite:"strict",maxAge:31556926e5}).status(201),[2]})})}function en(t,e){return Ye(this,void 0,void 0,function(){var n,r;return Ve(this,function(o){switch(o.label){case 0:return[4,nn(t,e)];case 1:return(n=o.sent())?(r=Ue().sign(n,process.env.JWT_SECRET_KEY),null==e||e.cookie("thingspool_token",r,{secure:!Ke,httpOnly:!0,sameSite:"strict",maxAge:31556926e5}).status(201),[2]):(_.log("Failed to add token (user not found)",{userName:t},"high"),null==e||e.status(404).send('Tried to add token, but there is no account with userName "'.concat(t,'".')),[2])}})})}function nn(t,e){return Ye(this,void 0,void 0,function(){var n;return Ve(this,function(r){switch(r.label){case 0:return[4,ze.withUserName(t,e)];case 1:return n=r.sent(),e&&(e.statusCode<200||e.statusCode>=300)?[2,null]:n&&0!=n.length?[2,n[0]]:(_.log("User Not Found",{userName:t},"high","pink"),null==e||e.clearCookie("thingspool_token").status(404).send('There is no account with userName "'.concat(t,'".')),[2,null])}})})}const rn=function(t){return Xe(t)},on=function(t,e){e.clearCookie("thingspool_token").status(200)},an=function(t,e,n){return Ye(void 0,void 0,void 0,function(){return Ve(this,function(r){switch(r.label){case 0:return[4,Ze(t,e,function(t){return"admin"==t.userType},n)];case 1:return r.sent(),[2]}})})},cn=function(t,e,n){return Ye(void 0,void 0,void 0,function(){return Ve(this,function(r){switch(r.label){case 0:return[4,Ze(t,e,function(t){return!0},n)];case 1:return r.sent(),[2]}})})};v().config();var sn=n().Router();sn.get("/mypage",cn,function(t,e){Y.render(t,e,"page/dynamic/mypage",{loginDestination:"".concat(process.env.URL_DYNAMIC,"/mypage")})}),sn.get("/register",function(t,e){Y.render(t,e,"page/dynamic/register",{registerDestination:"".concat(process.env.URL_DYNAMIC,"/mypage")})}),sn.get("/login",function(t,e){Y.render(t,e,"page/dynamic/login",{loginDestination:"".concat(process.env.URL_DYNAMIC,"/mypage")})}),"dev"==process.env.MODE?(sn.get("/admin",function(t,e){Y.render(t,e,"page/development/admin",{})}),sn.get("/console",function(t,e){Y.render(t,e,"page/development/console",{})}),sn.get("/test-ui",function(t,e){Y.render(t,e,"page/development/test_ui",{gameEntries:tt.gameEntries})})):(sn.get("/admin",an,function(t,e){Y.render(t,e,"page/development/admin",{})}),sn.get("/console",an,function(t,e){Y.render(t,e,"page/development/console",{})}));const ln=sn;v().config();const un=function(t,e){void 0===e&&(e=void 0),t.statusCode>=200&&t.statusCode<=299&&(e?t.json(e):t.end())},pn=function(t){return"".concat("dev"==process.env.MODE?"http://localhost:".concat(process.env.PORT):process.env.URL_STATIC,"/error/").concat(t,".html")};var hn=n().Router();hn.get("/clear-token",function(t,e){on(t,e),un(e)});const dn=hn;var fn=function(t,e,n,r){return new(n||(n=Promise))(function(o,a){function c(t){try{s(r.next(t))}catch(t){a(t)}}function i(t){try{s(r.throw(t))}catch(t){a(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(c,i)}s((r=r.apply(t,e||[])).next())})},mn=function(t,e){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};const bn=require("socket.io");var gn,vn=t.n(bn),yn={},wn="\nGGGGGGGGGGAAAAAAAAACCCCCCCCCCCCC\nGggggggggGaHaHaHaHaCcccccccccccC\nGggggggggGaaaaaaaaaCcccccccccccC\nGggggggggGaaaaaaaaaCCCCCccccCccC\nGggggggggGaaaaaaaaaaaaabbbbbbbbB\nGggggggggGaaaaahhhhhaaabbbbbBbbB\nKaaaaaaaaaaaaaahjjjhaaabbbbbbbbB\nKaaaaaaaaaaaaaahjjjhaaabbbbbbbbB\nKaaaaaaaaaaaaaahjjjhaaaBBBBBBBBB\nDDDDDDDDDaaaaaahjjjhaaaeeeeeeeeE\nDdddddddddddaaahjjjhaaaeeeeeeeeE\nDdddddddddddaaahhhhhaaaEeeeeeeeE\nDdddddddddddaaaaaaaaaaaEeeeeeeeE\nDdddddddddddDaaaaaaaaaaEeeeeeeeE\nDdddddddddddDiiiiiiiiiiEJeeeeeeE\nDDDDDDDDDDDDDiiiiiiiiiiEEEEEEEEE\nLLLLLLLLLLmmmmmmmmmNNNNNNNNNNNNN\nLllllllllLmmmmmmmmmnnnnnnnnnnnnN\nLllllllllLmmmooommmnnnnnnnnnnnnN\nLllllllllLmmmooommmnnnnPnnnnnnON\nLlllllllllmmmooommmnnnnPnnnnnnnN\nLlllllllllmmmooommmnnnnPnnnnnnON\nLllllllllLmmmooommmnnnnPnnnnnnnN\nLllllllllLmmmooommmnnnnnnnnnnnON\nLLLLLLLLLLmmmmmmmmmnnnnnnnnnnnnN\nRrrrrrrrssmmmmmmmmmNNqqqqqNNNNNN\nRrrrrrrrsssssssssssQQqqqqqQQQQQQ\nRrrrrrrRSssssssssssQqqqqqqqqqqqQ\nRrrrrrrRSssssssssssQqqqqqqqqqqqQ\nRrrrrrrRSssssssssssQqqqqqqqqqqqQ\nRrrrrrrRSssssssssssQqqqqqqqqqqqQ\nRRRRRRRRSSSSSSSSSSSQQQQQQQQQQQQQ\n".split("\n").map(function(t){return t.trim()}).filter(function(t){return t.length>0}).join("\n");const Sn=function(t,e){(gn=t.of("/game_sockets")).use(e),gn.on("connection",function(t){var e=t.handshake.auth;console.log("(GameSockets) Client connected :: ".concat(JSON.stringify(e))),t.on("objectMessage",function(e){e.message=e.message.trim().substring(0,32),t.broadcast.to("room_default").emit("objectMessage",e)}),t.on("objectSync",function(e){var n=yn[e.objectId];null!=n?(Object.assign(n.objectSpawnParams.transform,e.transform),t.broadcast.to("room_default").emit("objectSync",e)):console.error("Tried to sync a nonexistent object :: ".concat(JSON.stringify(e)))}),t.on("objectSpawn",function(e){null==yn[e.objectId]?(Object.assign({},e.transform),yn[e.objectId]={objectSpawnParams:e},t.broadcast.to("room_default").emit("objectSpawn",e)):console.error("Tried to spawn an already existing object :: ".concat(JSON.stringify(e)))}),t.on("objectDespawn",function(e){null!=yn[e.objectId]?(delete yn[e.objectId],t.broadcast.to("room_default").emit("objectDespawn",e)):console.error("Tried to despawn a nonexistent object :: ".concat(JSON.stringify(e)))}),t.on("disconnect",function(){console.log("(GameSockets) Client disconnected :: ".concat(JSON.stringify(e)));for(var t=[],n=0,r=Object.values(yn);n<r.length;n++){var o=r[n].objectSpawnParams;o.objectId.startsWith(e.userName)&&(console.log("Despawned :: ".concat(o.objectId)),t.push(o.objectId))}for(var a=0,c=t;a<c.length;a++){var i=c[a];null!=yn[i]&&delete yn[i],gn.to("room_default").emit("objectDespawn",{objectId:i})}}),t.join("room_default");var n={roomMap:wn,objectRecords:yn};t.emit("roomLoad",n)})},kn=require("cookie");v().config();var xn=new Set;function Tn(t){return function(e,n){var r=e.request.headers.cookie;if(console.log("Authenticating socket (ID: ".concat(e.id,")")),r){var o=kn.parse(r).thingspool_token;if(o){var a=rn(o);a?xn.has(a.userName)?n(new Error(pn("auth-duplication"))):t(a)?(xn.add(a.userName),e.on("disconnect",function(){xn.has(a.userName)?xn.delete(a.userName):console.error('User "'.concat(a.userName,'" is already disconnected.'))}),e.handshake.auth=a,n()):n(new Error(pn("auth-no-permission"))):n(new Error(pn("auth-failure")))}else n(new Error(pn("auth-failure")))}else n(new Error(pn("auth-failure")))}}v().config(),function(){var t,e,r,a;t=this,e=void 0,a=function(){var t,e;return function(t,e){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(r){switch(r.label){case 0:return"dev"!=process.env.MODE?[3,2]:[4,Me()];case 1:return r.sent(),[3,4];case 2:return"ssg"!=process.env.MODE?[3,4]:[4,Me()];case 3:return r.sent(),[2];case 4:return[4,E.runSQLFile("clear.sql")];case 5:return r.sent(),[4,E.runSQLFile("init.sql")];case 6:return r.sent(),t=n()(),e=o().createServer(t),t.set("view engine","ejs"),t.use(c().json()),t.use(c().urlencoded({extended:!0})),t.use(s()()),t.use(u()()),function(t){var e=this;"dev"==process.env.MODE&&(t.get("/",function(t,n){return fn(e,void 0,void 0,function(){var e;return mn(this,function(r){switch(r.label){case 0:return[4,C.read(t.url+"index.html")];case 1:return e=r.sent(),n.status(200).setHeader("content-type","text/html").send(Y.postProcessHTML(e)),[2]}})})}),t.get(/.*\.html$/,function(t,n){return fn(e,void 0,void 0,function(){var e;return mn(this,function(r){switch(r.label){case 0:return[4,C.read(t.url)];case 1:return e=r.sent(),n.status(200).setHeader("content-type","text/html").send(Y.postProcessHTML(e)),[2]}})})}),t.get(/.*\.js$/,function(t,n){return fn(e,void 0,void 0,function(){return mn(this,function(e){return n.status(200).setHeader("content-type","text/javascript").sendFile(C.getAbsoluteFilePath(t.url)),[2]})})}),t.get(/(.*\.css)|(.*\.jpg)|(.*\.png)|(.*\.ico)|(.*\.atom)|(.*\.xml)|(.*\.pdf)|(.*\.glb)$/,function(t,n){return fn(e,void 0,void 0,function(){return mn(this,function(e){return n.sendFile(C.getAbsoluteFilePath(t.url)),[2]})})})),t.use("/api/auth",dn),t.use("/",ln)}(t),e.listen(process.env.PORT,function(){console.log("---------------------------------------------"),console.log("Listening to port ".concat(process.env.PORT,"."))}),function(t){var e=new(vn().Server)(t);O(e,"dev"==process.env.MODE?function(t,e){return e()}:Tn(function(t){return"admin"==t.userType})),Sn(e,Tn(function(t){return!0}))}(e),[2]}})},new((r=void 0)||(r=Promise))(function(n,o){function c(t){try{s(a.next(t))}catch(t){o(t)}}function i(t){try{s(a.throw(t))}catch(t){o(t)}}function s(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(c,i)}s((a=a.apply(t,e||[])).next())})}()})();