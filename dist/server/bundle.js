(()=>{"use strict";var e={857:e=>{e.exports=require("os")}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const r=require("express");var o=n.n(r);const a=require("http");var c=n.n(a);const i=require("body-parser");var s=n.n(i);const u=require("cookie-parser");var l=n.n(u);const f=require("hpp");var d=n.n(f);const p=require("path");var h=n.n(p);const y=require("fs/promises");var m,v=n.n(y),b="</td>";const w=function(e,t){(m=e.of("/console_sockets")).use(t),m.on("connection",function(e){console.log("(ConsoleSockets) Client connected :: ".concat(JSON.stringify(e.handshake.auth))),e.on("command",function(t){console.log("(ConsoleSockets) Command received :: [".concat(t,"] - sent by :: ").concat(JSON.stringify(e.handshake.auth.user)));var n=t.split(" ");switch(n[0]){case"print":n.shift(),I.logRaw(0==n.length?"-":n.join(" "),"high");break;case"reboot":I.logRaw("Rebooting...","high"),process.exit(0);break;default:I.logRaw('Unknown command "'.concat(n[0],'".'),"high","pink")}}),e.on("disconnect",function(){console.log("(ConsoleSockets) Client disconnected :: ".concat(JSON.stringify(e.handshake.auth)))})})},g=function(e,t,n){var r,o,a;m?m.emit("log",(r=e,o=t,a=n,"".concat('<td style="color: #e0e020; background-color: #202090;">').concat(r).concat(b).concat('<td style="color: #20e020; background-color: #101010;">').concat(o).concat(b).concat('<td style="color: #303030; background-color: #c0c0c0;">').concat(a).concat(b))):console.log("".concat(e," (ORIGIN: ").concat(t,") (DETAILS: ").concat(n,")"))};var x=[],O={thresholdLogLevel:0,setThresholdLogLevel:function(e){O.thresholdLogLevel=isNaN(e)?O.getLogLevelFromName(e):e},getThresholdLogLevel:function(){return O.thresholdLogLevel},getLogLevelFromName:function(e){switch(e){case"low":return 0;case"medium":return 1;case"high":return 2;default:console.error('ERROR: Unknown log level name ("'.concat(e,'")'))}return 0},log:function(e,t,n,r){void 0===t&&(t=void 0),void 0===n&&(n="high");var o="";null!=t&&(o=JSON.stringify(t).substring(0,1024));var a=O.getStackTrace();O.getLogLevelFromName(n)>=O.thresholdLogLevel&&g((r?'<b style="color:'.concat(r,'">'):"")+e+(r?"</b>":""),a,o)},logRaw:function(e,t,n){void 0===t&&(t="high"),O.log(e,void 0,t,n)},getStackTrace:function(){for(var e=[],t=x.length-1;t>=0;--t)e.push(x[t]);return e.join(" <- ")},pushStackTrace:function(e){x.push(e),O.logRaw("pushStackTrace: ".concat(e),"high","gray")},popStackTrace:function(e){if(0!=x.length){var t=x.pop();t==e?O.logRaw("popStackTrace: ".concat(e),"high","gray"):O.logRaw("Name mismatch in stackTrace :: (traceName = ".concat(e,", expectedTraceName = ").concat(t,")"),"high","pink")}else O.logRaw("No name to pop in stackTrace :: (traceName = ".concat(e,")"),"high","pink")}};const I=O,S=require("dotenv");var j=n.n(S),k=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function c(e){try{s(r.next(e))}catch(e){a(e)}}function i(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,i)}s((r=r.apply(e,t||[])).next())})},_=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};j().config();var T={read:function(e,t){return k(void 0,void 0,void 0,function(){var n,r;return _(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),n=T.getAbsoluteFilePath(e,t),[4,v().readFile(n,{encoding:"utf8"})];case 1:return[2,o.sent()];case 2:return r=o.sent(),I.log("Failed to read file",{relativeFilePath:e,err:r},"high","pink"),[2,""];case 3:return[2]}})})},write:function(e,t,n){return k(void 0,void 0,void 0,function(){var r,o;return _(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),r=T.getAbsoluteFilePath(e,n),[4,v().writeFile(r,t)];case 1:return a.sent(),[3,3];case 2:return o=a.sent(),I.log("Failed to write file",{relativeFilePath:e,err:o},"high","pink"),[3,3];case 3:return[2]}})})},getAllRelativePathsInDirRecursively:function(e){return k(void 0,void 0,void 0,function(){var t,n;return _(this,function(r){switch(r.label){case 0:return t=h().join(process.env.PWD,e),n=[],[4,T.getAllRelativePathsInDirRecursively_internal(t,[],n)];case 1:return r.sent(),[2,n]}})})},getAbsoluteFilePath:function(e,t){return null==t&&(t=process.env.STATIC_PAGE_ROOT_DIR),h().join(process.env.PWD,t+"/"+e)},getAllRelativePathsInDirRecursively_internal:function(e,t,n){return k(this,void 0,void 0,function(){var r,o,a,c,i,s;return _(this,function(u){switch(u.label){case 0:return[4,v().readdir(e)];case 1:r=u.sent(),o=0,a=r,u.label=2;case 2:return o<a.length?(c=a[o],i=t.concat(c),s="".concat(e,"/").concat(c),[4,v().lstat(s)]):[3,7];case 3:return u.sent().isFile()?(n.push(i.join("/")),[3,6]):[3,4];case 4:return[4,T.getAllRelativePathsInDirRecursively_internal(s,i,n)];case 5:u.sent(),u.label=6;case 6:return o++,[3,2];case 7:return[2]}})})}};const N=T,R={displayText:{pageName:{index:"Home",arcade:"Arcade",library:"Library",portfolio:"Portfolio",register:"Create Account",login:"Log In",mypage:"Portal"},message:{"error/userName/length":"Username must be between 4 and 16 characters long.","error/userName/chars":"Username can only contain alphabets, numbers, and underbar(_).","error/password/length":"Password must be between 6 and 24 characters long.","error/password/chars":"Password can only contain alphabets, numbers, and the following special characters: ~`!@#$%^&*()-_+={}[]|\\:;\"'<>,.?/","error/email/length":"Email address must not contain more than 64 characters.","error/email/chars":"Please enter a valid email address.","error/roomName/length":"Room name must be between 4 and 64 characters long.","error/roomName/chars":"Room name can only contain alphabets, numbers, spaces, and the following special characters: ~`!@#$%^&*()-_+={}[]|\\:;\"'<>,.?/","rule/userName/length":"Username must be between 4 and 16 characters long.","rule/userName/chars":"Username can only contain alphabets, numbers, and underbar(_).","rule/password/length":"Password must be between 6 and 24 characters long.","rule/password/chars":"Password can only contain alphabets, numbers, and the following special characters: ~`!@#$%^&*()-_+={}[]|\\:;\"'<>,.?/","rule/email/length":"Email address must not contain more than 64 characters.","rule/roomName/length":"Room name must be between 4 and 64 characters long.","rule/roomName/chars":"Room name can only contain alphabets, numbers, spaces, and the following special characters: ~`!@#$%^&*()-_+={}[]|\\:;\"'<>,.?/"}}},P={escapeHTMLChars:e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replaceAll("\n","<br>").replaceAll(" ","&nbsp;"),findErrorInUserName:e=>e.length<4||e.length>16?"error/userName/length":e!=P.sanitizeUserName(e)?"error/userName/chars":null,findErrorInPassword:e=>e.length<6||e.length>24?"error/password/length":e!=P.sanitizePassword(e)?"error/password/chars":null,findErrorInEmailAddress:e=>e.length>64?"error/email/length":/^[^\s@]+@[^\s@]+.[^\s@]+$/.test(e)?null:"error/email/chars",findErrorInRoomName:e=>e.length<4||e.length>64?"error/roomName/length":e!=P.sanitizeRoomName(e)?"error/roomName/chars":null,sanitizeUserName:e=>(e.length>16&&(e=e.substring(0,16)),e.replace(/[^a-zA-Z0-9_]/g,"")),sanitizePassword:e=>(e.length>24&&(e=e.substring(0,24)),e.replace(/[^a-zA-Z0-9~`!@#\$%\^&\*\(\)-_\+=\{\[\}\]\|\\:;"'<>,\.\?\/]/g,"")),sanitizeRoomName:e=>P.sanitizeRoomNameWithoutTrimming(e).trim(),sanitizeRoomNameWithoutTrimming:e=>(e.length>64&&(e=e.substring(0,64)),e.replace(/[^a-zA-Z0-9~`!@#\$%\^&\*\(\)-_\+=\{\[\}\]\|\\:;"'<>,\.\?\/\s]/g,"").replace(/\s+/g," "))},E=P,L=require("ejs");var M=n.n(L),A=n(857);j().config();var D={getErrorPageURL:function(e){return"".concat("dev"==process.env.MODE?"http://".concat(D.getLocalIpAddress(),":").concat(process.env.PORT):process.env.URL_STATIC,"/error/").concat(e,".html")},getLocalIpAddress:function(){if("dev"!=process.env.MODE)throw new Error("Calling 'getLocalIpAddress' is not allowed in a non-dev mode.");for(var e=A.networkInterfaces(),t=0,n=Object.keys(e);t<n.length;t++)for(var r=0,o=e[n[t]];r<o.length;r++){var a=o[r];if("IPv4"==a.family&&!a.internal)return a.address}return"127.0.0.1"}};const U=D;j().config();var C="".concat(process.env.PWD,"/").concat(process.env.VIEWS_ROOT_DIR,"/partial"),B={TextUtil:E,UIConfig:R,ejsPartialRootPath:C,isStaticPage:!0},z={TextUtil:E,UIConfig:R,ejsPartialRootPath:C,isStaticPage:!1},F={},G={render:function(e,t,n,r){t.render(n,G.makeEJSParams(e,r),function(e,n){e?t.status(500).send(e.message):(n=G.postProcessHTML(n),t.status(200).setHeader("content-type","text/html").send(n))})},postProcessHTML:function(e){if("dev"==process.env.MODE){var t=U.getLocalIpAddress();return e.replaceAll("\n","!*NEW_LINE*!").replace(/(PROD_CODE_BEGIN).*?(PROD_CODE_END)/g,"REMOVED_PROD_CODE").replaceAll("!*NEW_LINE*!","\n").replaceAll(process.env.URL_STATIC,"http://".concat(t,":").concat(process.env.PORT)).replaceAll(process.env.URL_DYNAMIC,"http://".concat(t,":").concat(process.env.PORT))}return e},makeEJSParams:function(e,t){var n={};return Object.assign(n,z),Object.assign(n,t),n.userString&&I.log("'userString' shouldn't be defined manually in EJS params.",{mergedEJSParams:n},"high","pink"),n.userString=e.userString,n.globalDictionary&&I.log("'globalDictionary' shouldn't be defined manually in EJS params.",{mergedEJSParams:n},"high","pink"),n.globalDictionary={},n},makeEJSParamsStatic:function(e){var t={};return Object.assign(t,B),Object.assign(t,e),t},createStaticHTMLFromEJS:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return r=void 0,o=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}([e],t,!0),c=function(e,t){var n;return void 0===t&&(t={}),function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(r){switch(r.label){case 0:return null!=(n=F[e])?[3,2]:[4,N.read(e,process.env.VIEWS_ROOT_DIR)];case 1:n=r.sent(),F[e]=n,r.label=2;case 2:return[2,M().compile(n)(G.makeEJSParamsStatic(t))]}})},new((a=void 0)||(a=Promise))(function(e,t){function n(e){try{s(c.next(e))}catch(e){t(e)}}function i(e){try{s(c.throw(e))}catch(e){t(e)}}function s(t){var r;t.done?e(t.value):(r=t.value,r instanceof a?r:new a(function(e){e(r)})).then(n,i)}s((c=c.apply(r,o||[])).next())});var r,o,a,c}};const q=G;j().config();const W=function(){function e(){this.lines=["</urlset>"]}return e.prototype.addEntry=function(e,t){this.lines.push("</url>"),this.lines.push("  <lastmod>".concat(t,"</lastmod>")),this.lines.push("  <loc>".concat(process.env.URL_STATIC,"/").concat(e,"</loc>")),this.lines.push("<url>")},e.prototype.build=function(){return e=this,t=void 0,r=function(){return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(e){switch(e.label){case 0:return this.lines.push('<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">'),this.lines.push('<?xml version="1.0" encoding="UTF-8"?>'),this.lines.reverse(),[4,N.write("sitemap.xml",this.lines.join("\n"))];case 1:return e.sent(),[2]}})},new((n=void 0)||(n=Promise))(function(o,a){function c(e){try{s(r.next(e))}catch(e){a(e)}}function i(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,i)}s((r=r.apply(e,t||[])).next())});var e,t,n,r},e}();j().config();const V=function(){function e(){this.lines=["</feed>"],this.globalLatestUpdate=new Date(process.env.GLOBAL_LAST_MOD)}return e.prototype.addEntry=function(e,t,n,r){var o=new Date(n);o>this.globalLatestUpdate&&(this.globalLatestUpdate=o),this.lines.push("</entry>"),this.lines.push("  <summary>".concat(r,"</summary>")),this.lines.push("  <updated>".concat(o.toISOString(),"</updated>")),this.lines.push("  <id>".concat(e,"</id>")),this.lines.push('  <link href="'.concat(e,'"/>')),this.lines.push("  <title>".concat(t,"</title>")),this.lines.push("<entry>")},e.prototype.build=function(){return e=this,t=void 0,r=function(){return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(e){switch(e.label){case 0:return this.lines.push("<id>urn:uuid:02210672-5391-4cc8-800a-2a88f3a6d00c</id>"),this.lines.push("</author>"),this.lines.push("  <name>Youngjin Kang</name>"),this.lines.push("<author>"),this.lines.push("<updated>".concat(this.globalLatestUpdate.toISOString(),"</updated>")),this.lines.push('<link href="'.concat(process.env.URL_STATIC,'"/>')),this.lines.push('<link rel="self" type="application/atom+xml" href="'.concat(process.env.URL_STATIC,'/feed.atom"/>')),this.lines.push("<title>ThingsPool</title>"),this.lines.push('<feed xmlns="http://www.w3.org/2005/Atom">'),this.lines.push('<?xml version="1.0" encoding="utf-8"?>'),this.lines.reverse(),[4,N.write("feed.atom",this.lines.join("\n"))];case 1:return e.sent(),[2]}})},new((n=void 0)||(n=Promise))(function(o,a){function c(e){try{s(r.next(e))}catch(e){a(e)}}function i(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,i)}s((r=r.apply(e,t||[])).next())});var e,t,n,r},e}();j().config();const Q=function(){function e(){this.lines=[]}return e.prototype.addLine=function(e){this.lines.push(e)},e.prototype.getText=function(){return this.lines.join("\n")},e.prototype.build=function(e,t){return n=this,r=void 0,a=function(){return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(n){switch(n.label){case 0:return null==t&&(t=process.env.STATIC_PAGE_ROOT_DIR),[4,N.write(e,this.lines.join("\n"),t)];case 1:return n.sent(),[2]}})},new((o=void 0)||(o=Promise))(function(e,t){function c(e){try{s(a.next(e))}catch(e){t(e)}}function i(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o(function(e){e(n)})).then(c,i)}s((a=a.apply(n,r||[])).next())});var n,r,o,a},e}();j().config();var H=function(){function e(e,t){this.sitemapBuilder=e,this.atomFeedBuilder=t}return e.prototype.build=function(e){return t=this,n=void 0,o=function(){var t,n,r,o,a,c,i,s,u,l,f,d,p,h,y,m,v,b;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(w){switch(w.label){case 0:return t="".concat(e.dirName,"/page.html"),[4,N.read("".concat(e.dirName,"/source.txt"))];case 1:for(n=w.sent(),r=n.split(/\r?\n/),o=null==e.playLinkImagePathOverride?"play.png":e.playLinkImagePathOverride,a="",c="",r[0].startsWith(":d:")?a=r[0].substring(3):console.error(":d: is missing in -> "+e.title),r[1].startsWith(":k:")?c=r[1].substring(3).toLowerCase().replaceAll("-"," "):console.error(":k: is missing in -> "+e.title),i=[],s=1,u=[],l=function(){u.length>0&&(i.push("<p>".concat(u.join("<br>"),"</p>")),u.length=0)},f=2;f<r.length;++f)0==(d=(d=r[f]).trim()).length?l():d.startsWith("[")?(l(),(p=d.match(/\[(.*?)\]/)[1].trim()).length>0&&i.push("<h2>".concat(p,"</h2>"))):d.startsWith("<")?(l(),(h=d.match(/<(.*?)>/)[1]).length>0&&(y="".concat(process.env.URL_STATIC,"/").concat(e.dirName,"/").concat(h,".jpg"),i.push('<img class="l_image" src="'.concat(y,'" alt="ThingsPool - ').concat(e.title," (Screenshot ").concat(s++,')">')))):(d=d.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll("{%","<").replaceAll("%}",">"),u.push(d));return l(),null!=e.videoTag&&null!=e.videoTag&&i.push(e.videoTag),m=new Q,b=(v=m).addLine,[4,q.createStaticHTMLFromEJS("page/static/arcadeGame.ejs",{entry:e,relativeURL:t,description:a,keywords:c,playLinkImagePath:o,content:i.join("\n")})];case 2:return b.apply(v,[w.sent()]),this.sitemapBuilder.addEntry(t,e.lastmod),this.atomFeedBuilder.addEntry("".concat(process.env.URL_STATIC,"/").concat(t),e.title,e.lastmod,e.title),[4,m.build(t)];case 3:return w.sent(),[2]}})},new((r=void 0)||(r=Promise))(function(e,a){function c(e){try{s(o.next(e))}catch(e){a(e)}}function i(e){try{s(o.throw(e))}catch(e){a(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r(function(e){e(n)})).then(c,i)}s((o=o.apply(t,n||[])).next())});var t,n,r,o},e}();const J=H;var Y={gameEntries:[{dirName:"ArtRaider",title:"ArtRaider",playLinkImagePathOverride:"badge_onestore.png",playLinkURL:"https://onesto.re/0001000383",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/RuLgOJrNtKA?si=Ts_Yu_jdpB1qmNiT" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>',lastmod:"2025-04-15"},{dirName:"Water-vs-Fire",title:"Water vs Fire",playLinkURL:"https://www.gamearter.com/game/water-vs-fire",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/6DeA_m8Iq4M?si=hC1uzkEtBWpYcM8z" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>',lastmod:"2023-09-10"},{dirName:"HuntLand",title:"HuntLand",playLinkURL:"https://www.gamearter.com/game/huntland",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/3dRg6vvoPqc?si=FlnKVyzQq0_55sL2" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>',lastmod:"2023-09-10"},{dirName:"PoliceChase",title:"Police Chase",playLinkURL:"https://www.gamearter.com/game/policechase",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/kABg0j2mZqQ?si=3-JUZQnh3omVXSJd" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>',lastmod:"2023-09-10"},{dirName:"SpaceTown",title:"SpaceTown",playLinkURL:"https://www.gamearter.com/game/spacetown",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/NoiQzEKJM-A?si=o8vTNqW1kxCJ4MnW" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>',lastmod:"2023-09-20"}]};j().config();var X=function(){function e(e,t){this.sitemapBuilder=e,this.atomFeedBuilder=t}return e.prototype.build=function(){return e=this,t=void 0,r=function(){var e,t,n,r,o,a;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(c){switch(c.label){case 0:return e=new Q,n=(t=e).addLine,[4,q.createStaticHTMLFromEJS("page/static/arcade.ejs",{entries:Y.gameEntries})];case 1:return n.apply(t,[c.sent()]),[4,e.build("arcade.html")];case 2:c.sent(),this.sitemapBuilder.addEntry("arcade.html","2025-02-28"),r=0,o=Y.gameEntries,c.label=3;case 3:return r<o.length?(a=o[r],[4,new J(this.sitemapBuilder,this.atomFeedBuilder).build(a)]):[3,6];case 4:c.sent(),c.label=5;case 5:return r++,[3,3];case 6:return[2]}})},new((n=void 0)||(n=Promise))(function(o,a){function c(e){try{s(r.next(e))}catch(e){a(e)}}function i(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,i)}s((r=r.apply(e,t||[])).next())});var e,t,n,r},e}();const $=X;var K=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function c(e){try{s(r.next(e))}catch(e){a(e)}}function i(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,i)}s((r=r.apply(e,t||[])).next())})},Z=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};j().config();var ee=function(){function e(e,t){this.sitemapBuilder=e,this.atomFeedBuilder=t}return e.prototype.build=function(e){return K(this,void 0,void 0,function(){var t,n,r,o,a,c,i,s,u,l,f,d,p,h,y,m,v,b,w,g,x,O,I,S,j,k,_=this;return Z(this,function(T){switch(T.label){case 0:return t=!0,n="???",r=1,o=1,a=void 0,c=!1,i=!1,s=[],u=[],l=[],f="A writing by ThingsPool.",d="thingspool, software, engineering, philosophy",p=process.env.GLOBAL_LAST_MOD,h=n,y=f,m=d,v=p,b=function(){s.length>0&&(c?l.push('<div class="snippet"><pre><code>'.concat(s.join("\n"),"</code></pre></div>")):i?l.push('<pre><div class="excerpt">'.concat(s.join("\n"),"</div></pre>")):l.push("<p>".concat(s.join("<br>"),"</p>")),s.length=0)},w=function(t,n,c,i,s){return K(_,void 0,void 0,function(){var f,d,p,h;return Z(this,function(y){switch(y.label){case 0:return f="".concat(e.dirName,"/page-").concat(r,".html"),d=new Q,h=(p=d).addLine,[4,q.createStaticHTMLFromEJS("page/static/libraryPost.ejs",{title:t,desc:c,keywords:i,customOGImagePath:a,entry:e,pageNumber:r,isLastPage:s,content:l.join("\n")})];case 1:return h.apply(p,[y.sent()]),[4,d.build(f)];case 2:return y.sent(),l.length=0,this.sitemapBuilder.addEntry(f,n),this.atomFeedBuilder.addEntry("".concat(process.env.URL_STATIC,"/").concat(f),t,n,c),u.push({pageNumber:r,title:t,lastmod:n,desc:c,keywords:i,customOGImagePath:a}),r++,o=1,a=void 0,[2]}})})},[4,N.read("".concat(e.dirName,"/source.txt"))];case 1:g=T.sent(),x=g.split(/\r?\n/),O=0,T.label=2;case 2:return O<x.length?(I=x[O],c||i||(I=I.trim()),0!=I.length?[3,3]:(c||i?s.push("\n"):b(),[3,7])):[3,8];case 3:return I.startsWith("[")?(b(),t||(h=n),n=I.match(/\[(.*?)\]/)[1].trim(),S=I.match(/\](.*?)$/)[1].trim(),t?[3,5]:[4,w(h,v,y,m,!1)]):[3,6];case 4:T.sent(),y=f,m=d,v=p,T.label=5;case 5:return t=!1,l.push("<h1>".concat(n,"</h1>")),l.push('<p class="dim">Author: Youngjin Kang&nbsp;&nbsp;&nbsp;Date: '.concat(S,"</p>")),[3,7];case 6:!I.startsWith("<")||c||i?I.startsWith("@@")?l.push(I.substring(2)):I.startsWith("#$")?(b(),c=!c):I.startsWith('#"')?(b(),i=!i):I.startsWith(":d:")?(t||(y=f),f=I.substring(3)):I.startsWith(":k:")?(t||(m=d),d=I.substring(3).toLowerCase().replaceAll("-"," ")):I.startsWith(":l:")?(t||(v=p),p=I.substring(3)):(I=I.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll("{%","<").replaceAll("%}",">"),s.push(I)):(b(),(j=I.match(/<(.*?)>/)[1]).length>0&&(k="".concat(process.env.URL_STATIC,"/").concat(e.dirName,"/").concat(j,".jpg"),(null==a||I.endsWith("*"))&&(a=k),l.push('<img class="l_image" src="'.concat(k,'" alt="').concat(n.replaceAll('"',"&quot;")," (Figure ").concat(o++,')">')))),T.label=7;case 7:return++O,[3,2];case 8:return b(),[4,w(n,p,f,d,!0)];case 9:return T.sent(),[2,u]}})})},e}();const te=ee;j().config();var ne=function(){function e(e,t){this.sitemapBuilder=e,this.atomFeedBuilder=t}return e.prototype.build=function(e,t){return n=this,r=void 0,a=function(){var e,n,r,o,a,c,i;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(s){switch(s.label){case 0:e=0,s.label=1;case 1:return e<t.length?(n=t[e],[4,new te(this.sitemapBuilder,this.atomFeedBuilder).build(n)]):[3,6];case 2:return r=s.sent(),o="".concat(n.dirName,"/list.html"),a=new Q,i=(c=a).addLine,[4,q.createStaticHTMLFromEJS("page/static/libraryPostList.ejs",{entry:n,listRelativeURL:o,postInfoList:r})];case 3:return i.apply(c,[s.sent()]),[4,a.build("".concat(n.dirName,"/list.html"))];case 4:s.sent(),this.sitemapBuilder.addEntry("".concat(n.dirName,"/list.html"),r.sort(function(e,t){return Date.parse(t.lastmod)-Date.parse(e.lastmod)}).pop().lastmod),s.label=5;case 5:return++e,[3,1];case 6:return[2]}})},new((o=void 0)||(o=Promise))(function(e,t){function c(e){try{s(a.next(e))}catch(e){t(e)}}function i(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o(function(e){e(n)})).then(c,i)}s((a=a.apply(n,r||[])).next())});var n,r,o,a},e}();const re=ne;var oe={entriesByCategory:{Nonfiction:[{dirName:"metaphysics",title:"형이상학 (2013 - 2014)"},{dirName:"game-analysis",title:"게임분석 (2019)"},{dirName:"essays",title:"Miscellaneous Writings (2022 - 2024)"},{dirName:"blockchains",title:"On Legitimacy of Blockchains (2022)"},{dirName:"software-development",title:"Software Development (2022 - 2024)"},{dirName:"game-design",title:"Universal Laws of Game Design (2023)"},{dirName:"reality",title:"The Origin of Reality (2023)"},{dirName:"bridge-to-math",title:"A Layman's Bridge to Mathematics (2024)"},{dirName:"read-rec",title:"Recommended Readings (2024)"},{dirName:"morsels",title:"Morsels of Thought (2024)"},{dirName:"concepts-of-plan",title:"Concepts of a Plan (2025)"}],Fiction:[{dirName:"novels",title:"단편소설 (2012 - 2013)"},{dirName:"alien-job-interview",title:"Alien Job Interview (2022)"},{dirName:"infinite-treasures",title:"The Island of Infinite Treasures (2022)"},{dirName:"infsoc",title:"Influential Social Posts (2023)"},{dirName:"gamedev-journey",title:"A Game Developer's Journey (2023)"},{dirName:"sandwich",title:"Sandwich Engineering (2025)"}],Arts:[{dirName:"illustrations",title:"Illustrations (2009 - 2014)"},{dirName:"cartoons",title:"Cartoons (2011 - 2015)"}]}};j().config();var ae=function(){function e(e,t){this.sitemapBuilder=e,this.atomFeedBuilder=t}return e.prototype.build=function(){return e=this,t=void 0,r=function(){var e,t,n,r,o,a,c,i;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(s){switch(s.label){case 0:return e=new Q,n=(t=e).addLine,[4,q.createStaticHTMLFromEJS("page/static/library.ejs",{entriesByCategory:oe.entriesByCategory,gameEntries:Y.gameEntries})];case 1:return n.apply(t,[s.sent()]),[4,e.build("library.html")];case 2:s.sent(),this.sitemapBuilder.addEntry("library.html","2025-02-28"),r=0,o=Object.entries(oe.entriesByCategory),s.label=3;case 3:return r<o.length?(a=o[r],c=a[0],i=a[1],[4,new re(this.sitemapBuilder,this.atomFeedBuilder).build(c,i)]):[3,6];case 4:s.sent(),s.label=5;case 5:return r++,[3,3];case 6:return[2]}})},new((n=void 0)||(n=Promise))(function(o,a){function c(e){try{s(r.next(e))}catch(e){a(e)}}function i(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,i)}s((r=r.apply(e,t||[])).next())});var e,t,n,r},e}();const ce=ae;j().config();const ie=function(){function e(){}return e.prototype.build=function(e,t){return n=this,r=void 0,a=function(){var n,r,o,a,c;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(i){switch(i.label){case 0:return null==e&&(e="".concat(process.env.SRC_ROOT_DIR,"/shared/embeddedScripts")),null==t&&(t="".concat(process.env.VIEWS_ROOT_DIR,"/partial/embeddedScript")),[4,N.getAllRelativePathsInDirRecursively(e)];case 1:n=(n=i.sent()).filter(function(e){return e.endsWith(".js")}),r=0,o=n,i.label=2;case 2:return r<o.length?(a=o[r],[4,N.read(a,e)]):[3,6];case 3:return c=i.sent().split("\n").filter(function(e){return!e.startsWith("export ")}).join("\n").trim(),[4,N.write(a.replace(".js",".ejs"),'\n<%_ if (!locals.globalDictionary["script_included_('.concat(a,")\"]) { _%>\n\x3c!-- NOTE: This EJS partial is auto-generated by 'embeddedScriptBuilder.ts' --\x3e\n<%_ locals.globalDictionary[\"script_included_(").concat(a,')"] = true; _%>\n<script>\n').concat(c,"\n<\/script>\n<%_ } _%>\n").trim(),t)];case 4:i.sent(),i.label=5;case 5:return r++,[3,2];case 6:return[2]}})},new((o=void 0)||(o=Promise))(function(e,t){function c(e){try{s(a.next(e))}catch(e){t(e)}}function i(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o(function(e){e(n)})).then(c,i)}s((a=a.apply(n,r||[])).next())});var n,r,o,a},e}();var se,ue,le,fe="#101010",de="#303030",pe="#707070",he="#a0a0a0",ye="#c0c0c0",me="#d0c090",ve="#70c060",be="#b0a070",we="17px",ge={unit:{landscape:{vertical:.6,horizontal:1},portrait:{vertical:1,horizontal:2.5}}},xe=400,Oe=800,Ie=function(e,t,n,r,o,a){return"position: absolute;\n\tdisplay: block;\n\tleft: ".concat(e,"%;\n\tright: ").concat(t,"%;\n\ttop: ").concat(n,"%;\n\tbottom: ").concat(r,"%;\n\twidth: ").concat(o,"%;\n\theight: ").concat(a,"%;")},Se=function(e,t){return"position: relative;\n\tdisplay: ".concat(e?"block":"inline-block",";\n\tmax-width: ").concat(t,";")},je=function(e){return"position: relative;\n\tdisplay: ".concat(e?"block":"inline-block",";\n\tmax-width: none;\n\twidth: fit-content;\n\tblock-size: fit-content;")},ke=function(e,t,n,r,o){void 0===r&&(r=!1),void 0===o&&(o=!1);var a=ge.unit[e?"landscape":"portrait"],c=(a.vertical*t).toFixed(2),i=(a.horizontal*n).toFixed(2),s=o?"0":"".concat(c,"%"),u=o?"0":"".concat(i,"%"),l=r?"0":"".concat(c,"%"),f=r?"0":"".concat(i,"%");return"padding: ".concat(s," ").concat(u," ").concat(s," ").concat(u,";\n\tmargin: ").concat(l," ").concat(f," ").concat(l," 0;")},_e=function(e,t,n){return"font-size: ".concat(e,';\n\tfont-family: "Lucida Console", "Lucida Sans Typewriter", "Monaco", Consolas, monospace;\n\tfont-style: ').concat(t?"italic":"normal",";\n\tfont-weight: ").concat(n,";")},Te=function(e,t,n){return void 0===n&&(n=1),"background-color: ".concat(e,";\n\tcolor: ").concat(t,";").concat(n<1?"\n\topacity: ".concat(n,";"):"")},Ne=function(e,t,n){return void 0===n&&(n=1),Te(e,t,n)+"\n\tborder-radius: 2vmin;"},Re=function(e,t,n,r,o){return void 0===r&&(r="1.25"),void 0===o&&(o=1),Ne(e,t,o)+"\n"+"\tborder-bottom: ".concat(r,"vmin ").concat(n," solid;")+"\n"+"\tborder-right: ".concat(r,"vmin ").concat(n," solid;")},Pe=function(e,t,n,r,o){return void 0===r&&(r="1.25"),void 0===o&&(o=1),Ne(e,t,o)+"\n"+"\tborder: ".concat(r,"vmin ").concat(n," solid;")},Ee=Ie(0,0,0,0,100,100),Le=Ie(0,86,0,0,14,100),Me=Ie(0,0,0,88,100,12),Ae=Ie(14,5,0,0,81,100),De=Ie(0,2.5,12,0,95,88),Ue=Ie(0,0,0,86,100,14),Ce=Ie(0,0,14,0,100,80),Be=Ie(0,0,0,35,100,65),ze=Ie(0,0,65,0,100,35),Fe=function(e){return 2*ge.unit[e?"landscape":"portrait"].horizontal},Ge=function(e){return Se(!0,"".concat(100..toFixed(2),"%"))},qe=function(e){return Se(!0,"1%")},We=function(e){return je(!0)},Ve=function(e){return Se(!1,"".concat(100..toFixed(2),"%"))},Qe=function(e){return Se(!1,"".concat((50-Fe(e)).toFixed(2),"%"))},He=function(e){return Se(!1,"".concat((33-Fe(e)).toFixed(2),"%"))},Je=function(e){return je(!1)},Ye=function(e){return ke(e,1,1)},Xe=function(e){return ke(e,2,2)},$e=function(e){return ke(e,4,4)},Ke=function(e){return ke(e,2,1,!1,!0)},Ze=function(e){return ke(e,4,1,!1,!0)},et="min(".concat(1.8199999999999998.toFixed(2),"vmax, ").concat(16..toFixed(2),"px)"),tt="min(".concat(2.1839999999999997.toFixed(2),"vmax, ").concat(19.2.toFixed(2),"px)"),nt="min(".concat(2.6207999999999996.toFixed(2),"vmax, ").concat(23.04.toFixed(2),"px)"),rt="min(".concat(3.1449599999999998.toFixed(2),"vmax, ").concat(27.648.toFixed(2),"px)"),ot="min(".concat(3.7739519999999995.toFixed(2),"vmax, ").concat(33.1776.toFixed(2),"px)"),at=_e(et,!1,xe),ct=_e(et,!0,xe),it=_e(et,!1,Oe),st=(_e(tt,!0,xe),_e(tt,!0,Oe)),ut=(_e(nt,!0,xe),_e(nt,!0,Oe)),lt=(_e(rt,!0,xe),_e(rt,!0,Oe)),ft=(_e(ot,!0,xe),_e(ot,!0,Oe)),dt="opacity: 0;",pt=Te("#000000",ye,.7),ht=Re(me,de,be,"1.25"),yt=Te("#000000",ye,.7),mt=Re(de,he,ye,"1.25"),vt=Te(de,ye),bt=(se=ye,void 0===ue&&(ue="1.25"),void 0===le&&(le=1),Te(de,ye,le)+"\n"+"\tborder-bottom: ".concat(ue,"vmin ").concat(se," solid;")),wt=Te(de,he),gt=Te(he,de),xt=Te(de,pe),Ot=Te(de,me),It=Te(de,be),St=Re(de,he,he),jt=Ne(de,ye),kt=Ne(fe,ve),_t=Ne(fe,ve),Tt=Re(fe,he,pe,"0.5"),Nt=Re(fe,he,pe,"0.75"),Rt=Re(pe,ye,he,"0.25"),Pt=Pe(de,ye,pe,"0.1"),Et=Pe(he,ye,ye,"0.1"),Lt=function(e){return"\n@supports(-moz-appearance:none) {\n\t* {\n\t\tscrollbar-width: ".concat(e?"auto":"none",";\n\t\tscrollbar-color: ").concat(pe," ").concat(fe,";\n\t}\n}\n::-webkit-scrollbar {\n\twidth: ").concat(e?we:"0",";\n\theight: ").concat(e?we:"0",";\n}\n::-webkit-scrollbar-track {\n\tbackground: ").concat(fe,";\n}\n::-webkit-scrollbar-thumb {\n\tbackground: ").concat(pe,";\n\tborder-radius: ").concat("8px",";\n\tborder: ").concat("4px"," solid ").concat(fe,";\n}\n::-webkit-scrollbar-thumb:hover {\n\tbackground: ").concat(he,";\n}\niframe {\n\t").concat(Ge(),"\n\t").concat(Ke(e),"\n\t").concat(ut,"\n\t").concat(wt,"\n}\np {\n\t").concat(Ge(),"\n\t").concat(Ze(e),"\n\t").concat(at,"\n\t").concat(vt,"\n}\nh3 {\n\t").concat(Ge(),"\n\t").concat(Ze(e),"\n\t").concat(st,"\n\t").concat(It,"\n}\nh2 {\n\t").concat(Ge(),"\n\t").concat(Ze(e),"\n\t").concat(lt,"\n\t").concat(xt,"\n}\nh1 {\n\t").concat(Ge(),"\n\t").concat(Ze(e),"\n\t").concat(ft,"\n\t").concat(Ot,"\n}\nhr {\n\t").concat(Ge(),"\n\t").concat(Ke(e),"\n\t").concat(vt,"\n}\n.fullscreenBar {\n\t").concat(e?Le:Me,"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t").concat(st,"\n\t").concat(gt,"\n\ttext-align: ").concat("center",";\n\tz-index: 1;\n\toverflow: hidden;\n}\n.fullscreenPanel {\n\t").concat(e?Ae:De,"\n\tmargin: 0 0 0 0;\n\tpadding: 0 ").concat(2.5,"% 0 ").concat(2.5,"%;\n\t").concat(ut,"\n\t").concat(wt,"\n\toverflow-y: scroll;\n\toverflow-x: auto;\n}\n.fullscreenBarLogo {\n\t").concat(e?Ue:Be,"\n}\n.fullscreenBarLogoImage {\n\tposition: relative;\n\tdisplay: block;\n\tmax-width: 80%;\n\tmax-height: 70%;\n\tmargin: auto;\n  \ttop: 50%;\n  \t-ms-transform: translateY(-50%);\n  \ttransform: translateY(-50%);\n}\n.fullscreenBarMenu {\n\t").concat(e?Ce:ze,"\n}\n.fullscreenBarMenuButton {\n\tposition: relative;\n\tdisplay: ").concat(e?"block":"inline-block",";\n\t").concat(e?"width: 100%;":"top: 100%; -ms-transform: translateY(-100%); transform: translateY(-100%);","\n\tmax-height: 100%;\n\t").concat(e?function(e){return ke(e,4,1,!0,!1)}(e):function(e){return ke(e,1,1,!0,!1)}(e),"\n\tbox-sizing: border-box;\n\ttext-decoration: none;\n}\n.fullscreenBarMenuButton.idle {\n\t").concat(gt,"\n}\n.fullscreenBarMenuButton.selected {\n\t").concat(wt,"\n}\n.fullscreenBarMenuButton.idle:hover {\n\tcolor: ").concat(me,";\n}\n.fullscreenBarMenuButton.selected:hover {\n\tcolor: ").concat(me,";\n}\n.loadingScreen {\n\t").concat(Ee,"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\tz-index: 900;\n\n\t.background {\n\t\t").concat(Ee,"\n\t\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t\t").concat(pt,"\n\t}\n\t.content {\n\t\tposition: absolute;\n\t\tmin-width: 50%;\n\t\ttop: 50%;\n\t\tleft: 50%;\n\t\ttransform: translate(-50%, -50%);\n\t\t").concat(ft,"\n\t\t").concat($e(e),"\n\t\t").concat(ht,"\n\t\ttext-align: center;\n\t\tz-index: 901;\n\t}\n}\n.popupScreen {\n\t").concat(Ee,"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\tz-index: 500;\n\n\t.background {\n\t\t").concat(Ee,"\n\t\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t\t").concat(yt,"\n\t}\n\t.content {\n\t\tposition: absolute;\n\t\twidth: 80%;\n\t\twidth: 80%;\n\t\ttop: 50%;\n\t\tleft: 50%;\n\t\ttransform: translate(-50%, -50%);\n\t\t").concat(at,"\n\t\t").concat(Xe(e),"\n\t\t").concat(mt,"\n\t\toverflow-y: scroll;\n\t\tz-index: 501;\n\t}\n}\n.s_image {\n\t").concat(e?function(e){return Se(!1,"".concat((25-Fe(e)).toFixed(2),"%"))}(e):Qe(e),"\n\t").concat(Ke(e),"\n\t").concat(ut,"\n\t").concat(jt,"\n}\n.m_image {\n\t").concat(e?He(e):Ve(),"\n\t").concat(Ke(e),"\n\t").concat(ut,"\n\t").concat(jt,"\n}\n.m_linkImage {\n\t").concat(e?He(e):Se(!1,"".concat(98..toFixed(2),"%")),"\n\t").concat(Ke(e),"\n\t").concat(ut,"\n\t").concat(St,"\n}\n.m_linkImage:hover {\n\tborder-color: ").concat(me,";\n}\n.l_image {\n\t").concat(e?Qe(e):Ve(),"\n\t").concat(Ke(e),"\n\t").concat(ut,"\n\t").concat(jt,"\n}\n.portal {\n\tposition: relative;\n\tdisplay: block;\n\tmargin: ").concat(e?"5%":"12.5%"," 0;\n\tpadding: 0 0;\n\tmax-width: ").concat(e?"30%":"70%",";\n}\n.postEntryButton {\n\t").concat(We(),"\n\t").concat(Ye(e),"\n\t").concat(it,"\n\t").concat(Tt,"\n\ttext-decoration: none;\n}\n.postEntryButton:hover {\n\tborder-color: ").concat(me,";\n}\n.bigButton {\n\t").concat(We(),"\n\t").concat(function(e){return ke(e,6,6)}(e),"\n\t").concat(st,"\n\t").concat(Nt,"\n\ttext-decoration: none;\n\ttext-align: center;\n}\n.bigButton:hover {\n\tborder-color: ").concat(me,";\n}\n.pagePath {\n\t").concat(function(e){return ke(e,1,1,!1,!0)}(e),"\n\t").concat(at,"\n}\n.listScrollPanel {\n\t").concat((t="".concat(100..toFixed(2),"%"),n="".concat(70..toFixed(2),"%"),"position: relative;\n\tdisplay: ".concat("block",";\n\twidth: ").concat(t,";\n\theight: ").concat(n,";")),"\n\t").concat(Ye(e),"\n\t").concat(Pt,"\n\toverflow: auto;\n}\n.listItem {\n\t").concat(We(),"\n\t").concat(Ye(e),"\n\t").concat(at,"\n\t").concat(Et,"\n\ttext-decoration: none;\n}\n.inlineTextInput {\n\t").concat(e?Je():We(),"\n\t").concat(Ye(e),"\n\t").concat(at,"\n\t").concat(Rt,"\n}\n.inlineLabel {\n\t").concat(Je(),"\n\t").concat(Ye(e),"\n\t").concat(at,"\n\t").concat(wt,"\n}\n.inlineButton {\n\t").concat(Je(),"\n\t").concat(Ye(e),"\n\t").concat(at,"\n\t").concat(Tt,"\n\ttext-decoration: none;\n}\n.inlineButton:hover {\n\tborder-color: ").concat(me,";\n\tcursor: pointer;\n}\n.inlineButton:disabled {\n\topacity: 0.25;\n\tcursor: not-allowed;\n}\n.inlineTabButton {\n\t").concat(Je(),"\n\t").concat(Ye(e),"\n\t").concat(at,"\n\ttext-decoration: none;\n}\n.inlineTabButton.idle {\n\t").concat(vt,"\n}\n.inlineTabButton.selected {\n\t").concat(bt,"\n}\n.inlineTabButton.idle:hover {\n\tcolor: ").concat(me,";\n}\n.inlineTabButton.selected:hover {\n\tcolor: ").concat(me,";\n}\n.snippet {\n\t").concat(We(),"\n\t").concat(Xe(e),"\n\t").concat(it,"\n\t").concat(kt,"\n\twhite-space: nowrap;\n}\n.excerpt {\n\t").concat(Ge(),"\n\t").concat(Xe(e),"\n\t").concat(ct,"\n\t").concat(_t,"\n\twhite-space: pre-wrap;\n\twhite-space: -moz-pre-wrap;\n\twhite-space: -pre-wrap;\n\twhite-space: -o-pre-wrap;\n\tword-wrap: break-word;\n}\n.zero_row {\n\t").concat(qe(),"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t").concat(dt,"\n}\n.xs_row {\n\t").concat(qe(),"\n\t").concat(function(e){return ke(e,.5,1)}(e),"\n\t").concat(dt,"\n}\n.s_row {\n\t").concat(qe(),"\n\t").concat(Ye(e),"\n\t").concat(dt,"\n}\n.m_row {\n\t").concat(qe(),"\n\t").concat(Xe(e),"\n\t").concat(dt,"\n}\n.l_row {\n\t").concat(qe(),"\n\t").concat(function(e){return ke(e,3,3)}(e),"\n\t").concat(dt,"\n}\n.xl_row {\n\t").concat(qe(),"\n\t").concat($e(e),"\n\t").concat(dt,"\n}\n");var t,n};const Mt="* {\n\toverflow: hidden;\n\tvertical-align: middle;\n}\nbody {\n\t".concat(Ee,"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t").concat(at,"\n\t").concat(vt,"\n\ttext-align: ").concat("left",";\n\tz-index: 0;\n}\na:link {\n  color: ").concat(he,";\n}\na:visited {\n  color: ").concat(he,";\n}\na:hover {\n  color: ").concat(me,";\n}\na:active {\n  color: ").concat(he,";\n}\n.dim {\n\t").concat(xt,"\n}\n.noTextDeco {\n\ttext-decoration: none;\n}\n.horizontallyCentered {\n\tleft: 50%;\n\ttransform: translate(-50%, 0);\n}\n\n@media (orientation: landscape) {\n\t").concat(Lt(!0),"\n}\n\n@media (orientation: portrait) {\n\t").concat(Lt(!1),"\n}");j().config();const At=function(){function e(){}return e.prototype.build=function(e,t){return n=this,r=void 0,a=function(){var n,r,o,a,c,i,s;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(u){switch(u.label){case 0:return null==e&&(e="".concat(process.env.VIEWS_ROOT_DIR,"/page/static/error")),null==t&&(t="".concat(process.env.STATIC_PAGE_ROOT_DIR,"/error")),[4,N.getAllRelativePathsInDirRecursively(e)];case 1:n=(n=u.sent()).filter(function(e){return e.endsWith(".ejs")}),r=0,o=n,u.label=2;case 2:return r<o.length?(a=o[r],c=new Q,s=(i=c).addLine,[4,q.createStaticHTMLFromEJS("/page/static/error/"+a,{})]):[3,6];case 3:return s.apply(i,[u.sent()]),[4,c.build(a.replace(".ejs",".html"),t)];case 4:u.sent(),u.label=5;case 5:return r++,[3,2];case 6:return[2]}})},new((o=void 0)||(o=Promise))(function(e,t){function c(e){try{s(a.next(e))}catch(e){t(e)}}function i(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o(function(e){e(n)})).then(c,i)}s((a=a.apply(n,r||[])).next())});var n,r,o,a},e}();function Dt(){return e=this,t=void 0,r=function(){var e,t,n,r,o,a,c,i,s,u,l,f,d;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(p){switch(p.label){case 0:return console.log("SSG START"),e=new W,t=new V,n=new Q,o=(r=n).addLine,[4,q.createStaticHTMLFromEJS("page/static/index.ejs",{})];case 1:return o.apply(r,[p.sent()]),[4,n.build("index.html")];case 2:return p.sent(),n=new Q,c=(a=n).addLine,[4,q.createStaticHTMLFromEJS("page/static/portfolio.ejs",{})];case 3:return c.apply(a,[p.sent()]),[4,n.build("portfolio.html")];case 4:return p.sent(),n=new Q,s=(i=n).addLine,[4,q.createStaticHTMLFromEJS("page/static/portfolio_minimal.ejs",{})];case 5:return s.apply(i,[p.sent()]),[4,n.build("portfolio_minimal.html")];case 6:return p.sent(),n=new Q,l=(u=n).addLine,[4,q.createStaticHTMLFromEJS("page/static/privacyPolicy.ejs",{})];case 7:return l.apply(u,[p.sent()]),[4,n.build("privacy-policy.html")];case 8:return p.sent(),n=new Q,d=(f=n).addLine,[4,q.createStaticHTMLFromEJS("page/static/termsOfService.ejs",{})];case 9:return d.apply(f,[p.sent()]),[4,n.build("terms-of-service.html")];case 10:return p.sent(),[4,new $(e,t).build()];case 11:return p.sent(),[4,new ce(e,t).build()];case 12:return p.sent(),[4,(new At).build()];case 13:return p.sent(),[4,e.build()];case 14:return p.sent(),[4,t.build()];case 15:return p.sent(),[4,N.write("style.css",Mt)];case 16:return p.sent(),[4,(new ie).build()];case 17:return p.sent(),console.log("SSG END"),[2]}})},new((n=void 0)||(n=Promise))(function(o,a){function c(e){try{s(r.next(e))}catch(e){a(e)}}function i(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,i)}s((r=r.apply(e,t||[])).next())});var e,t,n,r}j().config();const Ut=require("mysql2/promise");var Ct=n.n(Ut);const Bt=function(e){return e instanceof Error?e.message:String(e)};var zt=function(){function e(e,t){this.queryStr=e,this.queryParams=t}return e.prototype.run=function(){return e=this,t=void 0,r=function(){var e,t,n,r;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(o){switch(o.label){case 0:I.log("SQL Query Started",{queryStr:this.queryStr},"low"),e=Jt.getPool(),o.label=1;case 1:return o.trys.push([1,3,,4]),e?[4,e.query(this.queryStr,this.queryParams)]:(I.logRaw("SQL Connection Pool Failed To Load","high","pink"),[2,{success:!1,data:[]}]);case 2:return t=o.sent(),n=t[0],t[1],I.log("SQL Query Succeeded",{queryStr:this.queryStr},"medium"),[2,{success:!0,data:n}];case 3:return r=o.sent(),I.log("SQL Query Error",{errorMessage:Bt(r)},"high","pink"),[2,{success:!1,data:[]}];case 4:return[2]}})},new((n=void 0)||(n=Promise))(function(o,a){function c(e){try{s(r.next(e))}catch(e){a(e)}}function i(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,i)}s((r=r.apply(e,t||[])).next())});var e,t,n,r},e}();const Ft=zt;var Gt=function(){function e(e){this.queries=e}return e.prototype.run=function(){return e=this,t=void 0,r=function(){var e,t,n,r,o,a,c;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(i){switch(i.label){case 0:I.log("SQL Transaction Began",{numQueries:this.queries.length},"low"),e=Jt.getPool(),t=void 0,n=0,i.label=1;case 1:return i.trys.push([1,9,11,12]),e?[4,e.getConnection()]:(I.logRaw("SQL Connection Pool Failed To Load","high","pink"),[2,!1]);case 2:return(t=i.sent())?[4,t.beginTransaction()]:(I.logRaw("SQL Transaction Connection Failed","high","pink"),[2,!1]);case 3:i.sent(),r=0,o=this.queries,i.label=4;case 4:return r<o.length?(a=o[r],[4,t.execute(a.queryStr,a.queryParams)]):[3,7];case 5:i.sent(),n++,I.log("SQL Transaction Query Succeeded",{progress:"".concat(n,"/").concat(this.queries.length),query:a},"low"),i.label=6;case 6:return r++,[3,4];case 7:return[4,t.commit()];case 8:return i.sent(),I.logRaw("SQL Transaction Committed","medium"),[3,12];case 9:return c=i.sent(),I.log("SQL Transaction Error",{progress:"".concat(n,"/").concat(this.queries.length),errorMessage:Bt(c)},"high","pink"),[4,null==t?void 0:t.rollback()];case 10:return i.sent(),[3,12];case 11:return null==t||t.release(),[2,n==this.queries.length];case 12:return[2]}})},new((n=void 0)||(n=Promise))(function(o,a){function c(e){try{s(r.next(e))}catch(e){a(e)}}function i(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,i)}s((r=r.apply(e,t||[])).next())});var e,t,n,r},e}();const qt=Gt;var Wt=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function c(e){try{s(r.next(e))}catch(e){a(e)}}function i(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,i)}s((r=r.apply(e,t||[])).next())})},Vt=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};j().config();var Qt="dev"==process.env.MODE,Ht=void 0;const Jt={getPool:function(){return Ht||(Ht?I.logRaw("DB connection pool is already created.","high","pink"):(Ht=Ct().createPool({host:Qt?process.env.SQL_HOST_DEV:process.env.SQL_HOST_PROD,user:Qt?process.env.SQL_USER_DEV:process.env.SQL_USER_PROD,password:Qt?process.env.SQL_PASS_DEV:process.env.SQL_PASS_PROD,database:"main",waitForConnections:!0,connectionLimit:10,queueLimit:0,enableKeepAlive:!0,keepAliveInitialDelay:0}))||I.logRaw("Failed to create a DB connection pool.","high","pink")),Ht},runQuery:function(e,t){return Wt(void 0,void 0,void 0,function(){return Vt(this,function(n){switch(n.label){case 0:return[4,new Ft(e,t).run()];case 1:return[2,n.sent()]}})})},runTransaction:function(e){return Wt(void 0,void 0,void 0,function(){return Vt(this,function(t){switch(t.label){case 0:return[4,new qt(e).run()];case 1:return[2,t.sent()]}})})}},Yt=require("bcrypt");var Xt=n.n(Yt),$t=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function c(e){try{s(r.next(e))}catch(e){a(e)}}function i(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,i)}s((r=r.apply(e,t||[])).next())})},Kt=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};j().config();const Zt={all:function(e){return $t(void 0,void 0,void 0,function(){return Kt(this,function(t){switch(t.label){case 0:return[4,Jt.runQuery("SELECT roomID, roomName, roomType FROM rooms\n                ORDER BY roomID LIMIT 10, ".concat(10*e,";"))];case 1:return[2,t.sent()]}})})},withRoomName:function(e){return $t(void 0,void 0,void 0,function(){return Kt(this,function(t){switch(t.label){case 0:return[4,Jt.runQuery("SELECT roomID, roomName, roomType FROM rooms WHERE roomName = ?;",[e])];case 1:return[2,t.sent()]}})})},withRoomType:function(e){return $t(void 0,void 0,void 0,function(){return Kt(this,function(t){switch(t.label){case 0:return[4,Jt.runQuery("SELECT roomID, roomName, roomType FROM rooms WHERE roomType = ?;",[e])];case 1:return[2,t.sent()]}})})}},en={all:function(e){return $t(void 0,void 0,void 0,function(){return Kt(this,function(t){switch(t.label){case 0:return[4,Jt.runQuery("SELECT * FROM users\n                ORDER BY userID LIMIT 10, ".concat(10*e,";"))];case 1:return[2,t.sent()]}})})},withUserName:function(e){return $t(void 0,void 0,void 0,function(){return Kt(this,function(t){switch(t.label){case 0:return[4,Jt.runQuery("SELECT * FROM users WHERE userName = ?;",[e])];case 1:return[2,t.sent()]}})})},withUserNameOrEmail:function(e,t){return $t(void 0,void 0,void 0,function(){return Kt(this,function(n){switch(n.label){case 0:return[4,Jt.runQuery("SELECT * FROM users WHERE userName = ? OR email = ?;",[e,t])];case 1:return[2,n.sent()]}})})}};j().config();const tn=function(e,t,n,r){return o=void 0,a=void 0,i=function(){return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(o){switch(o.label){case 0:return[4,Jt.runQuery("INSERT INTO users (userName, userType, passwordHash, email, tutorialStep)\n            VALUES (?, ?, ?, ?, 0);",[e,t,n,r])];case 1:return[2,o.sent().success]}})},new((c=void 0)||(c=Promise))(function(e,t){function n(e){try{s(i.next(e))}catch(e){t(e)}}function r(e){try{s(i.throw(e))}catch(e){t(e)}}function s(t){var o;t.done?e(t.value):(o=t.value,o instanceof c?o:new c(function(e){e(o)})).then(n,r)}s((i=i.apply(o,a||[])).next())});var o,a,c,i};var nn={Admin:0,Member:1,Guest:2};const rn=function(){function e(){}return e.decode=function(e){throw new Error("'decode' method is not implemented.")},e}();var on,an=(on=function(e,t){return on=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},on(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}on(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});const cn=function(e){function t(t){var n=e.call(this)||this;return n.str=t,n}return an(t,e),t.prototype.encode=function(e){for(var t=0;t<this.str.length;++t){var n=this.str.charCodeAt(t);(n<0||n>255)&&(console.error("Char code is out of the 8-bit range (code = ".concat(n,", string = ").concat(this.str,", index = ").concat(t,")")),n="?".charCodeAt(0)),e.view[e.byteIndex++]=n}e.view[e.byteIndex++]=0},t.decode=function(e){for(var n,r=[];e.byteIndex<e.view.length&&0!=(n=e.view[e.byteIndex++]);)r.push(String.fromCharCode(n));return new t(r.join(""))},t}(rn);var sn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),un={};const ln=function(e){function t(t,n){var r=e.call(this)||this;return r.enumValue=t,r.enumMap=n,r}return sn(t,e),t.prototype.encode=function(e){e.view[e.byteIndex++]=this.enumMap[this.enumValue]},t.decodeWithParams=function(e,n){return un=n,t.decode(e)},t.decode=function(e){return new t(un[e.view[e.byteIndex++]],un)},t}(rn);var fn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const dn=function(e){function t(t){var n=e.call(this)||this;return n.n=t,n}return fn(t,e),t.prototype.encode=function(e){(this.n<0||this.n>4294967295)&&console.error("Number is out of its desired range (n = ".concat(this.n,")")),Math.floor(this.n)!=this.n&&console.error("Number is not an integer (n = ".concat(this.n,")"));var t=Math.min(4294967295,Math.max(0,Math.floor(this.n))),n=t>>24&255,r=t>>16&255,o=t>>8&255,a=255&t;e.view[e.byteIndex++]=n,e.view[e.byteIndex++]=r,e.view[e.byteIndex++]=o,e.view[e.byteIndex++]=a},t.decode=function(e){return new t(e.view[e.byteIndex++]<<24|e.view[e.byteIndex++]<<16|e.view[e.byteIndex++]<<8|e.view[e.byteIndex++])},t}(rn);var pn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const hn=function(e){function t(t){var n=e.call(this)||this;return n.n=t,n}return pn(t,e),t.prototype.encode=function(e){(this.n<0||this.n>255)&&console.error("Number is out of its desired range (n = ".concat(this.n,")")),Math.floor(this.n)!=this.n&&console.error("Number is not an integer (n = ".concat(this.n,")"));var t=Math.min(255,Math.max(0,Math.floor(this.n)));e.view[e.byteIndex++]=t},t.decode=function(e){return new t(e.view[e.byteIndex++])},t}(rn);var yn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const mn=function(e){function t(t,n,r,o,a){var c=e.call(this)||this;return c.userID=t,c.userName=n,c.userType=r,c.email=o,c.tutorialStep=a,c}return yn(t,e),t.fromString=function(e){var n=e.split(" "),r=parseInt(n[0]),o=n[1],a=parseInt(n[2]),c=n[3],i=parseInt(n[4]);if(isNaN(r))throw new Error('userID is NaN (userString = "'.concat(e,'")'));if(isNaN(a))throw new Error('userType is NaN (userString = "'.concat(e,'")'));if(isNaN(i))throw new Error('tutorialStep is NaN (userString = "'.concat(e,'")'));return new t(r,o,a,c,i)},t.prototype.toString=function(){return"".concat(this.userID," ").concat(this.userName," ").concat(this.userType," ").concat(this.email," ").concat(this.tutorialStep)},t.fromSQL=function(e){return new t(e.userID,e.userName,e.userType,e.email,e.tutorialStep)},t.prototype.encode=function(e){new dn(this.userID).encode(e),new cn(this.userName).encode(e),new ln(this.userType,nn).encode(e),new cn(this.email).encode(e),new hn(this.tutorialStep).encode(e)},t.decode=function(e){return new t(dn.decode(e).n,cn.decode(e).str,ln.decodeWithParams(e,nn).enumValue,cn.decode(e).str,hn.decode(e).n)},t}(rn),vn=require("jsonwebtoken");var bn=n.n(vn),wn="thingspool_token_v".concat(0),gn=32,xn=50;j().config();var On="dev"==process.env.MODE;const In=function(){return"".concat(wn).concat(On?"_dev":"")};j().config();var Sn="dev"==process.env.MODE;const jn=function(e){try{var t=bn().verify(e,process.env.JWT_SECRET_KEY);return t?mn.fromString(t):void I.log("User is not found in the given token.",{tokenLength:e.length},"high","yellow")}catch(e){return void I.log("Token Verification Failed",{err:e},"high","pink")}},kn=function(e,t,n){return r=void 0,o=void 0,c=function(){var t;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(r){return t=bn().sign(e.toString(),process.env.JWT_SECRET_KEY),null==n||n.cookie(In(),t,{secure:!Sn,httpOnly:!0,sameSite:Sn?"lax":"strict",maxAge:31556926e5}).status(201),[2]})},new((a=void 0)||(a=Promise))(function(e,t){function n(e){try{s(c.next(e))}catch(e){t(e)}}function i(e){try{s(c.throw(e))}catch(e){t(e)}}function s(t){var r;t.done?e(t.value):(r=t.value,r instanceof a?r:new a(function(e){e(r)})).then(n,i)}s((c=c.apply(r,o||[])).next())});var r,o,a,c};j().config();const _n=function(e,t){return n=void 0,r=void 0,a=function(){var n;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(r){switch(r.label){case 0:return[4,en.withUserName(e)];case 1:return(n=r.sent()).success?0==n.data.length?(I.log("User Not Found",{userName:e},"high","pink"),null==t||t.clearCookie(In()).status(404).send('There is no account with userName "'.concat(e,'".')),[2,null]):[2,n.data[0]]:(null==t||t.status(500).send("Internal Server Error"),[2,null])}})},new((o=void 0)||(o=Promise))(function(e,t){function c(e){try{s(a.next(e))}catch(e){t(e)}}function i(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o(function(e){e(n)})).then(c,i)}s((a=a.apply(n,r||[])).next())});var n,r,o,a};j().config();var Tn=0;const Nn=function(e,t,n,r){return o=void 0,a=void 0,i=function(){var o,a,c,i,s;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(u){switch(u.label){case 0:if(o=function(e){var t=void 0,n=e.cookies[In()];if(n&&(t=jn(n)),!t){console.log("############ User not found (".concat(n,") --- (").concat(JSON.stringify(Object.entries(e.cookies)),")"));var r=10*(Math.floor(Date.now()/1e3)-1768e6)+Tn;Tn=(Tn+1)%10;var o=r.toString(16),a="Guest-".concat(o);t=new mn(0,a,nn.Guest,"",0)}return t}(e),!o)return[3,10];if(!n(o))return I.log("User doesn't satisfy the pass-condition.",{user:o},"high","pink"),t.status(403).send("User doesn't satisfy the pass-condition."),[2,!1];switch(o.userType){case nn.Admin:case nn.Member:return[3,1];case nn.Guest:return[3,5]}return[3,8];case 1:return u.trys.push([1,4,,5]),[4,_n(o.userName,t)];case 2:return(a=u.sent())?(c=mn.fromSQL(a),[4,kn(c,e,t)]):[2,!1];case 3:return u.sent(),e.userString=c.toString(),r(),[2,!0];case 4:return i=u.sent(),I.log("Failed to process a registered user",{err:i},"high","pink"),t.status(401).send("Failed to process a registered user (error: ".concat(i,")")),[2,!1];case 5:return u.trys.push([5,7,,8]),[4,kn(o,e,t)];case 6:return u.sent(),e.userString=o.toString(),r(),[2,!0];case 7:return s=u.sent(),I.log("Failed to add token (guest)",{err:s},"high","pink"),t.status(401).send("Failed to add token (error: ".concat(s,")")),[2,!1];case 8:return I.log("Unknown user type",{userType:o.userType},"high","pink"),t.status(500).send("Unknown user type :: ".concat(o.userType," (user: ").concat(o.toString(),")")),[2,!1];case 9:return[3,11];case 10:return I.logRaw("Authentication Failed","high","pink"),t.status(401).send("Authentication Failed"),[2,!1];case 11:return[2]}})},new((c=void 0)||(c=Promise))(function(e,t){function n(e){try{s(i.next(e))}catch(e){t(e)}}function r(e){try{s(i.throw(e))}catch(e){t(e)}}function s(t){var o;t.done?e(t.value):(o=t.value,o instanceof c?o:new c(function(e){e(o)})).then(n,r)}s((i=i.apply(o,a||[])).next())});var o,a,c,i};var Rn={findErrorInUserName:function(e){return e.length<4||e.length>16?"auth/error/userName/length":e!=Rn.sanitizeUserName(e)?"auth/error/userName/chars":null},findErrorInPassword:function(e){return e.length<6||e.length>24?"auth/error/password/length":e!=Rn.sanitizePassword(e)?"auth/error/password/chars":null},findErrorInEmailAddress:function(e){return e.length>64?"auth/error/email/length":/^[^\s@]+@[^\s@]+.[^\s@]+$/.test(e)?null:"auth/error/email/chars"},findErrorInRoomName:function(e){return e.length<4||e.length>64?"auth/error/roomName/length":e!=Rn.sanitizeRoomName(e)?"auth/error/roomName/chars":null},sanitizeUserName:function(e){return e.length>16&&(e=e.substring(0,16)),e.replace(/[^a-zA-Z0-9_]/g,"")},sanitizePassword:function(e){return e.length>24&&(e=e.substring(0,24)),e.replace(/[^a-zA-Z0-9~`!@#\$%\^&\*\(\)-_\+=\{\[\}\]\|\\:;"'<>,\.\?\/]/g,"")},sanitizeRoomName:function(e){return Rn.sanitizeRoomNameWithoutTrimming(e).trim()},sanitizeRoomNameWithoutTrimming:function(e){return e.length>64&&(e=e.substring(0,64)),e.replace(/[^a-zA-Z0-9~`!@#\$%\^&\*\(\)-_\+=\{\[\}\]\|\\:;"'<>,\.\?\/\s]/g,"").replace(/\s+/g," ")}};const Pn=Rn;function En(e){var t;return null!==(t=Ln.en[e])&&void 0!==t?t:e}var Ln={en:{"auth/error/userName/length":"Username must be between 4 and 16 characters long.","auth/error/userName/chars":"Username can only contain alphabets, numbers, and underbar(_).","auth/error/password/length":"Password must be between 6 and 24 characters long.","auth/error/password/chars":"Password can only contain alphabets, numbers, and the following special characters: ~`!@#$%^&*()-_+={}[]|\\:;\"'<>,.?/","auth/error/email/length":"Email address must not contain more than 64 characters.","auth/error/email/chars":"Please enter a valid email address.","auth/error/roomName/length":"Room name must be between 4 and 64 characters long.","auth/error/roomName/chars":"Room name can only contain alphabets, numbers, spaces, and the following special characters: ~`!@#$%^&*()-_+={}[]|\\:;\"'<>,.?/","auth/rule/userName/length":"Username must be between 4 and 16 characters long.","auth/rule/userName/chars":"Username can only contain alphabets, numbers, and underbar(_).","auth/rule/password/length":"Password must be between 6 and 24 characters long.","auth/rule/password/chars":"Password can only contain alphabets, numbers, and the following special characters: ~`!@#$%^&*()-_+={}[]|\\:;\"'<>,.?/","auth/rule/email/length":"Email address must not contain more than 64 characters.","auth/rule/roomName/length":"Room name must be between 4 and 64 characters long.","auth/rule/roomName/chars":"Room name can only contain alphabets, numbers, spaces, and the following special characters: ~`!@#$%^&*()-_+={}[]|\\:;\"'<>,.?/"}},Mn=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function c(e){try{s(r.next(e))}catch(e){a(e)}}function i(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,i)}s((r=r.apply(e,t||[])).next())})},An=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};j().config();var Dn="dev"==process.env.MODE;function Un(e,t){var n=Pn.findErrorInUserName(e.body.userName);if(null!=n)return I.log("UserName Error",{userName:e.body.userName,userNameError:n},"high","pink"),t.status(400).send(En(n)),!1;var r=Pn.findErrorInPassword(e.body.password);return null==r||(I.log("Password Error",{password:Dn?e.body.password:"(HIDDEN)",passwordError:r},"high","pink"),t.status(400).send(En(r)),!1)}const Cn=function(e,t){return Mn(void 0,void 0,void 0,function(){var n,r,o,a;return An(this,function(c){switch(c.label){case 0:return c.trys.push([0,6,,7]),Un(e,t)?[4,en.withUserNameOrEmail(e.body.userName,"test@example.com")]:[2];case 1:return(n=c.sent()).success?n.data.length>0?(I.log("User already exists",{userName:e.body.userName,email:"test@example.com",existingUser:n.data[0]},"high","pink"),t.status(403).send('User "'.concat(e.body.userName,'" (').concat("test@example.com",") already exists.")),[2]):[4,Xt().hash(e.body.password,10)]:(t.status(500).send("Internal Server Error (during search)"),[2]);case 2:return r=c.sent(),[4,tn(e.body.userName,nn.Member,r,"test@example.com")];case 3:return c.sent()?[4,_n(e.body.userName,t)]:(t.status(500).send("Internal Server Error (during registration)"),[2]);case 4:return(o=c.sent())?[4,kn(mn.fromSQL(o),e,t)]:[2];case 5:return c.sent(),[3,7];case 6:return a=c.sent(),I.log("User Registration Error",{err:a},"high","pink"),t.status(500).send("ERROR: Failed to register the user (".concat(a,").")),[3,7];case 7:return[2]}})})},Bn=function(e,t){return Mn(void 0,void 0,void 0,function(){var n,r;return An(this,function(o){switch(o.label){case 0:return o.trys.push([0,4,,5]),Un(e,t)?[4,_n(e.body.userName,t)]:[2];case 1:return(n=o.sent())?[4,Xt().compare(e.body.password,n.passwordHash)]:[2];case 2:return o.sent()?[4,kn(mn.fromSQL(n),e,t)]:(I.log("Wrong password",{passwordEntered:Dn?e.body.password:"(HIDDEN)",passwordHash:n.passwordHash},"high","pink"),t.status(401).send("Wrong password."),[2]);case 3:return o.sent(),[3,5];case 4:return r=o.sent(),I.log("Login Error",{err:r},"high","pink"),t.status(500).send("ERROR: Failed to login (".concat(r,").")),[3,5];case 5:return[2]}})})},zn=function(e,t){t.clearCookie(In()).status(200)},Fn=function(e,t,n){return Mn(void 0,void 0,void 0,function(){return An(this,function(r){switch(r.label){case 0:return[4,Nn(e,t,function(e){return e.userType==nn.Admin},n)];case 1:return r.sent(),[2]}})})},Gn=function(e,t,n){return Mn(void 0,void 0,void 0,function(){return An(this,function(r){switch(r.label){case 0:return[4,Nn(e,t,function(e){return!0},n)];case 1:return r.sent(),[2]}})})};j().config();var qn=o().Router();qn.get("/mypage",Gn,function(e,t){q.render(e,t,"page/dynamic/mypage",{loginDestination:"".concat(process.env.URL_DYNAMIC,"/mypage")})}),"dev"==process.env.MODE?(qn.get("/admin",function(e,t){q.render(e,t,"page/development/admin",{})}),qn.get("/console",function(e,t){q.render(e,t,"page/development/console",{})}),qn.get("/test-ui",function(e,t){q.render(e,t,"page/development/test_ui",{gameEntries:Y.gameEntries})}),qn.get("/tailwind_test",function(e,t){q.render(e,t,"page/development/tailwind_test",{loginDestination:"".concat(process.env.URL_DYNAMIC,"/tailwind_test")})})):(qn.get("/admin",Fn,function(e,t){q.render(e,t,"page/development/admin",{})}),qn.get("/console",Fn,function(e,t){q.render(e,t,"page/development/console",{})}));const Wn=qn;var Vn=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function c(e){try{s(r.next(e))}catch(e){a(e)}}function i(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,i)}s((r=r.apply(e,t||[])).next())})},Qn=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Hn=o().Router();Hn.post("/register",function(e,t){return Vn(void 0,void 0,void 0,function(){return Qn(this,function(n){switch(n.label){case 0:return[4,Cn(e,t)];case 1:return n.sent(),t.statusCode>=200&&t.statusCode<=299&&t.end(),[2]}})})}),Hn.post("/login",function(e,t){return Vn(void 0,void 0,void 0,function(){return Qn(this,function(n){switch(n.label){case 0:return[4,Bn(e,t)];case 1:return n.sent(),t.statusCode>=200&&t.statusCode<=299&&t.end(),[2]}})})}),Hn.get("/logout",function(e,t){zn(e,t),t.statusCode>=200&&t.statusCode<=299&&t.end()});const Jn=Hn;var Yn=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function c(e){try{s(r.next(e))}catch(e){a(e)}}function i(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,i)}s((r=r.apply(e,t||[])).next())})},Xn=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};const $n=require("socket.io");var Kn=n.n($n),Zn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const er=function(e){function t(t,n){var r=e.call(this)||this;return r.senderObjectId=t,r.message=n,r}return Zn(t,e),t.prototype.encode=function(e){new cn(this.senderObjectId).encode(e),new cn(this.message).encode(e)},t.decode=function(e){return new t(cn.decode(e).str,cn.decode(e).str)},t}(rn);var tr={normalizeInRange:function(e,t,n){return(tr.clampInRange(e,t,n)-t)/(n-t)},clampInRange:function(e,t,n){return Math.max(t,Math.min(n,e))},normalizeInRangeWithWarning:function(e,t,n){return(tr.clampInRangeWithWarning(e,t,n)-t)/(n-t)},clampInRangeWithWarning:function(e,t,n){return(e<t||e>n)&&console.warn("'n' is out of its expected range (n = ".concat(e,", min = ").concat(t,", max = ").concat(n,")")),Math.max(t,Math.min(n,e))}};const nr=tr;var rr=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),or=0,ar=0;const cr=function(e){function t(t,n,r){var o=e.call(this)||this;return o.n=t,o.min=n,o.max=r,o}return rr(t,e),t.prototype.encode=function(e){e.view[e.byteIndex++]=Math.floor(255.9999*nr.normalizeInRangeWithWarning(this.n,this.min,this.max))},t.decodeWithParams=function(e,n,r){return or=n,ar=r,t.decode(e)},t.decode=function(e){return new t(or+e.view[e.byteIndex++]*(ar-or)/255.9999,or,ar)},t}(rn);var ir=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),sr=[0,32],ur=[-1,4.019605882352941],lr=[-1,1.0157472440944881];const fr=function(e){function t(t,n,r,o,a,c){var i=e.call(this)||this;return i.x=t,i.y=n,i.z=r,i.dirX=o,i.dirY=a,i.dirZ=c,i}return ir(t,e),t.prototype.encode=function(e){new cr(this.x,sr[0],sr[1]).encode(e),new cr(this.y,ur[0],ur[1]).encode(e),new cr(this.z,sr[0],sr[1]).encode(e),new cr(this.dirX,lr[0],lr[1]).encode(e),new cr(this.dirY,lr[0],lr[1]).encode(e),new cr(this.dirZ,lr[0],lr[1]).encode(e)},t.decode=function(e){return new t(cr.decodeWithParams(e,sr[0],sr[1]).n,cr.decodeWithParams(e,ur[0],ur[1]).n,cr.decodeWithParams(e,sr[0],sr[1]).n,cr.decodeWithParams(e,lr[0],lr[1]).n,cr.decodeWithParams(e,lr[0],lr[1]).n,cr.decodeWithParams(e,lr[0],lr[1]).n)},t}(rn);var dr=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const pr=function(e){function t(t,n){var r=e.call(this)||this;return r.objectId=t,r.transform=n,r}return dr(t,e),t.prototype.encode=function(e){new cn(this.objectId).encode(e),this.transform.encode(e)},t.decode=function(e){return new t(cn.decode(e).str,fr.decode(e))},t}(rn);var hr=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const yr=function(e){function t(t){var n=e.call(this)||this;return n.roomID=t,n}return hr(t,e),t.prototype.encode=function(e){new dn(this.roomID).encode(e)},t.decode=function(e){return new t(dn.decode(e).n)},t}(rn),mr=function(e){var t=Math.sqrt(e.x*e.x+e.y*e.y);if(0==t)return{x:0,y:0};var n=1/t;return{x:e.x*n,y:e.y*n}},vr=function(e,t){return{x:e.x*t,y:e.y*t}},br=function(e,t){return{x:e.x+t.x,y:e.y+t.y}},wr=function(e,t){return{x:e.x-t.x,y:e.y-t.y}},gr=function(e,t){return e.x*t.y-e.y*t.x},xr=function(e,t){return e.x*t.x+e.y*t.y},Or=function(e,t){var n=t.x-e.x,r=t.y-e.y;return n*n+r*r};var Ir=new Array;function Sr(e,t){Ir.length=0;for(var n=Math.max(0,Math.floor(t.y-t.halfSizeY)),r=Math.max(0,Math.floor(t.x-t.halfSizeX)),o=Math.min(31,Math.floor(t.y+t.halfSizeY)),a=Math.min(31,Math.floor(t.x+t.halfSizeX)),c=n;c<=o;++c)for(var i=r;i<=a;++i){var s=e.voxels[c*gn+i];null!=s?Ir.push(s):console.error("PhysicsVoxel is undefined (row = ".concat(c,", col = ").concat(i,")"))}return Ir}var jr=new Array,kr=new Array;function _r(e,t){for(var n=!1,r=0;r<t.intersectingObjects.length;++r)t.intersectingObjects[r].objectId==e.objectId&&(console.error("Object already added to voxel (object = ".concat(JSON.stringify(e),", voxel = ").concat(JSON.stringify(t),")")),n=!0);for(n||t.intersectingObjects.push(e),n=!1,r=0;r<e.intersectingVoxels.length;++r)e.intersectingVoxels[r]==t&&(console.error("Voxel already added to object (object = ".concat(JSON.stringify(e),", voxel = ").concat(JSON.stringify(t),")")),n=!0);n||e.intersectingVoxels.push(t)}function Tr(e){jr.length=0;for(var t=0,n=e.intersectingVoxels;t<n.length;t++){var r=n[t];jr.push(r)}for(var o=0,a=jr;o<a.length;o++)Nr(e,r=a[o])}function Nr(e,t){for(var n=!1,r=t.intersectingObjects,o=0;o<r.length;++o)if(r[o].objectId==e.objectId){for(var a=o+1;a<r.length;++a)r[o]=r[a];--r.length,n=!0}n||console.error("Object not found in voxel (object = ".concat(JSON.stringify(e),", voxel = ").concat(JSON.stringify(t),")"))}var Rr={castAABBAgainstAABB:function(e,t,n){var r,o,a=n.x-n.halfSizeX-e.halfSizeX,c=n.y-n.halfSizeY-e.halfSizeY,i=n.x+n.halfSizeX+e.halfSizeX,s=n.y+n.halfSizeY+e.halfSizeY,u={x:a,y:c},l={x:i,y:c},f={x:a,y:s},d={x:i,y:s},p={start:u,end:l},h={start:l,end:d},y={start:d,end:f},m={start:f,end:u},v={start:{x:e.x,y:e.y},end:t},b=1;return(r=Math.min(b,Rr.raycastToLine(v,p,!0)))<b&&(b=r,o=p),(r=Math.min(b,Rr.raycastToLine(v,h,!0)))<b&&(b=r,o=h),(r=Math.min(b,Rr.raycastToLine(v,y,!0)))<b&&(b=r,o=y),(r=Math.min(b,Rr.raycastToLine(v,m,!0)))<b&&(b=r,o=m),{hitRayScale:b,hitLine:o}},raycastToLine:function(e,t,n){void 0===n&&(n=!1);var r=wr(e.end,e.start),o=wr(t.end,t.start),a=gr(r,o);if(0==a)return 1;if(n&&a>0)return 1;var c=1/a,i=wr(t.start,e.start),s=gr(i,o)*c,u=gr(i,r)*c;return s<0||s>1||u<0||u>1?1:s}};const Pr=Rr;function Er(e,t,n,r){var o=Pr.castAABBAgainstAABB(e,t,n);return o.hitRayScale<=r.minHitRayScale&&(r.minHitRayScale=o.hitRayScale,r.hitLine=o.hitLine),r}function Lr(e,t,n){if(t<0||t>=32||n<0||n>=gn)throw new Error("Voxel coordinates are out of range (row: ".concat(t,", col: ").concat(n,")"));return e.voxelGrid.voxels[t*gn+n]}function Mr(e,t){return t<0||t>7||!!(e.collisionLayerMask&1<<t)}function Ar(e){for(var t=7,n=e.collisionLayerMask;!(128&n);){if(0==(n<<=1))return 8;t--}return t}function Dr(e,t,n,r,o){var a=Ur(e,t,o),c=Br(n,r);return c>=6?-1:a+c}function Ur(e,t,n){return Cr(e,t)+6*n}function Cr(e,t){return xn*(e*gn+t)}function Br(e,t){return 2*("y"==e?0:"x"==e?1:2)+("-"==t?0:1)}function zr(e){var t=Math.floor(e%xn%6*.5);return 0==t?"y":1==t?"x":"z"}function Fr(e){return e%2==0?"-":"+"}function Gr(e){return Math.floor(e%xn/6)}function qr(e){var t=Math.floor(e/xn);return Math.floor(t/gn)}function Wr(e){return Math.floor(e/xn)%gn}var Vr={},Qr={minHitRayScale:1,hitLine:void 0};const Hr={load:function(e){if(null!=Vr[e.room.roomID])throw new Error("Physics-room already exists (roomID = ".concat(e.room.roomID,")"));var t=e.room.voxelGrid;Vr[e.room.roomID]={room:e.room,voxels:t.voxels.map(function(e){var t=e.row,n=e.col,r=new Array(4);return r.length=0,{voxel:e,hitbox:{x:n+.5,y:t+.5,halfSizeX:.5,halfSizeY:.5},intersectingObjects:r}}),objectById:{}}},unload:function(e){if(null==Vr[e])throw new Error("Physics-room doesn't exist (roomID = ".concat(e,")"));delete Vr[e]},hasRoom:function(e){return null!=Vr[e]},addObject:function(e,t,n,r){var o=Vr[e];if(null==o)throw new Error("Physics-room doesn't exist (roomID = ".concat(e,", objectId = ").concat(t,")"));if(null!=o.objectById[t])return console.warn("PhysicsObjct is already added (roomID = ".concat(e,", objectId = ").concat(t,")")),o.objectById[t];var a=Ar(o.voxels[Math.floor(n.y)*gn+Math.floor(n.x)].voxel),c=new Array(4);c.length=0;var i={objectId:t,collisionLayerMaskAtGroundLevel:r,level:8!=a?a:0,lastLevelChangeTime:.001*performance.now(),hitbox:n,intersectingVoxels:c};return o.objectById[t]=i,function(e,t,n){var r=e.objectById[t];if(null==r)throw new Error("PhysicsObject is not registered (objectId = ".concat(t,")"));var o=Sr(e,r.hitbox);r.hitbox.x=n.x,r.hitbox.y=n.y,Tr(r);for(var a=0,c=o;a<c.length;a++)_r(r,c[a])}(o,t,{x:n.x,y:n.y}),i},removeObject:function(e,t){var n=Vr[e];if(null==n)throw new Error("Physics-room doesn't exist (roomID = ".concat(e,", objectId = ").concat(t,")"));var r=n.objectById[t];if(null==r)throw new Error("PhysicsObject is not registered (roomID = ".concat(e,", objectId = ").concat(t,")"));delete n.objectById[t],Tr(r)},tryMoveObject:function(e,t,n){var r=Vr[e];if(null==Vr[e])throw new Error("Physics-room doesn't exist (roomID = ".concat(e,")"));var o=r.objectById[t];if(null==o)throw new Error("PhysicsObject is not registered (objectId = ".concat(t,")"));var a={x:o.hitbox.x,y:o.hitbox.y},c=Or(n,a);if(c>=9)return console.warn("Physics-position desync due to distance gap (startPos = (".concat(a.x.toFixed(3),", ").concat(a.y.toFixed(3),"), targetPos = (").concat(n.x.toFixed(3),", ").concat(n.y.toFixed(3),"), dist = ").concat(Math.sqrt(c),")")),{resolvedPos:a,desyncDetected:!0};if(c<1e-6)return{resolvedPos:a,desyncDetected:!1};var i=mr(wr(n,a));a=wr(a,vr(i,.01));var s=Math.min(a.x,n.x)-o.hitbox.halfSizeX,u=Math.max(a.x,n.x)+o.hitbox.halfSizeX,l=Math.min(a.y,n.y)-o.hitbox.halfSizeY,f=Math.max(a.y,n.y)+o.hitbox.halfSizeY,d=Math.floor(s),p=Math.floor(u),h=Math.floor(l),y=Math.floor(f);if(d<0||h<0||p>=gn||y>=32)return console.warn("Physics-position desync due to room boundary limit (startPos = (".concat(a.x.toFixed(3),", ").concat(a.y.toFixed(3),"), targetPos = (").concat(n.x.toFixed(3),", ").concat(n.y.toFixed(3),", minCol = ").concat(d,", minRow = ").concat(h,", maxCol = ").concat(p,", maxRow = ").concat(y,"))")),{resolvedPos:a,desyncDetected:!0};Qr.minHitRayScale=1,Qr.hitLine=void 0;for(var m=.001*performance.now(),v=r.voxels[Math.floor(a.y)*gn+Math.floor(a.x)].voxel,b=o.collisionLayerMaskAtGroundLevel<<o.level,w=o.collisionLayerMaskAtGroundLevel<<o.level+1,g=-9999,x=h;x<=y;++x)for(var O=d;O<=p;++O){var I=(z=r.voxels[x*gn+O]).voxel;0!=(I.collisionLayerMask&b)&&(m>=o.lastLevelChangeTime+.2&&!(128&b)&&0==(v.collisionLayerMask&w)&&0==(I.collisionLayerMask&w)?(o.level++,b=o.collisionLayerMaskAtGroundLevel<<o.level,o.lastLevelChangeTime=m):Er(o.hitbox,n,z.hitbox,Qr));var S=Ar(I);8!=S&&S>g&&(g=S)}o.level>0&&m>=o.lastLevelChangeTime+.2&&function(e){for(var t=0,n=e.collisionLayerMaskAtGroundLevel<<e.level;!(1&n);){if(0==(n>>=1))return 8;t++}return t}(o)>g+1&&(o.level--,b=o.collisionLayerMaskAtGroundLevel<<o.level,o.lastLevelChangeTime=m);for(var j=0,k=Object.values(r.objectById);j<k.length;j++){var _=k[j],T=_.collisionLayerMaskAtGroundLevel<<_.level;o.objectId!=_.objectId&&(o.hitbox.halfSizeX>0||o.hitbox.halfSizeY>0)&&0!=(b&T)&&(Qr=Er(o.hitbox,n,_.hitbox,Qr))}var N=n;if(null!=Qr.hitLine){var R=vr(wr(n,a),Qr.minHitRayScale),P=br(a,R),E=wr(n,P),L=wr(Qr.hitLine.end,Qr.hitLine.start),M=xr(E,L);M<0&&(L=wr(Qr.hitLine.start,Qr.hitLine.end),M=xr(E,L));for(var A=vr(L,M/xr(L,L)),D=br(P,A),U=!1,C=0,B=Sr(r,{x:D.x,y:D.y,halfSizeX:o.hitbox.halfSizeX,halfSizeY:o.hitbox.halfSizeY});C<B.length;C++){var z;0!=((z=B[C]).voxel.collisionLayerMask&b)&&(U=!0)}N=U?P:D}return o.hitbox.x=N.x,o.hitbox.y=N.y,{resolvedPos:N,desyncDetected:!1}},forceMoveObject:function(e,t,n){var r=Vr[e];if(null==Vr[e])throw new Error("Physics-room doesn't exist (roomID = ".concat(e,")"));var o=r.objectById[t];if(null==o)throw new Error("PhysicsObject is not registered (objectId = ".concat(t,")"));o.hitbox.x=n.x,o.hitbox.y=n.y},getObjectsInDist:function(e,t,n,r){var o=Vr[e];if(null==Vr[e])throw new Error("Physics-room doesn't exist (roomID = ".concat(e,")"));return function(e,t,n,r){var o=Sr(e,{x:t,y:n,halfSizeX:r,halfSizeY:r});kr.length=0;for(var a=0,c=o;a<c.length;a++)for(var i=0,s=c[a].intersectingObjects;i<s.length;i++){var u=s[i],l=u.hitbox.x-t,f=u.hitbox.y-n;l*l+f*f<=r*r&&kr.push(u)}return kr}(o,t,n,r)}};var Jr=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Yr=0,Xr=0;const $r=function(e){function t(t,n,r){var o=e.call(this)||this;return o.v=t,o.min=n,o.max=r,o}return Jr(t,e),t.prototype.encode=function(e){new cr(this.v.x,this.min,this.max).encode(e),new cr(this.v.y,this.min,this.max).encode(e)},t.decodeWithParams=function(e,n,r){return Yr=n,Xr=r,t.decode(e)},t.decode=function(e){var n=cr.decodeWithParams(e,Yr,Xr),r=cr.decodeWithParams(e,Yr,Xr);return new t({x:n.n,y:r.n},Yr,Xr)},t}(rn);var Kr=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const Zr=function(e){function t(t,n){var r=e.call(this)||this;return r.objectId=t,r.resolvedPos=n,r}return Kr(t,e),t.prototype.encode=function(e){new cn(this.objectId).encode(e),new $r(this.resolvedPos,0,32).encode(e)},t.decode=function(e){return new t(cn.decode(e).str,$r.decodeWithParams(e,0,32).v)},t}(rn);var eo=[[0,{objectType:"Voxel",components:{spawnedByAny:{instancedMeshGraphics:{createInstanceIdPool:!1},voxelMeshInstancer:{}}}}],[1,{objectType:"Player",components:{spawnedByAny:{collider:{collisionLayerMaskAtGroundLevel:31,hitboxSize:{sizeX:.6,sizeZ:.6}},speechBubble:{yOffset:2.4},playerProximityDetector:{maxDist:.45,maxLookAngle:-1}},spawnedByMe:{firstPersonController:{},objectSyncEmitter:{}},spawnedByOther:{modelGraphics:{path:"lowpolyghost/lowpolyghost.glb",localPosition:{x:0,y:1.22,z:0},scale:{x:.3,y:.3,z:.3}},objectSyncReceiver:{}}}}],[2,{objectType:"Canvas",components:{spawnedByAny:{collider:{collisionLayerMaskAtGroundLevel:0,hitboxSize:{sizeX:0,sizeZ:0}},instancedMeshGraphics:{createInstanceIdPool:!0},persistentObjectMeshInstancer:{},speechBubble:{yOffset:0},playerProximityDetector:{maxDist:3,maxLookAngle:.25*Math.PI}}}}]],to={},no={};eo.forEach(function(e){to[e[0]]=e[1],no[e[1].objectType]=e[0]});const ro=function(e){var t=to[e];if(null==t)throw new Error("getConfigByIndex :: Invalid object type index (objectTypeIndex = ".concat(e,")"));return t},oo=function(e){var t=no[e];if(null==t)throw new Error("getIndexByType :: Invalid object type (objectType = ".concat(e,")"));return t};var ao=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const co=function(e){function t(t,n,r,o,a){var c=e.call(this)||this;return c.sourceUserName=t,c.objectTypeIndex=n,c.objectId=r,c.transform=o,c.metadata=a,c}return ao(t,e),t.prototype.encode=function(e){new cn(this.sourceUserName).encode(e),new hn(this.objectTypeIndex).encode(e),new cn(this.objectId).encode(e),this.transform.encode(e),new cn(this.metadata).encode(e)},t.decode=function(e){return new t(cn.decode(e).str,hn.decode(e).n,cn.decode(e).str,fr.decode(e),cn.decode(e).str)},t}(rn);var io=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const so=function(e){function t(t){var n=e.call(this)||this;return n.objectSpawnParams=t,n}return io(t,e),t.prototype.encode=function(e){this.objectSpawnParams.encode(e)},t.decode=function(e){return new t(co.decode(e))},t}(rn);var uo=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const lo=function(e){function t(t){var n=e.call(this)||this;return n.objectId=t,n}return uo(t,e),t.prototype.encode=function(e){new cn(this.objectId).encode(e)},t.decode=function(e){return new t(cn.decode(e).str)},t}(rn);function fo(e,t){var n,r=e.socket.handshake.auth,o=Da.currentRoomIDByUserName[r.userName];if(console.log("RoomManager.removeObject :: roomID = ".concat(o,", userName = ").concat(r.userName,", objectId = ").concat(t)),null!=o){var a=Da.roomRuntimeMemories[o];if(null!=a){var c=a.objectRuntimeMemories[t];if(null!=c){delete a.objectRuntimeMemories[t],(null===(n=ro(c.objectSpawnParams.objectTypeIndex).components.spawnedByAny)||void 0===n?void 0:n.collider)&&Hr.removeObject(o,t);var i=new lo(t),s=Da.socketRoomContexts[o];s?s.multicastSignal("objectDespawnParams",i,r.userName):console.error("RoomManager.removeObject :: SocketRoomContext not found (roomID = ".concat(o,")"))}else console.error("RoomManager.removeObject :: ObjectRuntimeMemory doesn't exist (roomID = ".concat(o,", objectId = ").concat(t,")"))}else console.error("RoomManager.removeObject :: RoomRuntimeMemory doesn't exist (roomID = ".concat(o,", objectId = ").concat(t,")"))}else console.error("RoomManager.removeObject :: RoomID not found (userName = ".concat(r.userName,", objectId = ").concat(t,")"))}var po=0;const ho=function(e,t){void 0===t&&(t=0),this.view=e,this.byteIndex=t};var yo,mo=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),vo=-1,bo=-1;const wo=function(e){function t(t,n,r,o){var a=e.call(this)||this;return a.quadsMem=t,a.gameObjectId="",a.row=n,a.col=r,a.collisionLayerMask=o,a}return mo(t,e),t.prototype.setGameObjectId=function(e){this.gameObjectId=e},t.prototype.encode=function(e){if(this.collisionLayerMask<0||this.collisionLayerMask>255)throw new Error("Voxel's collisionLayerMask is out of its range (value found = ".concat(this.collisionLayerMask,", range = [0:255])"));var t=this.quadsMem.quads,n=Cr(this.row,this.col);e.view[e.byteIndex++]=t[n+xn-2],e.view[e.byteIndex++]=t[n+xn-1],e.view[e.byteIndex++]=this.collisionLayerMask;for(var r=0;r<=7;){if(1<<r&this.collisionLayerMask)for(var o=Ur(this.row,this.col,r),a=o;a<o+6;++a)e.view[e.byteIndex++]=t[a];r++}},t.decodeWithParams=function(e,n,r,o){return yo=n,vo=r,bo=o,t.decode(e)},t.decode=function(e){var n=yo.quads,r=Cr(vo,bo);n[r+xn-2]=e.view[e.byteIndex++],n[r+xn-1]=e.view[e.byteIndex++];for(var o=e.view[e.byteIndex++],a=o;0!=a;)a>>=1;for(var c=0;c<=7;){var i=Ur(vo,bo,c);if(1<<c&o)for(var s=i;s<i+6;++s)n[s]=e.view[e.byteIndex++];else for(s=i;s<i+6;++s)n[s]=0;c++}return new t(yo,vo,bo,o)},t.prototype.toString=function(){for(var e=this.quadsMem.quads,t=["(".concat(this.row,",").concat(this.col,"):")],n=Cr(this.row,this.col),r=n;r<n+xn;++r){var o=zr(r),a=Fr(r),c=Gr(r),i=e[r],s=127&i;128&i&&t.push("".concat(a).concat(o," at ").concat(c," (texture ").concat(s,")"))}return t.join("\n        ")},t}(rn),go=function(){this.quads=new Uint8Array(51200)};var xo=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Oo=function(e){function t(t,n){var r=e.call(this)||this;return r.voxels=t,r.quadsMem=n,r}return xo(t,e),t.prototype.encode=function(e){new hn(0).encode(e);for(var t=0,n=this.voxels;t<n.length;t++)n[t].encode(e)},t.decode=function(e){var n=hn.decode(e).n;if(n<0){for(var r=So[n](e),o=n;o<0;++o)r=jo[o](r);return r}var a=new Array(1024);a.length=0;for(var c=0,i=new go;c<1024;){var s=Math.floor(.03125*c),u=c%gn;if(s<0||u<0||s>=32||u>=gn)throw new Error("Decoded voxel coordinates are out of range (row = ".concat(s,", col = ").concat(u,")"));var l=wo.decodeWithParams(e,i,s,u);a[c++]=l}return new t(a,i)},t}(rn);const Io=Oo;var So=[function(e){return new Oo([],new go)}],jo=[function(e){return new Oo([],new go)}],ko=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const _o=function(e){function t(t,n,r,o,a,c,i){var s=e.call(this)||this;return s.objectId=t,s.objectTypeIndex=n,s.direction=r,s.x=o,s.y=a,s.z=c,s.metadata=i,s}return ko(t,e),t.prototype.encode=function(e){if(this.objectTypeIndex<0||this.objectTypeIndex>63)throw new Error("Object type index out of range (objectTypeIndex = ".concat(this.objectTypeIndex,")"));if(this.x<0||this.x>32)throw new Error("Object x out of range (x = ".concat(this.x,")"));if(this.z<0||this.z>32)throw new Error("Object z out of range (z = ".concat(this.z,")"));if(this.y<0||this.y>4)throw new Error("Object y out of range (y = ".concat(this.y,")"));e.view[e.byteIndex++]=this.objectTypeIndex<<2|("+z"==this.direction?0:"+x"==this.direction?1:"-z"==this.direction?2:3);var t=Math.floor(4*this.y),n=(12&t)>>2,r=3&t;e.view[e.byteIndex++]=Math.floor(2*this.x)<<2|n,e.view[e.byteIndex++]=Math.floor(2*this.z)<<2|r,new cn(this.metadata).encode(e)},t.decode=function(e){var n=e.view[e.byteIndex++],r=n>>2&63,o=3&n,a=o<=1?0==o?"+z":"+x":2==o?"-z":"-x",c=e.view[e.byteIndex++],i=.5*(c>>2&63),s=3&c,u=e.view[e.byteIndex++],l=.5*(u>>2&63),f=.25*(s<<2|3&u),d=cn.decode(e).str;return new t("p".concat(i,"-").concat(f,"-").concat(l),r,a,i,f,l,d)},t}(rn);var To=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const No=function(e){function t(t){var n=e.call(this)||this;return n.n=t,n}return To(t,e),t.prototype.encode=function(e){(this.n<0||this.n>65535)&&console.error("Number is out of its desired range (n = ".concat(this.n,")")),Math.floor(this.n)!=this.n&&console.error("Number is not an integer (n = ".concat(this.n,")"));var t=Math.min(65535,Math.max(0,Math.floor(this.n))),n=t>>8&255,r=255&t;e.view[e.byteIndex++]=n,e.view[e.byteIndex++]=r},t.decode=function(e){return new t(e.view[e.byteIndex++]<<8|e.view[e.byteIndex++])},t}(rn);var Ro,Po=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Eo=0;const Lo=function(e){function t(t,n){var r=e.call(this)||this;return r.arr=t,r.lengthLimit=n,r}return Po(t,e),t.prototype.encode=function(e){this.arr.length>this.lengthLimit&&console.error("Encodable data array's length limit exceeded (length = ".concat(this.arr.length,", lengthLimit = ").concat(this.lengthLimit,")"));var t=Math.min(this.arr.length,this.lengthLimit);if(this.lengthLimit<=255)new hn(t).encode(e);else{if(!(this.lengthLimit<=65535))throw new Error("Length limit of ".concat(this.lengthLimit," is not supported."));new No(t).encode(e)}for(var n=0;n<t;++n)this.arr[n].encode(e)},t.decodeWithParams=function(e,n,r){return Ro=n,Eo=r,t.decode(e)},t.decode=function(e){var n=0;if(Eo<256)n=hn.decode(e).n;else{if(!(Eo<65536))throw new Error("Length limit of ".concat(Eo," is not supported."));n=No.decode(e).n}for(var r=new Array(n),o=0;o<n;++o)r[o]=Ro(e);return new t(r,Eo)},t}(rn);var Mo=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ao=function(e){function t(t){var n=e.call(this)||this;return n.persistentObjects=t,n}return Mo(t,e),t.prototype.encode=function(e){new hn(0).encode(e),new Lo(this.persistentObjects,65535).encode(e);for(var t=0,n=this.persistentObjects;t<n.length;t++)n[t].encode(e)},t.decode=function(e){var n=hn.decode(e).n;if(n<0){for(var r=Uo[n](e),o=n;o<0;++o)r=Co[o](r);return r}return new t(Lo.decodeWithParams(e,_o.decode,65535).arr)},t}(rn);const Do=Ao;var Uo=[function(e){return new Ao([])}],Co=[function(e){return new Ao([])}],Bo=new ArrayBuffer(65536),zo=!1,Fo=0;const Go=function(e){if(void 0===e&&(e=0),zo)throw new Error("WriteBuffer is already reserved.");return zo=!0,Fo=e,new ho(new Uint8Array(Bo,e))},qo=function(e){zo||console.error("WriteBuffer is already free."),zo=!1;var t=e.view.buffer.slice(Fo,e.byteIndex);return Fo=0,t};var Wo={Hub:0,Regular:1},Vo=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const Qo=function(e){function t(t,n,r,o,a,c,i){var s=e.call(this)||this;return s.roomID=t,s.roomName=n,s.roomType=r,s.ownerUserName=o,s.texturePackURL=a,s.voxelGrid=c,s.persistentObjectGroup=i,s}return Vo(t,e),Object.defineProperty(t.prototype,"voxelQuads",{get:function(){return this.voxelGrid.quadsMem.quads},enumerable:!1,configurable:!0}),t.prototype.toSQL=function(){var e=Go();this.voxelGrid.encode(e);var t=qo(e);e=Go(e.byteIndex),this.persistentObjectGroup.encode(e);var n=qo(e);return{roomID:this.roomID,roomName:this.roomName,roomType:this.roomType,ownerUserName:this.ownerUserName,texturePackURL:this.texturePackURL,voxelGrid:t,persistentObjectGroup:n}},t.fromSQL=function(e){var n=Io.decode(new ho(new Uint8Array(e.voxelGrid))),r=Do.decode(new ho(new Uint8Array(e.persistentObjectGroup)));return new t(e.roomID,e.roomName,e.roomType,e.ownerUserName,e.texturePackURL,n,r)},t.prototype.encode=function(e){new dn(this.roomID).encode(e),new cn(this.roomName).encode(e),new ln(this.roomType,Wo).encode(e),new cn(this.ownerUserName).encode(e),new cn(this.texturePackURL).encode(e),this.voxelGrid.encode(e),this.persistentObjectGroup.encode(e)},t.decode=function(e){return new t(dn.decode(e).n,cn.decode(e).str,ln.decodeWithParams(e,Wo).enumValue,cn.decode(e).str,cn.decode(e).str,Io.decode(e),Do.decode(e))},t}(rn);var Ho=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const Jo=function(e){function t(t,n,r){var o=e.call(this)||this;return o.room=t,o.participantUserNames=n,o.objectRuntimeMemories=r,o}return Ho(t,e),t.prototype.encode=function(e){this.room.encode(e),new Lo(Object.keys(this.participantUserNames).map(function(e){return new cn(e)}),65535).encode(e),new Lo(Object.values(this.objectRuntimeMemories),65535).encode(e)},t.decode=function(e){for(var n=Qo.decode(e),r={},o=0,a=Lo.decodeWithParams(e,cn.decode,65535).arr;o<a.length;o++)r[a[o].str]=!0;for(var c={},i=0,s=Lo.decodeWithParams(e,so.decode,65535).arr;i<s.length;i++){var u=s[i];c[u.objectSpawnParams.objectId]=u}return new t(n,r,c)},t}(rn);var Yo=new(function(){function e(e){this.listeners={},this.currValue=e}return e.prototype.notify=function(e){if(void 0!==this.currValue)if(e)null!=(r=this.listeners[e])?r(this.currValue):console.error("Unicast key not found in the map of listeners (key = ".concat(e,")"));else for(var t=0,n=Object.values(this.listeners);t<n.length;t++){var r;(r=n[t])(this.currValue)}else console.error("Current value is undefined")},e.prototype.set=function(e,t){this.currValue=e,this.notify(t)},e.prototype.change=function(e,t){if(void 0===this.currValue)throw new Error("Tried to apply a change to an undefined currValue in an Observable.");var n=e(this.currValue);this.set(n,t)},e.prototype.peek=function(){if(void 0===this.currValue)throw new Error("Tried to access an undefined currValue in an Observable.");return this.currValue},e.prototype.addListener=function(e,t){if(null!=this.listeners[e])throw new Error("Listener key already exists (key = ".concat(e,")"));this.listeners[e]=t},e.prototype.removeListener=function(e){if(void 0===this.listeners[e])throw new Error("Listener key doesn't exist (key = ".concat(e,")"));delete this.listeners[e]},e}());const Xo=function(){function e(e,t){this.quadIndex=e,this.newQuad=t}return e.prototype.toString=function(){var e=qr(this.quadIndex),t=Wr(this.quadIndex),n=zr(this.quadIndex),r=Fr(this.quadIndex),o=Gr(this.quadIndex),a=!!(128&this.newQuad),c=127&this.newQuad;return"(".concat(e,",").concat(t,") ").concat(r).concat(n," at ").concat(o," ---\x3e ").concat(a?"show":"hide"," texture ").concat(c,"\n    Result: ").concat(this.voxelQuadsResultSnapshot||"(?)")},e}();function $o(e,t,n,r,o,a){void 0===a&&(a=-1);var c=Dr(t.row,t.col,n,r,o),i=t.quadsMem.quads[c],s=127&(a>=0?a:127&i)|(e?128:0);if(s==i)return!1;t.quadsMem.quads[c]=s;var u=new Xo(c,s);return Yo.set(u),!0}function Ko(e,t,n,r,o){var a=Cr(t,n);ea(e,a),e[a+xn-2]=128|o,e[a+xn-1]=128|r}function Zo(e,t,n,r,o,a){ea(e,Cr(t,n));for(var c=0;c<=7;++c)e[Ur(t,n,c)+Br(r,o)]=128|a}function ea(e,t){for(var n=t;n<t+xn;++n)e[n]=0}const ta={generateEmptyRoom:function(e,t,n){var r=new Array(1024),o=new go;ea(o.quads,Cr(0,0)),ea(o.quads,Cr(0,31)),ea(o.quads,Cr(31,0)),ea(o.quads,Cr(31,31)),r[0]=new wo(o,0,0,0),r[31]=new wo(o,0,31,0),r[992]=new wo(o,31,0,0),r[1023]=new wo(o,31,31,0);for(var a=1;a<31;++a)for(var c=1;c<31;++c)Ko(o.quads,a,c,e,n),r[a*gn+c]=new wo(o,a,c,0);for(c=1;c<31;++c){Zo(o.quads,0,c,"z","+",t),Zo(o.quads,31,c,"z","-",t);var i=new wo(o,0,c,255);r[c]=i;var s=new wo(o,31,c,255);r[992+c]=s;for(var u=0;u<=7;++u)$o(!0,i,"z","+",u,t),$o(!0,s,"z","-",u,t)}for(a=1;a<31;++a)for(Zo(o.quads,a,0,"x","+",t),Zo(o.quads,a,31,"x","-",t),i=new wo(o,a,0,255),r[a*gn]=i,s=new wo(o,a,31,255),r[a*gn+gn-1]=s,u=0;u<=7;++u)$o(!0,i,"x","+",u,t),$o(!0,s,"x","-",u,t);return{voxelGrid:new Io(r,o),persistentObjectGroup:new Do([])}}};var na=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function c(e){try{s(r.next(e))}catch(e){a(e)}}function i(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,i)}s((r=r.apply(e,t||[])).next())})},ra=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};j().config();const oa=function(e){return na(void 0,void 0,void 0,function(){var t;return ra(this,function(n){switch(n.label){case 0:return[4,Jt.runQuery("SELECT * FROM rooms WHERE rooms.roomID = ?;",[e])];case 1:return(t=n.sent()).success&&0!=t.data.length?[2,Qo.fromSQL(t.data[0])]:[2,null]}})})},aa=function(e,t,n,r,o,a,c){return na(void 0,void 0,void 0,function(){var i,s,u,l,f;return ra(this,function(d){switch(d.label){case 0:return i=ta.generateEmptyRoom(r,o,a),s=i.voxelGrid,u=i.persistentObjectGroup,l=new Qo(0,e,t,n,c,s,u),f=l.toSQL(),[4,Jt.runQuery("INSERT INTO rooms\n            (roomName, roomType, ownerUserName, texturePackURL, voxelGrid, persistentObjectGroup)\n            VALUES (?, ?, ?, ?, ?, ?);",[f.roomName,f.roomType,f.ownerUserName,f.texturePackURL,Buffer.from(f.voxelGrid),Buffer.from(f.persistentObjectGroup)])];case 1:return[2,d.sent().success]}})})},ca=function(){function e(){this.socketUserContexts={}}return e.prototype.getUserContexts=function(){return this.socketUserContexts},e.prototype.multicastSignal=function(e,t,n){void 0===n&&(n=void 0);for(var r=0,o=Object.entries(this.socketUserContexts);r<o.length;r++){var a=o[r],c=a[0],i=a[1];c!=n&&i.addPendingSignal(e,t)}},e.prototype.unicastSignal=function(e,t,n){var r=this.socketUserContexts[n];null!=r?r.addPendingSignal(e,t):console.error("SocketUserContext not found (targetUserName = ".concat(n,")"))},e.prototype.addSocketUserContext=function(e,t){null==this.socketUserContexts[e]?this.socketUserContexts[e]=t:console.error("SocketUserContext already exists (userName = ".concat(e,")"))},e.prototype.removeSocketUserContext=function(e){null!=this.socketUserContexts[e]?delete this.socketUserContexts[e]:console.error("SocketUserContext doesn't exist (userName = ".concat(e,")"))},e}();function ia(e){return t=this,n=void 0,o=function(){var t,n;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(r){switch(r.label){case 0:if(console.log("RoomManager.loadRoom :: roomID = ".concat(e)),null!=Da.roomRuntimeMemories[e])throw new Error("RoomManager.loadRoom :: RoomRuntimeMemory already exists (roomID = ".concat(e,")"));return[4,oa(e)];case 1:return(t=r.sent())?(n=new Jo(t,{},{}),Da.roomRuntimeMemories[e]=n,Da.socketRoomContexts[e]=new ca,Hr.load(n),[2,n]):[2,null]}})},new((r=void 0)||(r=Promise))(function(e,a){function c(e){try{s(o.next(e))}catch(e){a(e)}}function i(e){try{s(o.throw(e))}catch(e){a(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r(function(e){e(n)})).then(c,i)}s((o=o.apply(t,n||[])).next())});var t,n,r,o}var sa=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const ua=function(e){function t(t){var n=e.call(this)||this;return n.type=t,n}return sa(t,e),t.prototype.encode=function(e){throw new Error("Thie 'encode' method in UpdateVoxelGridTaskParams must be overriden by a child class.")},t.decode=function(e){throw new Error("Thie 'decode' method in UpdateVoxelGridTaskParams must be overriden by a child class.")},t}(rn);var la=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const fa=function(e){function t(t,n){var r=e.call(this,1)||this;return r.quadIndex=t,r.quadTextureIndicesWithinLayer=n,r}return la(t,e),t.prototype.encode=function(e){new No(this.quadIndex).encode(e);for(var t=0;t<6;++t)new hn(this.quadTextureIndicesWithinLayer[t]).encode(e)},t.decode=function(e){for(var n=No.decode(e).n,r=new Array(6),o=0;o<6;++o)r[o]=hn.decode(e).n;return new t(n,r)},t}(ua);var da=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const pa=function(e){function t(t){var n=e.call(this)||this;return n.n=t,n}return da(t,e),t.prototype.encode=function(e){(this.n<-128||this.n>127)&&console.error("Number is out of its desired range (n = ".concat(this.n,")")),Math.floor(this.n)!=this.n&&console.error("Number is not an integer (n = ".concat(this.n,")"));var t=Math.min(127,Math.max(-128,Math.floor(this.n)))+128;e.view[e.byteIndex++]=t},t.decode=function(e){return new t(e.view[e.byteIndex++]-128)},t}(rn);var ha=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const ya=function(e){function t(t,n,r,o){var a=e.call(this,0)||this;return a.quadIndex=t,a.rowOffset=n,a.colOffset=r,a.collisionLayerOffset=o,a}return ha(t,e),t.prototype.encode=function(e){new No(this.quadIndex).encode(e),new pa(this.rowOffset).encode(e),new pa(this.colOffset).encode(e),new pa(this.collisionLayerOffset).encode(e)},t.decode=function(e){return new t(No.decode(e).n,pa.decode(e).n,pa.decode(e).n,pa.decode(e).n)},t}(ua);var ma=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const va=function(e){function t(t){var n=e.call(this,2)||this;return n.quadIndex=t,n}return ma(t,e),t.prototype.encode=function(e){new No(this.quadIndex).encode(e)},t.decode=function(e){return new t(No.decode(e).n)},t}(ua);var ba=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const wa=function(e){function t(t,n){var r=e.call(this,3)||this;return r.quadIndex=t,r.textureIndex=n,r}return ba(t,e),t.prototype.encode=function(e){new No(this.quadIndex).encode(e),new hn(this.textureIndex).encode(e)},t.decode=function(e){return new t(No.decode(e).n,hn.decode(e).n)},t}(ua);var ga=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();const xa=function(e){function t(t){var n=e.call(this)||this;return n.tasks=t,n}return ga(t,e),t.prototype.encode=function(e){for(var t=0,n=this.tasks;t<n.length;t++){var r=n[t];new hn(r.type).encode(e),r.encode(e)}},t.decode=function(e){for(var n=[];e.byteIndex<e.view.byteLength;){var r=hn.decode(e).n;switch(r){case 0:n.push(ya.decode(e));break;case 1:n.push(fa.decode(e));break;case 2:n.push(va.decode(e));break;case 3:n.push(wa.decode(e));break;default:console.error("Unknown task type :: ".concat(r))}}return new t(n)},t}(rn);function Oa(e,t,n){var r=qr(t),o=Wr(t),a=Gr(t);if(a<0||a>7)return console.warn("collisionLayer is out of range (row: ".concat(r,", col: ").concat(o,", collisionLayer = ").concat(a,")")),!1;if(r<=0||o<=0||r>=31||o>=31)return console.warn("Cannot change a boundary voxel. (row: ".concat(r,", col: ").concat(o,", collisionLayer = ").concat(a,")")),!1;var c=Lr(e,r,o);return c?Mr(c,a)?(console.error("Voxel block already exists (row: ".concat(r,", col: ").concat(o,", collisionLayer: ").concat(a,")")),!1):(c.collisionLayerMask^=1<<a,Sa(e,c,a,n),!0):(console.error("No voxel found in (row: ".concat(r,", col: ").concat(o,")")),!1)}function Ia(e,t){var n=qr(t),r=Wr(t),o=Gr(t);if(o<0||o>7)return console.warn("collisionLayer is out of range (row: ".concat(n,", col: ").concat(r,", collisionLayer = ").concat(o,")")),!1;if(n<=0||r<=0||n>=31||r>=31)return console.warn("Cannot change a boundary voxel. (row: ".concat(n,", col: ").concat(r,", collisionLayer = ").concat(o,")")),!1;var a=Lr(e,n,r);return a?Mr(a,o)?(a.collisionLayerMask^=1<<o,Sa(e,a,o),!0):(console.error("No voxel block to remove (row: ".concat(n,", col: ").concat(r,", collisionLayer: ").concat(o,")")),!1):(console.error("No voxel found in (row: ".concat(n,", col: ").concat(r,")")),!1)}function Sa(e,t,n,r){var o=n-1;o<0&&(o=8);var a=n+1;a>7&&(a=8),ja(e,t,n,o,a,"y","-",null!=r?r[Br("y","-")]:void 0),ja(e,t,n,o,a,"y","+",null!=r?r[Br("y","+")]:void 0),ja(e,t,n,o,a,"x","-",null!=r?r[Br("x","-")]:void 0),ja(e,t,n,o,a,"x","+",null!=r?r[Br("x","+")]:void 0),ja(e,t,n,o,a,"z","-",null!=r?r[Br("z","-")]:void 0),ja(e,t,n,o,a,"z","+",null!=r?r[Br("z","+")]:void 0)}function ja(e,t,n,r,o,a,c,i){void 0===i&&(i=-1);var s=t,u=n;switch(a){case"y":u="-"==c?r:o;break;case"x":s=Lr(e,t.row,t.col+("-"==c?-1:1));break;case"z":s=Lr(e,t.row+("-"==c?-1:1),t.col)}var l=Mr(t,n),f=Mr(s,u),d=f&&!l;$o(l&&!f,t,a,c,n,i),$o(d,s,a,"-"==c?"+":"-",u)}function ka(e,t){var n=Pa(e);n&&function(e,t,n,r,o){var a=qr(t),c=Wr(t),i=Gr(t);if(!Lr(e,a,c))return console.error("No voxel found in (row: ".concat(a,", col: ").concat(c,")")),!1;for(var s=[],u=Ur(a,c,i),l=u;l<u+6;++l)s.push(127&e.voxelGrid.quadsMem.quads[l]);var f=i+o;return(f<0||f>7)&&(f=8),Oa(e,Dr(a+n,c+r,"y","-",f),s)&&Ia(e,t)}(n,t.quadIndex,t.rowOffset,t.colOffset,t.collisionLayerOffset)?Ra(e,n,t):console.error("Voxel update failed (moveVoxelBlockTask) - params: ".concat(JSON.stringify(t)))}function _a(e,t){var n=Pa(e);n&&Oa(n,t.quadIndex,t.quadTextureIndicesWithinLayer)?Ra(e,n,t):console.error("Voxel update failed (addVoxelBlockTask) - params: ".concat(JSON.stringify(t)))}function Ta(e,t){var n=Pa(e);n&&Ia(n,t.quadIndex)?Ra(e,n,t):console.error("Voxel update failed (removeVoxelBlockTask) - params: ".concat(JSON.stringify(t)))}function Na(e,t){var n=Pa(e);if(n){var r=t.quadIndex,o=Lr(n,qr(r),Wr(r));o?$o(!0,o,zr(r),Fr(r),Gr(r),t.textureIndex)?Ra(e,n,t):console.error("Voxel update failed (setVoxelQuadTextureTask) - params: ".concat(JSON.stringify(t))):console.error("Voxel update failed (setVoxelQuadTextureTask) - voxel not found - params: ".concat(JSON.stringify(t)))}else console.error("Voxel update failed (setVoxelQuadTextureTask) - room not found - params: ".concat(JSON.stringify(t)))}function Ra(e,t,n,r){var o=e.socket.handshake.auth,a=Da.socketRoomContexts[t.roomID];a?Object.entries(a.getUserContexts()).forEach(function(e){if(o.userName!=e[0]){var t=e[1];t.tryUpdateLatestPendingSignal("updateVoxelGridParams",function(e){e.tasks.push(n)})||t.addPendingSignal("updateVoxelGridParams",new xa([n]))}}):console.error("SocketRoomContext not found (roomID = ".concat(t.roomID,")"))}function Pa(e){var t=e.socket.handshake.auth,n=Da.currentRoomIDByUserName[t.userName];if(null!=n){var r=Da.roomRuntimeMemories[n];if(null!=r)return r.room;console.error("getRoom :: RoomRuntimeMemory doesn't exist (roomID = ".concat(n,")"))}else console.error("getRoom :: RoomID not found (userName = ".concat(t.userName,")"))}j().config();var Ea={},La={},Ma={},Aa={roomRuntimeMemories:Ea,socketRoomContexts:La,currentRoomIDByUserName:Ma,changeUserRoom:function(e,t,n){return r=void 0,o=void 0,c=function(){var r,o,a,c;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(i){switch(i.label){case 0:return r=e.socket.handshake.auth,console.log("RoomManager.changeUserRoom :: roomID = ".concat(t,", userName = ").concat(r.userName)),function(e,t){var n=e.socket.handshake.auth,r=Da.currentRoomIDByUserName[n.userName];if(console.log("RoomManager.removeUserFromRoom :: roomID = ".concat(r,", userName = ").concat(n.userName)),null!=r){var o=Da.roomRuntimeMemories[r];if(null!=o){for(var a=function(e,t){var n=Da.roomRuntimeMemories[e];if(null==n)return console.error("RoomManager.getIdsOfObjectsSpawnedByUser :: RoomRuntimeMemory doesn't exist (roomID = ".concat(e,")")),[];for(var r=[],o=0,a=Object.entries(n.objectRuntimeMemories);o<a.length;o++){var c=a[o],i=c[0];c[1].objectSpawnParams.sourceUserName==t&&r.push(i)}return r}(r,n.userName),c=0,i=a;c<i.length;c++)fo(e,i[c]);if(null!=o.participantUserNames[n.userName]){delete Da.currentRoomIDByUserName[n.userName],delete o.participantUserNames[n.userName];var s=Da.socketRoomContexts[r];s?s.removeSocketUserContext(n.userName):console.error("RoomManager.removeUserFromRoom :: SocketRoomContext not found (roomID = ".concat(r,")"))}else console.error("RoomManager.removeUserFromRoom :: User is not registered as the room's participant (userName = ".concat(n.userName,", roomID = ").concat(r,")"))}else console.error("RoomManager.removeUserFromRoom :: RoomRuntimeMemory doesn't exist (roomID = ".concat(r,")"))}else t&&console.warn("RoomManager.removeUserFromRoom :: Previous room not found :: userName = ".concat(n.userName))}(e,n),t?(o=Ea[t])?[3,2]:[4,ia(t)]:[2];case 1:(a=i.sent())&&(o=a),i.label=2;case 2:return o?(function(e,t,n){var r=e.socket.handshake.auth;if(console.log("RoomManager.addUserToRoom :: roomID = ".concat(t.room.roomID,", userName = ").concat(n)),null==t.participantUserNames[n]){Da.currentRoomIDByUserName[n]=t.room.roomID,t.participantUserNames[n]=!0;var o=Da.socketRoomContexts[t.room.roomID];o?o.addSocketUserContext(n,e):console.error("RoomManager.addUserToRoom :: SocketRoomContext not found (roomID = ".concat(t.room.roomID,")")),function(e,t){var n,r=e.socket.handshake.auth,o=Da.currentRoomIDByUserName[r.userName],a=t.objectSpawnParams.objectId;if(console.log("RoomManager.addObject :: roomID = ".concat(o,", userName = ").concat(r.userName,", objectId = ").concat(a)),null!=o){var c=Da.roomRuntimeMemories[o];if(null!=c)if(null==c.objectRuntimeMemories[a]){c.objectRuntimeMemories[a]=t;var i=null===(n=ro(t.objectSpawnParams.objectTypeIndex).components.spawnedByAny)||void 0===n?void 0:n.collider;if(i){var s=.5*i.hitboxSize.sizeX,u=.5*i.hitboxSize.sizeZ,l={x:t.objectSpawnParams.transform.x,y:t.objectSpawnParams.transform.z,halfSizeX:s,halfSizeY:u};Hr.addObject(o,a,l,i.collisionLayerMaskAtGroundLevel)}var f=Da.socketRoomContexts[o];f?f.multicastSignal("objectSpawnParams",t.objectSpawnParams,r.userName):console.error("RoomManager.addObject :: SocketRoomContext not found (roomID = ".concat(o,")"))}else console.error("RoomManager.addObject :: ObjectRuntimeMemory already exists (roomID = ".concat(o,", objectId = ").concat(a,")"));else console.error("RoomManager.addObject :: RoomRuntimeMemory doesn't exist (roomID = ".concat(o,", objectId = ").concat(a,")"))}else console.error("RoomManager.addObject :: RoomID not found (userName = ".concat(r.userName,", objectId = ").concat(a,")"))}(e,new so(new co(r.userName,oo("Player"),"#".concat(++po),new fr(16,0,16,0,0,1),"")))}else console.error("RoomManager.addUserToRoom :: User is already registered (roomID = ".concat(t.room.roomID,", userName = ").concat(n,")"))}(e,o,r.userName),(c=La[t])?c.unicastSignal("roomRuntimeMemory",o,r.userName):console.error("RoomManager.changeUserRoom :: SocketRoomContext not found (roomID = ".concat(t,")")),[2]):(console.error("Failed to load room (ID = ".concat(t,")")),[2])}})},new((a=void 0)||(a=Promise))(function(e,t){function n(e){try{s(c.next(e))}catch(e){t(e)}}function i(e){try{s(c.throw(e))}catch(e){t(e)}}function s(t){var r;t.done?e(t.value):(r=t.value,r instanceof a?r:new a(function(e){e(r)})).then(n,i)}s((c=c.apply(r,o||[])).next())});var r,o,a,c},updateVoxelGrid:function(e,t){!function(e,t){for(var n=0,r=t.tasks;n<r.length;n++){var o=r[n];switch(o.type){case 0:ka(e,o);break;case 1:_a(e,o);break;case 2:Ta(e,o);break;case 3:Na(e,o);break;default:console.error("Unknown task type :: ".concat(o.type))}}}(e,t)},sendObjectMessage:function(e,t){var n=e.socket.handshake.auth,r=Ma[n.userName];if(null!=r){var o=Ea[r];if(null!=o){var a=o.objectRuntimeMemories[t.senderObjectId];if(null!=a)if(a.objectSpawnParams.sourceUserName==n.userName){t.message=t.message.trim().substring(0,32);var c=La[r];c?c.multicastSignal("objectMessageParams",t,n.userName):console.error("RoomManager.sendObjectMessage :: SocketRoomContext not found (roomID = ".concat(r,")"))}else console.error("RoomManager.sendObjectMessage :: User has no authority to control this object (roomID = ".concat(r,", objectId = ").concat(t.senderObjectId,")"));else console.error("RoomManager.sendObjectMessage :: ObjectRuntimeMemory doesn't exist (roomID = ".concat(r,", objectId = ").concat(t.senderObjectId,")"))}else console.error("RoomManager.sendObjectMessage :: RoomRuntimeMemory doesn't exist (roomID = ".concat(r,")"))}else console.error("RoomManager.sendObjectMessage :: RoomID not found (userName = ".concat(n.userName,")"))},updateObjectTransform:function(e,t,n){var r=e.socket.handshake.auth,o=Ma[r.userName];if(null!=o){var a=Ea[o];if(null!=a){var c=a.objectRuntimeMemories[t];if(null!=c)if(c.objectSpawnParams.sourceUserName==r.userName){var i={x:n.x,y:n.z},s=Hr.tryMoveObject(o,t,i);if(n.x=s.resolvedPos.x,n.z=s.resolvedPos.y,Object.assign(c.objectSpawnParams.transform,n),s.desyncDetected){var u=new Zr(t,s.resolvedPos);(l=La[o])?l.multicastSignal("objectDesyncResolveParams",u):console.error("RoomManager.updateObjectTransform :: SocketRoomContext not found (roomID = ".concat(o,")"))}else{var l;u=new pr(t,n),(l=La[o])?l.multicastSignal("objectSyncParams",u,r.userName):console.error("RoomManager.updateObjectTransform :: SocketRoomContext not found (roomID = ".concat(o,")"))}}else console.error("RoomManager.updateObjectTransform :: User has no authority to control this object (roomID = ".concat(o,", objectId = ").concat(t,")"));else console.error("RoomManager.updateObjectTransform :: ObjectRuntimeMemory doesn't exist (roomID = ".concat(o,", objectId = ").concat(t,")"))}else console.error("RoomManager.updateObjectTransform :: RoomRuntimeMemory doesn't exist (roomID = ".concat(o,")"))}else console.error("RoomManager.updateObjectTransform :: RoomID not found (userName = ".concat(r.userName,")"))}};const Da=Aa;var Ua=[[0,{signalType:"objectDespawnParams",decode:function(e){return lo.decode(e)}}],[1,{signalType:"objectDesyncResolveParams",decode:function(e){return Zr.decode(e)}}],[2,{signalType:"objectMessageParams",decode:function(e){return er.decode(e)}}],[3,{signalType:"objectSpawnParams",decode:function(e){return co.decode(e)}}],[4,{signalType:"objectSyncParams",decode:function(e){return pr.decode(e)}}],[5,{signalType:"roomChangeRequestParams",decode:function(e){return yr.decode(e)}}],[6,{signalType:"roomRuntimeMemory",decode:function(e){return Jo.decode(e)}}],[7,{signalType:"updateVoxelGridParams",decode:function(e){return xa.decode(e)}}]],Ca={},Ba={};Ua.forEach(function(e){if(e[0]<0||e[0]>255)throw new Error("Signal type index is outside of its valid range (".concat(e[0],")"));Ca[e[0]]=e[1],Ba[e[1].signalType]=e[0]});const za=function(e){var t=Ba[e];return null==t&&console.error("getIndexByType :: Invalid signal type (signalType = ".concat(e,")")),t},Fa=function(){return Ua.map(function(e){return e[0]}).reduce(function(e,t){return t>=e?t:e})},Ga=function(){function e(e){this.socket=e,this.pendingSignalsByTypeIndex=new Array(Fa()+1)}return e.prototype.addPendingSignal=function(e,t){var n=za(e);if(null!=n){var r=this.pendingSignalsByTypeIndex[n];null==r&&(r=[],this.pendingSignalsByTypeIndex[n]=r),r.push(t)}else console.error("Failed to add the incoming signal. The signal's type is unknown (signalType = ".concat(e,")"))},e.prototype.tryUpdateLatestPendingSignal=function(e,t){var n=za(e);if(null==n)return console.error("Failed to add the incoming signal. The signal's type is unknown (signalType = ".concat(e,")")),!1;var r=this.pendingSignalsByTypeIndex[n];if(null==r)return!1;var o=r.length-1;return!(o<0||(t(r[o]),0))},e.prototype.processAllPendingSignals=function(){for(var e=Go(),t=0;t<this.pendingSignalsByTypeIndex.length;++t){var n=this.pendingSignalsByTypeIndex[t];n&&n.length>0&&(new hn(t).encode(e),new Lo(n,65535).encode(e),n.length=0)}var r=qo(e);e.byteIndex>0&&this.socket.emit("signalBatch",r)},e}();var qa,Wa=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function c(e){try{s(r.next(e))}catch(e){a(e)}}function i(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,i)}s((r=r.apply(e,t||[])).next())})},Va=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Qa={};const Ha=function(e,t){(qa=e.of("/game_sockets")).use(t),qa.on("connection",function(e){return Wa(void 0,void 0,void 0,function(){var t,n,r,o;return Va(this,function(a){switch(a.label){case 0:return t=new Ga(e),n=e.handshake.auth,console.log("(GameSockets) Client connected :: ".concat(JSON.stringify(n))),null!=Qa[n.userName]?(console.error("SocketUserContext with userName already exists (userName = ".concat(n.userName,")")),[2]):(Qa[n.userName]=t,e.on("objectSync",function(e){var n=new ho(new Uint8Array(e)),r=pr.decode(n);Da.updateObjectTransform(t,r.objectId,r.transform)}),e.on("objectMessage",function(e){var n=new ho(new Uint8Array(e)),r=er.decode(n);Da.sendObjectMessage(t,r)}),e.on("updateVoxelGrid",function(e){var n=new ho(new Uint8Array(e)),r=xa.decode(n);Da.updateVoxelGrid(t,r)}),e.on("roomChangeRequest",function(e){return Wa(void 0,void 0,void 0,function(){var n,r;return Va(this,function(o){switch(o.label){case 0:return n=new ho(new Uint8Array(e)),r=yr.decode(n),[4,Da.changeUserRoom(t,r.roomID,!0)];case 1:return o.sent(),[2]}})})}),e.on("disconnect",function(){return Wa(void 0,void 0,void 0,function(){return Va(this,function(e){switch(e.label){case 0:return console.log("(GameSockets) Client disconnected :: ".concat(JSON.stringify(n))),null==Qa[n.userName]?(console.error("SocketUserContext with userName doesn't exist (userName = ".concat(n.userName,")")),[2]):(delete Qa[n.userName],[4,Da.changeUserRoom(t,void 0,!1)]);case 1:return e.sent(),[2]}})})}),[4,Zt.withRoomType(Wo.Hub)]);case 1:return(r=a.sent()).success&&r.data.length>0?(o=r.data[0].roomID,[4,Da.changeUserRoom(t,o,!1)]):[3,3];case 2:a.sent(),a.label=3;case 3:return[2]}})})}),setInterval(function(){for(var e=0,t=Object.values(Qa);e<t.length;e++)t[e].processAllPendingSignals()},200)},Ja=require("cookie");j().config();var Ya=new Set;function Xa(e){return function(t,n){var r=t.request.headers.cookie;if(console.log("Authenticating socket (ID: ".concat(t.id,")")),r){var o=Ja.parse(r)[In()];if(o){var a=jn(o);a?Ya.has(a.userName)?n(new Error(U.getErrorPageURL("auth-duplication"))):e(a)?(Ya.add(a.userName),t.on("disconnect",function(){Ya.has(a.userName)?Ya.delete(a.userName):console.error('User "'.concat(a.userName,'" is already disconnected.'))}),t.handshake.auth=a,n()):n(new Error(U.getErrorPageURL("auth-no-permission"))):n(new Error(U.getErrorPageURL("auth-failure")))}else n(new Error(U.getErrorPageURL("auth-failure")))}else n(new Error(U.getErrorPageURL("auth-failure")))}}function $a(){return e=this,t=void 0,r=function(){return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(e){switch(e.label){case 0:return[4,Jt.runTransaction([new Ft("\n            CREATE TABLE IF NOT EXISTS users (\n                userID INT NOT NULL AUTO_INCREMENT,\n                userName VARCHAR(16) NOT NULL,\n                userType TINYINT NOT NULL,\n                passwordHash VARCHAR(72) NOT NULL,\n                email VARCHAR(64) NOT NULL,\n                tutorialStep TINYINT NOT NULL,\n                PRIMARY KEY (userID),\n                UNIQUE KEY (userName),\n                UNIQUE KEY (email)\n            );\n        "),new Ft("\n            CREATE TABLE IF NOT EXISTS rooms (\n                roomID INT NOT NULL AUTO_INCREMENT,\n                roomName VARCHAR(64) NOT NULL,\n                roomType TINYINT NOT NULL,\n                ownerUserName VARCHAR(16) NOT NULL,\n                texturePackURL VARCHAR(128) NOT NULL,\n                voxelGrid BLOB NOT NULL,\n                persistentObjectGroup BLOB NOT NULL,\n                PRIMARY KEY (roomID),\n                UNIQUE KEY (roomName)\n            );\n        "),new Ft("INSERT INTO globalData (dbVersion) VALUES (0);")])];case 1:return[2,e.sent()]}})},new((n=void 0)||(n=Promise))(function(o,a){function c(e){try{s(r.next(e))}catch(e){a(e)}}function i(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,i)}s((r=r.apply(e,t||[])).next())});var e,t,n,r}j().config(),function(){var e,t,n,r;e=this,t=void 0,r=function(){var e,t,n,r,a;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=i(0),c.throw=i(1),c.return=i(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,i[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(i){switch(i.label){case 0:return process.env.SKIP_SSG?[3,4]:"dev"!=process.env.MODE?[3,2]:[4,Dt()];case 1:return i.sent(),[3,4];case 2:return"ssg"!=process.env.MODE?[3,4]:[4,Dt()];case 3:return i.sent(),[2];case 4:return[4,Jt.runQuery("DROP DATABASE IF EXISTS main;")];case 5:return i.sent().success?[4,Jt.runQuery("CREATE DATABASE IF NOT EXISTS main;")]:[2];case 6:return i.sent().success?[4,Jt.runQuery("USE main;")]:[2];case 7:return i.sent().success?[4,Jt.runQuery("CREATE TABLE IF NOT EXISTS globalData (dbVersion INT NOT NULL);")]:[2];case 8:return i.sent().success?[4,Jt.runQuery("SELECT dbVersion FROM globalData;")]:[2];case 9:return(e=i.sent()).success?e.data&&0!=e.data.length?[3,11]:[4,$a()]:[2];case 10:return i.sent()?[3,12]:[2];case 11:for(t=e.data[0],console.log("Current DB Version: ".concat(t));t<0;)t++;i.label=12;case 12:return[4,Zt.withRoomType(Wo.Hub)];case 13:return(n=i.sent()).success?0!=n.data.length?[3,15]:[4,aa("hub",Wo.Hub,"",0,1,2,"".concat("dev"==process.env.MODE?"http://".concat(U.getLocalIpAddress(),":").concat(process.env.PORT):process.env.URL_STATIC,"/app/assets/texture_packs/default.jpg"))]:[2];case 14:if(!i.sent())return[2];i.label=15;case 15:return r=o()(),a=c().createServer(r),r.set("view engine","ejs"),r.use(s().json()),r.use(s().urlencoded({extended:!0})),r.use(l()()),r.use(d()()),function(e){var t=this;"dev"==process.env.MODE&&(e.get("/",function(e,n){return Yn(t,void 0,void 0,function(){var t;return Xn(this,function(r){switch(r.label){case 0:return[4,N.read(e.url+"index.html")];case 1:return t=r.sent(),n.status(200).setHeader("content-type","text/html").send(q.postProcessHTML(t)),[2]}})})}),e.get(/.*\.html$/,function(e,n){return Yn(t,void 0,void 0,function(){var t;return Xn(this,function(r){switch(r.label){case 0:return[4,N.read(e.url)];case 1:return t=r.sent(),n.status(200).setHeader("content-type","text/html").send(q.postProcessHTML(t)),[2]}})})}),e.get(/.*\.js$/,function(e,n){return Yn(t,void 0,void 0,function(){return Xn(this,function(t){return n.status(200).setHeader("content-type","text/javascript").sendFile(N.getAbsoluteFilePath(e.url)),[2]})})}),e.get(/(.*\.css)|(.*\.jpg)|(.*\.png)|(.*\.ico)|(.*\.atom)|(.*\.xml)|(.*\.pdf)|(.*\.glb)$/,function(e,n){return Yn(t,void 0,void 0,function(){return Xn(this,function(t){return n.sendFile(N.getAbsoluteFilePath(e.url)),[2]})})})),e.use("/".concat("api/user"),Jn),e.use("/",Wn)}(r),a.listen(process.env.PORT,function(){console.log("---------------------------------------------"),console.log("Listening to port ".concat(process.env.PORT,"."))}),function(e){var t=new(Kn().Server)(e);w(t,"dev"==process.env.MODE?function(e,t){return t()}:Xa(function(e){return e.userType==nn.Admin})),Ha(t,Xa(function(e){return!0}))}(a),[2]}})},new((n=void 0)||(n=Promise))(function(o,a){function c(e){try{s(r.next(e))}catch(e){a(e)}}function i(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,i)}s((r=r.apply(e,t||[])).next())})}(),"dev"==process.env.MODE&&setInterval(function(){},36e6)})();