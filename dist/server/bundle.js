(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=require("express");var n=e.n(t);const r=require("http");var o=e.n(r);const a=require("body-parser");var i=e.n(a);const c=require("cookie-parser");var s=e.n(c);const l=require("hpp");var u=e.n(l);const d=require("path");var p=e.n(d);const h=require("fs/promises");var f=e.n(h);const m=require("mysql2/promise");var b=e.n(m);const y=require("dotenv");var v=e.n(y),g=function(){function e(e,t,n){this.pool=e,this.queryStr=t,this.queryParams=n}return e.prototype.run=function(e,t){return n=this,r=void 0,a=function(){var n,r,o;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(a){switch(a.label){case 0:t&&A.pushStackTrace(t),A.log("SQL Query Started",{queryStr:this.queryStr,queryParams:this.queryParams},"low"),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.pool.query(this.queryStr,this.queryParams)];case 2:return n=a.sent(),r=n[0],n[1],A.log("SQL Query Succeeded",{queryStr:this.queryStr,queryParams:this.queryParams},"medium"),t&&A.popStackTrace(t),null==e||e.status(202),[2,r];case 3:return o=a.sent(),A.log("SQL Query Error",{err:o},"high","pink"),t&&A.popStackTrace(t),null==e||e.status(500).send(o),[2,[]];case 4:return[2]}})},new((o=void 0)||(o=Promise))(function(e,t){function i(e){try{s(a.next(e))}catch(e){t(e)}}function c(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o(function(e){e(n)})).then(i,c)}s((a=a.apply(n,r||[])).next())});var n,r,o,a},e}();const w=g;var S=function(){function e(e,t){this.pool=e,this.queries=t}return e.prototype.run=function(e,t){return n=this,r=void 0,a=function(){var n,r,o,a,i,c,s,l,u;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(d){switch(d.label){case 0:t&&A.pushStackTrace(t),A.log("SQL Transaction Began",{numQueries:this.queries.length},"low"),n=void 0,r=!1,o=0,d.label=1;case 1:return d.trys.push([1,11,13,14]),[4,this.pool.getConnection()];case 2:return[4,(n=d.sent()).beginTransaction()];case 3:d.sent(),a=0,i=this.queries,d.label=4;case 4:return a<i.length?(c=i[a],o++,A.log("SQL Transaction Query Started",{progress:"".concat(o,"/").concat(this.queries.length),query:c},"low"),[4,null==n?void 0:n.query(c.queryStr,c.queryParams)]):[3,9];case 5:return s=d.sent(),l=s[0],s[1],0!=l.affectedRows?[3,7]:[4,null==n?void 0:n.rollback()];case 6:return d.sent(),A.log("SQL Transaction Query Made No Change",{progress:"".concat(o,"/").concat(this.queries.length),query:c},"high"),t&&A.popStackTrace(t),null==e||e.status(403),[2];case 7:A.log("SQL Transaction Query Succeeded",{progress:"".concat(o,"/").concat(this.queries.length),query:c},"low"),d.label=8;case 8:return a++,[3,4];case 9:return[4,null==n?void 0:n.commit()];case 10:return d.sent(),A.logRaw("SQL Transaction Committed","medium"),t&&A.popStackTrace(t),r=!0,[3,14];case 11:return u=d.sent(),A.log("SQL Transaction Error",{progress:"".concat(o,"/").concat(this.queries.length),err:u},"high","pink"),[4,null==n?void 0:n.rollback()];case 12:return d.sent(),t&&A.popStackTrace(t),null==e||e.status(500).send(u),[3,14];case 13:return null==n||n.release(),r&&(null==e||e.status(202)),[7];case 14:return[2]}})},new((o=void 0)||(o=Promise))(function(e,t){function i(e){try{s(a.next(e))}catch(e){t(e)}}function c(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o(function(e){e(n)})).then(i,c)}s((a=a.apply(n,r||[])).next())});var n,r,o,a},e}();const T=S;v().config();var k="dev"==process.env.MODE,x=void 0,E={createPool:function(){x?A.logRaw("DB connection pool is already created.","high","pink"):(x=b().createPool({host:k?process.env.SQL_HOST_DEV:process.env.SQL_HOST_PROD,user:k?process.env.SQL_USER_DEV:process.env.SQL_USER_PROD,password:k?process.env.SQL_PASS_DEV:process.env.SQL_PASS_PROD,database:"main",waitForConnections:!0,connectionLimit:10,queueLimit:0,enableKeepAlive:!0,keepAliveInitialDelay:0}))||A.logRaw("Failed to create a DB connection pool.","high","pink")},makeQuery:function(e,t){return x||E.createPool(),new w(x,e,t)},makeTransaction:function(e){return new T(x,e)},runSQLFile:function(e){return t=void 0,n=void 0,o=function(){var t,n,r,o,a,i,c;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(s){switch(s.label){case 0:return A.log("Opening SQL File",{fileName:e},"high"),[4,F.read(e,"sql")];case 1:t=s.sent(),n=t.split(";").map(function(e){return e.trim()+";"}).filter(function(e){return e.length>1}),r=void 0,s.label=2;case 2:return s.trys.push([2,8,9,10]),[4,b().createConnection({host:k?process.env.SQL_HOST_DEV:process.env.SQL_HOST_PROD,user:k?process.env.SQL_USER_DEV:process.env.SQL_USER_PROD,password:k?process.env.SQL_PASS_DEV:process.env.SQL_PASS_PROD})];case 3:null==(r=s.sent())||r.connect(),o=0,a=n,s.label=4;case 4:return o<a.length?(i=a[o],[4,null==r?void 0:r.query(i)]):[3,7];case 5:s.sent(),s.label=6;case 6:return o++,[3,4];case 7:return[3,10];case 8:return c=s.sent(),A.log("SQL File Execution Error",{err:c},"high","pink"),[3,10];case 9:return null==r||r.end(),[7];case 10:return[2]}})},new((r=void 0)||(r=Promise))(function(e,a){function i(e){try{s(o.next(e))}catch(e){a(e)}}function c(e){try{s(o.throw(e))}catch(e){a(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r(function(e){e(n)})).then(i,c)}s((o=o.apply(t,n||[])).next())});var t,n,r,o}};const L=E;var I,R="</td>";const N=function(e,t){(I=e.of("/console_sockets")).use(t),I.on("connection",function(e){console.log("(ConsoleSockets) Client connected :: ".concat(JSON.stringify(e.handshake.auth.user))),e.on("command",function(t){console.log("(ConsoleSockets) Command received :: [".concat(t,"] - sent by :: ").concat(JSON.stringify(e.handshake.auth.user)));var n=t.split(" ");switch(n[0]){case"print":n.shift(),A.logRaw(0==n.length?"-":n.join(" "),"high");break;case"db":"dev"==process.env.MODE?(n.shift(),L.runSQLFile("".concat(n[0],".sql"))):A.logRaw('Command "'.concat(n[0],'" is supported only in dev mode.'),"high","pink");break;case"reboot":A.logRaw("Rebooting...","high"),process.exit(0);break;default:A.logRaw('Unknown command "'.concat(n[0],'".'),"high","pink")}}),e.on("disconnect",function(){console.log("(ConsoleSockets) Client disconnected :: ".concat(JSON.stringify(e.handshake.auth.user)))})})},_=function(e,t,n){var r,o,a;I?I.emit("log",(r=e,o=t,a=n,"".concat('<td style="color: #e0e020; background-color: #202090;">').concat(r).concat(R).concat('<td style="color: #20e020; background-color: #101010;">').concat(o).concat(R).concat('<td style="color: #303030; background-color: #c0c0c0;">').concat(a).concat(R))):console.log("".concat(e,"\n(ORIGIN: ").concat(t,")\n(DETAILS: ").concat(n,")"))};var O=[],P={thresholdLogLevel:0,setThresholdLogLevel:function(e){P.thresholdLogLevel=isNaN(e)?P.getLogLevelFromName(e):e},getThresholdLogLevel:function(){return P.thresholdLogLevel},getLogLevelFromName:function(e){switch(e){case"low":return 0;case"medium":return 1;case"high":return 2;default:console.error('ERROR: Unknown log level name ("'.concat(e,'")'))}return 0},log:function(e,t,n,r){void 0===t&&(t=void 0),void 0===n&&(n="high");var o="";null!=t&&(o=JSON.stringify(t));var a=P.getStackTrace();P.getLogLevelFromName(n)>=P.thresholdLogLevel&&_((r?'<b style="color:'.concat(r,'">'):"")+e+(r?"</b>":""),a,o)},logRaw:function(e,t,n){void 0===t&&(t="high"),P.log(e,void 0,t,n)},getStackTrace:function(){for(var e=[],t=O.length-1;t>=0;--t)e.push(O[t]);return e.join(" <- ")},pushStackTrace:function(e){O.push(e),P.logRaw("pushStackTrace: ".concat(e),"high","gray")},popStackTrace:function(e){if(0!=O.length){var t=O.pop();t==e?P.logRaw("popStackTrace: ".concat(e),"high","gray"):P.logRaw("Name mismatch in stackTrace :: (traceName = ".concat(e,", expectedTraceName = ").concat(t,")"),"high","pink")}else P.logRaw("No name to pop in stackTrace :: (traceName = ".concat(e,")"),"high","pink")}};const A=P;var C=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})},D=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};v().config();var j={read:function(e,t){return C(void 0,void 0,void 0,function(){var n,r;return D(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),n=j.getAbsoluteFilePath(e,t),[4,f().readFile(n,{encoding:"utf8"})];case 1:return[2,o.sent()];case 2:return r=o.sent(),A.log("Failed to read file",{relativeFilePath:e,err:r},"high","pink"),[2,""];case 3:return[2]}})})},write:function(e,t,n){return C(void 0,void 0,void 0,function(){var r,o;return D(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),r=j.getAbsoluteFilePath(e,n),[4,f().writeFile(r,t)];case 1:return a.sent(),[3,3];case 2:return o=a.sent(),A.log("Failed to write file",{relativeFilePath:e,err:o},"high","pink"),[3,3];case 3:return[2]}})})},getAllRelativePathsInDirRecursively:function(e){return C(void 0,void 0,void 0,function(){var t,n;return D(this,function(r){switch(r.label){case 0:return t=p().join(process.env.PWD,e),n=[],[4,j.getAllRelativePathsInDirRecursively_internal(t,[],n)];case 1:return r.sent(),[2,n]}})})},getAbsoluteFilePath:function(e,t){return null==t&&(t=process.env.STATIC_PAGE_ROOT_DIR),p().join(process.env.PWD,t+"/"+e)},getAllRelativePathsInDirRecursively_internal:function(e,t,n){return C(this,void 0,void 0,function(){var r,o,a,i,c,s;return D(this,function(l){switch(l.label){case 0:return[4,f().readdir(e)];case 1:r=l.sent(),o=0,a=r,l.label=2;case 2:return o<a.length?(i=a[o],c=t.concat(i),s="".concat(e,"/").concat(i),[4,f().lstat(s)]):[3,7];case 3:return l.sent().isFile()?(n.push(c.join("/")),[3,6]):[3,4];case 4:return[4,j.getAllRelativePathsInDirRecursively_internal(s,c,n)];case 5:l.sent(),l.label=6;case 6:return o++,[3,2];case 7:return[2]}})})}};const F=j,U={displayText:{pageName:{index:"Home",arcade:"Arcade",library:"Library",portfolio:"Portfolio",register:"Create Account",mypage:"My Page",chat:"Chat"},message:{"error/userName/length":"Username must be between 4 and 16 characters long.","error/userName/chars":"Username can only contain alphabets, numbers, and underbar(_).","error/password/length":"Password must be between 6 and 24 characters long.","error/password/chars":"Password can only contain alphabets, numbers, and the following special characters: ~`!@#$%^&*()-_+={}[]|\\:;\"'<>,.?/","error/email/length":"Email address must not contain more than 64 characters.","error/email/chars":"Please enter a valid email address.","error/roomName/length":"Room name must be between 4 and 64 characters long.","error/roomName/chars":"Room name can only contain alphabets, numbers, spaces, and the following special characters: ~`!@#$%^&*()-_+={}[]|\\:;\"'<>,.?/","rule/userName/length":"Username must be between 4 and 16 characters long.","rule/userName/chars":"Username can only contain alphabets, numbers, and underbar(_).","rule/password/length":"Password must be between 6 and 24 characters long.","rule/password/chars":"Password can only contain alphabets, numbers, and the following special characters: ~`!@#$%^&*()-_+={}[]|\\:;\"'<>,.?/","rule/email/length":"Email address must not contain more than 64 characters.","rule/roomName/length":"Room name must be between 4 and 64 characters long.","rule/roomName/chars":"Room name can only contain alphabets, numbers, spaces, and the following special characters: ~`!@#$%^&*()-_+={}[]|\\:;\"'<>,.?/"}}},B={escapeHTMLChars:e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replaceAll("\n","<br>").replaceAll(" ","&nbsp;"),findErrorInUserName:e=>e.length<4||e.length>16?"error/userName/length":e!=B.sanitizeUserName(e)?"error/userName/chars":null,findErrorInPassword:e=>e.length<6||e.length>24?"error/password/length":e!=B.sanitizePassword(e)?"error/password/chars":null,findErrorInEmailAddress:e=>e.length>64?"error/email/length":/^[^\s@]+@[^\s@]+.[^\s@]+$/.test(e)?null:"error/email/chars",findErrorInRoomName:e=>e.length<4||e.length>64?"error/roomName/length":e!=B.sanitizeRoomName(e)?"error/roomName/chars":null,sanitizeUserName:e=>(e.length>16&&(e=e.substring(0,16)),e.replace(/[^a-zA-Z0-9_]/g,"")),sanitizePassword:e=>(e.length>24&&(e=e.substring(0,24)),e.replace(/[^a-zA-Z0-9~`!@#\$%\^&\*\(\)-_\+=\{\[\}\]\|\\:;"'<>,\.\?\/]/g,"")),sanitizeRoomName:e=>B.sanitizeRoomNameWithoutTrimming(e).trim(),sanitizeRoomNameWithoutTrimming:e=>(e.length>64&&(e=e.substring(0,64)),e.replace(/[^a-zA-Z0-9~`!@#\$%\^&\*\(\)-_\+=\{\[\}\]\|\\:;"'<>,\.\?\/\s]/g,"").replace(/\s+/g," "))},M=B,q=require("ejs");var Q=e.n(q);v().config();var H="".concat(process.env.PWD,"/").concat(process.env.VIEWS_ROOT_DIR,"/partial"),J={TextUtil:M,UIConfig:U,ejsPartialRootPath:H,isStaticPage:!0},W={TextUtil:M,UIConfig:U,ejsPartialRootPath:H,isStaticPage:!1},G={},z={render:function(e,t,n,r){t.render(n,z.makeEJSParams(e,r),function(e,n){e?t.status(500).send(e.message):(n=z.postProcessHTML(n),t.status(200).setHeader("content-type","text/html").send(n))})},postProcessHTML:function(e){return"dev"==process.env.MODE?e=e.replaceAll("\n","!*NEW_LINE*!").replace(/(PROD_CODE_BEGIN).*?(PROD_CODE_END)/g,"REMOVED_PROD_CODE").replaceAll("!*NEW_LINE*!","\n").replaceAll(process.env.URL_STATIC,"http://localhost:".concat(process.env.PORT)).replaceAll(process.env.URL_DYNAMIC,"http://localhost:".concat(process.env.PORT)):e},makeEJSParams:function(e,t){var n={};return Object.assign(n,W),Object.assign(n,t),n.user&&A.log("'user' shouldn't be defined manually in EJS params.",{mergedEJSParams:n},"high","pink"),n.user=e.user,n.globalDictionary&&A.log("'globalDictionary' shouldn't be defined manually in EJS params.",{mergedEJSParams:n},"high","pink"),n.globalDictionary={},n},makeEJSParamsStatic:function(e){var t={};return Object.assign(t,J),Object.assign(t,e),t},createStaticHTMLFromEJS:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return r=void 0,o=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}([e],t,!0),i=function(e,t){var n;return void 0===t&&(t={}),function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(r){switch(r.label){case 0:return null!=(n=G[e])?[3,2]:[4,F.read(e,process.env.VIEWS_ROOT_DIR)];case 1:n=r.sent(),G[e]=n,r.label=2;case 2:return[2,Q().compile(n)(z.makeEJSParamsStatic(t))]}})},new((a=void 0)||(a=Promise))(function(e,t){function n(e){try{s(i.next(e))}catch(e){t(e)}}function c(e){try{s(i.throw(e))}catch(e){t(e)}}function s(t){var r;t.done?e(t.value):(r=t.value,r instanceof a?r:new a(function(e){e(r)})).then(n,c)}s((i=i.apply(r,o||[])).next())});var r,o,a,i}};const V=z;v().config();const Y=function(){function e(){this.lines=["</urlset>"]}return e.prototype.addEntry=function(e,t){this.lines.push("</url>"),this.lines.push("  <lastmod>".concat(t,"</lastmod>")),this.lines.push("  <loc>".concat(process.env.URL_STATIC,"/").concat(e,"</loc>")),this.lines.push("<url>")},e.prototype.build=function(){return e=this,t=void 0,r=function(){return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(e){switch(e.label){case 0:return this.lines.push('<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">'),this.lines.push('<?xml version="1.0" encoding="UTF-8"?>'),this.lines.reverse(),[4,F.write("sitemap.xml",this.lines.join("\n"))];case 1:return e.sent(),[2]}})},new((n=void 0)||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())});var e,t,n,r},e}();v().config();const $=function(){function e(){this.lines=["</feed>"],this.globalLatestUpdate=new Date(process.env.GLOBAL_LAST_MOD)}return e.prototype.addEntry=function(e,t,n,r){var o=new Date(n);o>this.globalLatestUpdate&&(this.globalLatestUpdate=o),this.lines.push("</entry>"),this.lines.push("  <summary>".concat(r,"</summary>")),this.lines.push("  <updated>".concat(o.toISOString(),"</updated>")),this.lines.push("  <id>".concat(e,"</id>")),this.lines.push('  <link href="'.concat(e,'"/>')),this.lines.push("  <title>".concat(t,"</title>")),this.lines.push("<entry>")},e.prototype.build=function(){return e=this,t=void 0,r=function(){return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(e){switch(e.label){case 0:return this.lines.push("<id>urn:uuid:02210672-5391-4cc8-800a-2a88f3a6d00c</id>"),this.lines.push("</author>"),this.lines.push("  <name>Youngjin Kang</name>"),this.lines.push("<author>"),this.lines.push("<updated>".concat(this.globalLatestUpdate.toISOString(),"</updated>")),this.lines.push('<link href="'.concat(process.env.URL_STATIC,'"/>')),this.lines.push('<link rel="self" type="application/atom+xml" href="'.concat(process.env.URL_STATIC,'/feed.atom"/>')),this.lines.push("<title>ThingsPool</title>"),this.lines.push('<feed xmlns="http://www.w3.org/2005/Atom">'),this.lines.push('<?xml version="1.0" encoding="utf-8"?>'),this.lines.reverse(),[4,F.write("feed.atom",this.lines.join("\n"))];case 1:return e.sent(),[2]}})},new((n=void 0)||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())});var e,t,n,r},e}();v().config();const K=function(){function e(){this.lines=[]}return e.prototype.addLine=function(e){this.lines.push(e)},e.prototype.getText=function(){return this.lines.join("\n")},e.prototype.build=function(e,t){return n=this,r=void 0,a=function(){return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(n){switch(n.label){case 0:return null==t&&(t=process.env.STATIC_PAGE_ROOT_DIR),[4,F.write(e,this.lines.join("\n"),t)];case 1:return n.sent(),[2]}})},new((o=void 0)||(o=Promise))(function(e,t){function i(e){try{s(a.next(e))}catch(e){t(e)}}function c(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o(function(e){e(n)})).then(i,c)}s((a=a.apply(n,r||[])).next())});var n,r,o,a},e}();v().config();var Z=function(){function e(e,t){this.sitemapBuilder=e,this.atomFeedBuilder=t}return e.prototype.build=function(e){return t=this,n=void 0,o=function(){var t,n,r,o,a,i,c,s,l,u,d,p,h,f,m,b,y,v,g;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(w){switch(w.label){case 0:return t=new K,n="".concat(e.dirName,"/page.html"),[4,F.read("".concat(e.dirName,"/source.txt"))];case 1:return r=w.sent(),o=r.split(/\r?\n/),a=null==e.playLinkImagePathOverride?"play.png":e.playLinkImagePathOverride,i="",c="",o[0].startsWith(":d:")?i=o[0].substring(3):console.error(":d: is missing in -> "+e.title),o[1].startsWith(":k:")?c=o[1].substring(3).toLowerCase().replaceAll("-"," "):console.error(":k: is missing in -> "+e.title),t=new K,l=(s=t).addLine,[4,V.createStaticHTMLFromEJS("partial/common/header.ejs",{title:"ThingsPool - "+e.title,desc:i,keywords:c,url:"".concat(process.env.URL_STATIC,"/").concat(n),pageName:"arcade",pagePathList:[{title:U.displayText.pageName.index,url:process.env.URL_STATIC},{title:U.displayText.pageName.arcade,url:"".concat(process.env.URL_STATIC,"/arcade.html")},{title:e.title,url:void 0}],backDestination_href:"".concat(process.env.URL_STATIC,"/arcade.html")})];case 2:for(l.apply(s,[w.sent()]),t.addLine("<h1>".concat(e.title,"</h1>")),t.addLine('<a class="noTextDeco" target="_blank" href="'.concat(e.playLinkURL,'">')),t.addLine('<img class="xs_image" src="'.concat(process.env.URL_STATIC,"/").concat(a,'" alt="Play">')),t.addLine("</a>"),t.addLine('<div class="zero_row"></div>'),u=1,d=[],p=function(){d.length>0&&(t.addLine("<p>".concat(d.join("<br>"),"</p>")),d.length=0)},h=2;h<o.length;++h)0==(f=(f=o[h]).trim()).length?p():f.startsWith("[")?(p(),(m=f.match(/\[(.*?)\]/)[1].trim()).length>0&&t.addLine("<h2>".concat(m,"</h2>"))):f.startsWith("<")?(p(),(b=f.match(/<(.*?)>/)[1]).length>0&&(y="".concat(process.env.URL_STATIC,"/").concat(e.dirName,"/").concat(b,".jpg"),t.addLine('<img class="m_image" src="'.concat(y,'" alt="ThingsPool - ').concat(e.title," (Screenshot ").concat(u++,')">')))):(f=f.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll("{%","<").replaceAll("%}",">"),d.push(f));return p(),null!=e.videoTag&&null!=e.videoTag&&t.addLine(e.videoTag),g=(v=t).addLine,[4,V.createStaticHTMLFromEJS("partial/common/footer.ejs")];case 3:return g.apply(v,[w.sent()]),this.sitemapBuilder.addEntry(n,e.lastmod),this.atomFeedBuilder.addEntry("".concat(process.env.URL_STATIC,"/").concat(n),e.title,e.lastmod,e.title),[4,t.build(n)];case 4:return w.sent(),[2]}})},new((r=void 0)||(r=Promise))(function(e,a){function i(e){try{s(o.next(e))}catch(e){a(e)}}function c(e){try{s(o.throw(e))}catch(e){a(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r(function(e){e(n)})).then(i,c)}s((o=o.apply(t,n||[])).next())});var t,n,r,o},e}();const X=Z;v().config();var ee=function(){function e(e,t){this.gameEntries=[{dirName:"ArtRaider",title:"ArtRaider",playLinkImagePathOverride:"badge_onestore.png",playLinkURL:"https://onesto.re/0001000383",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/RuLgOJrNtKA?si=Ts_Yu_jdpB1qmNiT" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>',lastmod:"2025-04-15"},{dirName:"Water-vs-Fire",title:"Water vs Fire",playLinkURL:"https://www.gamearter.com/game/water-vs-fire",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/6DeA_m8Iq4M?si=hC1uzkEtBWpYcM8z" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>',lastmod:"2023-09-10"},{dirName:"HuntLand",title:"HuntLand",playLinkURL:"https://www.gamearter.com/game/huntland",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/3dRg6vvoPqc?si=FlnKVyzQq0_55sL2" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>',lastmod:"2023-09-10"},{dirName:"PoliceChase",title:"Police Chase",playLinkURL:"https://www.gamearter.com/game/policechase",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/kABg0j2mZqQ?si=3-JUZQnh3omVXSJd" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>',lastmod:"2023-09-10"},{dirName:"SpaceTown",title:"SpaceTown",playLinkURL:"https://www.gamearter.com/game/spacetown",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/NoiQzEKJM-A?si=o8vTNqW1kxCJ4MnW" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>',lastmod:"2023-09-20"}],this.sitemapBuilder=e,this.atomFeedBuilder=t}return e.prototype.build=function(){return e=this,t=void 0,r=function(){var e,t,n,r,o,a,i,c,s,l;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(u){switch(u.label){case 0:return e=new K,n=(t=e).addLine,[4,V.createStaticHTMLFromEJS("partial/common/header.ejs",{desc:"Games made by ThingsPool.",keywords:"thingspool, software toys, technical design, computer science, systems engineering, game design, game development",url:"".concat(process.env.URL_STATIC,"/arcade.html"),pageName:"arcade",pagePathList:[{title:U.displayText.pageName.index,url:process.env.URL_STATIC},{title:U.displayText.pageName.arcade,url:void 0}],backDestination_href:process.env.URL_STATIC})];case 1:return n.apply(t,[u.sent()]),e.addLine("<hr>"),e.addLine("<h1>Games</h1>"),o=(r=e).addLine,[4,V.createStaticHTMLFromEJS("partial/info/gameLinks.ejs")];case 2:return o.apply(r,[u.sent()]),i=(a=e).addLine,[4,V.createStaticHTMLFromEJS("partial/common/footer.ejs")];case 3:return i.apply(a,[u.sent()]),this.sitemapBuilder.addEntry("arcade.html","2025-02-28"),[4,e.build("arcade.html")];case 4:u.sent(),c=0,s=this.gameEntries,u.label=5;case 5:return c<s.length?(l=s[c],[4,new X(this.sitemapBuilder,this.atomFeedBuilder).build(l)]):[3,8];case 6:u.sent(),u.label=7;case 7:return c++,[3,5];case 8:return[2]}})},new((n=void 0)||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())});var e,t,n,r},e}();const te=ee;var ne=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})},re=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};v().config();var oe=function(){function e(e,t){this.sitemapBuilder=e,this.atomFeedBuilder=t}return e.prototype.build=function(e){return ne(this,void 0,void 0,function(){var t,n,r,o,a,i,c,s,l,u,d,p,h,f,m,b,y,v,g,w,S,T,k,x,E,L,I=this;return re(this,function(R){switch(R.label){case 0:return t=!0,n="???",r=1,o=1,a=void 0,i=!1,c=!1,s=[],l=[],u=new K,d="A writing by ThingsPool.",p="thingspool, software, engineering, philosophy",h=process.env.GLOBAL_LAST_MOD,f=n,m=d,b=p,y=h,v=function(){s.length>0&&(i?u.addLine('<div class="snippet"><pre><code>'.concat(s.join("\n"),"</code></pre></div>")):c?u.addLine('<pre><div class="excerpt">'.concat(s.join("\n"),"</div></pre>")):u.addLine("<p>".concat(s.join("<br>"),"</p>")),s.length=0)},g=function(t,n,i,c){return ne(I,void 0,void 0,function(){var s,d,p,h,f,m,b;return re(this,function(y){switch(y.label){case 0:return s="".concat(e.dirName,"/list.html"),d="".concat(e.dirName,"/page-").concat(r,".html"),p=new K,f=(h=p).addLine,[4,V.createStaticHTMLFromEJS("partial/common/header.ejs",{title:t,desc:i,keywords:c,ogImageURLOverride:a,url:"".concat(process.env.URL_STATIC,"/").concat(d),ogType:"article",pageName:"library",pagePathList:[{title:U.displayText.pageName.index,url:process.env.URL_STATIC},{title:U.displayText.pageName.library,url:"".concat(process.env.URL_STATIC,"/library.html")},{title:e.title,url:"".concat(process.env.URL_STATIC,"/").concat(s)},{title:t,url:void 0}],backDestination_href:"".concat(process.env.URL_STATIC,"/").concat(s)})];case 1:return f.apply(h,[y.sent()]),p.addLine(u.getText()),b=(m=p).addLine,[4,V.createStaticHTMLFromEJS("partial/common/footer.ejs")];case 2:return b.apply(m,[y.sent()]),[4,p.build(d)];case 3:return y.sent(),u=new K,this.sitemapBuilder.addEntry(d,n),this.atomFeedBuilder.addEntry("".concat(process.env.URL_STATIC,"/").concat(d),t,n,i),l.push({pageNumber:r,title:t,lastmod:n,desc:i,keywords:c,customOGImagePath:a}),r++,o=1,a=void 0,[2]}})})},[4,F.read("".concat(e.dirName,"/source.txt"))];case 1:w=R.sent(),S=w.split(/\r?\n/),T=0,R.label=2;case 2:return T<S.length?(k=S[T],i||c||(k=k.trim()),0!=k.length?[3,3]:(i||c?s.push("\n"):v(),[3,7])):[3,8];case 3:return k.startsWith("[")?(v(),t||(f=n),n=k.match(/\[(.*?)\]/)[1].trim(),x=k.match(/\](.*?)$/)[1].trim(),t?[3,5]:[4,g(f,y,m,b)]):[3,6];case 4:R.sent(),m=d,b=p,y=h,R.label=5;case 5:return t=!1,u.addLine("<h1>".concat(n,"</h1>")),u.addLine('<p class="dim">Author: Youngjin Kang&nbsp;&nbsp;&nbsp;Date: '.concat(x,"</p>")),[3,7];case 6:!k.startsWith("<")||i||c?k.startsWith("@@")?u.addLine(k.substring(2)):k.startsWith("#$")?(v(),i=!i):k.startsWith('#"')?(v(),c=!c):k.startsWith(":d:")?(t||(m=d),d=k.substring(3)):k.startsWith(":k:")?(t||(b=p),p=k.substring(3).toLowerCase().replaceAll("-"," ")):k.startsWith(":l:")?(t||(y=h),h=k.substring(3)):(k=k.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll("{%","<").replaceAll("%}",">"),s.push(k)):(v(),(E=k.match(/<(.*?)>/)[1]).length>0&&(L="".concat(process.env.URL_STATIC,"/").concat(e.dirName,"/").concat(E,".jpg"),(null==a||k.endsWith("*"))&&(a=L),u.addLine('<img class="m_image" src="'.concat(L,'" alt="').concat(n.replaceAll('"',"&quot;")," (Figure ").concat(o++,')">')))),R.label=7;case 7:return++T,[3,2];case 8:return v(),[4,g(n,h,d,p)];case 9:return R.sent(),[2,l]}})})},e}();const ae=oe;v().config();var ie=function(){function e(e,t){this.sitemapBuilder=e,this.atomFeedBuilder=t}return e.prototype.build=function(e){return t=this,n=void 0,o=function(){var t,n,r,o,a,i,c,s,l,u,d,p;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(h){switch(h.label){case 0:t=0,n=e,h.label=1;case 1:return t<n.length?(r=n[t],[4,new ae(this.sitemapBuilder,this.atomFeedBuilder).build(r)]):[3,7];case 2:return o=h.sent(),a="".concat(r.dirName,"/list.html"),i=new K,s=(c=i).addLine,[4,V.createStaticHTMLFromEJS("partial/common/header.ejs",{title:"ThingsPool - "+r.title,desc:r.title,keywords:"thingspool, software toys, technical design, computer science, systems engineering, game design, game development",url:"".concat(process.env.URL_STATIC,"/").concat(a),pageName:"library",pagePathList:[{title:U.displayText.pageName.index,url:process.env.URL_STATIC},{title:U.displayText.pageName.library,url:"".concat(process.env.URL_STATIC,"/library.html")},{title:r.title,url:void 0}],backDestination_href:"".concat(process.env.URL_STATIC,"/library.html")})];case 3:for(s.apply(c,[h.sent()]),i.addLine("<h1>".concat(r.title,"</h1>")),l=o.length-1;l>=0;--l)u=o[l],i.addLine('<a class="postEntryButton" href="'.concat(process.env.URL_STATIC,"/").concat(r.dirName,"/page-").concat(u.pageNumber,'.html">').concat(u.title,"</a>"));return p=(d=i).addLine,[4,V.createStaticHTMLFromEJS("partial/common/footer.ejs")];case 4:return p.apply(d,[h.sent()]),[4,i.build(a)];case 5:h.sent(),this.sitemapBuilder.addEntry(a,o.sort(function(e,t){return Date.parse(t.lastmod)-Date.parse(e.lastmod)}).pop().lastmod),h.label=6;case 6:return t++,[3,1];case 7:return[2]}})},new((r=void 0)||(r=Promise))(function(e,a){function i(e){try{s(o.next(e))}catch(e){a(e)}}function c(e){try{s(o.throw(e))}catch(e){a(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r(function(e){e(n)})).then(i,c)}s((o=o.apply(t,n||[])).next())});var t,n,r,o},e}();const ce=ie;v().config();var se=function(){function e(e,t){this.nonfictionEntries=[{dirName:"metaphysics",title:"형이상학 (2013 - 2014)"},{dirName:"game-analysis",title:"게임분석 (2019)"},{dirName:"essays",title:"Miscellaneous Writings (2022 - 2024)"},{dirName:"blockchains",title:"On Legitimacy of Blockchains (2022)"},{dirName:"software-development",title:"Software Development (2022 - 2024)"},{dirName:"game-design",title:"Universal Laws of Game Design (2023)"},{dirName:"reality",title:"The Origin of Reality (2023)"},{dirName:"bridge-to-math",title:"A Layman's Bridge to Mathematics (2024)"},{dirName:"read-rec",title:"Recommended Readings (2024)"},{dirName:"morsels",title:"Morsels of Thought (2024)"},{dirName:"concepts-of-plan",title:"Concepts of a Plan (2025)"}],this.fictionEntries=[{dirName:"novels",title:"단편소설 (2012 - 2013)"},{dirName:"alien-job-interview",title:"Alien Job Interview (2022)"},{dirName:"infinite-treasures",title:"The Island of Infinite Treasures (2022)"},{dirName:"infsoc",title:"Influential Social Posts (2023)"},{dirName:"gamedev-journey",title:"A Game Developer's Journey (2023)"},{dirName:"sandwich",title:"Sandwich Engineering (2025)"}],this.artEntries=[{dirName:"illustrations",title:"Illustrations (2009 - 2014)"},{dirName:"cartoons",title:"Cartoons (2011 - 2015)"}],this.sitemapBuilder=e,this.atomFeedBuilder=t}return e.prototype.addPostLinks=function(e,t,n){e.addLine("<hr>"),e.addLine("<h1>".concat(t,"</h1>"));for(var r=n.length-1;r>=0;--r){var o=n[r];e.addLine('<a class="postEntryButton" href="'.concat(process.env.URL_STATIC,"/").concat(o.dirName,'/list.html">').concat(o.title,"</a>"))}},e.prototype.build=function(){return e=this,t=void 0,r=function(){var e,t,n,r,o;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(a){switch(a.label){case 0:return e=new K,n=(t=e).addLine,[4,V.createStaticHTMLFromEJS("partial/common/header.ejs",{url:"".concat(process.env.URL_STATIC,"/library.html"),pageName:"library",pagePathList:[{title:U.displayText.pageName.index,url:process.env.URL_STATIC},{title:U.displayText.pageName.library,url:void 0}],backDestination_href:process.env.URL_STATIC})];case 1:return n.apply(t,[a.sent()]),this.addPostLinks(e,"Nonfiction",this.nonfictionEntries),this.addPostLinks(e,"Fiction",this.fictionEntries),this.addPostLinks(e,"Arts",this.artEntries),o=(r=e).addLine,[4,V.createStaticHTMLFromEJS("partial/common/footer.ejs")];case 2:return o.apply(r,[a.sent()]),this.sitemapBuilder.addEntry("library.html","2025-02-28"),[4,e.build("library.html")];case 3:return a.sent(),[4,new ce(this.sitemapBuilder,this.atomFeedBuilder).build(this.nonfictionEntries)];case 4:return a.sent(),[4,new ce(this.sitemapBuilder,this.atomFeedBuilder).build(this.fictionEntries)];case 5:return a.sent(),[4,new ce(this.sitemapBuilder,this.atomFeedBuilder).build(this.artEntries)];case 6:return a.sent(),[2]}})},new((n=void 0)||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())});var e,t,n,r},e}();const le=se;v().config();const ue=function(){function e(){}return e.prototype.build=function(e,t){return n=this,r=void 0,a=function(){var n,r,o,a,i;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(c){switch(c.label){case 0:return null==e&&(e="".concat(process.env.SRC_ROOT_DIR,"/shared")),null==t&&(t="".concat(process.env.VIEWS_ROOT_DIR,"/partial/embeddedScript")),[4,F.getAllRelativePathsInDirRecursively(e)];case 1:n=(n=c.sent()).filter(function(e){return e.endsWith(".js")}),r=0,o=n,c.label=2;case 2:return r<o.length?(a=o[r],[4,F.read(a,e)]):[3,6];case 3:return i=c.sent().split("\n").filter(function(e){return!e.startsWith("export ")}).join("\n").trim(),[4,F.write(a.replace(".js",".ejs"),'\n<%_ if (!locals.globalDictionary["script_included_('.concat(a,")\"]) { _%>\n\x3c!-- NOTE: This EJS partial is auto-generated by 'embeddedScriptBuilder.ts' --\x3e\n<%_ locals.globalDictionary[\"script_included_(").concat(a,')"] = true; _%>\n<script>\n').concat(i,"\n<\/script>\n<%_ } _%>\n").trim(),t)];case 4:c.sent(),c.label=5;case 5:return r++,[3,2];case 6:return[2]}})},new((o=void 0)||(o=Promise))(function(e,t){function i(e){try{s(a.next(e))}catch(e){t(e)}}function c(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o(function(e){e(n)})).then(i,c)}s((a=a.apply(n,r||[])).next())});var n,r,o,a},e}();var de,pe,he,fe="#101010",me="#303030",be="#707070",ye="#a0a0a0",ve="#c0c0c0",ge="#d0c090",we="#70c060",Se="#b0a070",Te="17px",ke={unit:{landscape:{vertical:.6,horizontal:1},portrait:{vertical:1,horizontal:2.5}}},xe=400,Ee=800,Le=function(e,t,n,r,o,a){return"position: absolute;\n\tdisplay: block;\n\tleft: ".concat(e,"%;\n\tright: ").concat(t,"%;\n\ttop: ").concat(n,"%;\n\tbottom: ").concat(r,"%;\n\twidth: ").concat(o,"%;\n\theight: ").concat(a,"%;")},Ie=function(e,t){return"position: relative;\n\tdisplay: ".concat(e?"block":"inline-block",";\n\tmax-width: ").concat(t,";")},Re=function(e){return"position: relative;\n\tdisplay: ".concat(e?"block":"inline-block",";\n\tmax-width: none;\n\twidth: fit-content;\n\tblock-size: fit-content;")},Ne=function(e,t,n,r,o){void 0===r&&(r=!1),void 0===o&&(o=!1);var a=ke.unit[e?"landscape":"portrait"],i=(a.vertical*t).toFixed(2),c=(a.horizontal*n).toFixed(2),s=o?"0":"".concat(i,"%"),l=o?"0":"".concat(c,"%"),u=r?"0":"".concat(i,"%"),d=r?"0":"".concat(c,"%");return"padding: ".concat(s," ").concat(l," ").concat(s," ").concat(l,";\n\tmargin: ").concat(u," ").concat(d," ").concat(u," 0;")},_e=function(e,t,n){return"font-size: ".concat(e,';\n\tfont-family: "Lucida Console", "Lucida Sans Typewriter", "Monaco", Consolas, monospace;\n\tfont-style: ').concat(t?"italic":"normal",";\n\tfont-weight: ").concat(n,";")},Oe=function(e,t,n){return void 0===n&&(n=1),"background-color: ".concat(e,";\n\tcolor: ").concat(t,";").concat(n<1?"\n\topacity: ".concat(n,";"):"")},Pe=function(e,t,n){return void 0===n&&(n=1),Oe(e,t,n)+"\n\tborder-radius: 4.5vmin;"},Ae=function(e,t,n,r,o){return void 0===r&&(r="1.25"),void 0===o&&(o=1),Pe(e,t,o)+"\n"+"\tborder-bottom: ".concat(r,"vmin ").concat(n," solid;")+"\n"+"\tborder-right: ".concat(r,"vmin ").concat(n," solid;")},Ce=function(e,t,n,r,o){return void 0===r&&(r="1.25"),void 0===o&&(o=1),Pe(e,t,o)+"\n"+"\tborder: ".concat(r,"vmin ").concat(n," solid;")},De=Le(0,0,0,0,100,100),je=Le(0,86,0,0,14,100),Fe=Le(0,0,0,88,100,12),Ue=Le(14,5,0,0,81,100),Be=Le(0,2.5,12,0,95,88),Me=Le(0,0,0,86,100,14),qe=Le(0,0,14,0,100,80),Qe=Le(0,0,0,35,100,65),He=Le(0,0,65,0,100,35),Je=function(e){return 2*ke.unit[e?"landscape":"portrait"].horizontal},We=function(e){return Ie(!0,"".concat(100..toFixed(2),"%"))},Ge=function(e){return Ie(!0,"1%")},ze=function(e){return Re(!0)},Ve=function(e){return Ie(!1,"".concat((66-Je(e)).toFixed(2),"%"))},Ye=function(e){return Ie(!1,"".concat((50-Je(e)).toFixed(2),"%"))},$e=function(e){return Re(!1)},Ke=function(e){return Ne(e,1,1)},Ze=function(e){return Ne(e,2,1)},Xe=function(e){return Ne(e,4,1)},et=function(e){return Ne(e,2,1,!1,!0)},tt=function(e){return Ne(e,4,1,!1,!0)},nt="min(".concat(1.8199999999999998.toFixed(2),"vmax, ").concat(16..toFixed(2),"px)"),rt="min(".concat(2.1839999999999997.toFixed(2),"vmax, ").concat(19.2.toFixed(2),"px)"),ot="min(".concat(2.6207999999999996.toFixed(2),"vmax, ").concat(23.04.toFixed(2),"px)"),at="min(".concat(3.1449599999999998.toFixed(2),"vmax, ").concat(27.648.toFixed(2),"px)"),it="min(".concat(3.7739519999999995.toFixed(2),"vmax, ").concat(33.1776.toFixed(2),"px)"),ct=_e(nt,!1,xe),st=_e(nt,!0,xe),lt=_e(nt,!1,Ee),ut=(_e(rt,!0,xe),_e(rt,!0,Ee)),dt=(_e(ot,!0,xe),_e(ot,!0,Ee)),pt=(_e(at,!0,xe),_e(at,!0,Ee)),ht=(_e(it,!0,xe),_e(it,!0,Ee)),ft="opacity: 0;",mt=Oe("#000000",ve,.7),bt=Ae(ge,me,Se,"1.25"),yt=Oe("#000000",ve,.7),vt=Ae(me,ye,ve,"1.25"),gt=Oe(me,ve),wt=(de=ve,void 0===pe&&(pe="1.25"),void 0===he&&(he=1),Oe(me,ve,he)+"\n"+"\tborder-bottom: ".concat(pe,"vmin ").concat(de," solid;")),St=Oe(me,ye),Tt=Oe(ye,me),kt=Oe(me,be),xt=Oe(me,ge),Et=Oe(me,Se),Lt=Ae(me,ye,ye),It=Pe(me,ve),Rt=Pe(fe,we),Nt=Pe(fe,we),_t=Ae(fe,ye,be,"0.5"),Ot=Ae(be,ve,ye,"0.25"),Pt=Ce(me,ve,be,"0.1"),At=Ce(ye,ve,ve,"0.1"),Ct=function(e){return"\n@supports(-moz-appearance:none) {\n\t* {\n\t\tscrollbar-width: ".concat(e?"auto":"none",";\n\t\tscrollbar-color: ").concat(be," ").concat(fe,";\n\t}\n}\n::-webkit-scrollbar {\n\twidth: ").concat(e?Te:"0",";\n\theight: ").concat(e?Te:"0",";\n}\n::-webkit-scrollbar-track {\n\tbackground: ").concat(fe,";\n}\n::-webkit-scrollbar-thumb {\n\tbackground: ").concat(be,";\n\tborder-radius: ").concat("8px",";\n\tborder: ").concat("4px"," solid ").concat(fe,";\n}\n::-webkit-scrollbar-thumb:hover {\n\tbackground: ").concat(ye,";\n}\niframe {\n\t").concat(We(),"\n\t").concat(et(e),"\n\t").concat(dt,"\n\t").concat(St,"\n}\np {\n\t").concat(We(),"\n\t").concat(tt(e),"\n\t").concat(ct,"\n\t").concat(gt,"\n}\nh3 {\n\t").concat(We(),"\n\t").concat(tt(e),"\n\t").concat(ut,"\n\t").concat(Et,"\n}\nh2 {\n\t").concat(We(),"\n\t").concat(tt(e),"\n\t").concat(pt,"\n\t").concat(kt,"\n}\nh1 {\n\t").concat(We(),"\n\t").concat(tt(e),"\n\t").concat(ht,"\n\t").concat(xt,"\n}\nhr {\n\t").concat(We(),"\n\t").concat(et(e),"\n\t").concat(gt,"\n}\n.fullscreenBar {\n\t").concat(e?je:Fe,"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t").concat(ut,"\n\t").concat(Tt,"\n\ttext-align: ").concat("center",";\n\tz-index: 1;\n\toverflow: hidden;\n}\n.fullscreenPanel {\n\t").concat(e?Ue:Be,"\n\tmargin: 0 0 0 0;\n\tpadding: 0 ").concat(2.5,"% 0 ").concat(2.5,"%;\n\t").concat(dt,"\n\t").concat(St,"\n\toverflow-y: scroll;\n\toverflow-x: auto;\n}\n.fullscreenBarLogo {\n\t").concat(e?Me:Qe,"\n}\n.fullscreenBarLogoImage {\n\tposition: relative;\n\tdisplay: block;\n\tmax-width: 80%;\n\tmax-height: 70%;\n\tmargin: auto;\n  \ttop: 50%;\n  \t-ms-transform: translateY(-50%);\n  \ttransform: translateY(-50%);\n}\n.fullscreenBarMenu {\n\t").concat(e?qe:He,"\n}\n.fullscreenBarMenuButton {\n\tposition: relative;\n\tdisplay: ").concat(e?"block":"inline-block",";\n\t").concat(e?"width: 100%;":"top: 100%; -ms-transform: translateY(-100%); transform: translateY(-100%);","\n\tmax-height: 100%;\n\t").concat(e?function(e){return Ne(e,4,1,!0,!1)}(e):function(e){return Ne(e,1,1,!0,!1)}(e),"\n\tbox-sizing: border-box;\n\ttext-decoration: none;\n}\n.fullscreenBarMenuButton.idle {\n\t").concat(Tt,"\n}\n.fullscreenBarMenuButton.selected {\n\t").concat(St,"\n}\n.fullscreenBarMenuButton.idle:hover {\n\tcolor: ").concat(ge,";\n}\n.fullscreenBarMenuButton.selected:hover {\n\tcolor: ").concat(ge,";\n}\n.loadingScreen {\n\t").concat(De,"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\tz-index: 900;\n\n\t.background {\n\t\t").concat(De,"\n\t\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t\t").concat(mt,"\n\t}\n\t.content {\n\t\tposition: absolute;\n\t\tmin-width: 50%;\n\t\ttop: 50%;\n\t\tleft: 50%;\n\t\ttransform: translate(-50%, -50%);\n\t\t").concat(ht,"\n\t\t").concat(Xe(e),"\n\t\t").concat(bt,"\n\t\ttext-align: center;\n\t\tz-index: 901;\n\t}\n}\n.popupScreen {\n\t").concat(De,"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\tz-index: 500;\n\n\t.background {\n\t\t").concat(De,"\n\t\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t\t").concat(yt,"\n\t}\n\t.content {\n\t\tposition: absolute;\n\t\twidth: 80%;\n\t\twidth: 80%;\n\t\ttop: 50%;\n\t\tleft: 50%;\n\t\ttransform: translate(-50%, -50%);\n\t\t").concat(ct,"\n\t\t").concat(Ze(e),"\n\t\t").concat(vt,"\n\t\toverflow-y: scroll;\n\t\tz-index: 501;\n\t}\n}\n.xs_image {\n\t").concat(e?function(e){return Ie(!1,"".concat((25-Je(e)).toFixed(2),"%"))}(e):Ye(e),"\n\t").concat(et(e),"\n\t").concat(dt,"\n\t").concat(St,"\n}\n.s_image {\n\t").concat(e?function(e){return Ie(!1,"".concat((33-Je(e)).toFixed(2),"%"))}(e):Ve(e),"\n\t").concat(et(e),"\n\t").concat(dt,"\n\t").concat(It,"\n}\n.m_image {\n\t").concat(e?Ve(e):Ie(!1,"".concat(100..toFixed(2),"%")),"\n\t").concat(et(e),"\n\t").concat(dt,"\n\t").concat(It,"\n}\n.m_linkImage {\n\t").concat(e?Ye(e):Ie(!1,"".concat(98..toFixed(2),"%")),"\n\t").concat(et(e),"\n\t").concat(dt,"\n\t").concat(Lt,"\n}\n.m_linkImage:hover {\n\tborder-color: ").concat(ge,";\n}\n.postEntryButton {\n\t").concat(ze(),"\n\t").concat(Ke(e),"\n\t").concat(lt,"\n\t").concat(_t,"\n\ttext-decoration: none;\n}\n.pagePath {\n\t").concat(function(e){return Ne(e,1,1,!1,!0)}(e),"\n\t").concat(ct,"\n}\n.listScrollPanel {\n\t").concat((t="".concat(100..toFixed(2),"%"),n="".concat(70..toFixed(2),"%"),"position: relative;\n\tdisplay: ".concat("block",";\n\twidth: ").concat(t,";\n\theight: ").concat(n,";")),"\n\t").concat(Ke(e),"\n\t").concat(Pt,"\n\toverflow: auto;\n}\n.listItem {\n\t").concat(ze(),"\n\t").concat(Ke(e),"\n\t").concat(ct,"\n\t").concat(At,"\n\ttext-decoration: none;\n}\n.inlineTextInput {\n\t").concat(e?$e():ze(),"\n\t").concat(Ke(e),"\n\t").concat(ct,"\n\t").concat(Ot,"\n}\n.inlineLabel {\n\t").concat($e(),"\n\t").concat(Ke(e),"\n\t").concat(ct,"\n\t").concat(St,"\n}\n.inlineButton {\n\t").concat($e(),"\n\t").concat(Ke(e),"\n\t").concat(ct,"\n\t").concat(_t,"\n\ttext-decoration: none;\n}\n.inlineButton:hover {\n\tcolor: ").concat(ge,";\n\tcursor: pointer;\n}\n.inlineButton:disabled {\n\topacity: 0.25;\n\tcursor: not-allowed;\n}\n.inlineTabButton {\n\t").concat($e(),"\n\t").concat(Ke(e),"\n\t").concat(ct,"\n\ttext-decoration: none;\n}\n.inlineTabButton.idle {\n\t").concat(gt,"\n}\n.inlineTabButton.selected {\n\t").concat(wt,"\n}\n.inlineTabButton.idle:hover {\n\tcolor: ").concat(ge,";\n}\n.inlineTabButton.selected:hover {\n\tcolor: ").concat(ge,";\n}\n.snippet {\n\t").concat(ze(),"\n\t").concat(Ze(e),"\n\t").concat(lt,"\n\t").concat(Rt,"\n\twhite-space: nowrap;\n}\n.excerpt {\n\t").concat(We(),"\n\t").concat(Ze(e),"\n\t").concat(st,"\n\t").concat(Nt,"\n\twhite-space: pre-wrap;\n\twhite-space: -moz-pre-wrap;\n\twhite-space: -pre-wrap;\n\twhite-space: -o-pre-wrap;\n\tword-wrap: break-word;\n}\n.zero_row {\n\t").concat(Ge(),"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t").concat(ft,"\n}\n.xs_row {\n\t").concat(Ge(),"\n\t").concat(function(e){return Ne(e,.5,1)}(e),"\n\t").concat(ft,"\n}\n.s_row {\n\t").concat(Ge(),"\n\t").concat(Ke(e),"\n\t").concat(ft,"\n}\n.m_row {\n\t").concat(Ge(),"\n\t").concat(Ze(e),"\n\t").concat(ft,"\n}\n.l_row {\n\t").concat(Ge(),"\n\t").concat(function(e){return Ne(e,3,1)}(e),"\n\t").concat(ft,"\n}\n.xl_row {\n\t").concat(Ge(),"\n\t").concat(Xe(e),"\n\t").concat(ft,"\n}\n");var t,n};const Dt="* {\n\toverflow: hidden;\n\tvertical-align: middle;\n}\nbody {\n\t".concat(De,"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t").concat(ct,"\n\t").concat(gt,"\n\ttext-align: ").concat("left",";\n\tz-index: 0;\n}\na:link {\n  color: ").concat(ye,";\n}\na:visited {\n  color: ").concat(ye,";\n}\na:hover {\n  color: ").concat(ge,";\n}\na:active {\n  color: ").concat(ye,";\n}\n.dim {\n\t").concat(kt,"\n}\n.noTextDeco {\n\ttext-decoration: none;\n}\n\n@media (orientation: landscape) {\n\t").concat(Ct(!0),"\n}\n\n@media (orientation: portrait) {\n\t").concat(Ct(!1),"\n}");function jt(){return e=this,t=void 0,r=function(){var e,t,n,r,o,a,i,c,s,l,u,d,p,h,f;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(m){switch(m.label){case 0:return console.log("SSG START"),e=new Y,t=new $,n=new K,o=(r=n).addLine,[4,V.createStaticHTMLFromEJS("page/static/index.ejs",{url:process.env.URL_STATIC})];case 1:return o.apply(r,[m.sent()]),[4,n.build("index.html")];case 2:return m.sent(),n=new K,i=(a=n).addLine,[4,V.createStaticHTMLFromEJS("page/static/portfolio.ejs",{url:"".concat(process.env.URL_STATIC,"/portfolio.html")})];case 3:return i.apply(a,[m.sent()]),[4,n.build("portfolio.html")];case 4:return m.sent(),n=new K,s=(c=n).addLine,[4,V.createStaticHTMLFromEJS("page/static/portfolio_minimal.ejs",{})];case 5:return s.apply(c,[m.sent()]),[4,n.build("portfolio_minimal.html")];case 6:return m.sent(),n=new K,u=(l=n).addLine,[4,V.createStaticHTMLFromEJS("page/static/privacyPolicy.ejs",{url:"".concat(process.env.URL_STATIC,"/privacy-policy.html")})];case 7:return u.apply(l,[m.sent()]),[4,n.build("privacy-policy.html")];case 8:return m.sent(),n=new K,p=(d=n).addLine,[4,V.createStaticHTMLFromEJS("page/static/termsOfService.ejs",{url:"".concat(process.env.URL_STATIC,"/terms-of-service.html")})];case 9:return p.apply(d,[m.sent()]),[4,n.build("terms-of-service.html")];case 10:return m.sent(),n=new K,f=(h=n).addLine,[4,V.createStaticHTMLFromEJS("page/dynamic/mypage.ejs",{url:"".concat(process.env.URL_STATIC,"/mypage.html")})];case 11:return f.apply(h,[m.sent()]),[4,n.build("mypage.html")];case 12:return m.sent(),[4,new te(e,t).build()];case 13:return m.sent(),[4,new le(e,t).build()];case 14:return m.sent(),[4,e.build()];case 15:return m.sent(),[4,t.build()];case 16:return m.sent(),[4,F.write("style.css",Dt)];case 17:return m.sent(),[4,(new ue).build()];case 18:return m.sent(),console.log("SSG END"),[2]}})},new((n=void 0)||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())});var e,t,n,r}v().config();const Ft=require("jsonwebtoken");var Ut=e.n(Ft);const Bt=require("bcrypt");var Mt=e.n(Bt);const qt=require("crypto");var Qt=e.n(qt);const Ht=require("nodemailer");var Jt=e.n(Ht),Wt=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})},Gt=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};v().config();const zt={selectByEmail:function(e,t){return Wt(void 0,void 0,void 0,function(){return Gt(this,function(n){switch(n.label){case 0:return[4,L.makeQuery("SELECT * FROM emailVerifications WHERE email = ?;",[e]).run(t,"EmailDB.verifications.selectByEmail")];case 1:return[2,n.sent()]}})})},insert:function(e,t,n,r){return Wt(void 0,void 0,void 0,function(){return Gt(this,function(o){switch(o.label){case 0:return[4,L.makeQuery("INSERT INTO emailVerifications (email, verificationCode, expirationTime) VALUES (?, ?, ?);",[e,t,n.toString()]).run(r,"EmailDB.verifications.insert")];case 1:return o.sent(),[2]}})})},updateExpirationTime:function(e,t,n){return Wt(void 0,void 0,void 0,function(){return Gt(this,function(r){switch(r.label){case 0:return[4,L.makeQuery("UPDATE emailVerifications SET expirationTime = ? WHERE email = ?;",[t.toString(),e]).run(n,"EmailDB.verifications.updateExpirationTime")];case 1:return r.sent(),[2]}})})},deleteExpired:function(e,t){return Wt(void 0,void 0,void 0,function(){return Gt(this,function(n){switch(n.label){case 0:return[4,L.makeQuery("DELETE FROM emailVerifications WHERE expirationTime < ?;",[e.toString()]).run(t,"EmailDB.verifications.deleteExpired")];case 1:return n.sent(),[2]}})})}},Vt={bypassEmailVerification:!1,emailVerificationTimeoutInSeconds:600};var Yt=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})},$t=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};v().config();const Kt=function(e,t){return Yt(void 0,void 0,void 0,function(){var n,r,o,a,i,c,s;return $t(this,function(l){switch(l.label){case 0:return l.trys.push([0,9,,10]),[4,zt.deleteExpired(Math.floor(.001*Date.now()),t)];case 1:return l.sent(),t.statusCode<200||t.statusCode>=300?[2]:null!=(n=M.findErrorInEmailAddress(e.body.email))?(A.log("Email Input Error",{email:e.body.email,emailError:n},"high","pink"),t.status(400).send(U.displayText.message[n]),[2]):[4,zt.selectByEmail(e.body.email,t)];case 2:return r=l.sent(),t.statusCode<200||t.statusCode>=300?[2]:r&&r.length>0?(A.log("Email is already undergoing verification",{email:e.body.email},"high","pink"),t.status(403).send('Email "'.concat(e.body.email,'" is already undergoing verification.')),[2]):(o=new Array(8).fill(null).map(function(){return"0123456789".charAt(Qt().randomInt(10))}).join(""),[4,zt.insert(e.body.email,o,Math.floor(.001*Date.now())+Vt.emailVerificationTimeoutInSeconds,t)]);case 3:return l.sent(),t.statusCode<200||t.statusCode>=300?[2]:Vt.bypassEmailVerification?(A.log("Email transmission bypassed",{email:e.body.email},"low"),t.status(201).send(o),[3,8]):[3,4];case 4:return a=Jt().createTransport({service:"naver",host:"smtp.naver.com",auth:{user:"pinkroom77@naver.com",pass:process.env.EMAIL_SENDER_PASS}}),i={from:"pinkroom77@naver.com",to:e.body.email,subject:"Here is your email verification code.",text:"Your verification code is ".concat(o)},[4,a.sendMail(i)];case 5:return c=l.sent(),a.close(),c.accepted?(A.log("Email sent",{email:e.body.email},"low"),t.sendStatus(201),[3,8]):[3,6];case 6:return A.log("Email failed to be sent",{email:e.body.email},"high","pink"),[4,zt.updateExpirationTime(e.body.email,Math.floor(.001*Date.now())+120,t)];case 7:if(l.sent(),t.statusCode<200||t.statusCode>=300)return[2];t.status(500).send('Error while sending the verification code to "'.concat(e.body.email,'". Please try again after 2 minutes.')),l.label=8;case 8:return[3,10];case 9:return s=l.sent(),A.log("Email Verification Start Error",{err:s},"high","pink"),t.status(500).send("ERROR: Failed to start email verification (".concat(s,").")),[3,10];case 10:return[2]}})})},Zt=function(e,t){return Yt(void 0,void 0,void 0,function(){var n,r,o;return $t(this,function(a){switch(a.label){case 0:return null!=(n=M.findErrorInEmailAddress(e.body.email))?(A.log("Email Input Error",{email:e.body.email,emailError:n},"high","pink"),t.status(400).send(U.displayText.message[n]),[2]):(r=e.body.verificationCode,[4,zt.selectByEmail(e.body.email,t)]);case 1:return o=a.sent(),t.statusCode<200||t.statusCode>=300?[2]:o&&0!=o.length?o[0].verificationCode!=r?(A.log("Verification Code Mismatch (code entered = '".concat(r,"')"),{email:e.body.email,actualCode:o[0].verificationCode,enteredCode:r},"high","pink"),t.status(403).send('Wrong verification code for email "'.concat(e.body.email,'".')),[2]):(t.status(202),[2]):(A.log("No pending email verification found",{email:e.body.email},"high","pink"),t.status(404).send('No pending verification found for email "'.concat(e.body.email,'".')),[2])}})})};var Xt=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})},en=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};v().config();var tn=function(e,t){var n=" AND (".concat(e.map(function(e){return"roomMemberships.userStatus = '".concat(e,"'")}).join(" OR "),")");return"SELECT users.userID as userID, users.userName AS userName, roomMemberships.userStatus as userStatus\n    FROM users INNER JOIN roomMemberships ON roomMemberships.userID = users.userID\n    WHERE roomMemberships.roomID = ?".concat(e.length>0?n:"","\n    ORDER BY users.userID DESC LIMIT ").concat(10,", ").concat(10*t,";")};const nn={withUserName:function(e,t){return Xt(void 0,void 0,void 0,function(){return en(this,function(n){switch(n.label){case 0:return[4,L.makeQuery("SELECT * FROM users WHERE userName = ?;",[e]).run(t,"SearchDB.users.withUserName")];case 1:return[2,n.sent()]}})})},withEmail:function(e,t){return Xt(void 0,void 0,void 0,function(){return en(this,function(n){switch(n.label){case 0:return[4,L.makeQuery("SELECT * FROM users WHERE email = ?;",[e]).run(t,"SearchDB.users.withEmail")];case 1:return[2,n.sent()]}})})},whoJoinedRoom:function(e,t,n){return Xt(void 0,void 0,void 0,function(){return en(this,function(r){switch(r.label){case 0:return[4,L.makeQuery(tn(["member"],t),[e]).run(n,"SearchDB.users.whoJoinedRoom")];case 1:return[2,r.sent()]}})})},whoAreInvitedToJoinRoom:function(e,t,n){return Xt(void 0,void 0,void 0,function(){return en(this,function(r){switch(r.label){case 0:return[4,L.makeQuery(tn(["invited"],t),[e]).run(n,"SearchDB.users.whoAreInvitedToJoinRoom")];case 1:return[2,r.sent()]}})})},whoRequestedToJoinRoom:function(e,t,n){return Xt(void 0,void 0,void 0,function(){return en(this,function(r){switch(r.label){case 0:return[4,L.makeQuery(tn(["requested"],t),[e]).run(n,"SearchDB.users.whoRequestedToJoinRoom")];case 1:return[2,r.sent()]}})})},whoArePendingToJoinRoom:function(e,t,n){return Xt(void 0,void 0,void 0,function(){return en(this,function(r){switch(r.label){case 0:return[4,L.makeQuery(tn(["invited","requested"],t),[e]).run(n,"SearchDB.users.whoArePendingToJoinRoom")];case 1:return[2,r.sent()]}})})},whoAreAssociatedWithRoom:function(e,t,n){return Xt(void 0,void 0,void 0,function(){return en(this,function(r){switch(r.label){case 0:return[4,L.makeQuery(tn([],t),[e]).run(n,"SearchDB.users.whoAreAssociatedWithRoom")];case 1:return[2,r.sent()]}})})},others:function(e,t,n){return Xt(void 0,void 0,void 0,function(){return en(this,function(r){switch(r.label){case 0:return[4,L.makeQuery("SELECT userID, userName FROM users\n                WHERE NOT EXISTS (SELECT userID FROM roomMemberships WHERE roomID = ".concat(e," LIMIT 1)\n                ORDER BY userID DESC LIMIT ").concat(10,", ").concat(10*t,";"),void 0).run(n,"SearchDB.users.others")];case 1:return[2,r.sent()]}})})}};v().config();const rn=function(e,t,n,r){return o=void 0,a=void 0,c=function(){return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(o){switch(o.label){case 0:return[4,L.makeQuery("INSERT INTO users (userName, userType, passwordHash, email) VALUES (?, ?, ?, ?);",[e,"member",t,n]).run(r,"AuthDB.registerNewUser")];case 1:return[2,o.sent()]}})},new((i=void 0)||(i=Promise))(function(e,t){function n(e){try{s(c.next(e))}catch(e){t(e)}}function r(e){try{s(c.throw(e))}catch(e){t(e)}}function s(t){var o;t.done?e(t.value):(o=t.value,o instanceof i?o:new i(function(e){e(o)})).then(n,r)}s((c=c.apply(o,a||[])).next())});var o,a,i,c};var on=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})},an=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};v().config();var cn="dev"==process.env.MODE;function sn(e,t,n,r){return on(this,void 0,void 0,function(){var o,a;return an(this,function(i){switch(i.label){case 0:if(o=function(e){var t=e.cookies.thingspool_token;if(!t)return{userID:"0",userName:"guest",userType:"guest",passwordHash:"",email:""};try{return Ut().verify(t,process.env.JWT_SECRET_KEY)||(A.log("User is not found in the given token.",{tokenLength:t.length},"high","yellow"),null)}catch(e){return A.log("Token Verification Failed",{err:e},"high","pink"),null}}(e),!o)return[3,7];if(!n(o))return A.log("User doesn't satisfy the pass-condition.",{user:o},"high","pink"),t.status(403).send("User doesn't satisfy the pass-condition."),[2,!1];switch(o.userType){case"admin":case"member":return[3,1];case"guest":return[3,4]}return[3,5];case 1:return i.trys.push([1,3,,4]),[4,ln(o.userName,t)];case 2:return i.sent(),e.user=o,r(),[2,!0];case 3:return a=i.sent(),A.log("Failed to add token",{err:a},"high","pink"),t.status(401).send("Failed to add token (error: ".concat(a,")")),[2,!1];case 4:return e.user=o,r(),[2,!0];case 5:return A.log("Unknown user type",{userType:o.userType},"high","pink"),t.status(500).send("Unknown user type :: ".concat(o.userType)),[2,!1];case 6:return[3,8];case 7:return A.logRaw("Authentication Failed","high","pink"),t.status(401).send("Authentication Failed"),[2,!1];case 8:return[2]}})})}function ln(e,t){return on(this,void 0,void 0,function(){var n,r;return an(this,function(o){switch(o.label){case 0:return[4,un(e,t)];case 1:return(n=o.sent())?(r=Ut().sign(n,process.env.JWT_SECRET_KEY,{expiresIn:"60m"}),null==t||t.cookie("thingspool_token",r,{secure:!cn,httpOnly:!0,sameSite:"strict"}).status(201),[2]):(A.log("AddToken Tried, User Not Found",{userName:e},"high"),null==t||t.status(404).send('Tried to add token, but there is no account with userName "'.concat(e,'".')),[2])}})})}function un(e,t){return on(this,void 0,void 0,function(){var n;return an(this,function(r){switch(r.label){case 0:return[4,nn.withUserName(e,t)];case 1:return n=r.sent(),t&&(t.statusCode<200||t.statusCode>=300)?[2,null]:n&&0!=n.length?[2,n[0]]:(A.log("User Not Found",{userName:e},"high","pink"),null==t||t.clearCookie("thingspool_token").status(404).send('There is no account with userName "'.concat(e,'".')),[2,null])}})})}function dn(e,t){var n=M.findErrorInUserName(e.body.userName);if(null!=n)return A.log("UserName Input Error",{userName:e.body.userName,userNameError:n},"high","pink"),t.status(400).send(U.displayText.message[n]),!1;var r=M.findErrorInPassword(e.body.password);return null==r||(A.log("Password Input Error",{password:cn?e.body.password:"(HIDDEN)",passwordError:r},"high","pink"),t.status(400).send(U.displayText.message[r]),!1)}const pn=function(e,t){return on(void 0,void 0,void 0,function(){var n,r,o,a;return an(this,function(i){switch(i.label){case 0:return i.trys.push([0,7,,8]),dn(e,t)?null!=(n=M.findErrorInEmailAddress(e.body.email))?(A.log("Email Input Error",{email:e.body.email,emailError:n},"high","pink"),t.status(400).send(U.displayText.message[n]),[2]):[4,nn.withUserName(e.body.userName,t)]:[2];case 1:return r=i.sent(),t.statusCode<200||t.statusCode>=300?[2]:r&&r.length>0?(A.log("UserName already exists",{userName:e.body.userName,existingUser:r[0]},"high","pink"),t.status(403).send('User "'.concat(e.body.userName,'" already exists.')),[2]):[4,nn.withEmail(e.body.email,t)];case 2:return r=i.sent(),t.statusCode<200||t.statusCode>=300?[2]:r&&r.length>0?(A.log("There is already an account with the same email",{email:e.body.email,existingUser:r[0]},"high","pink"),t.status(403).send('There is already an account with the email "'.concat(e.body.email,'".')),[2]):[4,Zt(e,t)];case 3:return i.sent(),t.statusCode<200||t.statusCode>=300?[2]:[4,Mt().hash(e.body.password,10)];case 4:return o=i.sent(),[4,rn(e.body.userName,o,e.body.email,t)];case 5:return i.sent(),t.statusCode<200||t.statusCode>=300?[2]:[4,ln(e.body.userName,t)];case 6:return i.sent(),[3,8];case 7:return a=i.sent(),A.log("User Registration Error",{err:a},"high","pink"),t.status(500).send("ERROR: Failed to register the user (".concat(a,").")),[3,8];case 8:return[2]}})})},hn=function(e,t){return on(void 0,void 0,void 0,function(){var n,r;return an(this,function(o){switch(o.label){case 0:return o.trys.push([0,4,,5]),dn(e,t)?[4,un(e.body.userName,t)]:[2];case 1:return(n=o.sent())?[4,Mt().compare(e.body.password,n.passwordHash)]:[2];case 2:return o.sent()?[4,ln(e.body.userName,t)]:(A.log("Wrong password",{passwordEntered:cn?e.body.password:"(HIDDEN)",passwordHash:n.passwordHash},"high","pink"),t.status(401).send("Wrong password."),[2]);case 3:return o.sent(),[3,5];case 4:return r=o.sent(),A.log("Login Error",{err:r},"high","pink"),t.status(500).send("ERROR: Failed to login (".concat(r,").")),[3,5];case 5:return[2]}})})},fn=function(e,t){t.clearCookie("thingspool_token").status(200)},mn=function(e,t,n){return on(void 0,void 0,void 0,function(){return an(this,function(r){switch(r.label){case 0:return[4,sn(e,t,function(e){return"admin"==e.userType},n)];case 1:return r.sent(),[2]}})})},bn=function(e,t,n){return on(void 0,void 0,void 0,function(){return an(this,function(r){switch(r.label){case 0:return[4,sn(e,t,function(e){return!0},n)];case 1:return r.sent(),[2]}})})};v().config();var yn=n().Router();yn.get("/mypage",bn,function(e,t){V.render(e,t,"page/dynamic/mypage",{loginDestination:"".concat(process.env.URL_DYNAMIC,"/mypage")})}),yn.get("/register",function(e,t){V.render(e,t,"page/dynamic/register",{registerDestination:"".concat(process.env.URL_DYNAMIC,"/mypage")})}),yn.get("/chat",bn,function(e,t){return n=void 0,r=void 0,a=function(){return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(n){return V.render(e,t,"page/dynamic/chat",{title:"Chat",desc:"This is ThingsPool's chat room.",keywords:void 0}),[2]})},new((o=void 0)||(o=Promise))(function(e,t){function i(e){try{s(a.next(e))}catch(e){t(e)}}function c(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o(function(e){e(n)})).then(i,c)}s((a=a.apply(n,r||[])).next())});var n,r,o,a}),"dev"==process.env.MODE?(yn.get("/admin",function(e,t){V.render(e,t,"page/development/admin",{})}),yn.get("/console",function(e,t){V.render(e,t,"page/development/console",{})}),yn.get("/test-ui",function(e,t){V.render(e,t,"page/development/test_ui",{})})):(yn.get("/admin",mn,function(e,t){V.render(e,t,"page/development/admin",{})}),yn.get("/console",mn,function(e,t){V.render(e,t,"page/development/console",{})}));const vn=yn,gn=function(e,t){void 0===t&&(t=void 0),e.statusCode>=200&&e.statusCode<=299&&(t?e.json(t):e.end())};var wn=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})},Sn=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},Tn=n().Router();Tn.post("/register",function(e,t){return wn(void 0,void 0,void 0,function(){return Sn(this,function(n){switch(n.label){case 0:return[4,pn(e,t)];case 1:return n.sent(),gn(t),[2]}})})}),Tn.post("/vemail",function(e,t){return wn(void 0,void 0,void 0,function(){return Sn(this,function(n){switch(n.label){case 0:return[4,Kt(e,t)];case 1:return n.sent(),gn(t),[2]}})})}),Tn.post("/login",function(e,t){return wn(void 0,void 0,void 0,function(){return Sn(this,function(n){switch(n.label){case 0:return[4,hn(e,t)];case 1:return n.sent(),gn(t),[2]}})})}),Tn.delete("/clear-token",function(e,t){fn(e,t),gn(t)});const kn=Tn;var xn=n().Router();xn.get("/db/:table",mn,function(e,t){return n=void 0,r=void 0,a=function(){var n,r,o,a;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(i){switch(i.label){case 0:return[4,L.makeQuery("SELECT * FROM ".concat(e.params.table,";")).run()];case 1:return n=i.sent(),r={},o=n.map(function(e){return"<tr>".concat(Object.entries(e.map(function(e,t){return r[e]=!0,"<td>".concat(t,"<td>")})).join("\n  "),"</tr>")}).join("\n"),a=Object.keys(r).map(function(e){return"<th>".concat(M.escapeHTMLChars(e),"</th>")}).join(""),t.status(200).setHeader("content-type","text/html").send("<table>\n<tr>".concat(a,"</tr>\n").concat(o,"\n</table>")),[2]}})},new((o=void 0)||(o=Promise))(function(e,t){function i(e){try{s(a.next(e))}catch(e){t(e)}}function c(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o(function(e){e(n)})).then(i,c)}s((a=a.apply(n,r||[])).next())});var n,r,o,a});const En=xn;var Ln=function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function c(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,c)}s((r=r.apply(e,t||[])).next())})},In=function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}};const Rn=require("socket.io");var Nn,_n=e.n(Rn);const On=function(e,t){(Nn=e.of("/chat_sockets")).use(t),Nn.on("connection",function(e){console.log("(ChatSockets) Client connected :: ".concat(JSON.stringify(e.handshake.auth.user))),e.on("message",function(e){A.log("Chat Message Received",{message:e},"low"),Nn.emit("message",e)}),e.on("disconnect",function(){console.log("(ChatSockets) Client disconnected :: ".concat(JSON.stringify(e.handshake.auth.user)))})})};function Pn(e){return function(t,n){var r=t.handshake.auth.user;e(r)?n():n(new Error('Authorization Failed (User "'.concat(r.userName,'" does not satisfy the pass-condition)')))}}v().config();v().config(),function(){var e,t,r,a;e=this,t=void 0,a=function(){var e,t;return function(e,t){var n,r,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],r=0}finally{n=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,function(r){switch(r.label){case 0:return"dev"!=process.env.MODE?[3,2]:[4,jt()];case 1:return r.sent(),[3,4];case 2:return"ssg"!=process.env.MODE?[3,4]:[4,jt()];case 3:return r.sent(),[2];case 4:return[4,L.runSQLFile("clear.sql")];case 5:return r.sent(),[4,L.runSQLFile("init.sql")];case 6:return r.sent(),e=n()(),t=o().createServer(e),e.set("view engine","ejs"),e.use(i().json()),e.use(i().urlencoded({extended:!0})),e.use(s()()),e.use(u()()),function(e){var t=this;"dev"==process.env.MODE&&(e.get("/",function(e,n){return Ln(t,void 0,void 0,function(){var t;return In(this,function(r){switch(r.label){case 0:return[4,F.read(e.url+"index.html")];case 1:return t=r.sent(),n.status(200).setHeader("content-type","text/html").send(V.postProcessHTML(t)),[2]}})})}),e.get(/.*\.html$/,function(e,n){return Ln(t,void 0,void 0,function(){var t;return In(this,function(r){switch(r.label){case 0:return[4,F.read(e.url)];case 1:return t=r.sent(),n.status(200).setHeader("content-type","text/html").send(V.postProcessHTML(t)),[2]}})})}),e.get(/(.*\.css)|(.*\.jpg)|(.*\.png)|(.*\.ico)|(.*\.atom)|(.*\.xml)|(.*\.pdf)$/,function(e,n){return Ln(t,void 0,void 0,function(){return In(this,function(t){return n.sendFile(F.getAbsoluteFilePath(e.url)),[2]})})})),e.use("/api/auth",kn),e.use("/api/admin",En),e.use("/",vn)}(e),t.listen(process.env.PORT,function(){console.log("---------------------------------------------"),console.log("Listening to port ".concat(process.env.PORT,"."))}),function(e){var t=new(_n().Server)(e);N(t,"dev"==process.env.MODE?function(e,t){return t()}:Pn(function(e){return"admin"==e.userType})),On(t,Pn(function(e){return!0}))}(t),[2]}})},new((r=void 0)||(r=Promise))(function(n,o){function i(e){try{s(a.next(e))}catch(e){o(e)}}function c(e){try{s(a.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,c)}s((a=a.apply(e,t||[])).next())})}()})();