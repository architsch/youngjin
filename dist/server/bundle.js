(()=>{"use strict";var e={857:e=>{e.exports=require("os")}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var c=t[o]={exports:{}};return e[o](c,c.exports,n),c.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const o=require("express");var r=n.n(o);const c=require("http");var a=n.n(c);const i=require("body-parser");var s=n.n(i);const u=require("cookie-parser");var l=n.n(u);const f=require("hpp");var d=n.n(f);const h=require("path");var p=n.n(h);const y=require("fs/promises");var m=n.n(y);const v=require("mysql2/promise");var b=n.n(v);const g=require("dotenv");var w=n.n(g),x=function(){function e(e,t,n){this.pool=e,this.queryStr=t,this.queryParams=n}return e.prototype.run=function(e,t){return n=this,o=void 0,c=function(){var n,o,r;return function(e,t){var n,o,r,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=i(0),a.throw=i(1),a.return=i(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,i[0]&&(c=0)),c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!((r=(r=c.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(c){switch(c.label){case 0:t&&D.pushStackTrace(t),D.log("SQL Query Started",{queryStr:this.queryStr,queryParams:this.queryParams},"low"),c.label=1;case 1:return c.trys.push([1,3,,4]),[4,this.pool.query(this.queryStr,this.queryParams)];case 2:return n=c.sent(),o=n[0],n[1],D.log("SQL Query Succeeded",{queryStr:this.queryStr,queryParams:this.queryParams},"medium"),t&&D.popStackTrace(t),null==e||e.status(202),[2,o];case 3:return r=c.sent(),D.log("SQL Query Error",{err:r},"high","pink"),t&&D.popStackTrace(t),null==e||e.status(500).send(r),[2,[]];case 4:return[2]}})},new((r=void 0)||(r=Promise))(function(e,t){function a(e){try{s(c.next(e))}catch(e){t(e)}}function i(e){try{s(c.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r(function(e){e(n)})).then(a,i)}s((c=c.apply(n,o||[])).next())});var n,o,r,c},e}();const I=x;var S=function(){function e(e,t){this.pool=e,this.queries=t}return e.prototype.run=function(e,t){return n=this,o=void 0,c=function(){var n,o,r,c,a,i,s,u,l;return function(e,t){var n,o,r,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=i(0),a.throw=i(1),a.return=i(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,i[0]&&(c=0)),c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!((r=(r=c.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(f){switch(f.label){case 0:t&&D.pushStackTrace(t),D.log("SQL Transaction Began",{numQueries:this.queries.length},"low"),n=void 0,o=!1,r=0,f.label=1;case 1:return f.trys.push([1,11,13,14]),[4,this.pool.getConnection()];case 2:return[4,(n=f.sent()).beginTransaction()];case 3:f.sent(),c=0,a=this.queries,f.label=4;case 4:return c<a.length?(i=a[c],r++,D.log("SQL Transaction Query Started",{progress:"".concat(r,"/").concat(this.queries.length),query:i},"low"),[4,null==n?void 0:n.query(i.queryStr,i.queryParams)]):[3,9];case 5:return s=f.sent(),u=s[0],s[1],0!=u.affectedRows?[3,7]:[4,null==n?void 0:n.rollback()];case 6:return f.sent(),D.log("SQL Transaction Query Made No Change",{progress:"".concat(r,"/").concat(this.queries.length),query:i},"high"),t&&D.popStackTrace(t),null==e||e.status(403),[2];case 7:D.log("SQL Transaction Query Succeeded",{progress:"".concat(r,"/").concat(this.queries.length),query:i},"low"),f.label=8;case 8:return c++,[3,4];case 9:return[4,null==n?void 0:n.commit()];case 10:return f.sent(),D.logRaw("SQL Transaction Committed","medium"),t&&D.popStackTrace(t),o=!0,[3,14];case 11:return l=f.sent(),D.log("SQL Transaction Error",{progress:"".concat(r,"/").concat(this.queries.length),err:l},"high","pink"),[4,null==n?void 0:n.rollback()];case 12:return f.sent(),t&&D.popStackTrace(t),null==e||e.status(500).send(l),[3,14];case 13:return null==n||n.release(),o&&(null==e||e.status(202)),[7];case 14:return[2]}})},new((r=void 0)||(r=Promise))(function(e,t){function a(e){try{s(c.next(e))}catch(e){t(e)}}function i(e){try{s(c.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r(function(e){e(n)})).then(a,i)}s((c=c.apply(n,o||[])).next())});var n,o,r,c},e}();const O=S;w().config();var j="dev"==process.env.MODE,R=void 0,k={createPool:function(){R?D.logRaw("DB connection pool is already created.","high","pink"):(R=b().createPool({host:j?process.env.SQL_HOST_DEV:process.env.SQL_HOST_PROD,user:j?process.env.SQL_USER_DEV:process.env.SQL_USER_PROD,password:j?process.env.SQL_PASS_DEV:process.env.SQL_PASS_PROD,database:"main",waitForConnections:!0,connectionLimit:10,queueLimit:0,enableKeepAlive:!0,keepAliveInitialDelay:0}))||D.logRaw("Failed to create a DB connection pool.","high","pink")},makeQuery:function(e,t){return R||k.createPool(),new I(R,e,t)},makeTransaction:function(e){return new O(R,e)},runSQLFile:function(e){return t=void 0,n=void 0,r=function(){var t,n,o,r,c,a,i;return function(e,t){var n,o,r,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=i(0),a.throw=i(1),a.return=i(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,i[0]&&(c=0)),c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!((r=(r=c.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(s){switch(s.label){case 0:return D.log("Opening SQL File",{fileName:e},"high"),[4,B.read(e,"sql")];case 1:t=s.sent(),n=t.split(";").map(function(e){return e.trim()+";"}).filter(function(e){return e.length>1}),o=void 0,s.label=2;case 2:return s.trys.push([2,8,9,10]),[4,b().createConnection({host:j?process.env.SQL_HOST_DEV:process.env.SQL_HOST_PROD,user:j?process.env.SQL_USER_DEV:process.env.SQL_USER_PROD,password:j?process.env.SQL_PASS_DEV:process.env.SQL_PASS_PROD})];case 3:null==(o=s.sent())||o.connect(),r=0,c=n,s.label=4;case 4:return r<c.length?(a=c[r],[4,null==o?void 0:o.query(a)]):[3,7];case 5:s.sent(),s.label=6;case 6:return r++,[3,4];case 7:return[3,10];case 8:return i=s.sent(),D.log("SQL File Execution Error",{err:i},"high","pink"),[3,10];case 9:return null==o||o.end(),[7];case 10:return[2]}})},new((o=void 0)||(o=Promise))(function(e,c){function a(e){try{s(r.next(e))}catch(e){c(e)}}function i(e){try{s(r.throw(e))}catch(e){c(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o(function(e){e(n)})).then(a,i)}s((r=r.apply(t,n||[])).next())});var t,n,o,r}};const _=k;var T,P="</td>";const E=function(e,t){(T=e.of("/console_sockets")).use(t),T.on("connection",function(e){console.log("(ConsoleSockets) Client connected :: ".concat(JSON.stringify(e.handshake.auth))),e.on("command",function(t){console.log("(ConsoleSockets) Command received :: [".concat(t,"] - sent by :: ").concat(JSON.stringify(e.handshake.auth.user)));var n=t.split(" ");switch(n[0]){case"print":n.shift(),D.logRaw(0==n.length?"-":n.join(" "),"high");break;case"db":"dev"==process.env.MODE?(n.shift(),_.runSQLFile("".concat(n[0],".sql"))):D.logRaw('Command "'.concat(n[0],'" is supported only in dev mode.'),"high","pink");break;case"reboot":D.logRaw("Rebooting...","high"),process.exit(0);break;default:D.logRaw('Unknown command "'.concat(n[0],'".'),"high","pink")}}),e.on("disconnect",function(){console.log("(ConsoleSockets) Client disconnected :: ".concat(JSON.stringify(e.handshake.auth)))})})},M=function(e,t,n){var o,r,c;T?T.emit("log",(o=e,r=t,c=n,"".concat('<td style="color: #e0e020; background-color: #202090;">').concat(o).concat(P).concat('<td style="color: #20e020; background-color: #101010;">').concat(r).concat(P).concat('<td style="color: #303030; background-color: #c0c0c0;">').concat(c).concat(P))):console.log("".concat(e,"\n(ORIGIN: ").concat(t,")\n(DETAILS: ").concat(n,")"))};var N=[],L={thresholdLogLevel:0,setThresholdLogLevel:function(e){L.thresholdLogLevel=isNaN(e)?L.getLogLevelFromName(e):e},getThresholdLogLevel:function(){return L.thresholdLogLevel},getLogLevelFromName:function(e){switch(e){case"low":return 0;case"medium":return 1;case"high":return 2;default:console.error('ERROR: Unknown log level name ("'.concat(e,'")'))}return 0},log:function(e,t,n,o){void 0===t&&(t=void 0),void 0===n&&(n="high");var r="";null!=t&&(r=JSON.stringify(t));var c=L.getStackTrace();L.getLogLevelFromName(n)>=L.thresholdLogLevel&&M((o?'<b style="color:'.concat(o,'">'):"")+e+(o?"</b>":""),c,r)},logRaw:function(e,t,n){void 0===t&&(t="high"),L.log(e,void 0,t,n)},getStackTrace:function(){for(var e=[],t=N.length-1;t>=0;--t)e.push(N[t]);return e.join(" <- ")},pushStackTrace:function(e){N.push(e),L.logRaw("pushStackTrace: ".concat(e),"high","gray")},popStackTrace:function(e){if(0!=N.length){var t=N.pop();t==e?L.logRaw("popStackTrace: ".concat(e),"high","gray"):L.logRaw("Name mismatch in stackTrace :: (traceName = ".concat(e,", expectedTraceName = ").concat(t,")"),"high","pink")}else L.logRaw("No name to pop in stackTrace :: (traceName = ".concat(e,")"),"high","pink")}};const D=L;var C=function(e,t,n,o){return new(n||(n=Promise))(function(r,c){function a(e){try{s(o.next(e))}catch(e){c(e)}}function i(e){try{s(o.throw(e))}catch(e){c(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,i)}s((o=o.apply(e,t||[])).next())})},A=function(e,t){var n,o,r,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=i(0),a.throw=i(1),a.return=i(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,i[0]&&(c=0)),c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!((r=(r=c.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};w().config();var U={read:function(e,t){return C(void 0,void 0,void 0,function(){var n,o;return A(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),n=U.getAbsoluteFilePath(e,t),[4,m().readFile(n,{encoding:"utf8"})];case 1:return[2,r.sent()];case 2:return o=r.sent(),D.log("Failed to read file",{relativeFilePath:e,err:o},"high","pink"),[2,""];case 3:return[2]}})})},write:function(e,t,n){return C(void 0,void 0,void 0,function(){var o,r;return A(this,function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),o=U.getAbsoluteFilePath(e,n),[4,m().writeFile(o,t)];case 1:return c.sent(),[3,3];case 2:return r=c.sent(),D.log("Failed to write file",{relativeFilePath:e,err:r},"high","pink"),[3,3];case 3:return[2]}})})},getAllRelativePathsInDirRecursively:function(e){return C(void 0,void 0,void 0,function(){var t,n;return A(this,function(o){switch(o.label){case 0:return t=p().join(process.env.PWD,e),n=[],[4,U.getAllRelativePathsInDirRecursively_internal(t,[],n)];case 1:return o.sent(),[2,n]}})})},getAbsoluteFilePath:function(e,t){return null==t&&(t=process.env.STATIC_PAGE_ROOT_DIR),p().join(process.env.PWD,t+"/"+e)},getAllRelativePathsInDirRecursively_internal:function(e,t,n){return C(this,void 0,void 0,function(){var o,r,c,a,i,s;return A(this,function(u){switch(u.label){case 0:return[4,m().readdir(e)];case 1:o=u.sent(),r=0,c=o,u.label=2;case 2:return r<c.length?(a=c[r],i=t.concat(a),s="".concat(e,"/").concat(a),[4,m().lstat(s)]):[3,7];case 3:return u.sent().isFile()?(n.push(i.join("/")),[3,6]):[3,4];case 4:return[4,U.getAllRelativePathsInDirRecursively_internal(s,i,n)];case 5:u.sent(),u.label=6;case 6:return r++,[3,2];case 7:return[2]}})})}};const B=U,q={displayText:{pageName:{index:"Home",arcade:"Arcade",library:"Library",portfolio:"Portfolio",register:"Create Account",login:"Log In",mypage:"Portal"},message:{"error/userName/length":"Username must be between 4 and 16 characters long.","error/userName/chars":"Username can only contain alphabets, numbers, and underbar(_).","error/password/length":"Password must be between 6 and 24 characters long.","error/password/chars":"Password can only contain alphabets, numbers, and the following special characters: ~`!@#$%^&*()-_+={}[]|\\:;\"'<>,.?/","error/email/length":"Email address must not contain more than 64 characters.","error/email/chars":"Please enter a valid email address.","error/roomName/length":"Room name must be between 4 and 64 characters long.","error/roomName/chars":"Room name can only contain alphabets, numbers, spaces, and the following special characters: ~`!@#$%^&*()-_+={}[]|\\:;\"'<>,.?/","rule/userName/length":"Username must be between 4 and 16 characters long.","rule/userName/chars":"Username can only contain alphabets, numbers, and underbar(_).","rule/password/length":"Password must be between 6 and 24 characters long.","rule/password/chars":"Password can only contain alphabets, numbers, and the following special characters: ~`!@#$%^&*()-_+={}[]|\\:;\"'<>,.?/","rule/email/length":"Email address must not contain more than 64 characters.","rule/roomName/length":"Room name must be between 4 and 64 characters long.","rule/roomName/chars":"Room name can only contain alphabets, numbers, spaces, and the following special characters: ~`!@#$%^&*()-_+={}[]|\\:;\"'<>,.?/"}}},z={escapeHTMLChars:e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replaceAll("\n","<br>").replaceAll(" ","&nbsp;"),findErrorInUserName:e=>e.length<4||e.length>16?"error/userName/length":e!=z.sanitizeUserName(e)?"error/userName/chars":null,findErrorInPassword:e=>e.length<6||e.length>24?"error/password/length":e!=z.sanitizePassword(e)?"error/password/chars":null,findErrorInEmailAddress:e=>e.length>64?"error/email/length":/^[^\s@]+@[^\s@]+.[^\s@]+$/.test(e)?null:"error/email/chars",findErrorInRoomName:e=>e.length<4||e.length>64?"error/roomName/length":e!=z.sanitizeRoomName(e)?"error/roomName/chars":null,sanitizeUserName:e=>(e.length>16&&(e=e.substring(0,16)),e.replace(/[^a-zA-Z0-9_]/g,"")),sanitizePassword:e=>(e.length>24&&(e=e.substring(0,24)),e.replace(/[^a-zA-Z0-9~`!@#\$%\^&\*\(\)-_\+=\{\[\}\]\|\\:;"'<>,\.\?\/]/g,"")),sanitizeRoomName:e=>z.sanitizeRoomNameWithoutTrimming(e).trim(),sanitizeRoomNameWithoutTrimming:e=>(e.length>64&&(e=e.substring(0,64)),e.replace(/[^a-zA-Z0-9~`!@#\$%\^&\*\(\)-_\+=\{\[\}\]\|\\:;"'<>,\.\?\/\s]/g,"").replace(/\s+/g," "))},F=z,G=require("ejs");var W=n.n(G),V=n(857);w().config();var J={onRouteResponse:function(e,t){void 0===t&&(t=void 0),e.statusCode>=200&&e.statusCode<=299&&(t?e.json(t):e.end())},getErrorPageURL:function(e){return"".concat("dev"==process.env.MODE?"http://".concat(J.getLocalIpAddress(),":").concat(process.env.PORT):process.env.URL_STATIC,"/error/").concat(e,".html")},getLocalIpAddress:function(){if("dev"!=process.env.MODE)throw new Error("Calling 'getLocalIpAddress' is not allowed in a non-dev mode.");for(var e=V.networkInterfaces(),t=0,n=Object.keys(e);t<n.length;t++)for(var o=0,r=e[n[t]];o<r.length;o++){var c=r[o];if("IPv4"==c.family&&!c.internal)return c.address}return"127.0.0.1"}};const Q=J;w().config();var H="".concat(process.env.PWD,"/").concat(process.env.VIEWS_ROOT_DIR,"/partial"),Y={TextUtil:F,UIConfig:q,ejsPartialRootPath:H,isStaticPage:!0},X={TextUtil:F,UIConfig:q,ejsPartialRootPath:H,isStaticPage:!1},$={},K={render:function(e,t,n,o){t.render(n,K.makeEJSParams(e,o),function(e,n){e?t.status(500).send(e.message):(n=K.postProcessHTML(n),t.status(200).setHeader("content-type","text/html").send(n))})},postProcessHTML:function(e){if("dev"==process.env.MODE){var t=Q.getLocalIpAddress();return e.replaceAll("\n","!*NEW_LINE*!").replace(/(PROD_CODE_BEGIN).*?(PROD_CODE_END)/g,"REMOVED_PROD_CODE").replaceAll("!*NEW_LINE*!","\n").replaceAll(process.env.URL_STATIC,"http://".concat(t,":").concat(process.env.PORT)).replaceAll(process.env.URL_DYNAMIC,"http://".concat(t,":").concat(process.env.PORT))}return e},makeEJSParams:function(e,t){var n={};return Object.assign(n,X),Object.assign(n,t),n.user&&D.log("'user' shouldn't be defined manually in EJS params.",{mergedEJSParams:n},"high","pink"),n.user=e.user,n.globalDictionary&&D.log("'globalDictionary' shouldn't be defined manually in EJS params.",{mergedEJSParams:n},"high","pink"),n.globalDictionary={},n},makeEJSParamsStatic:function(e){var t={};return Object.assign(t,Y),Object.assign(t,e),t},createStaticHTMLFromEJS:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return o=void 0,r=function(e,t,n){if(n||2===arguments.length)for(var o,r=0,c=t.length;r<c;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))}([e],t,!0),a=function(e,t){var n;return void 0===t&&(t={}),function(e,t){var n,o,r,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=i(0),a.throw=i(1),a.return=i(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,i[0]&&(c=0)),c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!((r=(r=c.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(o){switch(o.label){case 0:return null!=(n=$[e])?[3,2]:[4,B.read(e,process.env.VIEWS_ROOT_DIR)];case 1:n=o.sent(),$[e]=n,o.label=2;case 2:return[2,W().compile(n)(K.makeEJSParamsStatic(t))]}})},new((c=void 0)||(c=Promise))(function(e,t){function n(e){try{s(a.next(e))}catch(e){t(e)}}function i(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var o;t.done?e(t.value):(o=t.value,o instanceof c?o:new c(function(e){e(o)})).then(n,i)}s((a=a.apply(o,r||[])).next())});var o,r,c,a}};const Z=K;w().config();const ee=function(){function e(){this.lines=["</urlset>"]}return e.prototype.addEntry=function(e,t){this.lines.push("</url>"),this.lines.push("  <lastmod>".concat(t,"</lastmod>")),this.lines.push("  <loc>".concat(process.env.URL_STATIC,"/").concat(e,"</loc>")),this.lines.push("<url>")},e.prototype.build=function(){return e=this,t=void 0,o=function(){return function(e,t){var n,o,r,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=i(0),a.throw=i(1),a.return=i(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,i[0]&&(c=0)),c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!((r=(r=c.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(e){switch(e.label){case 0:return this.lines.push('<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">'),this.lines.push('<?xml version="1.0" encoding="UTF-8"?>'),this.lines.reverse(),[4,B.write("sitemap.xml",this.lines.join("\n"))];case 1:return e.sent(),[2]}})},new((n=void 0)||(n=Promise))(function(r,c){function a(e){try{s(o.next(e))}catch(e){c(e)}}function i(e){try{s(o.throw(e))}catch(e){c(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,i)}s((o=o.apply(e,t||[])).next())});var e,t,n,o},e}();w().config();const te=function(){function e(){this.lines=["</feed>"],this.globalLatestUpdate=new Date(process.env.GLOBAL_LAST_MOD)}return e.prototype.addEntry=function(e,t,n,o){var r=new Date(n);r>this.globalLatestUpdate&&(this.globalLatestUpdate=r),this.lines.push("</entry>"),this.lines.push("  <summary>".concat(o,"</summary>")),this.lines.push("  <updated>".concat(r.toISOString(),"</updated>")),this.lines.push("  <id>".concat(e,"</id>")),this.lines.push('  <link href="'.concat(e,'"/>')),this.lines.push("  <title>".concat(t,"</title>")),this.lines.push("<entry>")},e.prototype.build=function(){return e=this,t=void 0,o=function(){return function(e,t){var n,o,r,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=i(0),a.throw=i(1),a.return=i(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,i[0]&&(c=0)),c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!((r=(r=c.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(e){switch(e.label){case 0:return this.lines.push("<id>urn:uuid:02210672-5391-4cc8-800a-2a88f3a6d00c</id>"),this.lines.push("</author>"),this.lines.push("  <name>Youngjin Kang</name>"),this.lines.push("<author>"),this.lines.push("<updated>".concat(this.globalLatestUpdate.toISOString(),"</updated>")),this.lines.push('<link href="'.concat(process.env.URL_STATIC,'"/>')),this.lines.push('<link rel="self" type="application/atom+xml" href="'.concat(process.env.URL_STATIC,'/feed.atom"/>')),this.lines.push("<title>ThingsPool</title>"),this.lines.push('<feed xmlns="http://www.w3.org/2005/Atom">'),this.lines.push('<?xml version="1.0" encoding="utf-8"?>'),this.lines.reverse(),[4,B.write("feed.atom",this.lines.join("\n"))];case 1:return e.sent(),[2]}})},new((n=void 0)||(n=Promise))(function(r,c){function a(e){try{s(o.next(e))}catch(e){c(e)}}function i(e){try{s(o.throw(e))}catch(e){c(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,i)}s((o=o.apply(e,t||[])).next())});var e,t,n,o},e}();w().config();const ne=function(){function e(){this.lines=[]}return e.prototype.addLine=function(e){this.lines.push(e)},e.prototype.getText=function(){return this.lines.join("\n")},e.prototype.build=function(e,t){return n=this,o=void 0,c=function(){return function(e,t){var n,o,r,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=i(0),a.throw=i(1),a.return=i(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,i[0]&&(c=0)),c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!((r=(r=c.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(n){switch(n.label){case 0:return null==t&&(t=process.env.STATIC_PAGE_ROOT_DIR),[4,B.write(e,this.lines.join("\n"),t)];case 1:return n.sent(),[2]}})},new((r=void 0)||(r=Promise))(function(e,t){function a(e){try{s(c.next(e))}catch(e){t(e)}}function i(e){try{s(c.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r(function(e){e(n)})).then(a,i)}s((c=c.apply(n,o||[])).next())});var n,o,r,c},e}();w().config();var oe=function(){function e(e,t){this.sitemapBuilder=e,this.atomFeedBuilder=t}return e.prototype.build=function(e){return t=this,n=void 0,r=function(){var t,n,o,r,c,a,i,s,u,l,f,d,h,p,y,m,v,b;return function(e,t){var n,o,r,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=i(0),a.throw=i(1),a.return=i(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,i[0]&&(c=0)),c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!((r=(r=c.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(g){switch(g.label){case 0:return t="".concat(e.dirName,"/page.html"),[4,B.read("".concat(e.dirName,"/source.txt"))];case 1:for(n=g.sent(),o=n.split(/\r?\n/),r=null==e.playLinkImagePathOverride?"play.png":e.playLinkImagePathOverride,c="",a="",o[0].startsWith(":d:")?c=o[0].substring(3):console.error(":d: is missing in -> "+e.title),o[1].startsWith(":k:")?a=o[1].substring(3).toLowerCase().replaceAll("-"," "):console.error(":k: is missing in -> "+e.title),i=[],s=1,u=[],l=function(){u.length>0&&(i.push("<p>".concat(u.join("<br>"),"</p>")),u.length=0)},f=2;f<o.length;++f)0==(d=(d=o[f]).trim()).length?l():d.startsWith("[")?(l(),(h=d.match(/\[(.*?)\]/)[1].trim()).length>0&&i.push("<h2>".concat(h,"</h2>"))):d.startsWith("<")?(l(),(p=d.match(/<(.*?)>/)[1]).length>0&&(y="".concat(process.env.URL_STATIC,"/").concat(e.dirName,"/").concat(p,".jpg"),i.push('<img class="l_image" src="'.concat(y,'" alt="ThingsPool - ').concat(e.title," (Screenshot ").concat(s++,')">')))):(d=d.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll("{%","<").replaceAll("%}",">"),u.push(d));return l(),null!=e.videoTag&&null!=e.videoTag&&i.push(e.videoTag),m=new ne,b=(v=m).addLine,[4,Z.createStaticHTMLFromEJS("page/static/arcadeGame.ejs",{entry:e,relativeURL:t,description:c,keywords:a,playLinkImagePath:r,content:i.join("\n")})];case 2:return b.apply(v,[g.sent()]),this.sitemapBuilder.addEntry(t,e.lastmod),this.atomFeedBuilder.addEntry("".concat(process.env.URL_STATIC,"/").concat(t),e.title,e.lastmod,e.title),[4,m.build(t)];case 3:return g.sent(),[2]}})},new((o=void 0)||(o=Promise))(function(e,c){function a(e){try{s(r.next(e))}catch(e){c(e)}}function i(e){try{s(r.throw(e))}catch(e){c(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o(function(e){e(n)})).then(a,i)}s((r=r.apply(t,n||[])).next())});var t,n,o,r},e}();const re=oe;var ce={gameEntries:[{dirName:"ArtRaider",title:"ArtRaider",playLinkImagePathOverride:"badge_onestore.png",playLinkURL:"https://onesto.re/0001000383",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/RuLgOJrNtKA?si=Ts_Yu_jdpB1qmNiT" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>',lastmod:"2025-04-15"},{dirName:"Water-vs-Fire",title:"Water vs Fire",playLinkURL:"https://www.gamearter.com/game/water-vs-fire",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/6DeA_m8Iq4M?si=hC1uzkEtBWpYcM8z" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>',lastmod:"2023-09-10"},{dirName:"HuntLand",title:"HuntLand",playLinkURL:"https://www.gamearter.com/game/huntland",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/3dRg6vvoPqc?si=FlnKVyzQq0_55sL2" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>',lastmod:"2023-09-10"},{dirName:"PoliceChase",title:"Police Chase",playLinkURL:"https://www.gamearter.com/game/policechase",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/kABg0j2mZqQ?si=3-JUZQnh3omVXSJd" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>',lastmod:"2023-09-10"},{dirName:"SpaceTown",title:"SpaceTown",playLinkURL:"https://www.gamearter.com/game/spacetown",videoTag:'<iframe width="560" height="315" src="https://www.youtube.com/embed/NoiQzEKJM-A?si=o8vTNqW1kxCJ4MnW" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>',lastmod:"2023-09-20"}]};w().config();var ae=function(){function e(e,t){this.sitemapBuilder=e,this.atomFeedBuilder=t}return e.prototype.build=function(){return e=this,t=void 0,o=function(){var e,t,n,o,r,c;return function(e,t){var n,o,r,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=i(0),a.throw=i(1),a.return=i(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,i[0]&&(c=0)),c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!((r=(r=c.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(a){switch(a.label){case 0:return e=new ne,n=(t=e).addLine,[4,Z.createStaticHTMLFromEJS("page/static/arcade.ejs",{entries:ce.gameEntries})];case 1:return n.apply(t,[a.sent()]),[4,e.build("arcade.html")];case 2:a.sent(),this.sitemapBuilder.addEntry("arcade.html","2025-02-28"),o=0,r=ce.gameEntries,a.label=3;case 3:return o<r.length?(c=r[o],[4,new re(this.sitemapBuilder,this.atomFeedBuilder).build(c)]):[3,6];case 4:a.sent(),a.label=5;case 5:return o++,[3,3];case 6:return[2]}})},new((n=void 0)||(n=Promise))(function(r,c){function a(e){try{s(o.next(e))}catch(e){c(e)}}function i(e){try{s(o.throw(e))}catch(e){c(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,i)}s((o=o.apply(e,t||[])).next())});var e,t,n,o},e}();const ie=ae;var se=function(e,t,n,o){return new(n||(n=Promise))(function(r,c){function a(e){try{s(o.next(e))}catch(e){c(e)}}function i(e){try{s(o.throw(e))}catch(e){c(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,i)}s((o=o.apply(e,t||[])).next())})},ue=function(e,t){var n,o,r,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=i(0),a.throw=i(1),a.return=i(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,i[0]&&(c=0)),c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!((r=(r=c.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};w().config();var le=function(){function e(e,t){this.sitemapBuilder=e,this.atomFeedBuilder=t}return e.prototype.build=function(e){return se(this,void 0,void 0,function(){var t,n,o,r,c,a,i,s,u,l,f,d,h,p,y,m,v,b,g,w,x,I,S,O,j,R,k=this;return ue(this,function(_){switch(_.label){case 0:return t=!0,n="???",o=1,r=1,c=void 0,a=!1,i=!1,s=[],u=[],l=[],f="A writing by ThingsPool.",d="thingspool, software, engineering, philosophy",h=process.env.GLOBAL_LAST_MOD,p=n,y=f,m=d,v=h,b=function(){s.length>0&&(a?l.push('<div class="snippet"><pre><code>'.concat(s.join("\n"),"</code></pre></div>")):i?l.push('<pre><div class="excerpt">'.concat(s.join("\n"),"</div></pre>")):l.push("<p>".concat(s.join("<br>"),"</p>")),s.length=0)},g=function(t,n,a,i,s){return se(k,void 0,void 0,function(){var f,d,h,p;return ue(this,function(y){switch(y.label){case 0:return f="".concat(e.dirName,"/page-").concat(o,".html"),d=new ne,p=(h=d).addLine,[4,Z.createStaticHTMLFromEJS("page/static/libraryPost.ejs",{title:t,desc:a,keywords:i,customOGImagePath:c,entry:e,pageNumber:o,isLastPage:s,content:l.join("\n")})];case 1:return p.apply(h,[y.sent()]),[4,d.build(f)];case 2:return y.sent(),l.length=0,this.sitemapBuilder.addEntry(f,n),this.atomFeedBuilder.addEntry("".concat(process.env.URL_STATIC,"/").concat(f),t,n,a),u.push({pageNumber:o,title:t,lastmod:n,desc:a,keywords:i,customOGImagePath:c}),o++,r=1,c=void 0,[2]}})})},[4,B.read("".concat(e.dirName,"/source.txt"))];case 1:w=_.sent(),x=w.split(/\r?\n/),I=0,_.label=2;case 2:return I<x.length?(S=x[I],a||i||(S=S.trim()),0!=S.length?[3,3]:(a||i?s.push("\n"):b(),[3,7])):[3,8];case 3:return S.startsWith("[")?(b(),t||(p=n),n=S.match(/\[(.*?)\]/)[1].trim(),O=S.match(/\](.*?)$/)[1].trim(),t?[3,5]:[4,g(p,v,y,m,!1)]):[3,6];case 4:_.sent(),y=f,m=d,v=h,_.label=5;case 5:return t=!1,l.push("<h1>".concat(n,"</h1>")),l.push('<p class="dim">Author: Youngjin Kang&nbsp;&nbsp;&nbsp;Date: '.concat(O,"</p>")),[3,7];case 6:!S.startsWith("<")||a||i?S.startsWith("@@")?l.push(S.substring(2)):S.startsWith("#$")?(b(),a=!a):S.startsWith('#"')?(b(),i=!i):S.startsWith(":d:")?(t||(y=f),f=S.substring(3)):S.startsWith(":k:")?(t||(m=d),d=S.substring(3).toLowerCase().replaceAll("-"," ")):S.startsWith(":l:")?(t||(v=h),h=S.substring(3)):(S=S.replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll("{%","<").replaceAll("%}",">"),s.push(S)):(b(),(j=S.match(/<(.*?)>/)[1]).length>0&&(R="".concat(process.env.URL_STATIC,"/").concat(e.dirName,"/").concat(j,".jpg"),(null==c||S.endsWith("*"))&&(c=R),l.push('<img class="l_image" src="'.concat(R,'" alt="').concat(n.replaceAll('"',"&quot;")," (Figure ").concat(r++,')">')))),_.label=7;case 7:return++I,[3,2];case 8:return b(),[4,g(n,h,f,d,!0)];case 9:return _.sent(),[2,u]}})})},e}();const fe=le;w().config();var de=function(){function e(e,t){this.sitemapBuilder=e,this.atomFeedBuilder=t}return e.prototype.build=function(e,t){return n=this,o=void 0,c=function(){var e,n,o,r,c,a,i;return function(e,t){var n,o,r,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=i(0),a.throw=i(1),a.return=i(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,i[0]&&(c=0)),c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!((r=(r=c.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(s){switch(s.label){case 0:e=0,s.label=1;case 1:return e<t.length?(n=t[e],[4,new fe(this.sitemapBuilder,this.atomFeedBuilder).build(n)]):[3,6];case 2:return o=s.sent(),r="".concat(n.dirName,"/list.html"),c=new ne,i=(a=c).addLine,[4,Z.createStaticHTMLFromEJS("page/static/libraryPostList.ejs",{entry:n,listRelativeURL:r,postInfoList:o})];case 3:return i.apply(a,[s.sent()]),[4,c.build("".concat(n.dirName,"/list.html"))];case 4:s.sent(),this.sitemapBuilder.addEntry("".concat(n.dirName,"/list.html"),o.sort(function(e,t){return Date.parse(t.lastmod)-Date.parse(e.lastmod)}).pop().lastmod),s.label=5;case 5:return++e,[3,1];case 6:return[2]}})},new((r=void 0)||(r=Promise))(function(e,t){function a(e){try{s(c.next(e))}catch(e){t(e)}}function i(e){try{s(c.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r(function(e){e(n)})).then(a,i)}s((c=c.apply(n,o||[])).next())});var n,o,r,c},e}();const he=de;var pe={entriesByCategory:{Nonfiction:[{dirName:"metaphysics",title:"형이상학 (2013 - 2014)"},{dirName:"game-analysis",title:"게임분석 (2019)"},{dirName:"essays",title:"Miscellaneous Writings (2022 - 2024)"},{dirName:"blockchains",title:"On Legitimacy of Blockchains (2022)"},{dirName:"software-development",title:"Software Development (2022 - 2024)"},{dirName:"game-design",title:"Universal Laws of Game Design (2023)"},{dirName:"reality",title:"The Origin of Reality (2023)"},{dirName:"bridge-to-math",title:"A Layman's Bridge to Mathematics (2024)"},{dirName:"read-rec",title:"Recommended Readings (2024)"},{dirName:"morsels",title:"Morsels of Thought (2024)"},{dirName:"concepts-of-plan",title:"Concepts of a Plan (2025)"}],Fiction:[{dirName:"novels",title:"단편소설 (2012 - 2013)"},{dirName:"alien-job-interview",title:"Alien Job Interview (2022)"},{dirName:"infinite-treasures",title:"The Island of Infinite Treasures (2022)"},{dirName:"infsoc",title:"Influential Social Posts (2023)"},{dirName:"gamedev-journey",title:"A Game Developer's Journey (2023)"},{dirName:"sandwich",title:"Sandwich Engineering (2025)"}],Arts:[{dirName:"illustrations",title:"Illustrations (2009 - 2014)"},{dirName:"cartoons",title:"Cartoons (2011 - 2015)"}]}};w().config();var ye=function(){function e(e,t){this.sitemapBuilder=e,this.atomFeedBuilder=t}return e.prototype.build=function(){return e=this,t=void 0,o=function(){var e,t,n,o,r,c,a,i;return function(e,t){var n,o,r,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=i(0),a.throw=i(1),a.return=i(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,i[0]&&(c=0)),c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!((r=(r=c.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(s){switch(s.label){case 0:return e=new ne,n=(t=e).addLine,[4,Z.createStaticHTMLFromEJS("page/static/library.ejs",{entriesByCategory:pe.entriesByCategory,gameEntries:ce.gameEntries})];case 1:return n.apply(t,[s.sent()]),[4,e.build("library.html")];case 2:s.sent(),this.sitemapBuilder.addEntry("library.html","2025-02-28"),o=0,r=Object.entries(pe.entriesByCategory),s.label=3;case 3:return o<r.length?(c=r[o],a=c[0],i=c[1],[4,new he(this.sitemapBuilder,this.atomFeedBuilder).build(a,i)]):[3,6];case 4:s.sent(),s.label=5;case 5:return o++,[3,3];case 6:return[2]}})},new((n=void 0)||(n=Promise))(function(r,c){function a(e){try{s(o.next(e))}catch(e){c(e)}}function i(e){try{s(o.throw(e))}catch(e){c(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,i)}s((o=o.apply(e,t||[])).next())});var e,t,n,o},e}();const me=ye;w().config();const ve=function(){function e(){}return e.prototype.build=function(e,t){return n=this,o=void 0,c=function(){var n,o,r,c,a;return function(e,t){var n,o,r,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=i(0),a.throw=i(1),a.return=i(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,i[0]&&(c=0)),c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!((r=(r=c.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(i){switch(i.label){case 0:return null==e&&(e="".concat(process.env.SRC_ROOT_DIR,"/shared/embeddedScripts")),null==t&&(t="".concat(process.env.VIEWS_ROOT_DIR,"/partial/embeddedScript")),[4,B.getAllRelativePathsInDirRecursively(e)];case 1:n=(n=i.sent()).filter(function(e){return e.endsWith(".js")}),o=0,r=n,i.label=2;case 2:return o<r.length?(c=r[o],[4,B.read(c,e)]):[3,6];case 3:return a=i.sent().split("\n").filter(function(e){return!e.startsWith("export ")}).join("\n").trim(),[4,B.write(c.replace(".js",".ejs"),'\n<%_ if (!locals.globalDictionary["script_included_('.concat(c,")\"]) { _%>\n\x3c!-- NOTE: This EJS partial is auto-generated by 'embeddedScriptBuilder.ts' --\x3e\n<%_ locals.globalDictionary[\"script_included_(").concat(c,')"] = true; _%>\n<script>\n').concat(a,"\n<\/script>\n<%_ } _%>\n").trim(),t)];case 4:i.sent(),i.label=5;case 5:return o++,[3,2];case 6:return[2]}})},new((r=void 0)||(r=Promise))(function(e,t){function a(e){try{s(c.next(e))}catch(e){t(e)}}function i(e){try{s(c.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r(function(e){e(n)})).then(a,i)}s((c=c.apply(n,o||[])).next())});var n,o,r,c},e}();var be,ge,we,xe="#101010",Ie="#303030",Se="#707070",Oe="#a0a0a0",je="#c0c0c0",Re="#d0c090",ke="#70c060",_e="#b0a070",Te="17px",Pe={unit:{landscape:{vertical:.6,horizontal:1},portrait:{vertical:1,horizontal:2.5}}},Ee=400,Me=800,Ne=function(e,t,n,o,r,c){return"position: absolute;\n\tdisplay: block;\n\tleft: ".concat(e,"%;\n\tright: ").concat(t,"%;\n\ttop: ").concat(n,"%;\n\tbottom: ").concat(o,"%;\n\twidth: ").concat(r,"%;\n\theight: ").concat(c,"%;")},Le=function(e,t){return"position: relative;\n\tdisplay: ".concat(e?"block":"inline-block",";\n\tmax-width: ").concat(t,";")},De=function(e){return"position: relative;\n\tdisplay: ".concat(e?"block":"inline-block",";\n\tmax-width: none;\n\twidth: fit-content;\n\tblock-size: fit-content;")},Ce=function(e,t,n,o,r){void 0===o&&(o=!1),void 0===r&&(r=!1);var c=Pe.unit[e?"landscape":"portrait"],a=(c.vertical*t).toFixed(2),i=(c.horizontal*n).toFixed(2),s=r?"0":"".concat(a,"%"),u=r?"0":"".concat(i,"%"),l=o?"0":"".concat(a,"%"),f=o?"0":"".concat(i,"%");return"padding: ".concat(s," ").concat(u," ").concat(s," ").concat(u,";\n\tmargin: ").concat(l," ").concat(f," ").concat(l," 0;")},Ae=function(e,t,n){return"font-size: ".concat(e,';\n\tfont-family: "Lucida Console", "Lucida Sans Typewriter", "Monaco", Consolas, monospace;\n\tfont-style: ').concat(t?"italic":"normal",";\n\tfont-weight: ").concat(n,";")},Ue=function(e,t,n){return void 0===n&&(n=1),"background-color: ".concat(e,";\n\tcolor: ").concat(t,";").concat(n<1?"\n\topacity: ".concat(n,";"):"")},Be=function(e,t,n){return void 0===n&&(n=1),Ue(e,t,n)+"\n\tborder-radius: 2vmin;"},qe=function(e,t,n,o,r){return void 0===o&&(o="1.25"),void 0===r&&(r=1),Be(e,t,r)+"\n"+"\tborder-bottom: ".concat(o,"vmin ").concat(n," solid;")+"\n"+"\tborder-right: ".concat(o,"vmin ").concat(n," solid;")},ze=function(e,t,n,o,r){return void 0===o&&(o="1.25"),void 0===r&&(r=1),Be(e,t,r)+"\n"+"\tborder: ".concat(o,"vmin ").concat(n," solid;")},Fe=Ne(0,0,0,0,100,100),Ge=Ne(0,86,0,0,14,100),We=Ne(0,0,0,88,100,12),Ve=Ne(14,5,0,0,81,100),Je=Ne(0,2.5,12,0,95,88),Qe=Ne(0,0,0,86,100,14),He=Ne(0,0,14,0,100,80),Ye=Ne(0,0,0,35,100,65),Xe=Ne(0,0,65,0,100,35),$e=function(e){return 2*Pe.unit[e?"landscape":"portrait"].horizontal},Ke=function(e){return Le(!0,"".concat(100..toFixed(2),"%"))},Ze=function(e){return Le(!0,"1%")},et=function(e){return De(!0)},tt=function(e){return Le(!1,"".concat(100..toFixed(2),"%"))},nt=function(e){return Le(!1,"".concat((50-$e(e)).toFixed(2),"%"))},ot=function(e){return Le(!1,"".concat((33-$e(e)).toFixed(2),"%"))},rt=function(e){return De(!1)},ct=function(e){return Ce(e,1,1)},at=function(e){return Ce(e,2,2)},it=function(e){return Ce(e,4,4)},st=function(e){return Ce(e,2,1,!1,!0)},ut=function(e){return Ce(e,4,1,!1,!0)},lt="min(".concat(1.8199999999999998.toFixed(2),"vmax, ").concat(16..toFixed(2),"px)"),ft="min(".concat(2.1839999999999997.toFixed(2),"vmax, ").concat(19.2.toFixed(2),"px)"),dt="min(".concat(2.6207999999999996.toFixed(2),"vmax, ").concat(23.04.toFixed(2),"px)"),ht="min(".concat(3.1449599999999998.toFixed(2),"vmax, ").concat(27.648.toFixed(2),"px)"),pt="min(".concat(3.7739519999999995.toFixed(2),"vmax, ").concat(33.1776.toFixed(2),"px)"),yt=Ae(lt,!1,Ee),mt=Ae(lt,!0,Ee),vt=Ae(lt,!1,Me),bt=(Ae(ft,!0,Ee),Ae(ft,!0,Me)),gt=(Ae(dt,!0,Ee),Ae(dt,!0,Me)),wt=(Ae(ht,!0,Ee),Ae(ht,!0,Me)),xt=(Ae(pt,!0,Ee),Ae(pt,!0,Me)),It="opacity: 0;",St=Ue("#000000",je,.7),Ot=qe(Re,Ie,_e,"1.25"),jt=Ue("#000000",je,.7),Rt=qe(Ie,Oe,je,"1.25"),kt=Ue(Ie,je),_t=(be=je,void 0===ge&&(ge="1.25"),void 0===we&&(we=1),Ue(Ie,je,we)+"\n"+"\tborder-bottom: ".concat(ge,"vmin ").concat(be," solid;")),Tt=Ue(Ie,Oe),Pt=Ue(Oe,Ie),Et=Ue(Ie,Se),Mt=Ue(Ie,Re),Nt=Ue(Ie,_e),Lt=qe(Ie,Oe,Oe),Dt=Be(Ie,je),Ct=Be(xe,ke),At=Be(xe,ke),Ut=qe(xe,Oe,Se,"0.5"),Bt=qe(xe,Oe,Se,"0.75"),qt=qe(Se,je,Oe,"0.25"),zt=ze(Ie,je,Se,"0.1"),Ft=ze(Oe,je,je,"0.1"),Gt=function(e){return"\n@supports(-moz-appearance:none) {\n\t* {\n\t\tscrollbar-width: ".concat(e?"auto":"none",";\n\t\tscrollbar-color: ").concat(Se," ").concat(xe,";\n\t}\n}\n::-webkit-scrollbar {\n\twidth: ").concat(e?Te:"0",";\n\theight: ").concat(e?Te:"0",";\n}\n::-webkit-scrollbar-track {\n\tbackground: ").concat(xe,";\n}\n::-webkit-scrollbar-thumb {\n\tbackground: ").concat(Se,";\n\tborder-radius: ").concat("8px",";\n\tborder: ").concat("4px"," solid ").concat(xe,";\n}\n::-webkit-scrollbar-thumb:hover {\n\tbackground: ").concat(Oe,";\n}\niframe {\n\t").concat(Ke(),"\n\t").concat(st(e),"\n\t").concat(gt,"\n\t").concat(Tt,"\n}\np {\n\t").concat(Ke(),"\n\t").concat(ut(e),"\n\t").concat(yt,"\n\t").concat(kt,"\n}\nh3 {\n\t").concat(Ke(),"\n\t").concat(ut(e),"\n\t").concat(bt,"\n\t").concat(Nt,"\n}\nh2 {\n\t").concat(Ke(),"\n\t").concat(ut(e),"\n\t").concat(wt,"\n\t").concat(Et,"\n}\nh1 {\n\t").concat(Ke(),"\n\t").concat(ut(e),"\n\t").concat(xt,"\n\t").concat(Mt,"\n}\nhr {\n\t").concat(Ke(),"\n\t").concat(st(e),"\n\t").concat(kt,"\n}\n.fullscreenBar {\n\t").concat(e?Ge:We,"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t").concat(bt,"\n\t").concat(Pt,"\n\ttext-align: ").concat("center",";\n\tz-index: 1;\n\toverflow: hidden;\n}\n.fullscreenPanel {\n\t").concat(e?Ve:Je,"\n\tmargin: 0 0 0 0;\n\tpadding: 0 ").concat(2.5,"% 0 ").concat(2.5,"%;\n\t").concat(gt,"\n\t").concat(Tt,"\n\toverflow-y: scroll;\n\toverflow-x: auto;\n}\n.fullscreenBarLogo {\n\t").concat(e?Qe:Ye,"\n}\n.fullscreenBarLogoImage {\n\tposition: relative;\n\tdisplay: block;\n\tmax-width: 80%;\n\tmax-height: 70%;\n\tmargin: auto;\n  \ttop: 50%;\n  \t-ms-transform: translateY(-50%);\n  \ttransform: translateY(-50%);\n}\n.fullscreenBarMenu {\n\t").concat(e?He:Xe,"\n}\n.fullscreenBarMenuButton {\n\tposition: relative;\n\tdisplay: ").concat(e?"block":"inline-block",";\n\t").concat(e?"width: 100%;":"top: 100%; -ms-transform: translateY(-100%); transform: translateY(-100%);","\n\tmax-height: 100%;\n\t").concat(e?function(e){return Ce(e,4,1,!0,!1)}(e):function(e){return Ce(e,1,1,!0,!1)}(e),"\n\tbox-sizing: border-box;\n\ttext-decoration: none;\n}\n.fullscreenBarMenuButton.idle {\n\t").concat(Pt,"\n}\n.fullscreenBarMenuButton.selected {\n\t").concat(Tt,"\n}\n.fullscreenBarMenuButton.idle:hover {\n\tcolor: ").concat(Re,";\n}\n.fullscreenBarMenuButton.selected:hover {\n\tcolor: ").concat(Re,";\n}\n.loadingScreen {\n\t").concat(Fe,"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\tz-index: 900;\n\n\t.background {\n\t\t").concat(Fe,"\n\t\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t\t").concat(St,"\n\t}\n\t.content {\n\t\tposition: absolute;\n\t\tmin-width: 50%;\n\t\ttop: 50%;\n\t\tleft: 50%;\n\t\ttransform: translate(-50%, -50%);\n\t\t").concat(xt,"\n\t\t").concat(it(e),"\n\t\t").concat(Ot,"\n\t\ttext-align: center;\n\t\tz-index: 901;\n\t}\n}\n.popupScreen {\n\t").concat(Fe,"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\tz-index: 500;\n\n\t.background {\n\t\t").concat(Fe,"\n\t\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t\t").concat(jt,"\n\t}\n\t.content {\n\t\tposition: absolute;\n\t\twidth: 80%;\n\t\twidth: 80%;\n\t\ttop: 50%;\n\t\tleft: 50%;\n\t\ttransform: translate(-50%, -50%);\n\t\t").concat(yt,"\n\t\t").concat(at(e),"\n\t\t").concat(Rt,"\n\t\toverflow-y: scroll;\n\t\tz-index: 501;\n\t}\n}\n.s_image {\n\t").concat(e?function(e){return Le(!1,"".concat((25-$e(e)).toFixed(2),"%"))}(e):nt(e),"\n\t").concat(st(e),"\n\t").concat(gt,"\n\t").concat(Dt,"\n}\n.m_image {\n\t").concat(e?ot(e):tt(),"\n\t").concat(st(e),"\n\t").concat(gt,"\n\t").concat(Dt,"\n}\n.m_linkImage {\n\t").concat(e?ot(e):Le(!1,"".concat(98..toFixed(2),"%")),"\n\t").concat(st(e),"\n\t").concat(gt,"\n\t").concat(Lt,"\n}\n.m_linkImage:hover {\n\tborder-color: ").concat(Re,";\n}\n.l_image {\n\t").concat(e?nt(e):tt(),"\n\t").concat(st(e),"\n\t").concat(gt,"\n\t").concat(Dt,"\n}\n.portal {\n\tposition: relative;\n\tdisplay: block;\n\tmargin: ").concat(e?"5%":"12.5%"," 0;\n\tpadding: 0 0;\n\tmax-width: ").concat(e?"30%":"70%",";\n}\n.postEntryButton {\n\t").concat(et(),"\n\t").concat(ct(e),"\n\t").concat(vt,"\n\t").concat(Ut,"\n\ttext-decoration: none;\n}\n.postEntryButton:hover {\n\tborder-color: ").concat(Re,";\n}\n.bigButton {\n\t").concat(et(),"\n\t").concat(function(e){return Ce(e,6,6)}(e),"\n\t").concat(bt,"\n\t").concat(Bt,"\n\ttext-decoration: none;\n\ttext-align: center;\n}\n.bigButton:hover {\n\tborder-color: ").concat(Re,";\n}\n.pagePath {\n\t").concat(function(e){return Ce(e,1,1,!1,!0)}(e),"\n\t").concat(yt,"\n}\n.listScrollPanel {\n\t").concat((t="".concat(100..toFixed(2),"%"),n="".concat(70..toFixed(2),"%"),"position: relative;\n\tdisplay: ".concat("block",";\n\twidth: ").concat(t,";\n\theight: ").concat(n,";")),"\n\t").concat(ct(e),"\n\t").concat(zt,"\n\toverflow: auto;\n}\n.listItem {\n\t").concat(et(),"\n\t").concat(ct(e),"\n\t").concat(yt,"\n\t").concat(Ft,"\n\ttext-decoration: none;\n}\n.inlineTextInput {\n\t").concat(e?rt():et(),"\n\t").concat(ct(e),"\n\t").concat(yt,"\n\t").concat(qt,"\n}\n.inlineLabel {\n\t").concat(rt(),"\n\t").concat(ct(e),"\n\t").concat(yt,"\n\t").concat(Tt,"\n}\n.inlineButton {\n\t").concat(rt(),"\n\t").concat(ct(e),"\n\t").concat(yt,"\n\t").concat(Ut,"\n\ttext-decoration: none;\n}\n.inlineButton:hover {\n\tborder-color: ").concat(Re,";\n\tcursor: pointer;\n}\n.inlineButton:disabled {\n\topacity: 0.25;\n\tcursor: not-allowed;\n}\n.inlineTabButton {\n\t").concat(rt(),"\n\t").concat(ct(e),"\n\t").concat(yt,"\n\ttext-decoration: none;\n}\n.inlineTabButton.idle {\n\t").concat(kt,"\n}\n.inlineTabButton.selected {\n\t").concat(_t,"\n}\n.inlineTabButton.idle:hover {\n\tcolor: ").concat(Re,";\n}\n.inlineTabButton.selected:hover {\n\tcolor: ").concat(Re,";\n}\n.snippet {\n\t").concat(et(),"\n\t").concat(at(e),"\n\t").concat(vt,"\n\t").concat(Ct,"\n\twhite-space: nowrap;\n}\n.excerpt {\n\t").concat(Ke(),"\n\t").concat(at(e),"\n\t").concat(mt,"\n\t").concat(At,"\n\twhite-space: pre-wrap;\n\twhite-space: -moz-pre-wrap;\n\twhite-space: -pre-wrap;\n\twhite-space: -o-pre-wrap;\n\tword-wrap: break-word;\n}\n.zero_row {\n\t").concat(Ze(),"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t").concat(It,"\n}\n.xs_row {\n\t").concat(Ze(),"\n\t").concat(function(e){return Ce(e,.5,1)}(e),"\n\t").concat(It,"\n}\n.s_row {\n\t").concat(Ze(),"\n\t").concat(ct(e),"\n\t").concat(It,"\n}\n.m_row {\n\t").concat(Ze(),"\n\t").concat(at(e),"\n\t").concat(It,"\n}\n.l_row {\n\t").concat(Ze(),"\n\t").concat(function(e){return Ce(e,3,3)}(e),"\n\t").concat(It,"\n}\n.xl_row {\n\t").concat(Ze(),"\n\t").concat(it(e),"\n\t").concat(It,"\n}\n");var t,n};const Wt="* {\n\toverflow: hidden;\n\tvertical-align: middle;\n}\nbody {\n\t".concat(Fe,"\n\t").concat("padding: 0 0 0 0; margin: 0 0 0 0;","\n\t").concat(yt,"\n\t").concat(kt,"\n\ttext-align: ").concat("left",";\n\tz-index: 0;\n}\na:link {\n  color: ").concat(Oe,";\n}\na:visited {\n  color: ").concat(Oe,";\n}\na:hover {\n  color: ").concat(Re,";\n}\na:active {\n  color: ").concat(Oe,";\n}\n.dim {\n\t").concat(Et,"\n}\n.noTextDeco {\n\ttext-decoration: none;\n}\n.horizontallyCentered {\n\tleft: 50%;\n\ttransform: translate(-50%, 0);\n}\n\n@media (orientation: landscape) {\n\t").concat(Gt(!0),"\n}\n\n@media (orientation: portrait) {\n\t").concat(Gt(!1),"\n}");w().config();const Vt=function(){function e(){}return e.prototype.build=function(e,t){return n=this,o=void 0,c=function(){var n,o,r,c,a,i,s;return function(e,t){var n,o,r,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=i(0),a.throw=i(1),a.return=i(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,i[0]&&(c=0)),c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!((r=(r=c.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(u){switch(u.label){case 0:return null==e&&(e="".concat(process.env.VIEWS_ROOT_DIR,"/page/static/error")),null==t&&(t="".concat(process.env.STATIC_PAGE_ROOT_DIR,"/error")),[4,B.getAllRelativePathsInDirRecursively(e)];case 1:n=(n=u.sent()).filter(function(e){return e.endsWith(".ejs")}),o=0,r=n,u.label=2;case 2:return o<r.length?(c=r[o],a=new ne,s=(i=a).addLine,[4,Z.createStaticHTMLFromEJS("/page/static/error/"+c,{})]):[3,6];case 3:return s.apply(i,[u.sent()]),[4,a.build(c.replace(".ejs",".html"),t)];case 4:u.sent(),u.label=5;case 5:return o++,[3,2];case 6:return[2]}})},new((r=void 0)||(r=Promise))(function(e,t){function a(e){try{s(c.next(e))}catch(e){t(e)}}function i(e){try{s(c.throw(e))}catch(e){t(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r(function(e){e(n)})).then(a,i)}s((c=c.apply(n,o||[])).next())});var n,o,r,c},e}();function Jt(){return e=this,t=void 0,o=function(){var e,t,n,o,r,c,a,i,s,u,l,f,d;return function(e,t){var n,o,r,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=i(0),a.throw=i(1),a.return=i(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,i[0]&&(c=0)),c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!((r=(r=c.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(h){switch(h.label){case 0:return console.log("SSG START"),e=new ee,t=new te,n=new ne,r=(o=n).addLine,[4,Z.createStaticHTMLFromEJS("page/static/index.ejs",{})];case 1:return r.apply(o,[h.sent()]),[4,n.build("index.html")];case 2:return h.sent(),n=new ne,a=(c=n).addLine,[4,Z.createStaticHTMLFromEJS("page/static/portfolio.ejs",{})];case 3:return a.apply(c,[h.sent()]),[4,n.build("portfolio.html")];case 4:return h.sent(),n=new ne,s=(i=n).addLine,[4,Z.createStaticHTMLFromEJS("page/static/portfolio_minimal.ejs",{})];case 5:return s.apply(i,[h.sent()]),[4,n.build("portfolio_minimal.html")];case 6:return h.sent(),n=new ne,l=(u=n).addLine,[4,Z.createStaticHTMLFromEJS("page/static/privacyPolicy.ejs",{})];case 7:return l.apply(u,[h.sent()]),[4,n.build("privacy-policy.html")];case 8:return h.sent(),n=new ne,d=(f=n).addLine,[4,Z.createStaticHTMLFromEJS("page/static/termsOfService.ejs",{})];case 9:return d.apply(f,[h.sent()]),[4,n.build("terms-of-service.html")];case 10:return h.sent(),[4,new ie(e,t).build()];case 11:return h.sent(),[4,new me(e,t).build()];case 12:return h.sent(),[4,(new Vt).build()];case 13:return h.sent(),[4,e.build()];case 14:return h.sent(),[4,t.build()];case 15:return h.sent(),[4,B.write("style.css",Wt)];case 16:return h.sent(),[4,(new ve).build()];case 17:return h.sent(),console.log("SSG END"),[2]}})},new((n=void 0)||(n=Promise))(function(r,c){function a(e){try{s(o.next(e))}catch(e){c(e)}}function i(e){try{s(o.throw(e))}catch(e){c(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,i)}s((o=o.apply(e,t||[])).next())});var e,t,n,o}w().config();const Qt=require("jsonwebtoken");var Ht=n.n(Qt);require("bcrypt");require("crypto");require("nodemailer");w().config();w().config();var Yt=function(e,t,n,o){return new(n||(n=Promise))(function(r,c){function a(e){try{s(o.next(e))}catch(e){c(e)}}function i(e){try{s(o.throw(e))}catch(e){c(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,i)}s((o=o.apply(e,t||[])).next())})},Xt=function(e,t){var n,o,r,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=i(0),a.throw=i(1),a.return=i(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,i[0]&&(c=0)),c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!((r=(r=c.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};w().config();var $t=function(e,t){var n=" AND (".concat(e.map(function(e){return"roomMemberships.userStatus = '".concat(e,"'")}).join(" OR "),")");return"SELECT users.userID as userID, users.userName AS userName, roomMemberships.userStatus as userStatus\n    FROM users INNER JOIN roomMemberships ON roomMemberships.userID = users.userID\n    WHERE roomMemberships.roomID = ?".concat(e.length>0?n:"","\n    ORDER BY users.userID DESC LIMIT ").concat(10,", ").concat(10*t,";")};const Kt={withUserName:function(e,t){return Yt(void 0,void 0,void 0,function(){return Xt(this,function(n){switch(n.label){case 0:return[4,_.makeQuery("SELECT * FROM users WHERE userName = ?;",[e]).run(t,"SearchDB.users.withUserName")];case 1:return[2,n.sent()]}})})},withEmail:function(e,t){return Yt(void 0,void 0,void 0,function(){return Xt(this,function(n){switch(n.label){case 0:return[4,_.makeQuery("SELECT * FROM users WHERE email = ?;",[e]).run(t,"SearchDB.users.withEmail")];case 1:return[2,n.sent()]}})})},whoJoinedRoom:function(e,t,n){return Yt(void 0,void 0,void 0,function(){return Xt(this,function(o){switch(o.label){case 0:return[4,_.makeQuery($t(["member"],t),[e]).run(n,"SearchDB.users.whoJoinedRoom")];case 1:return[2,o.sent()]}})})},whoAreInvitedToJoinRoom:function(e,t,n){return Yt(void 0,void 0,void 0,function(){return Xt(this,function(o){switch(o.label){case 0:return[4,_.makeQuery($t(["invited"],t),[e]).run(n,"SearchDB.users.whoAreInvitedToJoinRoom")];case 1:return[2,o.sent()]}})})},whoRequestedToJoinRoom:function(e,t,n){return Yt(void 0,void 0,void 0,function(){return Xt(this,function(o){switch(o.label){case 0:return[4,_.makeQuery($t(["requested"],t),[e]).run(n,"SearchDB.users.whoRequestedToJoinRoom")];case 1:return[2,o.sent()]}})})},whoArePendingToJoinRoom:function(e,t,n){return Yt(void 0,void 0,void 0,function(){return Xt(this,function(o){switch(o.label){case 0:return[4,_.makeQuery($t(["invited","requested"],t),[e]).run(n,"SearchDB.users.whoArePendingToJoinRoom")];case 1:return[2,o.sent()]}})})},whoAreAssociatedWithRoom:function(e,t,n){return Yt(void 0,void 0,void 0,function(){return Xt(this,function(o){switch(o.label){case 0:return[4,_.makeQuery($t([],t),[e]).run(n,"SearchDB.users.whoAreAssociatedWithRoom")];case 1:return[2,o.sent()]}})})},others:function(e,t,n){return Yt(void 0,void 0,void 0,function(){return Xt(this,function(o){switch(o.label){case 0:return[4,_.makeQuery("SELECT userID, userName FROM users\n                WHERE NOT EXISTS (SELECT userID FROM roomMemberships WHERE roomID = ".concat(e," LIMIT 1)\n                ORDER BY userID DESC LIMIT ").concat(10,", ").concat(10*t,";"),void 0).run(n,"SearchDB.users.others")];case 1:return[2,o.sent()]}})})}};w().config();var Zt=function(e,t,n,o){return new(n||(n=Promise))(function(r,c){function a(e){try{s(o.next(e))}catch(e){c(e)}}function i(e){try{s(o.throw(e))}catch(e){c(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,i)}s((o=o.apply(e,t||[])).next())})},en=function(e,t){var n,o,r,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=i(0),a.throw=i(1),a.return=i(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,i[0]&&(c=0)),c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!((r=(r=c.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};w().config();var tn="dev"==process.env.MODE,nn=0;function on(e,t,n,o){return Zt(this,void 0,void 0,function(){var r,c,a;return en(this,function(i){switch(i.label){case 0:if(r=function(e){var t=e.cookies.thingspool_token;if(t)return rn(t);var n=10*(Math.floor(Date.now()/1e3)-17578e5)+nn;nn=(nn+1)%10;var o=n.toString(16);return{userID:"0",userName:"Guest-".concat(o),userType:"guest",passwordHash:"NO_PASSWORD",email:"NO_EMAIL"}}(e),!r)return[3,9];if(!n(r))return D.log("User doesn't satisfy the pass-condition.",{user:r},"high","pink"),t.status(403).send("User doesn't satisfy the pass-condition."),[2,!1];switch(r.userType){case"admin":case"member":return[3,1];case"guest":return[3,4]}return[3,7];case 1:return i.trys.push([1,3,,4]),[4,an(r.userName,t)];case 2:case 5:return i.sent(),e.user=r,o(),[2,!0];case 3:return c=i.sent(),D.log("Failed to add token (registered user)",{err:c},"high","pink"),t.status(401).send("Failed to add token (error: ".concat(c,")")),[2,!1];case 4:return i.trys.push([4,6,,7]),[4,cn(r,t)];case 6:return a=i.sent(),D.log("Failed to add token (guest)",{err:a},"high","pink"),t.status(401).send("Failed to add token (error: ".concat(a,")")),[2,!1];case 7:return D.log("Unknown user type",{userType:r.userType},"high","pink"),t.status(500).send("Unknown user type :: ".concat(r.userType)),[2,!1];case 8:return[3,10];case 9:return D.logRaw("Authentication Failed","high","pink"),t.status(401).send("Authentication Failed"),[2,!1];case 10:return[2]}})})}function rn(e){try{return Ht().verify(e,process.env.JWT_SECRET_KEY)||(D.log("User is not found in the given token.",{tokenLength:e.length},"high","yellow"),null)}catch(e){return D.log("Token Verification Failed",{err:e},"high","pink"),null}}function cn(e,t){return Zt(this,void 0,void 0,function(){var n;return en(this,function(o){return n=Ht().sign(e,process.env.JWT_SECRET_KEY),null==t||t.cookie("thingspool_token",n,{secure:!tn,httpOnly:!0,sameSite:"strict",maxAge:31556926e5}).status(201),[2]})})}function an(e,t){return Zt(this,void 0,void 0,function(){var n,o;return en(this,function(r){switch(r.label){case 0:return[4,sn(e,t)];case 1:return(n=r.sent())?(o=Ht().sign(n,process.env.JWT_SECRET_KEY),null==t||t.cookie("thingspool_token",o,{secure:!tn,httpOnly:!0,sameSite:"strict",maxAge:31556926e5}).status(201),[2]):(D.log("Failed to add token (user not found)",{userName:e},"high"),null==t||t.status(404).send('Tried to add token, but there is no account with userName "'.concat(e,'".')),[2])}})})}function sn(e,t){return Zt(this,void 0,void 0,function(){var n;return en(this,function(o){switch(o.label){case 0:return[4,Kt.withUserName(e,t)];case 1:return n=o.sent(),t&&(t.statusCode<200||t.statusCode>=300)?[2,null]:n&&0!=n.length?[2,n[0]]:(D.log("User Not Found",{userName:e},"high","pink"),null==t||t.clearCookie("thingspool_token").status(404).send('There is no account with userName "'.concat(e,'".')),[2,null])}})})}const un=function(e){return rn(e)},ln=function(e,t){t.clearCookie("thingspool_token").status(200)},fn=function(e,t,n){return Zt(void 0,void 0,void 0,function(){return en(this,function(o){switch(o.label){case 0:return[4,on(e,t,function(e){return"admin"==e.userType},n)];case 1:return o.sent(),[2]}})})},dn=function(e,t,n){return Zt(void 0,void 0,void 0,function(){return en(this,function(o){switch(o.label){case 0:return[4,on(e,t,function(e){return!0},n)];case 1:return o.sent(),[2]}})})};w().config();var hn=r().Router();hn.get("/mypage",dn,function(e,t){Z.render(e,t,"page/dynamic/mypage",{loginDestination:"".concat(process.env.URL_DYNAMIC,"/mypage")})}),hn.get("/register",function(e,t){Z.render(e,t,"page/dynamic/register",{registerDestination:"".concat(process.env.URL_DYNAMIC,"/mypage")})}),hn.get("/login",function(e,t){Z.render(e,t,"page/dynamic/login",{loginDestination:"".concat(process.env.URL_DYNAMIC,"/mypage")})}),"dev"==process.env.MODE?(hn.get("/admin",function(e,t){Z.render(e,t,"page/development/admin",{})}),hn.get("/console",function(e,t){Z.render(e,t,"page/development/console",{})}),hn.get("/test-ui",function(e,t){Z.render(e,t,"page/development/test_ui",{gameEntries:ce.gameEntries})}),hn.get("/tailwind_test",function(e,t){Z.render(e,t,"page/development/tailwind_test",{loginDestination:"".concat(process.env.URL_DYNAMIC,"/tailwind_test")})})):(hn.get("/admin",fn,function(e,t){Z.render(e,t,"page/development/admin",{})}),hn.get("/console",fn,function(e,t){Z.render(e,t,"page/development/console",{})}));const pn=hn;var yn=r().Router();yn.get("/clear-token",function(e,t){ln(e,t),Q.onRouteResponse(t)});const mn=yn;var vn=function(e,t,n,o){return new(n||(n=Promise))(function(r,c){function a(e){try{s(o.next(e))}catch(e){c(e)}}function i(e){try{s(o.throw(e))}catch(e){c(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,i)}s((o=o.apply(e,t||[])).next())})},bn=function(e,t){var n,o,r,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=i(0),a.throw=i(1),a.return=i(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,i[0]&&(c=0)),c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!((r=(r=c.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};const gn=require("socket.io");var wn=n.n(gn);const xn=function(){function e(){}return e.decode=function(e){throw new Error("'decode' method is not implemented.")},e}();var In,Sn=(In=function(e,t){return In=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},In(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}In(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});const On=function(e){function t(t){var n=e.call(this)||this;return n.str=t,n}return Sn(t,e),t.prototype.encode=function(e){for(var t=0;t<this.str.length;++t){var n=this.str.charCodeAt(t);(n<0||n>255)&&(console.error("Char code is out of the 8-bit range (code = ".concat(n,", string = ").concat(this.str,", index = ").concat(t,")")),n="?".charCodeAt(0)),e.view[e.byteIndex++]=n}e.view[e.byteIndex++]=0},t.decode=function(e){for(var n,o=[];e.byteIndex<e.view.length&&0!=(n=e.view[e.byteIndex++]);)o.push(String.fromCharCode(n));return new t(o.join(""))},t}(xn);var jn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const Rn=function(e){function t(t,n){var o=e.call(this)||this;return o.senderObjectId=t,o.message=n,o}return jn(t,e),t.prototype.encode=function(e){new On(this.senderObjectId).encode(e),new On(this.message).encode(e)},t.decode=function(e){return new t(On.decode(e).str,On.decode(e).str)},t}(xn);var kn={normalizeInRange:function(e,t,n){return(kn.clampInRange(e,t,n)-t)/(n-t)},clampInRange:function(e,t,n){return(e<t||e>n)&&console.error("'n' is out of its expected range (n = ".concat(e,", min = ").concat(t,", max = ").concat(n,")")),Math.max(t,Math.min(n,e))},numberIsInRange:function(e,t,n,o){return void 0===o&&(o=!1),o?e>t&&e<n:e>=t&&e<=n},rangesOverlap:function(e,t,n,o,r){return void 0===r&&(r=!1),r?e<o&&n<t:e<=o&&n<=t}};const _n=kn;var Tn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Pn=0,En=0;const Mn=function(e){function t(t,n,o){var r=e.call(this)||this;return r.n=t,r.min=n,r.max=o,r}return Tn(t,e),t.prototype.encode=function(e){e.view[e.byteIndex++]=Math.floor(255.9999*_n.normalizeInRange(this.n,this.min,this.max))},t.decodeWithParams=function(e,n,o){return Pn=n,En=o,t.decode(e)},t.decode=function(e){return new t(Pn+e.view[e.byteIndex++]*(En-Pn)/255.9999,Pn,En)},t}(xn);var Nn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Ln=[0,32],Dn=[-1,4.019605882352941],Cn=[-1,1.0157472440944881];const An=function(e){function t(t,n,o,r,c,a){var i=e.call(this)||this;return i.x=t,i.y=n,i.z=o,i.dirX=r,i.dirY=c,i.dirZ=a,i}return Nn(t,e),t.prototype.encode=function(e){new Mn(this.x,Ln[0],Ln[1]).encode(e),new Mn(this.y,Dn[0],Dn[1]).encode(e),new Mn(this.z,Ln[0],Ln[1]).encode(e),new Mn(this.dirX,Cn[0],Cn[1]).encode(e),new Mn(this.dirY,Cn[0],Cn[1]).encode(e),new Mn(this.dirZ,Cn[0],Cn[1]).encode(e)},t.decode=function(e){return new t(Mn.decodeWithParams(e,Ln[0],Ln[1]).n,Mn.decodeWithParams(e,Dn[0],Dn[1]).n,Mn.decodeWithParams(e,Ln[0],Ln[1]).n,Mn.decodeWithParams(e,Cn[0],Cn[1]).n,Mn.decodeWithParams(e,Cn[0],Cn[1]).n,Mn.decodeWithParams(e,Cn[0],Cn[1]).n)},t}(xn);var Un=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const Bn=function(e){function t(t,n){var o=e.call(this)||this;return o.objectId=t,o.transform=n,o}return Un(t,e),t.prototype.encode=function(e){new On(this.objectId).encode(e),this.transform.encode(e)},t.decode=function(e){return new t(On.decode(e).str,An.decode(e))},t}(xn);var qn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const zn=function(e){function t(t){var n=e.call(this)||this;return n.roomID=t,n}return qn(t,e),t.prototype.encode=function(e){new On(this.roomID).encode(e)},t.decode=function(e){return new t(On.decode(e).str)},t}(xn),Fn=function(e){var t=Math.sqrt(e.x*e.x+e.y*e.y);if(0==t)return{x:0,y:0};var n=1/t;return{x:e.x*n,y:e.y*n}},Gn=function(e,t){return{x:e.x*t,y:e.y*t}},Wn=function(e,t){return{x:e.x+t.x,y:e.y+t.y}},Vn=function(e,t){return{x:e.x-t.x,y:e.y-t.y}},Jn=function(e,t){return e.x*t.y-e.y*t.x},Qn=function(e,t){return e.x*t.x+e.y*t.y},Hn=function(e,t){var n=t.x-e.x,o=t.y-e.y;return n*n+o*o};var Yn=new Array;function Xn(e,t){Yn.length=0;for(var n=Math.max(0,Math.floor(t.y-t.halfSizeY)),o=Math.max(0,Math.floor(t.x-t.halfSizeX)),r=Math.min(e.numGridRows-1,Math.floor(t.y+t.halfSizeY)),c=Math.min(e.numGridCols-1,Math.floor(t.x+t.halfSizeX)),a=n;a<=r;++a)for(var i=o;i<=c;++i){var s=e.voxels[a*e.numGridCols+i];null!=s?Yn.push(s):console.error("PhysicsVoxel is undefined (row = ".concat(a,", col = ").concat(i,")"))}return Yn}function $n(e,t,n,o){return e.voxels[t*e.numGridCols+n].collisionLayerMask>>o&1}var Kn=new Array,Zn=new Array;function eo(e,t){for(var n=!1,o=0;o<t.intersectingObjects.length;++o)t.intersectingObjects[o].objectId==e.objectId&&(console.error("Object already added to voxel (object = ".concat(JSON.stringify(e),", voxel = ").concat(JSON.stringify(t),")")),n=!0);for(n||t.intersectingObjects.push(e),n=!1,o=0;o<e.intersectingVoxels.length;++o)e.intersectingVoxels[o]==t&&(console.error("Voxel already added to object (object = ".concat(JSON.stringify(e),", voxel = ").concat(JSON.stringify(t),")")),n=!0);n||e.intersectingVoxels.push(t)}function to(e){Kn.length=0;for(var t=0,n=e.intersectingVoxels;t<n.length;t++){var o=n[t];Kn.push(o)}for(var r=0,c=Kn;r<c.length;r++)no(e,o=c[r])}function no(e,t){for(var n=!1,o=t.intersectingObjects,r=0;r<o.length;++r)if(o[r].objectId==e.objectId){for(var c=r+1;c<o.length;++c)o[r]=o[c];--o.length,n=!0}n||console.error("Object not found in voxel (object = ".concat(JSON.stringify(e),", voxel = ").concat(JSON.stringify(t),")"))}var oo={castAABBAgainstAABB:function(e,t,n){var o,r,c=n.x-n.halfSizeX-e.halfSizeX,a=n.y-n.halfSizeY-e.halfSizeY,i=n.x+n.halfSizeX+e.halfSizeX,s=n.y+n.halfSizeY+e.halfSizeY,u={x:c,y:a},l={x:i,y:a},f={x:c,y:s},d={x:i,y:s},h={start:u,end:l},p={start:l,end:d},y={start:d,end:f},m={start:f,end:u},v={start:{x:e.x,y:e.y},end:t},b=1;return(o=Math.min(b,oo.raycastToLine(v,h,!0)))<b&&(b=o,r=h),(o=Math.min(b,oo.raycastToLine(v,p,!0)))<b&&(b=o,r=p),(o=Math.min(b,oo.raycastToLine(v,y,!0)))<b&&(b=o,r=y),(o=Math.min(b,oo.raycastToLine(v,m,!0)))<b&&(b=o,r=m),{hitRayScale:b,hitLine:r}},raycastToLine:function(e,t,n){void 0===n&&(n=!1);var o=Vn(e.end,e.start),r=Vn(t.end,t.start),c=Jn(o,r);if(0==c)return 1;if(n&&c>0)return 1;var a=1/c,i=Vn(t.start,e.start),s=Jn(i,r)*a,u=Jn(i,o)*a;return s<0||s>1||u<0||u>1?1:s}};const ro=oo;function co(e,t,n,o){var r=ro.castAABBAgainstAABB(e,t,n);return r.hitRayScale<=o.minHitRayScale&&(o.minHitRayScale=r.hitRayScale,o.hitLine=r.hitLine),o}var ao={},io={minHitRayScale:1,hitLine:void 0};const so={load:function(e){if(null!=ao[e.room.roomID])throw new Error("Physics-room already exists (roomID = ".concat(e.room.roomID,")"));var t=e.room.voxelGrid;ao[e.room.roomID]={roomID:e.room.roomID,numGridRows:t.numGridRows,numGridCols:t.numGridCols,voxels:t.voxels.map(function(e){var t=e.row,n=e.col,o=new Array(4);return o.length=0,{row:t,col:n,collisionLayerMask:e.collisionLayerMask,hitbox:{x:n+.5,y:t+.5,halfSizeX:.5,halfSizeY:.5},intersectingObjects:o}}),objectById:{}}},unload:function(e){if(null==ao[e])throw new Error("Physics-room doesn't exist (roomID = ".concat(e,")"));delete ao[e]},hasRoom:function(e){return null!=ao[e]},makeVoxelSolid:function(e,t,n){var o=ao[e];if(null==o)throw new Error("Physics-room doesn't exist (roomID = ".concat(e,", row = ").concat(t,", col = ").concat(n,")"));!function(e,t,n){e.voxels[t*e.numGridCols+n].collisionLayerMask|=1}(o,t,n)},makeVoxelUnsolid:function(e,t,n){var o=ao[e];if(null==o)throw new Error("Physics-room doesn't exist (roomID = ".concat(e,", row = ").concat(t,", col = ").concat(n,")"));!function(e,t,n){e.voxels[t*e.numGridCols+n].collisionLayerMask&=-2}(o,t,n)},addObject:function(e,t,n,o){var r=ao[e];if(null==r)throw new Error("Physics-room doesn't exist (roomID = ".concat(e,", objectId = ").concat(t,")"));if(null==r.objectById[t]){var c=new Array(4);c.length=0;var a={objectId:t,collisionLayer:o,hitbox:n,intersectingVoxels:c};r.objectById[t]=a,function(e,t,n){var o=e.objectById[t];if(null==o)throw new Error("PhysicsObject is not registered (objectId = ".concat(t,")"));var r=Xn(e,o.hitbox);o.hitbox.x=n.x,o.hitbox.y=n.y,to(o);for(var c=0,a=r;c<a.length;c++)eo(o,a[c])}(r,t,{x:n.x,y:n.y})}else console.warn("PhysicsObjct is already added (roomID = ".concat(e,", objectId = ").concat(t,")"))},removeObject:function(e,t){var n=ao[e];if(null==n)throw new Error("Physics-room doesn't exist (roomID = ".concat(e,", objectId = ").concat(t,")"));var o=n.objectById[t];if(null==o)throw new Error("PhysicsObject is not registered (roomID = ".concat(e,", objectId = ").concat(t,")"));delete n.objectById[t],to(o)},tryMoveObject:function(e,t,n){var o=ao[e];if(null==ao[e])throw new Error("Physics-room doesn't exist (roomID = ".concat(e,")"));var r=o.objectById[t];if(null==r)throw new Error("PhysicsObject is not registered (objectId = ".concat(t,")"));var c={x:r.hitbox.x,y:r.hitbox.y},a=Hn(n,c);if(a>=9)return console.warn("Physics-position desync due to distance gap (startPos = (".concat(c.x.toFixed(3),", ").concat(c.y.toFixed(3),"), targetPos = (").concat(n.x.toFixed(3),", ").concat(n.y.toFixed(3),"), dist = ").concat(Math.sqrt(a),")")),{resolvedPos:c,desyncDetected:!0};if(a<1e-6)return{resolvedPos:c,desyncDetected:!1};var i=Fn(Vn(n,c));c=Vn(c,Gn(i,.01));var s=Math.min(c.x,n.x)-r.hitbox.halfSizeX,u=Math.max(c.x,n.x)+r.hitbox.halfSizeX,l=Math.min(c.y,n.y)-r.hitbox.halfSizeY,f=Math.max(c.y,n.y)+r.hitbox.halfSizeY,d=Math.floor(s),h=Math.floor(u),p=Math.floor(l),y=Math.floor(f);if(d<0||p<0||h>=o.numGridCols||y>=o.numGridRows)return console.warn("Physics-position desync due to room boundary limit (startPos = (".concat(c.x.toFixed(3),", ").concat(c.y.toFixed(3),"), targetPos = (").concat(n.x.toFixed(3),", ").concat(n.y.toFixed(3),", minCol = ").concat(d,", minRow = ").concat(p,", maxCol = ").concat(h,", maxRow = ").concat(y,"))")),{resolvedPos:c,desyncDetected:!0};io.minHitRayScale=1,io.hitLine=void 0;for(var m=p;m<=y;++m)for(var v=d;v<=h;++v){var b=o.voxels[m*o.numGridCols+v];0!=$n(o,m,v,r.collisionLayer)&&co(r.hitbox,n,b.hitbox,io)}for(var g=0,w=Object.values(o.objectById);g<w.length;g++){var x=w[g];r.objectId!=x.objectId&&(r.hitbox.halfSizeX>0||r.hitbox.halfSizeY>0)&&r.collisionLayer==x.collisionLayer&&(io=co(r.hitbox,n,x.hitbox,io))}var I=n;if(null!=io.hitLine){var S=Gn(Vn(n,c),io.minHitRayScale),O=Wn(c,S),j=Vn(n,O),R=Vn(io.hitLine.end,io.hitLine.start),k=Qn(j,R);k<0&&(R=Vn(io.hitLine.start,io.hitLine.end),k=Qn(j,R));for(var _=Gn(R,k/Qn(R,R)),T=Wn(O,_),P=!1,E=0,M=Xn(o,{x:T.x,y:T.y,halfSizeX:r.hitbox.halfSizeX,halfSizeY:r.hitbox.halfSizeY});E<M.length;E++)0!=$n(o,(b=M[E]).row,b.col,r.collisionLayer)&&(P=!0);I=P?O:T}return r.hitbox.x=I.x,r.hitbox.y=I.y,{resolvedPos:I,desyncDetected:!1}},forceMoveObject:function(e,t,n){var o=ao[e];if(null==ao[e])throw new Error("Physics-room doesn't exist (roomID = ".concat(e,")"));var r=o.objectById[t];if(null==r)throw new Error("PhysicsObject is not registered (objectId = ".concat(t,")"));r.hitbox.x=n.x,r.hitbox.y=n.y},getObjectsInDist:function(e,t,n,o){var r=ao[e];if(null==ao[e])throw new Error("Physics-room doesn't exist (roomID = ".concat(e,")"));return function(e,t,n,o){var r=Xn(e,{x:t,y:n,halfSizeX:o,halfSizeY:o});Zn.length=0;for(var c=0,a=r;c<a.length;c++)for(var i=0,s=a[c].intersectingObjects;i<s.length;i++){var u=s[i],l=u.hitbox.x-t,f=u.hitbox.y-n;l*l+f*f<=o*o&&Zn.push(u)}return Zn}(r,t,n,o)}};var uo=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),lo=0,fo=0;const ho=function(e){function t(t,n,o){var r=e.call(this)||this;return r.v=t,r.min=n,r.max=o,r}return uo(t,e),t.prototype.encode=function(e){new Mn(this.v.x,this.min,this.max).encode(e),new Mn(this.v.y,this.min,this.max).encode(e)},t.decodeWithParams=function(e,n,o){return lo=n,fo=o,t.decode(e)},t.decode=function(e){var n=Mn.decodeWithParams(e,lo,fo),o=Mn.decodeWithParams(e,lo,fo);return new t({x:n.n,y:o.n},lo,fo)},t}(xn);var po=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const yo=function(e){function t(t,n){var o=e.call(this)||this;return o.objectId=t,o.resolvedPos=n,o}return po(t,e),t.prototype.encode=function(e){new On(this.objectId).encode(e),new ho(this.resolvedPos,0,32).encode(e)},t.decode=function(e){return new t(On.decode(e).str,ho.decodeWithParams(e,0,32).v)},t}(xn);var mo=[[0,{objectType:"Voxel",components:{spawnedByAny:{instancedMeshGraphics:{instancedMeshConfigId:"Voxel"},voxelMeshInstancer:{}}}}],[1,{objectType:"Player",components:{spawnedByAny:{collider:{collisionLayer:0,hitboxSize:{sizeX:.6,sizeZ:.6}},speechBubble:{yOffset:2.4},playerProximityDetector:{maxDist:.45,maxLookAngle:-1}},spawnedByMe:{firstPersonController:{},objectSyncEmitter:{}},spawnedByOther:{modelGraphics:{path:"lowpolyghost/lowpolyghost.glb",localPosition:{x:0,y:1.22,z:0},scale:{x:.3,y:.3,z:.3}},objectSyncReceiver:{}}}}],[2,{objectType:"Door",components:{spawnedByAny:{collider:{collisionLayer:0,hitboxSize:{sizeX:0,sizeZ:0}},instancedMeshGraphics:{instancedMeshConfigId:"Door"},persistentObjectMeshInstancer:{},speechBubble:{yOffset:0},playerProximityDetector:{maxDist:3,maxLookAngle:.25*Math.PI}}}}]],vo={},bo={};mo.forEach(function(e){vo[e[0]]=e[1],bo[e[1].objectType]=e[0]});const go=function(e){var t=vo[e];if(null==t)throw new Error("getConfigByIndex :: Invalid object type index (objectTypeIndex = ".concat(e,")"));return t},wo=function(e){var t=bo[e];if(null==t)throw new Error("getIndexByType :: Invalid object type (objectType = ".concat(e,")"));return t};var xo=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const Io=function(e){function t(t){var n=e.call(this)||this;return n.n=t,n}return xo(t,e),t.prototype.encode=function(e){(this.n<0||this.n>255)&&console.error("Number is out of its desired range (n = ".concat(this.n,")")),Math.floor(this.n)!=this.n&&console.error("Number is not an integer (n = ".concat(this.n,")"));var t=Math.min(255,Math.max(0,Math.floor(this.n)));e.view[e.byteIndex++]=t},t.decode=function(e){return new t(e.view[e.byteIndex++])},t}(xn);var So=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const Oo=function(e){function t(t,n,o,r,c){var a=e.call(this)||this;return a.sourceUserName=t,a.objectTypeIndex=n,a.objectId=o,a.transform=r,a.metadata=c,a}return So(t,e),t.prototype.encode=function(e){new On(this.sourceUserName).encode(e),new Io(this.objectTypeIndex).encode(e),new On(this.objectId).encode(e),this.transform.encode(e),new On(this.metadata).encode(e)},t.decode=function(e){return new t(On.decode(e).str,Io.decode(e).n,On.decode(e).str,An.decode(e),On.decode(e).str)},t}(xn);var jo=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const Ro=function(e){function t(t){var n=e.call(this)||this;return n.objectSpawnParams=t,n}return jo(t,e),t.prototype.encode=function(e){this.objectSpawnParams.encode(e)},t.decode=function(e){return new t(Oo.decode(e))},t}(xn);var ko=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const _o=function(e){function t(t,n,o,r,c,a,i){var s=e.call(this)||this;return s.objectId=t,s.objectTypeIndex=n,s.direction=o,s.x=r,s.y=c,s.z=a,s.metadata=i,s}return ko(t,e),t.prototype.encode=function(e){if(this.objectTypeIndex<0||this.objectTypeIndex>63)throw new Error("Object type index out of range (objectTypeIndex = ".concat(this.objectTypeIndex,")"));if(this.x<0||this.x>32)throw new Error("Object x out of range (x = ".concat(this.x,")"));if(this.z<0||this.z>32)throw new Error("Object z out of range (z = ".concat(this.z,")"));if(this.y<0||this.y>4)throw new Error("Object y out of range (y = ".concat(this.y,")"));e.view[e.byteIndex++]=this.objectTypeIndex<<2|("+z"==this.direction?0:"+x"==this.direction?1:"-z"==this.direction?2:3);var t=Math.floor(4*this.y),n=(12&t)>>2,o=3&t;e.view[e.byteIndex++]=Math.floor(2*this.x)<<2|n,e.view[e.byteIndex++]=Math.floor(2*this.z)<<2|o,new On(this.metadata).encode(e)},t.decode=function(e){var n=e.view[e.byteIndex++],o=n>>2&63,r=3&n,c=r<=1?0==r?"+z":"+x":2==r?"-z":"-x",a=e.view[e.byteIndex++],i=.5*(a>>2&63),s=3&a,u=e.view[e.byteIndex++],l=.5*(u>>2&63),f=.25*(s<<2|3&u),d=On.decode(e).str;return new t("p".concat(i,"-").concat(f,"-").concat(l),o,c,i,f,l,d)},t}(xn),To=function(e,t,n,o){this.facingAxis=e,this.orientation=t,this.yOffset=n,this.textureIndex=o};var Po=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const Eo=function(e){function t(t,n){var o=e.call(this)||this;return o.gameObjectId="",o.row=-1,o.col=-1,o.collisionLayerMask=t,o.quads=n,o}return Po(t,e),t.prototype.setGameObjectId=function(e){this.gameObjectId=e},t.prototype.setCoordinates=function(e,t){this.row=e,this.col=t},t.prototype.encode=function(e){if(this.quads.length>31)throw new Error("No more than 31 quads are allowed in a voxel (row = ".concat(this.row,", col = ").concat(this.col,", number of quads detected = ").concat(this.quads.length,")"));if(this.collisionLayerMask<0||this.collisionLayerMask>255)throw new Error("Voxel's collisionLayerMask is out of its range (value found = ".concat(this.collisionLayerMask,", range = [0:255])"));e.view[e.byteIndex++]=this.collisionLayerMask,e.view[e.byteIndex++]=this.quads.length;for(var t=this.quads.length,n=0;n<t;++n){var o=this.quads[n],r="x"==o.facingAxis?0:"y"==o.facingAxis?1:2,c=2*o.yOffset*6+2*r+("-"==o.orientation?0:1);n%2==0?(e.view[e.byteIndex++]=c<<2|o.textureIndex>>4,e.view[e.byteIndex]=(15&o.textureIndex)<<4):(e.view[e.byteIndex++]|=c>>2,e.view[e.byteIndex++]=(3&c)<<6|o.textureIndex)}t%2==1&&e.byteIndex++},t.decode=function(e){for(var n,o,r,c,a=e.view[e.byteIndex++],i=31&e.view[e.byteIndex++],s=new Array(i),u=0;u<i;++u){u%2==0?(r=(n=e.view[e.byteIndex++])>>2,c=(3&n)<<4|(o=e.view[e.byteIndex])>>4):(r=(15&(n=e.view[e.byteIndex++]))<<2|(o=e.view[e.byteIndex++])>>6,c=63&o);var l=.5*Math.floor(r/6),f=r%2==0?"-":"+",d=Math.floor(r/2)%3,h=0==d?"x":1==d?"y":"z";s[u]=new To(h,f,l,c)}return i%2==1&&e.byteIndex++,new t(a,s)},t}(xn);var Mo=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const No=function(e){function t(t,n,o){var r=e.call(this)||this;return r.numGridRows=t,r.numGridCols=n,r.voxels=o,r}return Mo(t,e),t.prototype.encode=function(e){e.view[e.byteIndex++]=this.numGridRows,e.view[e.byteIndex++]=this.numGridCols;for(var t=0,n=this.voxels;t<n.length;t++)n[t].encode(e)},t.decode=function(e){var n=e.view[e.byteIndex++],o=e.view[e.byteIndex++],r=n*o,c=new Array(r);c.length=0;for(var a=1/o,i=0;i<r;){var s=Math.floor(i*a),u=i%o;if(s<0||u<0||s>=n||u>=o)throw new Error("Decoded voxel coordinates are out of range (row = ".concat(s,", col = ").concat(u,", numGridRows = ").concat(n,", numGridCols = ").concat(o,")"));var l=Eo.decode(e);l.setCoordinates(s,u),c[i++]=l}return new t(n,o,c)},t}(xn);function Lo(e,t,n,o,r,c){return Ao(e,0,n,o,r,[function(e){return Uo("x","+",c,e)},function(e){return Uo("x","-",c,e)},function(e){return Uo("z","+",c,e)},function(e){return Uo("z","-",c,e)}])}function Do(e,t,n,o,r,c){return Ao(e,0,n,o,r,[function(e){return function(e,t){return t.push(new To("y","+",0,e)),0}(c,e)},function(e){return function(e,t){return t.push(new To("y","-",4,e)),0}(c,e)}])}function Co(e,t,n,o,r,c,a,i){return Ao(e,0,n,o,r,[function(e){return Uo(a,i,c,e)}])}function Ao(e,t,n,o,r,c){for(var a=[],i=0,s=0,u=c;s<u.length;s++)i|=(0,u[s])(a);var l=new Eo(i,a);return l.setCoordinates(o,r),e[o*n+r]=l,l}function Uo(e,t,n,o){for(var r=.5;r<=3.5;++r)o.push(new To(e,t,r,n));return 1}const Bo={generateRoom:function(e){for(var t=32,n=32,o=parseInt(e.substring(1)),r=8*o,c=8*o+1,a=new Array(1024),i=0;i<t;++i)for(var s=0;s<n;++s)0==i?Co(a,t,n,i,s,c,"z","+"):0==s?Co(a,t,n,i,s,c,"x","+"):31==i?Co(a,t,n,i,s,c,"z","-"):31==s?Co(a,t,n,i,s,c,"x","-"):Do(a,t,n,i,s,r);Lo(a,t,n,3,3,c),Lo(a,t,n,28,28,c),Lo(a,t,n,3,28,c),Lo(a,t,n,28,3,c);for(var u=[],l=12,f=0;f<=3;++f){var d="s".concat(f);if(d!=e){var h=l;l+=4;var p="p".concat(h,"-").concat(2,"-").concat(1);u.push(new _o(p,wo("Door"),"+z",h,2,1,d))}}return{voxelGrid:new No(t,n,a),persistentObjects:u}}};var qo=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const zo=function(e){function t(t){var n=e.call(this)||this;return n.n=t,n}return qo(t,e),t.prototype.encode=function(e){(this.n<0||this.n>65535)&&console.error("Number is out of its desired range (n = ".concat(this.n,")")),Math.floor(this.n)!=this.n&&console.error("Number is not an integer (n = ".concat(this.n,")"));var t=Math.min(65535,Math.max(0,Math.floor(this.n))),n=t>>8&255,o=255&t;e.view[e.byteIndex++]=n,e.view[e.byteIndex++]=o},t.decode=function(e){return new t(e.view[e.byteIndex++]<<8|e.view[e.byteIndex++])},t}(xn);var Fo,Go=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Wo=0;const Vo=function(e){function t(t,n){var o=e.call(this)||this;return o.arr=t,o.lengthLimit=n,o}return Go(t,e),t.prototype.encode=function(e){this.arr.length>this.lengthLimit&&console.error("Encodable data array's length limit exceeded (length = ".concat(this.arr.length,", lengthLimit = ").concat(this.lengthLimit,")"));var t=Math.min(this.arr.length,this.lengthLimit);if(this.lengthLimit<=255)new Io(t).encode(e);else{if(!(this.lengthLimit<=65535))throw new Error("Length limit of ".concat(this.lengthLimit," is not supported."));new zo(t).encode(e)}for(var n=0;n<t;++n)this.arr[n].encode(e)},t.decodeWithParams=function(e,n,o){return Fo=n,Wo=o,t.decode(e)},t.decode=function(e){var n=0;if(Wo<256)n=Io.decode(e).n;else{if(!(Wo<65536))throw new Error("Length limit of ".concat(Wo," is not supported."));n=zo.decode(e).n}for(var o=new Array(n),r=0;r<n;++r)o[r]=Fo(e);return new t(o,Wo)},t}(xn);var Jo=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const Qo=function(e){function t(t,n,o,r,c,a){var i=e.call(this)||this;return i.roomID=t,i.roomName=n,i.ownerUserName=o,i.texturePackURL=r,i.voxelGrid=c,i.persistentObjects=a,i}return Jo(t,e),t.prototype.encode=function(e){new On(this.roomID).encode(e),new On(this.roomName).encode(e),new On(this.ownerUserName).encode(e),new On(this.texturePackURL).encode(e),this.voxelGrid.encode(e),new Vo(this.persistentObjects,65535).encode(e)},t.decode=function(e){return new t(On.decode(e).str,On.decode(e).str,On.decode(e).str,On.decode(e).str,No.decode(e),Vo.decodeWithParams(e,_o.decode,65535).arr)},t}(xn);var Ho=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const Yo=function(e){function t(t,n,o){var r=e.call(this)||this;return r.room=t,r.participantUserNames=n,r.objectRuntimeMemories=o,r}return Ho(t,e),t.prototype.encode=function(e){this.room.encode(e),new Vo(Object.keys(this.participantUserNames).map(function(e){return new On(e)}),65535).encode(e),new Vo(Object.values(this.objectRuntimeMemories),65535).encode(e)},t.decode=function(e){for(var n=Qo.decode(e),o={},r=0,c=Vo.decodeWithParams(e,On.decode,65535).arr;r<c.length;r++)o[c[r].str]=!0;for(var a={},i=0,s=Vo.decodeWithParams(e,Ro.decode,65535).arr;i<s.length;i++){var u=s[i];a[u.objectSpawnParams.objectId]=u}return new t(n,o,a)},t}(xn),Xo=function(){function e(){this.socketUserContexts={}}return e.prototype.multicastSignal=function(e,t,n){void 0===n&&(n=void 0);for(var o=0,r=Object.entries(this.socketUserContexts);o<r.length;o++){var c=r[o],a=c[0],i=c[1];a!=n&&i.addPendingSignal(e,t)}},e.prototype.unicastSignal=function(e,t,n){var o=this.socketUserContexts[n];null!=o?o.addPendingSignal(e,t):console.error("SocketUserContext not found (targetUserName = ".concat(n,")"))},e.prototype.addSocketUserContext=function(e,t){null==this.socketUserContexts[e]?this.socketUserContexts[e]=t:console.error("SocketUserContext already exists (userName = ".concat(e,")"))},e.prototype.removeSocketUserContext=function(e){null!=this.socketUserContexts[e]?delete this.socketUserContexts[e]:console.error("SocketUserContext doesn't exist (userName = ".concat(e,")"))},e}();function $o(e){return t=this,n=void 0,r=function(){var t,n,o;return function(e,t){var n,o,r,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=i(0),a.throw=i(1),a.return=i(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,i[0]&&(c=0)),c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!((r=(r=c.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(r){if(console.log("RoomManager.loadRoom :: roomID = ".concat(e)),null!=Or.roomRuntimeMemories[e])throw new Error("RoomManager.loadRoom :: RoomRuntimeMemory already exists (roomID = ".concat(e,")"));if(!e.startsWith("s"))throw new Error("Fetching room from database is not supported yet (roomID = ".concat(e,")"));return n=Bo.generateRoom(e),t=new Qo(e,e,"","".concat("dev"==process.env.MODE?"http://".concat(Q.getLocalIpAddress(),":").concat(process.env.PORT):process.env.URL_STATIC,"/app/assets/texture_packs/default.jpg"),n.voxelGrid,n.persistentObjects),o=new Yo(t,{},{}),Or.roomRuntimeMemories[e]=o,Or.socketRoomContexts[e]=new Xo,so.load(o),[2,o]})},new((o=void 0)||(o=Promise))(function(e,c){function a(e){try{s(r.next(e))}catch(e){c(e)}}function i(e){try{s(r.throw(e))}catch(e){c(e)}}function s(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o(function(e){e(n)})).then(a,i)}s((r=r.apply(t,n||[])).next())});var t,n,o,r}var Ko=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const Zo=function(e){function t(t){var n=e.call(this)||this;return n.objectId=t,n}return Ko(t,e),t.prototype.encode=function(e){new On(this.objectId).encode(e)},t.decode=function(e){return new t(On.decode(e).str)},t}(xn);function er(e,t){var n,o=e.socket.handshake.auth,r=Or.currentRoomIDByUserName[o.userName];if(console.log("RoomManager.removeObject :: roomID = ".concat(r,", userName = ").concat(o.userName,", objectId = ").concat(t)),null!=r){var c=Or.roomRuntimeMemories[r];if(null!=c){var a=c.objectRuntimeMemories[t];if(null!=a){delete c.objectRuntimeMemories[t],(null===(n=go(a.objectSpawnParams.objectTypeIndex).components.spawnedByAny)||void 0===n?void 0:n.collider)&&so.removeObject(r,t);var i=new Zo(t),s=Or.socketRoomContexts[r];s?s.multicastSignal("objectDespawnParams",i,o.userName):console.error("RoomManager.removeObject :: SocketRoomContext not found (roomID = ".concat(r,")"))}else console.error("RoomManager.removeObject :: ObjectRuntimeMemory doesn't exist (roomID = ".concat(r,", objectId = ").concat(t,")"))}else console.error("RoomManager.removeObject :: RoomRuntimeMemory doesn't exist (roomID = ".concat(r,", objectId = ").concat(t,")"))}else console.error("RoomManager.removeObject :: RoomID not found (userName = ".concat(o.userName,", objectId = ").concat(t,")"))}var tr=0;const nr=function(){function e(e,t,n,o,r,c,a,i){this.actionType=e,this.row=t,this.col=n,this.quadIndex=o,this.facingAxis=r,this.orientation=c,this.yOffset=a,this.textureIndex=i}return e.prototype.toString=function(){return"[(".concat(this.actionType," ").concat(this.row,".").concat(this.col,".").concat(this.quadIndex,") -> ").concat(this.yOffset,".").concat(this.facingAxis).concat(this.orientation,".").concat(this.textureIndex,"]\n    -> Result: ").concat(this.voxelQuadsResultSnapshot?this.voxelQuadsResultSnapshot.map(function(e){return"[".concat(e.yOffset,".").concat(e.facingAxis).concat(e.orientation,".").concat(e.textureIndex,"]")}).join(","):"")},e}();var or=function(){return or=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},or.apply(this,arguments)},rr=!1,cr=[],ar={setDebugEnabled:function(e){rr=e},getRecentChanges:function(){return cr},flushRecentChanges:function(){cr.length=0},addCube:function(e,t,n,o,r){if(rr&&console.log("START - addCube - row: ".concat(t,", col: ").concat(n,", yCenter: ").concat(o,", textureIndex: ").concat(r)),o<0||o>4)return console.error("yCenter of the cube is out of range (yCenter = ".concat(o,")")),!1;var c=ar.getVoxel(e,t,n);if(!c)return console.error("No voxel found in (row: ".concat(t,", col: ").concat(n,")")),!1;if(c.quads.length>=31)return!1;for(var a=0;a<c.quads.length;++a){var i=c.quads[a];if("y"!=i.facingAxis&&Math.abs(i.yOffset-o)<1)return!1;if("y"==i.facingAxis&&i.yOffset>0&&i.yOffset<4){if("-"==i.orientation&&o>=i.yOffset&&o<=i.yOffset+1)return!1;if("+"==i.orientation&&o>=i.yOffset-1&&o<=i.yOffset)return!1}}var s=ar.getVoxel(e,t-1,n);return s&&sr(e,s,o)?lr(s,"z","+",o):ur(c,"z","-",o,r),(s=ar.getVoxel(e,t+1,n))&&sr(e,s,o)?lr(s,"z","-",o):ur(c,"z","+",o,r),(s=ar.getVoxel(e,t,n-1))&&sr(e,s,o)?lr(s,"x","+",o):ur(c,"x","-",o,r),(s=ar.getVoxel(e,t,n+1))&&sr(e,s,o)?lr(s,"x","-",o):ur(c,"x","+",o,r),sr(e,c,o-1)?lr(c,"y","+",o-.5):ur(c,"y","-",o-.5,r),sr(e,c,o+1)?lr(c,"y","-",o+.5):ur(c,"y","+",o+.5,r),(sr(e,c,.5)||sr(e,c,1)||sr(e,c,1.5)||sr(e,c,2)||sr(e,c,2.5))&&(function(e,t,n){ar.getVoxel(e,t,n).collisionLayerMask|=1}(e,t,n),so.makeVoxelSolid(e.roomID,t,n)),!0},removeCube:function(e,t,n,o){if(rr&&console.log("START - removeCube - row: ".concat(t,", col: ").concat(n,", yCenter: ").concat(o)),o<0||o>4)return console.error("yCenter of the cube is out of range (yCenter = ".concat(o,")")),!1;var r=ar.getVoxel(e,t,n);if(!r)return console.error("No voxel found in (row: ".concat(t,", col: ").concat(n,")")),!1;if(t<=0||n<=0||t>=e.voxelGrid.numGridRows-1||n>=e.voxelGrid.numGridCols-1)return!1;var c=r.quads[0].textureIndex;return lr(r,"x","-",o),lr(r,"x","+",o),lr(r,"y","-",o-.5),lr(r,"y","+",o+.5),lr(r,"z","-",o),lr(r,"z","+",o),ir(e,t,n,-1,0,o,c),ir(e,t,n,1,0,o,c),ir(e,t,n,0,-1,o,c),ir(e,t,n,0,1,o,c),(o>=3.5||sr(e,r,o+1))&&ur(r,"y","-",o+.5,c),(o<=.5||sr(e,r,o-1))&&ur(r,"y","+",o-.5,c),sr(e,r,.5)||sr(e,r,1)||sr(e,r,1.5)||sr(e,r,2)||sr(e,r,2.5)||(function(e,t,n){ar.getVoxel(e,t,n).collisionLayerMask&=-2}(e,t,n),so.makeVoxelUnsolid(e.roomID,t,n)),!0},changeVoxelTexture:function(e,t,n,o,r){rr&&console.log("START - changeVoxelTexture - row: ".concat(t,", col: ").concat(n,", quadIndex: ").concat(o,", textureIndex: ").concat(r));var c=ar.getVoxel(e,t,n);if(!c)return console.error("No voxel found in (row: ".concat(t,", col: ").concat(n,")")),!1;if(o<0||o>=c.quads.length)return console.error("Quad doesn't exist in voxel (quadIndex = ".concat(o,", voxel.quads.length = ").concat(c.quads.length,")")),!1;var a=c.quads[o];return a.textureIndex=r,fr(c,new nr("changeTexture",c.row,c.col,o,a.facingAxis,a.orientation,a.yOffset,a.textureIndex)),!0},getVoxel:function(e,t,n){var o=e.voxelGrid.numGridCols,r=e.voxelGrid.numGridRows;if(!(t<0||t>=r||n<0||n>=o))return e.voxelGrid.voxels[t*o+n]}};function ir(e,t,n,o,r,c,a){var i,s=o>0||r>0?"-":"+";if(0!=o&&0==r)i="z";else{if(0!=o||0==r)throw new Error("No valid facingAxis for offset: (rowOffset = ".concat(o,", colOffset = ").concat(r,")"));i="x"}var u=t+o,l=n+r,f=ar.getVoxel(e,u,l);f&&(sr(e,f,c)&&ur(f,i,s,c,a),sr(e,f,c-.5)&&ur(f,i,s,c-.5,a),sr(e,f,c+.5)&&ur(f,i,s,c+.5,a))}function sr(e,t,n){if(!(0!=t.row&&0!=t.col&&t.row!=e.voxelGrid.numGridRows-1&&t.col!=e.voxelGrid.numGridCols-1||.5!=n&&1.5!=n&&2.5!=n&&3.5!=n))return!0;for(var o=0;o<t.quads.length;++o){var r=t.quads[o];if("y"!=r.facingAxis){if(r.yOffset==n)return!0}else{if("-"==r.orientation&&r.yOffset==n-.5)return!0;if("+"==r.orientation&&r.yOffset==n+.5)return!0}}return!1}function ur(e,t,n,o,r){for(var c=0;c<e.quads.length;++c){var a=e.quads[c];if(a.facingAxis==t&&a.orientation==n&&a.yOffset==o)return!1}return e.quads.push(new To(t,n,o,r)),fr(e,new nr("add",e.row,e.col,e.quads.length-1,t,n,o,r)),!0}function lr(e,t,n,o){for(var r=-1,c=0;c<e.quads.length;++c){var a=e.quads[c];if(a.facingAxis==t&&a.orientation==n&&a.yOffset==o){r=c;break}}if(r>=0){for(c=r+1;c<e.quads.length;++c)e.quads[c-1]=e.quads[c];return e.quads.length=e.quads.length-1,fr(e,new nr("remove",e.row,e.col,r,t,n,o,-1)),!0}return!1}function fr(e,t){if(rr){for(var n=[],o=0,r=e.quads;o<r.length;o++){var c=r[o];n.push(or({},c))}t.voxelQuadsResultSnapshot=n}cr.push(t)}const dr=ar;var hr=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const pr=function(e){function t(t,n,o,r){var c=e.call(this)||this;return c.row=t,c.col=n,c.yCenter=o,c.textureIndex=r,c}return hr(t,e),t.prototype.encode=function(e){new Io(this.row).encode(e),new Io(this.col).encode(e),e.view[e.byteIndex++]=7&Math.round(2*this.yCenter),new Io(this.textureIndex).encode(e)},t.decode=function(e){return new t(Io.decode(e).n,Io.decode(e).n,.5*e.view[e.byteIndex++],Io.decode(e).n)},t}(xn);var yr=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const mr=function(e){function t(t,n,o){var r=e.call(this)||this;return r.row=t,r.col=n,r.yCenter=o,r}return yr(t,e),t.prototype.encode=function(e){new Io(this.row).encode(e),new Io(this.col).encode(e),e.view[e.byteIndex++]=7&Math.round(2*this.yCenter)},t.decode=function(e){return new t(Io.decode(e).n,Io.decode(e).n,.5*e.view[e.byteIndex++])},t}(xn);var vr=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const br=function(e){function t(t,n,o,r){var c=e.call(this)||this;return c.row=t,c.col=n,c.quadIndex=o,c.textureIndex=r,c}return vr(t,e),t.prototype.encode=function(e){new Io(this.row).encode(e),new Io(this.col).encode(e),new Io(this.quadIndex).encode(e),new Io(this.textureIndex).encode(e)},t.decode=function(e){return new t(Io.decode(e).n,Io.decode(e).n,Io.decode(e).n,Io.decode(e).n)},t}(xn);function gr(e){var t=e.socket.handshake.auth,n=Or.currentRoomIDByUserName[t.userName];if(null!=n){var o=Or.roomRuntimeMemories[n];if(null!=o)return o.room;console.error("RoomManager.getRoom :: RoomRuntimeMemory doesn't exist (roomID = ".concat(n,")"))}else console.error("RoomManager.getRoom :: RoomID not found (userName = ".concat(t.userName,")"))}w().config();var wr={},xr={},Ir={},Sr={roomRuntimeMemories:wr,socketRoomContexts:xr,currentRoomIDByUserName:Ir,changeUserRoom:function(e,t,n){return o=void 0,r=void 0,a=function(){var o,r,c;return function(e,t){var n,o,r,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=i(0),a.throw=i(1),a.return=i(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,i[0]&&(c=0)),c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!((r=(r=c.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(a){switch(a.label){case 0:return o=e.socket.handshake.auth,console.log("RoomManager.changeUserRoom :: roomID = ".concat(t,", userName = ").concat(o.userName)),function(e,t){var n=e.socket.handshake.auth,o=Or.currentRoomIDByUserName[n.userName];if(console.log("RoomManager.removeUserFromRoom :: roomID = ".concat(o,", userName = ").concat(n.userName)),null!=o){var r=Or.roomRuntimeMemories[o];if(null!=r){for(var c=function(e,t){var n=Or.roomRuntimeMemories[e];if(null==n)return console.error("RoomManager.getIdsOfObjectsSpawnedByUser :: RoomRuntimeMemory doesn't exist (roomID = ".concat(e,")")),[];for(var o=[],r=0,c=Object.entries(n.objectRuntimeMemories);r<c.length;r++){var a=c[r],i=a[0];a[1].objectSpawnParams.sourceUserName==t&&o.push(i)}return o}(o,n.userName),a=0,i=c;a<i.length;a++)er(e,i[a]);if(null!=r.participantUserNames[n.userName]){delete Or.currentRoomIDByUserName[n.userName],delete r.participantUserNames[n.userName];var s=Or.socketRoomContexts[o];s?s.removeSocketUserContext(n.userName):console.error("RoomManager.removeUserFromRoom :: SocketRoomContext not found (roomID = ".concat(o,")")),0==Object.keys(r.participantUserNames).length&&function(e){console.log("RoomManager.unloadRoom :: roomID = ".concat(e));var t=Or.roomRuntimeMemories[e];if(null==Or.roomRuntimeMemories[e])throw new Error("RoomManager.unloadRoom :: RoomRuntimeMemory doesn't exist (roomID = ".concat(e,")"));if(Object.keys(t.participantUserNames).length>0)throw new Error("RoomManager.unloadRoom :: There are still participants in the room (participants = [".concat(JSON.stringify(t.participantUserNames),"])"));delete Or.roomRuntimeMemories[e],delete Or.socketRoomContexts[e],so.unload(e)}(o)}else console.error("RoomManager.removeUserFromRoom :: User is not registered as the room's participant (userName = ".concat(n.userName,", roomID = ").concat(o,")"))}else console.error("RoomManager.removeUserFromRoom :: RoomRuntimeMemory doesn't exist (roomID = ".concat(o,")"))}else t&&console.warn("RoomManager.removeUserFromRoom :: Previous room not found :: userName = ".concat(n.userName))}(e,n),t?(r=wr[t])?[3,2]:[4,$o(t)]:[2];case 1:r=a.sent(),a.label=2;case 2:return r?(function(e,t,n){var o=e.socket.handshake.auth;if(console.log("RoomManager.addUserToRoom :: roomID = ".concat(t.room.roomID,", userName = ").concat(n)),null==t.participantUserNames[n]){Or.currentRoomIDByUserName[n]=t.room.roomID,t.participantUserNames[n]=!0;var r=Or.socketRoomContexts[t.room.roomID];r?r.addSocketUserContext(n,e):console.error("RoomManager.addUserToRoom :: SocketRoomContext not found (roomID = ".concat(t.room.roomID,")")),function(e,t){var n,o=e.socket.handshake.auth,r=Or.currentRoomIDByUserName[o.userName],c=t.objectSpawnParams.objectId;if(console.log("RoomManager.addObject :: roomID = ".concat(r,", userName = ").concat(o.userName,", objectId = ").concat(c)),null!=r){var a=Or.roomRuntimeMemories[r];if(null!=a)if(null==a.objectRuntimeMemories[c]){a.objectRuntimeMemories[c]=t;var i=null===(n=go(t.objectSpawnParams.objectTypeIndex).components.spawnedByAny)||void 0===n?void 0:n.collider;if(i){var s=.5*i.hitboxSize.sizeX,u=.5*i.hitboxSize.sizeZ,l={x:t.objectSpawnParams.transform.x,y:t.objectSpawnParams.transform.z,halfSizeX:s,halfSizeY:u};so.addObject(r,c,l,i.collisionLayer)}var f=Or.socketRoomContexts[r];f?f.multicastSignal("objectSpawnParams",t.objectSpawnParams,o.userName):console.error("RoomManager.addObject :: SocketRoomContext not found (roomID = ".concat(r,")"))}else console.error("RoomManager.addObject :: ObjectRuntimeMemory already exists (roomID = ".concat(r,", objectId = ").concat(c,")"));else console.error("RoomManager.addObject :: RoomRuntimeMemory doesn't exist (roomID = ".concat(r,", objectId = ").concat(c,")"))}else console.error("RoomManager.addObject :: RoomID not found (userName = ".concat(o.userName,", objectId = ").concat(c,")"))}(e,new Ro(new Oo(o.userName,wo("Player"),"#".concat(++tr),new An(16,0,16,0,0,1),"")))}else console.error("RoomManager.addUserToRoom :: User is already registered (roomID = ".concat(t.room.roomID,", userName = ").concat(n,")"))}(e,r,o.userName),(c=xr[t])?c.unicastSignal("roomRuntimeMemory",r,o.userName):console.error("RoomManager.changeUserRoom :: SocketRoomContext not found (roomID = ".concat(t,")")),[2]):(console.error("Failed to load room (ID = ".concat(t,")")),[2])}})},new((c=void 0)||(c=Promise))(function(e,t){function n(e){try{s(a.next(e))}catch(e){t(e)}}function i(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var o;t.done?e(t.value):(o=t.value,o instanceof c?o:new c(function(e){e(o)})).then(n,i)}s((a=a.apply(o,r||[])).next())});var o,r,c,a},addVoxelCube:function(e,t){!function(e,t,n,o,r){var c=e.socket.handshake.auth,a=gr(e);if(!a||!dr.addCube(a,t,n,o,r))return console.error("Voxel update failed (addVoxelCube) - row: ".concat(t,", col: ").concat(n,", yCenter = ").concat(o,", textureIndex = ").concat(r)),void e.addPendingSignal("voxelCubeAddParams",new pr(t,n,o,r));var i=Or.socketRoomContexts[a.roomID];i?i.multicastSignal("voxelCubeAddParams",new pr(t,n,o,r),c.userName):console.error("RoomManager.addVoxelCube :: SocketRoomContext not found (roomID = ".concat(a.roomID,")"))}(e,t.row,t.col,t.yCenter,t.textureIndex)},removeVoxelCube:function(e,t){!function(e,t,n,o){var r=e.socket.handshake.auth,c=gr(e);if(!c||!dr.removeCube(c,t,n,o))return console.error("Voxel update failed (removeVoxelCube) - row: ".concat(t,", col: ").concat(n,", yCenter = ").concat(o)),void e.addPendingSignal("voxelCubeRemoveParams",new mr(t,n,o));var a=Or.socketRoomContexts[c.roomID];a?a.multicastSignal("voxelCubeRemoveParams",new mr(t,n,o),r.userName):console.error("RoomManager.removeVoxelCube :: SocketRoomContext not found (roomID = ".concat(c.roomID,")"))}(e,t.row,t.col,t.yCenter)},changeVoxelTexture:function(e,t){!function(e,t,n,o,r){var c=e.socket.handshake.auth,a=gr(e);if(!a||!dr.changeVoxelTexture(a,t,n,o,r))return console.error("Voxel update failed (changeVoxelTexture) - row: ".concat(t,", col: ").concat(n,", quadIndex = ").concat(o,", textureIndex = ").concat(r)),void e.addPendingSignal("voxelTextureChangeParams",new br(t,n,o,r));var i=Or.socketRoomContexts[a.roomID];i?i.multicastSignal("voxelTextureChangeParams",new br(t,n,o,r),c.userName):console.error("RoomManager.changeVoxelTexture :: SocketRoomContext not found (roomID = ".concat(a.roomID,")"))}(e,t.row,t.col,t.quadIndex,t.textureIndex)},sendObjectMessage:function(e,t){var n=e.socket.handshake.auth,o=Ir[n.userName];if(null!=o){var r=wr[o];if(null!=r){var c=r.objectRuntimeMemories[t.senderObjectId];if(null!=c)if(c.objectSpawnParams.sourceUserName==n.userName){t.message=t.message.trim().substring(0,32);var a=xr[o];a?a.multicastSignal("objectMessageParams",t,n.userName):console.error("RoomManager.sendObjectMessage :: SocketRoomContext not found (roomID = ".concat(o,")"))}else console.error("RoomManager.sendObjectMessage :: User has no authority to control this object (roomID = ".concat(o,", objectId = ").concat(t.senderObjectId,")"));else console.error("RoomManager.sendObjectMessage :: ObjectRuntimeMemory doesn't exist (roomID = ".concat(o,", objectId = ").concat(t.senderObjectId,")"))}else console.error("RoomManager.sendObjectMessage :: RoomRuntimeMemory doesn't exist (roomID = ".concat(o,")"))}else console.error("RoomManager.sendObjectMessage :: RoomID not found (userName = ".concat(n.userName,")"))},updateObjectTransform:function(e,t,n){var o=e.socket.handshake.auth,r=Ir[o.userName];if(null!=r){var c=wr[r];if(null!=c){var a=c.objectRuntimeMemories[t];if(null!=a)if(a.objectSpawnParams.sourceUserName==o.userName){var i={x:n.x,y:n.z},s=so.tryMoveObject(r,t,i);if(n.x=s.resolvedPos.x,n.z=s.resolvedPos.y,Object.assign(a.objectSpawnParams.transform,n),s.desyncDetected){var u=new yo(t,s.resolvedPos);(l=xr[r])?l.multicastSignal("objectDesyncResolveParams",u):console.error("RoomManager.updateObjectTransform :: SocketRoomContext not found (roomID = ".concat(r,")"))}else{var l;u=new Bn(t,n),(l=xr[r])?l.multicastSignal("objectSyncParams",u,o.userName):console.error("RoomManager.updateObjectTransform :: SocketRoomContext not found (roomID = ".concat(r,")"))}}else console.error("RoomManager.updateObjectTransform :: User has no authority to control this object (roomID = ".concat(r,", objectId = ").concat(t,")"));else console.error("RoomManager.updateObjectTransform :: ObjectRuntimeMemory doesn't exist (roomID = ".concat(r,", objectId = ").concat(t,")"))}else console.error("RoomManager.updateObjectTransform :: RoomRuntimeMemory doesn't exist (roomID = ".concat(r,")"))}else console.error("RoomManager.updateObjectTransform :: RoomID not found (userName = ".concat(o.userName,")"))}};const Or=Sr;var jr=[[0,{signalType:"objectDespawnParams",decode:function(e){return Zo.decode(e)}}],[1,{signalType:"objectDesyncResolveParams",decode:function(e){return yo.decode(e)}}],[2,{signalType:"objectMessageParams",decode:function(e){return Rn.decode(e)}}],[3,{signalType:"objectSpawnParams",decode:function(e){return Oo.decode(e)}}],[4,{signalType:"objectSyncParams",decode:function(e){return Bn.decode(e)}}],[5,{signalType:"roomChangeRequestParams",decode:function(e){return zn.decode(e)}}],[6,{signalType:"roomRuntimeMemory",decode:function(e){return Yo.decode(e)}}],[7,{signalType:"voxelCubeAddParams",decode:function(e){return pr.decode(e)}}],[8,{signalType:"voxelCubeRemoveParams",decode:function(e){return mr.decode(e)}}],[9,{signalType:"voxelTextureChangeParams",decode:function(e){return br.decode(e)}}]],Rr={},kr={};jr.forEach(function(e){if(e[0]<0||e[0]>255)throw new Error("Signal type index is outside of its valid range (".concat(e[0],")"));Rr[e[0]]=e[1],kr[e[1].signalType]=e[0]});const _r=function(e){var t=kr[e];return null==t&&console.error("getIndexByType :: Invalid signal type (signalType = ".concat(e,")")),t},Tr=function(){return jr.map(function(e){return e[0]}).reduce(function(e,t){return t>=e?t:e})},Pr=function(e){this.view=e,this.byteIndex=0};var Er=new ArrayBuffer(65536),Mr=!1;const Nr=function(){if(Mr)throw new Error("WriteBuffer is already reserved.");return Mr=!0,new Pr(new Uint8Array(Er))},Lr=function(e){return Mr||console.error("WriteBuffer is already free."),Mr=!1,e.view.buffer.slice(0,e.byteIndex)},Dr=function(){function e(e){this.socket=e,this.pendingSignalsByTypeIndex=new Array(Tr()+1)}return e.prototype.addPendingSignal=function(e,t){var n=_r(e);if(null!=n){var o=this.pendingSignalsByTypeIndex[n];null==o&&(o=[],this.pendingSignalsByTypeIndex[n]=o),o.push(t)}else console.error("Failed to add the incoming signal. The signal's type is unknown (signalType = ".concat(e,")"))},e.prototype.processAllPendingSignals=function(){for(var e=Nr(),t=0;t<this.pendingSignalsByTypeIndex.length;++t){var n=this.pendingSignalsByTypeIndex[t];n&&n.length>0&&(new Io(t).encode(e),new Vo(n,65535).encode(e),n.length=0)}var o=Lr(e);e.byteIndex>0&&this.socket.emit("signalBatch",o)},e}();var Cr,Ar=function(e,t,n,o){return new(n||(n=Promise))(function(r,c){function a(e){try{s(o.next(e))}catch(e){c(e)}}function i(e){try{s(o.throw(e))}catch(e){c(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,i)}s((o=o.apply(e,t||[])).next())})},Ur=function(e,t){var n,o,r,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=i(0),a.throw=i(1),a.return=i(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,i[0]&&(c=0)),c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!((r=(r=c.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Br={};const qr=function(e,t){(Cr=e.of("/game_sockets")).use(t),Cr.on("connection",function(e){return Ar(void 0,void 0,void 0,function(){var t,n;return Ur(this,function(o){switch(o.label){case 0:return t=new Dr(e),n=e.handshake.auth,console.log("(GameSockets) Client connected :: ".concat(JSON.stringify(n))),null!=Br[n.userName]?(console.error("SocketUserContext with userName already exists (userName = ".concat(n.userName,")")),[2]):(Br[n.userName]=t,e.on("objectSync",function(e){var n=new Pr(new Uint8Array(e)),o=Bn.decode(n);Or.updateObjectTransform(t,o.objectId,o.transform)}),e.on("objectMessage",function(e){var n=new Pr(new Uint8Array(e)),o=Rn.decode(n);Or.sendObjectMessage(t,o)}),e.on("voxelCubeAdd",function(e){var n=new Pr(new Uint8Array(e)),o=pr.decode(n);Or.addVoxelCube(t,o)}),e.on("voxelCubeRemove",function(e){var n=new Pr(new Uint8Array(e)),o=mr.decode(n);Or.removeVoxelCube(t,o)}),e.on("voxelTextureChange",function(e){var n=new Pr(new Uint8Array(e)),o=br.decode(n);Or.changeVoxelTexture(t,o)}),e.on("roomChangeRequest",function(e){return Ar(void 0,void 0,void 0,function(){var n,o;return Ur(this,function(r){switch(r.label){case 0:return n=new Pr(new Uint8Array(e)),o=zn.decode(n),[4,Or.changeUserRoom(t,o.roomID,!0)];case 1:return r.sent(),[2]}})})}),e.on("disconnect",function(){return Ar(void 0,void 0,void 0,function(){return Ur(this,function(e){switch(e.label){case 0:return console.log("(GameSockets) Client disconnected :: ".concat(JSON.stringify(n))),null==Br[n.userName]?(console.error("SocketUserContext with userName doesn't exist (userName = ".concat(n.userName,")")),[2]):(delete Br[n.userName],[4,Or.changeUserRoom(t,void 0,!1)]);case 1:return e.sent(),[2]}})})}),[4,Or.changeUserRoom(t,"s0",!1)]);case 1:return o.sent(),[2]}})})}),setInterval(function(){for(var e=0,t=Object.values(Br);e<t.length;e++)t[e].processAllPendingSignals()},200)},zr=require("cookie");w().config();var Fr=new Set;function Gr(e){return function(t,n){var o=t.request.headers.cookie;if(console.log("Authenticating socket (ID: ".concat(t.id,")")),o){var r=zr.parse(o).thingspool_token;if(r){var c=un(r);c?Fr.has(c.userName)?n(new Error(Q.getErrorPageURL("auth-duplication"))):e(c)?(Fr.add(c.userName),t.on("disconnect",function(){Fr.has(c.userName)?Fr.delete(c.userName):console.error('User "'.concat(c.userName,'" is already disconnected.'))}),t.handshake.auth=c,n()):n(new Error(Q.getErrorPageURL("auth-no-permission"))):n(new Error(Q.getErrorPageURL("auth-failure")))}else n(new Error(Q.getErrorPageURL("auth-failure")))}else n(new Error(Q.getErrorPageURL("auth-failure")))}}w().config(),function(){var e,t,n,o;e=this,t=void 0,o=function(){var e,t;return function(e,t){var n,o,r,c={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=i(0),a.throw=i(1),a.return=i(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,i[0]&&(c=0)),c;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,o=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!((r=(r=c.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){c=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){c.label=i[1];break}if(6===i[0]&&c.label<r[1]){c.label=r[1],r=i;break}if(r&&c.label<r[2]){c.label=r[2],c.ops.push(i);break}r[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,function(n){switch(n.label){case 0:return process.env.SKIP_SSG?[3,4]:"dev"!=process.env.MODE?[3,2]:[4,Jt()];case 1:return n.sent(),[3,4];case 2:return"ssg"!=process.env.MODE?[3,4]:[4,Jt()];case 3:return n.sent(),[2];case 4:return[4,_.runSQLFile("clear.sql")];case 5:return n.sent(),[4,_.runSQLFile("init.sql")];case 6:return n.sent(),e=r()(),t=a().createServer(e),e.set("view engine","ejs"),e.use(s().json()),e.use(s().urlencoded({extended:!0})),e.use(l()()),e.use(d()()),function(e){var t=this;"dev"==process.env.MODE&&(e.get("/",function(e,n){return vn(t,void 0,void 0,function(){var t;return bn(this,function(o){switch(o.label){case 0:return[4,B.read(e.url+"index.html")];case 1:return t=o.sent(),n.status(200).setHeader("content-type","text/html").send(Z.postProcessHTML(t)),[2]}})})}),e.get(/.*\.html$/,function(e,n){return vn(t,void 0,void 0,function(){var t;return bn(this,function(o){switch(o.label){case 0:return[4,B.read(e.url)];case 1:return t=o.sent(),n.status(200).setHeader("content-type","text/html").send(Z.postProcessHTML(t)),[2]}})})}),e.get(/.*\.js$/,function(e,n){return vn(t,void 0,void 0,function(){return bn(this,function(t){return n.status(200).setHeader("content-type","text/javascript").sendFile(B.getAbsoluteFilePath(e.url)),[2]})})}),e.get(/(.*\.css)|(.*\.jpg)|(.*\.png)|(.*\.ico)|(.*\.atom)|(.*\.xml)|(.*\.pdf)|(.*\.glb)$/,function(e,n){return vn(t,void 0,void 0,function(){return bn(this,function(t){return n.sendFile(B.getAbsoluteFilePath(e.url)),[2]})})})),e.use("/api/auth",mn),e.use("/",pn)}(e),t.listen(process.env.PORT,function(){console.log("---------------------------------------------"),console.log("Listening to port ".concat(process.env.PORT,"."))}),function(e){var t=new(wn().Server)(e);E(t,"dev"==process.env.MODE?function(e,t){return t()}:Gr(function(e){return"admin"==e.userType})),qr(t,Gr(function(e){return!0}))}(t),[2]}})},new((n=void 0)||(n=Promise))(function(r,c){function a(e){try{s(o.next(e))}catch(e){c(e)}}function i(e){try{s(o.throw(e))}catch(e){c(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,i)}s((o=o.apply(e,t||[])).next())})}()})();