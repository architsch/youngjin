<%- include(`${ejsChunkRootPath}/common/header_min.ejs`) %>

<h1>Room Page</h1>
<p>Content: <%= textUtil.escapeHTMLChars(JSON.stringify(roomContent)) %></p>

<div class="l_row"></div>
<div class="inlineButton" id="room_members_button">View Members</div>
<div class="m_row"></div>
<div class="inlineButton" id="delete_room_button">Delete Room</div>

<script>
    const roomID = parseInt("<%= roomID %>");

    $("#room_members_button").click(function() {
        if (process_pending)
            return;
        process_pending_on();
        
        $.ajax({
            url: `<%= envUtil.getRootURL() %>/popup/room-members?roomid=<%= roomID %>`,
            method: "GET",
            success: function(data) {
                popup_on(data);
                process_pending_off();
            },
            error: function(xhr) {
                alert(xhr.responseText);
                process_pending_off();
            }
        });
    });

    $("#delete_room_button").click(function() {
        if (process_pending)
            return;
        if (!confirm("Are you sure you want to delete this room? You cannot undo this action."))
            return;
        process_pending_on();
        
        $.ajax({
            url: `<%= envUtil.getRootURL() %>/api/room/delete`,
            method: "DELETE",
            data: { roomID },
            success: function(data) {
                window.location.href = "<%= envUtil.getRootURL() %>/rooms.html";
            },
            error: function(xhr) {
                alert(xhr.responseText);
                process_pending_off();
            }
        });
    });
</script>

<%- include(`${ejsChunkRootPath}/common/footer_min.ejs`) %>